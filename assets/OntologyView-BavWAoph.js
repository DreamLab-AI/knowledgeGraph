import{A as t,_ as e,j as n,__tla as __tla_0}from"./index-BgmvI9JQ.js";import{b as r,i,u as o,k as a,j as s}from"./vendor-Arh2wdvo.js";import{a as l,b as c,_ as u,D as f,V as d,c as h,P as p,d as v,R as g,I as m,F as y,e as b,f as x,W as S,B as w,S as _,g as U,U as k,h as T,M as E,i as C,L as D,j as A,k as M,l as P,m as F,n as O,o as I,p as R,q as L,r as B,T as G,s as z,t as j,v as W,w as N,x as V,H,y as X,z as q,A as $,E as Y,G as K,J as Z,u as Q,C as J,O as tt}from"./useGraphStore-CYnLoR2i.js";import"./fuse-DRqTZInw.js";let Mr;let __tla=Promise.all([(()=>{try{return __tla_0}catch{}})()]).then(async()=>{const et=[];function nt(t,e,n=(t,e)=>t===e){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}const rt=(t,e,n)=>function(t,e=null,n=!1,r={}){null===e&&(e=[t]);for(const a of et)if(nt(e,a.keys,a.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return r.lifespan&&r.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,r.lifespan)),a.response;if(!n)throw a.promise}const i={keys:e,equal:r.equal,remove:()=>{const t=et.indexOf(i);-1!==t&&et.splice(t,1)},promise:(o=t,"object"==typeof o&&"function"==typeof o.then?t:t(...e)).then(t=>{i.response=t,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(t=>i.error=t)};var o;if(et.push(i),!n)throw i.promise}(t,e,!1,n),it=new d,ot=new d,at=new d,st=new h;function lt(t,e,n){const r=it.setFromMatrixPosition(t.matrixWorld);r.project(e);const i=n.width/2,o=n.height/2;return[r.x*i+i,-r.y*o+o]}const ct=t=>Math.abs(t)<1e-10?0:t;function ut(t,e,n=""){let r="matrix3d(";for(let i=0;16!==i;i++)r+=ct(e[i]*t.elements[i])+(15!==i?",":")");return n+r}const ft=(dt=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],t=>ut(t,dt));var dt;const ht=(t,e)=>{return ut(t,[1/(n=e),1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1],"translate(-50%,-50%)");var n};const pt=r.forwardRef(({children:e,eps:n=.001,style:i,className:o,prepend:a,center:s,fullscreen:h,portal:g,distanceFactor:m,sprite:y=!1,transform:b=!1,occlude:x,onOcclude:S,castShadow:w,receiveShadow:_,material:U,geometry:k,zIndexRange:T=[0x1000037,0],calculatePosition:E=lt,as:C="div",wrapperClass:D,pointerEvents:A="auto",...M},P)=>{const{gl:F,camera:O,scene:I,size:R,raycaster:L,events:B,viewport:G}=l(),[z]=r.useState(()=>document.createElement(C)),j=r.useRef(null),W=r.useRef(null),N=r.useRef(0),V=r.useRef([0,0]),H=r.useRef(null),X=r.useRef(null),q=(null==g?void 0:g.current)||B.connected||F.domElement.parentNode,$=r.useRef(null),Y=r.useRef(!1),K=r.useMemo(()=>x&&"blending"!==x||Array.isArray(x)&&x.length&&function(t){return t&&"object"==typeof t&&"current"in t}(x[0]),[x]);r.useLayoutEffect(()=>{const t=F.domElement;x&&"blending"===x?(t.style.zIndex=`${Math.floor(T[0]/2)}`,t.style.position="absolute",t.style.pointerEvents="none"):(t.style.zIndex=null,t.style.position=null,t.style.pointerEvents=null)},[x]),r.useLayoutEffect(()=>{if(W.current){const e=j.current=t.createRoot(z);if(I.updateMatrixWorld(),b)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const t=E(W.current,O,R);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${t[0]}px,${t[1]}px,0);transform-origin:0 0;`}return q&&(a?q.prepend(z):q.appendChild(z)),()=>{q&&q.removeChild(z),e.unmount()}}},[q,b]),r.useLayoutEffect(()=>{D&&(z.className=D)},[D]);const Z=r.useMemo(()=>b?{position:"absolute",top:0,left:0,width:R.width,height:R.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...h&&{top:-R.height/2,left:-R.width/2,width:R.width,height:R.height},...i},[i,s,h,R,b]),Q=r.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);r.useLayoutEffect(()=>{var t,n;(Y.current=!1,b)?null==(t=j.current)||t.render(r.createElement("div",{ref:H,style:Z},r.createElement("div",{ref:X,style:Q},r.createElement("div",{ref:P,className:o,style:i,children:e})))):null==(n=j.current)||n.render(r.createElement("div",{ref:P,style:Z,className:o,children:e}))});const J=r.useRef(!0);c(t=>{if(W.current){O.updateMatrixWorld(),W.current.updateWorldMatrix(!0,!1);const t=b?V.current:E(W.current,O,R);if(b||Math.abs(N.current-O.zoom)>n||Math.abs(V.current[0]-t[0])>n||Math.abs(V.current[1]-t[1])>n){const e=function(t,e){const n=it.setFromMatrixPosition(t.matrixWorld),r=ot.setFromMatrixPosition(e.matrixWorld),i=n.sub(r),o=e.getWorldDirection(at);return i.angleTo(o)>Math.PI/2}(W.current,O);let n=!1;K&&(Array.isArray(x)?n=x.map(t=>t.current):"blending"!==x&&(n=[I]));const r=J.current;if(n){const t=function(t,e,n,r){const i=it.setFromMatrixPosition(t.matrixWorld),o=i.clone();o.project(e),st.set(o.x,o.y),n.setFromCamera(st,e);const a=n.intersectObjects(r,!0);if(a.length){const t=a[0].distance;return i.distanceTo(n.ray.origin)<t}return!0}(W.current,O,L,n);J.current=t&&!e}else J.current=!e;r!==J.current&&(S?S(!J.current):z.style.display=J.current?"block":"none");const i=Math.floor(T[0]/2),o=x?K?[T[0],i]:[i-1,0]:T;if(z.style.zIndex=`${function(t,e,n){if(e instanceof p||e instanceof v){const r=it.setFromMatrixPosition(t.matrixWorld),i=ot.setFromMatrixPosition(e.matrixWorld),o=r.distanceTo(i),a=(n[1]-n[0])/(e.far-e.near),s=n[1]-a*e.far;return Math.round(a*o+s)}}(W.current,O,o)}`,b){const[t,e]=[R.width/2,R.height/2],n=O.projectionMatrix.elements[5]*e,{isOrthographicCamera:r,top:i,left:o,bottom:a,right:s}=O,l=ft(O.matrixWorldInverse),c=r?`scale(${n})translate(${ct(-(s+o)/2)}px,${ct((i+a)/2)}px)`:`translateZ(${n}px)`;let u=W.current.matrixWorld;y&&(u=O.matrixWorldInverse.clone().transpose().copyPosition(u).scale(W.current.scale),u.elements[3]=u.elements[7]=u.elements[11]=0,u.elements[15]=1),z.style.width=R.width+"px",z.style.height=R.height+"px",z.style.perspective=r?"":`${n}px`,H.current&&X.current&&(H.current.style.transform=`${c}${l}translate(${t}px,${e}px)`,X.current.style.transform=ht(u,1/((m||10)/400)))}else{const e=void 0===m?1:function(t,e){if(e instanceof v)return e.zoom;if(e instanceof p){const n=it.setFromMatrixPosition(t.matrixWorld),r=ot.setFromMatrixPosition(e.matrixWorld),i=e.fov*Math.PI/180,o=n.distanceTo(r);return 1/(2*Math.tan(i/2)*o)}return 1}(W.current,O)*m;z.style.transform=`translate3d(${t[0]}px,${t[1]}px,0) scale(${e})`}V.current=t,N.current=O.zoom}}if(!K&&$.current&&!Y.current)if(b){if(H.current){const t=H.current.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const{isOrthographicCamera:e}=O;if(e||k)M.scale&&(Array.isArray(M.scale)?M.scale instanceof d?$.current.scale.copy(M.scale.clone().divideScalar(1)):$.current.scale.set(1/M.scale[0],1/M.scale[1],1/M.scale[2]):$.current.scale.setScalar(1/M.scale));else{const e=(m||10)/400,n=t.clientWidth*e,r=t.clientHeight*e;$.current.scale.set(n,r,1)}Y.current=!0}}}else{const e=z.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const t=1/G.factor,n=e.clientWidth*t,r=e.clientHeight*t;$.current.scale.set(n,r,1),Y.current=!0}$.current.lookAt(t.camera.position)}});const tt=r.useMemo(()=>({vertexShader:b?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "}),[b]);return r.createElement("group",u({},M,{ref:W}),x&&!K&&r.createElement("mesh",{castShadow:w,receiveShadow:_,ref:$},k||r.createElement("planeGeometry",null),U||r.createElement("shaderMaterial",{side:f,vertexShader:tt.vertexShader,fragmentShader:tt.fragmentShader})))});const vt={toVector:(t,e)=>(void 0===t&&(t=e),Array.isArray(t)?t:[t,t]),add:(t,e)=>[t[0]+e[0],t[1]+e[1]],sub:(t,e)=>[t[0]-e[0],t[1]-e[1]],addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function gt(t,e,n){return 0===e||Math.abs(e)===1/0?Math.pow(t,5*n):t*e*n/(e+n*t)}function mt(t,e,n,r=.15){return 0===r?function(t,e,n){return Math.max(e,Math.min(t,n))}(t,e,n):t<e?-gt(e-t,n-e,r)+e:t>n?+gt(t-n,n-e,r)+n:t}function yt(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function bt(t,e,n){return(e=yt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function St(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xt(Object(n),!0).forEach(function(e){bt(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const wt={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function _t(t){return t?t[0].toUpperCase()+t.slice(1):""}const Ut=["enter","leave"];function kt(t,e="",n=!1){const r=wt[t],i=r&&r[e]||e;return"on"+_t(t)+_t(i)+(function(t=!1,e){return t&&!Ut.includes(e)}(n,i)?"Capture":"")}const Tt=["gotpointercapture","lostpointercapture"];function Et(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=Tt.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function Ct(t){return"touches"in t}function Dt(t){return Ct(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function At(t){return Ct(t)?function(t){return"touchend"===t.type||"touchcancel"===t.type?t.changedTouches:t.targetTouches}(t)[0]:t}function Mt(t,e){try{const n=e.clientX-t.clientX,r=e.clientY-t.clientY,i=(e.clientX+t.clientX)/2,o=(e.clientY+t.clientY)/2,a=Math.hypot(n,r),s=-180*Math.atan2(n,r)/Math.PI;return{angle:s,distance:a,origin:[i,o]}}catch(n){}return null}function Pt(t){return function(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||(null===(n=t.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,e.target))})}(t).map(t=>t.identifier)}function Ft(t,e){const[n,r]=Array.from(t.touches).filter(t=>e.includes(t.identifier));return Mt(n,r)}function Ot(t){const e=At(t);return Ct(t)?e.identifier:e.pointerId}function It(t){const e=At(t);return[e.clientX,e.clientY]}function Rt(t){let{deltaX:e,deltaY:n,deltaMode:r}=t;return 1===r?(e*=40,n*=40):2===r&&(e*=800,n*=800),[e,n]}function Lt(t,...e){return"function"==typeof t?t(...e):t}function Bt(){}function Gt(...t){return 0===t.length?Bt:1===t.length?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function zt(t,e){return Object.assign({},e,t||{})}class jt{constructor(t,e,n){this.ctrl=t,this.args=e,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:e,ingKey:n,args:r}=this;e[n]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=r,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const e=this.state,n=this.config;e._active||(this.reset(),this.computeInitial(),e._active=!0,e.target=t.target,e.currentTarget=t.currentTarget,e.lastOffset=n.from?Lt(n.from,e):e.offset,e.offset=e.lastOffset,e.startTime=e.timeStamp=t.timeStamp)}computeValues(t){const e=this.state;e._values=t,e.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:e,config:n,shared:r}=this;e.args=this.args;let i=0;if(t&&(e.event=t,n.preventDefault&&t.cancelable&&e.event.preventDefault(),e.type=t.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return e}(t)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=t.timeStamp-e.timeStamp,e.timeStamp=t.timeStamp,e.elapsedTime=e.timeStamp-e.startTime),e._active){const t=e._delta.map(Math.abs);vt.addTo(e._distance,t)}this.axisIntent&&this.axisIntent(t);const[o,a]=e._movement,[s,l]=n.threshold,{_step:c,values:u}=e;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=s&&u[0]),!1===c[1]&&(c[1]=Math.abs(a)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=s&&Math.sign(o)*s),!1===c[1]&&(c[1]=Math.abs(a)>=l&&Math.sign(a)*l)),e.intentional=!1!==c[0]||!1!==c[1],!e.intentional)return;const f=[0,0];if(n.hasCustomTransform){const[t,e]=u;f[0]=!1!==c[0]?t-c[0]:0,f[1]=!1!==c[1]?e-c[1]:0}else f[0]=!1!==c[0]?o-c[0]:0,f[1]=!1!==c[1]?a-c[1]:0;this.restrictToAxis&&!e._blocked&&this.restrictToAxis(f);const d=e.offset,h=e._active&&!e._blocked||e.active;h&&(e.first=e._active&&!e.active,e.last=!e._active&&e.active,e.active=r[this.ingKey]=e._active,t&&(e.first&&("bounds"in n&&(e._bounds=Lt(n.bounds,e)),this.setup&&this.setup()),e.movement=f,this.computeOffset()));const[p,v]=e.offset,[[g,m],[y,b]]=e._bounds;e.overflow=[p<g?-1:p>m?1:0,v<y?-1:v>b?1:0],e._movementBound[0]=!!e.overflow[0]&&(!1===e._movementBound[0]?e._movement[0]:e._movementBound[0]),e._movementBound[1]=!!e.overflow[1]&&(!1===e._movementBound[1]?e._movement[1]:e._movementBound[1]);const x=e._active&&n.rubberband||[0,0];if(e.offset=function(t,[e,n],[r,i]){const[[o,a],[s,l]]=t;return[mt(e,o,a,r),mt(n,s,l,i)]}(e._bounds,e.offset,x),e.delta=vt.sub(e.offset,d),this.computeMovement(),h&&(!e.last||i>32)){e.delta=vt.sub(e.offset,d);const t=e.delta.map(Math.abs);vt.addTo(e.distance,t),e.direction=e.delta.map(Math.sign),e._direction=e._delta.map(Math.sign),!e.first&&i>0&&(e.velocity=[t[0]/i,t[1]/i],e.timeDelta=i)}}emit(){const t=this.state,e=this.shared,n=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!n.triggerAllEvents)return;const r=this.handler(St(St(St({},e),t),{},{[this.aliasKey]:t.values}));void 0!==r&&(t.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class Wt extends jt{constructor(...t){super(...t),bt(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=vt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=vt.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const e=this.state,n=this.config;if(!e.axis&&t){const r="object"==typeof n.axisThreshold?n.axisThreshold[Dt(t)]:n.axisThreshold;e.axis=function([t,e],n){const r=Math.abs(t),i=Math.abs(e);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}(e._movement,r)}e._blocked=(n.lockDirection||!!n.axis)&&!e.axis||!!n.axis&&n.axis!==e.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0}}}const Nt=t=>t,Vt={enabled:(t=!0)=>t,eventOptions:(t,e,n)=>St(St({},n.shared.eventOptions),t),preventDefault:(t=!1)=>t,triggerAllEvents:(t=!1)=>t,rubberband(t=0){switch(t){case!0:return[.15,.15];case!1:return[0,0];default:return vt.toVector(t)}},from:t=>"function"==typeof t?t:null!=t?vt.toVector(t):void 0,transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||Nt},threshold:t=>vt.toVector(t,0)},Ht=St(St({},Vt),{},{axis(t,e,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(t=0)=>t,bounds(t={}){if("function"==typeof t)return e=>Ht.bounds(t(e));if("current"in t)return()=>t.current;if("function"==typeof HTMLElement&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=t;return[[e,n],[r,i]]}}),Xt={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};const qt="undefined"!=typeof window&&window.document&&window.document.createElement;function $t(){return qt&&"ontouchstart"in window}const Yt={isBrowser:qt,gesture:function(){try{return"constructor"in GestureEvent}catch(t){return!1}}(),touch:$t(),touchscreen:$t()||qt&&window.navigator.maxTouchPoints>1,pointer:qt&&"onpointerdown"in window,pointerLock:qt&&"exitPointerLock"in window.document},Kt={mouse:0,touch:0,pen:8},Zt=St(St({},Ht),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Yt.pointerLock,Yt.touch&&n?"touch":this.pointerLock?"mouse":Yt.pointer&&!i?"pointer":Yt.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&t?250:void 0,Yt.touchscreen&&!1!==n)return t||(void 0!==n?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){const o=vt.toVector(t,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:t=.5,distance:e=50,duration:n=250}={}){return{velocity:this.transform(vt.toVector(t)),distance:this.transform(vt.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return 180;case!1:return 0;default:return t}},axisThreshold:t=>t?St(St({},Kt),t):Kt,keyboardDisplacement:(t=10)=>t});function Qt(t){const[e,n]=t.overflow,[r,i]=t._delta,[o,a]=t._direction;(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&i>0&&a<0||n>0&&i<0&&a>0)&&(t._movement[1]=t._movementBound[1])}const Jt=St(St({},Vt),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!Yt.touch&&Yt.gesture)return"gesture";if(Yt.touch&&r)return"touch";if(Yt.touchscreen){if(Yt.pointer)return"pointer";if(Yt.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const i=t=>{const e=zt(Lt(n,t),{min:-1/0,max:1/0});return[e.min,e.max]},o=t=>{const e=zt(Lt(r,t),{min:-1/0,max:1/0});return[e.min,e.max]};return"function"!=typeof n&&"function"!=typeof r?[i(),o()]:t=>[i(t),o(t)]},threshold(t,e,n){this.lockDirection="lock"===n.axis;return vt.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey:t=>void 0===t?"ctrlKey":t,pinchOnWheel:(t=!0)=>t});const te=St(St({},Ht),{},{mouseOnly:(t=!0)=>t});const ee=Ht;const ne=Ht;const re=St(St({},Ht),{},{mouseOnly:(t=!0)=>t}),ie=new Map,oe=new Map;function ae(t){ie.set(t.key,t.engine),oe.set(t.key,t.resolver)}const se={key:"drag",engine:class extends Wt{constructor(...t){super(...t),bt(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const e=t._bounds.getBoundingClientRect(),n=t.currentTarget.getBoundingClientRect(),r={left:e.left-n.left+t.offset[0],right:e.right-n.right+t.offset[0],top:e.top-n.top+t.offset[1],bottom:e.bottom-n.bottom+t.offset[1]};t._bounds=Ht.bounds(r)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const e=this.config,n=this.state;if(null!=t.buttons&&(Array.isArray(e.pointerButtons)?!e.pointerButtons.includes(t.buttons):-1!==e.pointerButtons&&e.pointerButtons!==t.buttons))return;const r=this.ctrl.setEventIds(t);e.pointerCapture&&t.target.setPointerCapture(t.pointerId),r&&r.size>1&&n._pointerActive||(this.start(t),this.setupPointer(t),n._pointerId=Ot(t),n._pointerActive=!0,this.computeValues(It(t)),this.computeInitial(),e.preventScrollAxis&&"mouse"!==Dt(t)?(n._active=!1,this.setupScrollPrevention(t)):e.delay>0?(this.setupDelayTrigger(t),e.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const e=this.state;e._active=!0,e._preventScroll=!0,e._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const e=this.state,n=this.config;if(!e._pointerActive)return;const r=Ot(t);if(void 0!==e._pointerId&&r!==e._pointerId)return;const i=It(t);return document.pointerLockElement===t.target?e._delta=[t.movementX,t.movementY]:(e._delta=vt.sub(i,e._values),this.computeValues(i)),vt.addTo(e._movement,e._delta),this.compute(t),e._delayed&&e.intentional?(this.timeoutStore.remove("dragDelay"),e.active=!1,void this.startPointerDrag(t)):n.preventScrollAxis&&!e._preventScroll?e.axis?e.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(e._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(t)):void 0:void this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch(a){}const e=this.state,n=this.config;if(!e._active||!e._pointerActive)return;const r=Ot(t);if(void 0!==e._pointerId&&r!==e._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[i,o]=e._distance;if(e.tap=i<=n.tapsThreshold&&o<=n.tapsThreshold,e.tap&&n.filterTaps)e._force=!0;else{const[t,r]=e._delta,[i,o]=e._movement,[a,s]=n.swipe.velocity,[l,c]=n.swipe.distance,u=n.swipe.duration;if(e.elapsedTime<u){const n=Math.abs(t/e.timeDelta),u=Math.abs(r/e.timeDelta);n>a&&Math.abs(i)>l&&(e.swipe[0]=Math.sign(t)),u>s&&Math.abs(o)>c&&(e.swipe[1]=Math.sign(r))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const e=this.config,n=e.device;e.pointerLock&&t.currentTarget.requestPointerLock(),e.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,function(t){"persist"in t&&"function"==typeof t.persist&&t.persist()}(t);const e=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",e),this.eventStore.add(this.sharedConfig.window,"touch","cancel",e),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const e=Xt[t.key];if(e){const n=this.state,r=t.shiftKey?10:t.altKey?.1:1;this.start(t),n._delta=e(this.config.keyboardDisplacement,r),n._keyboardActive=!0,vt.addTo(n._movement,n._delta),this.compute(t),this.emit()}}keyUp(t){t.key in Xt&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const e=this.config.device;t(e,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(e,"change",this.pointerMove.bind(this)),t(e,"end",this.pointerUp.bind(this)),t(e,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}},resolver:Zt},le={key:"hover",engine:class extends Wt{constructor(...t){super(...t),bt(this,"ingKey","hovering")}enter(t){this.config.mouseOnly&&"mouse"!==t.pointerType||(this.start(t),this.computeValues(It(t)),this.compute(t),this.emit())}leave(t){if(this.config.mouseOnly&&"mouse"!==t.pointerType)return;const e=this.state;if(!e._active)return;e._active=!1;const n=It(t);e._movement=e._delta=vt.sub(n,e._values),this.computeValues(n),this.compute(t),e.delta=e.movement,this.emit()}bind(t){t("pointer","enter",this.enter.bind(this)),t("pointer","leave",this.leave.bind(this))}},resolver:re},ce={key:"move",engine:class extends Wt{constructor(...t){super(...t),bt(this,"ingKey","moving")}move(t){this.config.mouseOnly&&"mouse"!==t.pointerType||(this.state._active?this.moveChange(t):this.moveStart(t),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(t){this.start(t),this.computeValues(It(t)),this.compute(t),this.computeInitial(),this.emit()}moveChange(t){if(!this.state._active)return;const e=It(t),n=this.state;n._delta=vt.sub(e,n._values),vt.addTo(n._movement,n._delta),this.computeValues(e),this.compute(t),this.emit()}moveEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}bind(t){t("pointer","change",this.move.bind(this)),t("pointer","leave",this.moveEnd.bind(this))}},resolver:te},ue={key:"pinch",engine:class extends jt{constructor(...t){super(...t),bt(this,"ingKey","pinching"),bt(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:e,lastOffset:n}=this.state;this.state.offset="wheel"===t?vt.add(e,n):[(1+e[0])*n[0],e[1]+n[1]]}computeMovement(){const{offset:t,lastOffset:e}=this.state;this.state.movement=[t[0]/e[0],t[1]-e[1]]}axisIntent(){const t=this.state,[e,n]=t._movement;if(!t.axis){const r=30*Math.abs(e)-Math.abs(n);r<0?t.axis="angle":r>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&("scale"===this.state.axis?t[1]=0:"angle"===this.state.axis&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const e=this.state,n=this.ctrl.touchIds;if(e._active&&e._touchIds.every(t=>n.has(t)))return;if(n.size<2)return;this.start(t),e._touchIds=Array.from(n).slice(0,2);const r=Ft(t,e._touchIds);r&&this.pinchStart(t,r)}pointerStart(t){if(null!=t.buttons&&t.buttons%2!=1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const e=this.state,n=e._pointerEvents,r=this.ctrl.pointerIds;if(e._active&&Array.from(n.keys()).every(t=>r.has(t)))return;if(n.size<2&&n.set(t.pointerId,t),e._pointerEvents.size<2)return;this.start(t);const i=Mt(...Array.from(n.values()));i&&this.pinchStart(t,i)}pinchStart(t,e){this.state.origin=e.origin,this.computeValues([e.distance,e.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const e=Ft(t,this.state._touchIds);e&&this.pinchMove(t,e)}pointerMove(t){const e=this.state._pointerEvents;if(e.has(t.pointerId)&&e.set(t.pointerId,t),!this.state._active)return;const n=Mt(...Array.from(e.values()));n&&this.pinchMove(t,n)}pinchMove(t,e){const n=this.state,r=n._values[1],i=e.angle-r;let o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([e.distance,e.angle-360*o]),n.origin=e.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const e=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch(n){}e._pointerEvents.has(t.pointerId)&&e._pointerEvents.delete(t.pointerId),e._active&&e._pointerEvents.size<2&&(e._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const e=this.state;e._active||(this.start(t),this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const e=this.state;this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY];const n=e._movement;e._movement=[t.scale-1,t.rotation],e._delta=vt.sub(e._movement,n),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const e=this.config.modifierKey;e&&!(Array.isArray(e)?e.find(e=>t[e]):t[e])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const e=this.state;e._delta=[-Rt(t)[1]/100*e.offset[0],0],vt.addTo(e._movement,e._delta),Qt(e),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const e=this.config.device;e&&(t(e,"start",this[e+"Start"].bind(this)),t(e,"change",this[e+"Move"].bind(this)),t(e,"end",this[e+"End"].bind(this)),t(e,"cancel",this[e+"End"].bind(this)),t("lostPointerCapture","",this[e+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:Jt},fe={key:"scroll",engine:class extends Wt{constructor(...t){super(...t),bt(this,"ingKey","scrolling")}scroll(t){this.state._active||this.start(t),this.scrollChange(t),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(t){t.cancelable&&t.preventDefault();const e=this.state,n=function(t){var e,n;const{scrollX:r,scrollY:i,scrollLeft:o,scrollTop:a}=t.currentTarget;return[null!==(e=null!=r?r:o)&&void 0!==e?e:0,null!==(n=null!=i?i:a)&&void 0!==n?n:0]}(t);e._delta=vt.sub(n,e._values),vt.addTo(e._movement,e._delta),this.computeValues(n),this.compute(t),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("scroll","",this.scroll.bind(this))}},resolver:ee},de={key:"wheel",engine:class extends Wt{constructor(...t){super(...t),bt(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const e=this.state;e._delta=Rt(t),vt.addTo(e._movement,e._delta),Qt(e),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}},resolver:ne};function he(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}const pe={target(t){if(t)return()=>"current"in t?t.current:t},enabled:(t=!0)=>t,window:(t=(Yt.isBrowser?window:void 0))=>t,eventOptions:({passive:t=!0,capture:e=!1}={})=>({passive:t,capture:e}),transform:t=>t},ve=["target","eventOptions","window","enabled","transform"];function ge(t={},e){const n={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":n[r]=i.call(n,t[r],r,t);break;case"object":n[r]=ge(t[r],i);break;case"boolean":i&&(n[r]=t[r])}return n}class me{constructor(t,e){bt(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=e}add(t,e,n,r,i){const o=this._listeners,a=function(t,e=""){const n=wt[t];return t+(n&&n[e]||e)}(e,n),s=St(St({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);t.addEventListener(a,r,s);const l=()=>{t.removeEventListener(a,r,s),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}}class ye{constructor(){bt(this,"_timeouts",new Map)}add(t,e,n=140,...r){this.remove(t),this._timeouts.set(t,window.setTimeout(e,n,...r))}remove(t){const e=this._timeouts.get(t);e&&window.clearTimeout(e)}clean(){this._timeouts.forEach(t=>{window.clearTimeout(t)}),this._timeouts.clear()}}class be{constructor(t){bt(this,"gestures",new Set),bt(this,"_targetEventStore",new me(this)),bt(this,"gestureEventStores",{}),bt(this,"gestureTimeoutStores",{}),bt(this,"handlers",{}),bt(this,"config",{}),bt(this,"pointerIds",new Set),bt(this,"touchIds",new Set),bt(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(t,e){e.drag&&xe(t,"drag");e.wheel&&xe(t,"wheel");e.scroll&&xe(t,"scroll");e.move&&xe(t,"move");e.pinch&&xe(t,"pinch");e.hover&&xe(t,"hover")}(this,t)}setEventIds(t){return Ct(t)?(this.touchIds=new Set(Pt(t)),this.touchIds):"pointerId"in t?("pointerup"===t.type||"pointercancel"===t.type?this.pointerIds.delete(t.pointerId):"pointerdown"===t.type&&this.pointerIds.add(t.pointerId),this.pointerIds):void 0}applyHandlers(t,e){this.handlers=t,this.nativeHandlers=e}applyConfig(t,e){this.config=function(t,e,n={}){const r=t,{target:i,eventOptions:o,window:a,enabled:s,transform:l}=r,c=he(r,ve);if(n.shared=ge({target:i,eventOptions:o,window:a,enabled:s,transform:l},pe),e){const t=oe.get(e);n[e]=ge(St({shared:n.shared},c),t)}else for(const u in c){const t=oe.get(u);t&&(n[u]=ge(St({shared:n.shared},c[u]),t))}return n}(t,e,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const e=this.config.shared,n={};let r;if(!e.target||(r=e.target(),r)){if(e.enabled){for(const e of this.gestures){const i=this.config[e],o=Se(n,i.eventOptions,!!r);if(i.enabled){new(ie.get(e))(this,t,e).bind(o)}}const i=Se(n,e.eventOptions,!!r);for(const e in this.nativeHandlers)i(e,"",n=>this.nativeHandlers[e](St(St({},this.state.shared),{},{event:n,args:t})),void 0,!0)}for(const t in n)n[t]=Gt(...n[t]);if(!r)return n;for(const t in n){const{device:e,capture:i,passive:o}=Et(t);this._targetEventStore.add(r,e,"",n[t],{capture:i,passive:o})}}}}function xe(t,e){t.gestures.add(e),t.gestureEventStores[e]=new me(t,e),t.gestureTimeoutStores[e]=new ye}const Se=(t,e,n)=>(r,i,o,a={},s=!1)=>{var l,c;const u=null!==(l=a.capture)&&void 0!==l?l:e.capture,f=null!==(c=a.passive)&&void 0!==c?c:e.passive;let d=s?r:kt(r,i,u);n&&f&&(d+="Passive"),t[d]=t[d]||[],t[d].push(o)},we=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function _e(t,e,n,r,i,o){if(!t.has(n))return;if(!ie.has(r))return;const a=n+"Start",s=n+"End";i[r]=t=>{let r;return t.first&&a in e&&e[a](t),n in e&&(r=e[n](t)),t.last&&s in e&&e[s](t),r},o[r]=o[r]||{}}function Ue(t,e){const[n,r,i]=function(t){const e={},n={},r=new Set;for(let i in t)we.test(i)?(r.add(RegExp.lastMatch),n[i]=t[i]):e[i]=t[i];return[n,e,r]}(t),o={};return _e(i,n,"onDrag","drag",o,e),_e(i,n,"onWheel","wheel",o,e),_e(i,n,"onScroll","scroll",o,e),_e(i,n,"onPinch","pinch",o,e),_e(i,n,"onMove","move",o,e),_e(i,n,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:r}}function ke(t){return t.forEach(ae),function(t,e){const{handlers:n,nativeHandlers:r,config:o}=Ue(t,e||{});return function(t,e={},n,r){const o=i.useMemo(()=>new be(t),[]);if(o.applyHandlers(t,r),o.applyConfig(e,n),i.useEffect(o.effect.bind(o)),i.useEffect(()=>o.clean.bind(o),[]),void 0===e.target)return o.bind.bind(o)}(n,o,void 0,r)}}const Te=(()=>parseInt(g.replace(/\D+/g,"")))(),Ee=Te>=125?"uv1":"uv2",Ce=new w,De=new d;class Ae extends m{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new y([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new y([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(t){const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const n=new b(e,6,1);return this.setAttribute("instanceStart",new x(n,3,0)),this.setAttribute("instanceEnd",new x(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t,e=3){let n;t instanceof Float32Array?n=t:Array.isArray(t)&&(n=new Float32Array(t));const r=new b(n,2*e,1);return this.setAttribute("instanceColorStart",new x(r,e,0)),this.setAttribute("instanceColorEnd",new x(r,e,e)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new S(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new w);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),Ce.setFromBufferAttribute(e),this.boundingBox.union(Ce))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new _),null===this.boundingBox&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let i=0,o=t.count;i<o;i++)De.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(De)),De.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(De));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)}}toJSON(){}applyMatrix(t){return this.applyMatrix4(t)}}class Me extends Ae{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const e=t.length-3,n=new Float32Array(2*e);for(let r=0;r<e;r+=3)n[2*r]=t[r],n[2*r+1]=t[r+1],n[2*r+2]=t[r+2],n[2*r+3]=t[r+3],n[2*r+4]=t[r+4],n[2*r+5]=t[r+5];return super.setPositions(n),this}setColors(t,e=3){const n=t.length-e,r=new Float32Array(2*n);if(3===e)for(let i=0;i<n;i+=e)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5];else for(let i=0;i<n;i+=e)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5],r[2*i+6]=t[i+6],r[2*i+7]=t[i+7];return super.setColors(r,e),this}fromLine(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}}class Pe extends U{constructor(t){super({type:"LineMaterial",uniforms:k.clone(k.merge([T.common,T.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new h(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n				#include <common>\n				#include <fog_pars_vertex>\n				#include <logdepthbuf_pars_vertex>\n				#include <clipping_planes_pars_vertex>\n\n				uniform float linewidth;\n				uniform vec2 resolution;\n\n				attribute vec3 instanceStart;\n				attribute vec3 instanceEnd;\n\n				#ifdef USE_COLOR\n					#ifdef USE_LINE_COLOR_ALPHA\n						varying vec4 vLineColor;\n						attribute vec4 instanceColorStart;\n						attribute vec4 instanceColorEnd;\n					#else\n						varying vec3 vLineColor;\n						attribute vec3 instanceColorStart;\n						attribute vec3 instanceColorEnd;\n					#endif\n				#endif\n\n				#ifdef WORLD_UNITS\n\n					varying vec4 worldPos;\n					varying vec3 worldStart;\n					varying vec3 worldEnd;\n\n					#ifdef USE_DASH\n\n						varying vec2 vUv;\n\n					#endif\n\n				#else\n\n					varying vec2 vUv;\n\n				#endif\n\n				#ifdef USE_DASH\n\n					uniform float dashScale;\n					attribute float instanceDistanceStart;\n					attribute float instanceDistanceEnd;\n					varying float vLineDistance;\n\n				#endif\n\n				void trimSegment( const in vec4 start, inout vec4 end ) {\n\n					// trim end segment so it terminates between the camera plane and the near plane\n\n					// conservative estimate of the near plane\n					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n					float nearEstimate = - 0.5 * b / a;\n\n					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n					end.xyz = mix( start.xyz, end.xyz, alpha );\n\n				}\n\n				void main() {\n\n					#ifdef USE_COLOR\n\n						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n					#endif\n\n					#ifdef USE_DASH\n\n						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n						vUv = uv;\n\n					#endif\n\n					float aspect = resolution.x / resolution.y;\n\n					// camera space\n					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n					#ifdef WORLD_UNITS\n\n						worldStart = start.xyz;\n						worldEnd = end.xyz;\n\n					#else\n\n						vUv = uv;\n\n					#endif\n\n					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n					// perhaps there is a more elegant solution -- WestLangley\n\n					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n					if ( perspective ) {\n\n						if ( start.z < 0.0 && end.z >= 0.0 ) {\n\n							trimSegment( start, end );\n\n						} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n							trimSegment( end, start );\n\n						}\n\n					}\n\n					// clip space\n					vec4 clipStart = projectionMatrix * start;\n					vec4 clipEnd = projectionMatrix * end;\n\n					// ndc space\n					vec3 ndcStart = clipStart.xyz / clipStart.w;\n					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n					// direction\n					vec2 dir = ndcEnd.xy - ndcStart.xy;\n\n					// account for clip-space aspect ratio\n					dir.x *= aspect;\n					dir = normalize( dir );\n\n					#ifdef WORLD_UNITS\n\n						// get the offset direction as perpendicular to the view vector\n						vec3 worldDir = normalize( end.xyz - start.xyz );\n						vec3 offset;\n						if ( position.y < 0.5 ) {\n\n							offset = normalize( cross( start.xyz, worldDir ) );\n\n						} else {\n\n							offset = normalize( cross( end.xyz, worldDir ) );\n\n						}\n\n						// sign flip\n						if ( position.x < 0.0 ) offset *= - 1.0;\n\n						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n						// don't extend the line if we're rendering dashes because we\n						// won't be rendering the endcaps\n						#ifndef USE_DASH\n\n							// extend the line bounds to encompass  endcaps\n							start.xyz += - worldDir * linewidth * 0.5;\n							end.xyz += worldDir * linewidth * 0.5;\n\n							// shift the position of the quad so it hugs the forward edge of the line\n							offset.xy -= dir * forwardOffset;\n							offset.z += 0.5;\n\n						#endif\n\n						// endcaps\n						if ( position.y > 1.0 || position.y < 0.0 ) {\n\n							offset.xy += dir * 2.0 * forwardOffset;\n\n						}\n\n						// adjust for linewidth\n						offset *= linewidth * 0.5;\n\n						// set the world position\n						worldPos = ( position.y < 0.5 ) ? start : end;\n						worldPos.xyz += offset;\n\n						// project the worldpos\n						vec4 clip = projectionMatrix * worldPos;\n\n						// shift the depth of the projected points so the line\n						// segments overlap neatly\n						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n						clip.z = clipPose.z * clip.w;\n\n					#else\n\n						vec2 offset = vec2( dir.y, - dir.x );\n						// undo aspect ratio adjustment\n						dir.x /= aspect;\n						offset.x /= aspect;\n\n						// sign flip\n						if ( position.x < 0.0 ) offset *= - 1.0;\n\n						// endcaps\n						if ( position.y < 0.0 ) {\n\n							offset += - dir;\n\n						} else if ( position.y > 1.0 ) {\n\n							offset += dir;\n\n						}\n\n						// adjust for linewidth\n						offset *= linewidth;\n\n						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n						offset /= resolution.y;\n\n						// select end\n						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n						// back to clip space\n						offset *= clip.w;\n\n						clip.xy += offset;\n\n					#endif\n\n					gl_Position = clip;\n\n					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n					#include <logdepthbuf_vertex>\n					#include <clipping_planes_vertex>\n					#include <fog_vertex>\n\n				}\n			",fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${Te>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){!0===t?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===t?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===t?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}}const Fe=new C,Oe=new d,Ie=new d,Re=new C,Le=new C,Be=new C,Ge=new d,ze=new A,je=new D,We=new d,Ne=new w,Ve=new _,He=new C;let Xe,qe;function $e(t,e,n){return He.set(0,0,-e,1).applyMatrix4(t.projectionMatrix),He.multiplyScalar(1/He.w),He.x=qe/n.width,He.y=qe/n.height,He.applyMatrix4(t.projectionMatrixInverse),He.multiplyScalar(1/He.w),Math.abs(Math.max(He.x,He.y))}class Ye extends E{constructor(t=new Ae,e=new Pe({color:0xffffff*Math.random()})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,r=new Float32Array(2*e.count);for(let o=0,a=0,s=e.count;o<s;o++,a+=2)Oe.fromBufferAttribute(e,o),Ie.fromBufferAttribute(n,o),r[a]=0===a?0:r[a-1],r[a+1]=r[a]+Oe.distanceTo(Ie);const i=new b(r,2,1);return t.setAttribute("instanceDistanceStart",new x(i,1,0)),t.setAttribute("instanceDistanceEnd",new x(i,1,1)),this}raycast(t,e){const n=this.material.worldUnits,r=t.camera,i=void 0!==t.params.Line2&&t.params.Line2.threshold||0;Xe=t.ray;const o=this.matrixWorld,a=this.geometry,s=this.material;let l,c;if(qe=s.linewidth+i,null===a.boundingSphere&&a.computeBoundingSphere(),Ve.copy(a.boundingSphere).applyMatrix4(o),n)l=.5*qe;else{l=$e(r,Math.max(r.near,Ve.distanceToPoint(Xe.origin)),s.resolution)}if(Ve.radius+=l,!1!==Xe.intersectsSphere(Ve)){if(null===a.boundingBox&&a.computeBoundingBox(),Ne.copy(a.boundingBox).applyMatrix4(o),n)c=.5*qe;else{c=$e(r,Math.max(r.near,Ne.distanceToPoint(Xe.origin)),s.resolution)}Ne.expandByScalar(c),!1!==Xe.intersectsBox(Ne)&&(n?function(t,e){const n=t.matrixWorld,r=t.geometry,i=r.attributes.instanceStart,o=r.attributes.instanceEnd;for(let a=0,s=Math.min(r.instanceCount,i.count);a<s;a++){je.start.fromBufferAttribute(i,a),je.end.fromBufferAttribute(o,a),je.applyMatrix4(n);const r=new d,s=new d;Xe.distanceSqToSegment(je.start,je.end,s,r),s.distanceTo(r)<.5*qe&&e.push({point:s,pointOnLine:r,distance:Xe.origin.distanceTo(s),object:t,face:null,faceIndex:a,uv:null,[Ee]:null})}}(this,e):function(t,e,n){const r=e.projectionMatrix,i=t.material.resolution,o=t.matrixWorld,a=t.geometry,s=a.attributes.instanceStart,l=a.attributes.instanceEnd,c=Math.min(a.instanceCount,s.count),u=-e.near;Xe.at(1,Be),Be.w=1,Be.applyMatrix4(e.matrixWorldInverse),Be.applyMatrix4(r),Be.multiplyScalar(1/Be.w),Be.x*=i.x/2,Be.y*=i.y/2,Be.z=0,Ge.copy(Be),ze.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,h=c;f<h;f++){if(Re.fromBufferAttribute(s,f),Le.fromBufferAttribute(l,f),Re.w=1,Le.w=1,Re.applyMatrix4(ze),Le.applyMatrix4(ze),Re.z>u&&Le.z>u)continue;if(Re.z>u){const t=Re.z-Le.z,e=(Re.z-u)/t;Re.lerp(Le,e)}else if(Le.z>u){const t=Le.z-Re.z,e=(Le.z-u)/t;Le.lerp(Re,e)}Re.applyMatrix4(r),Le.applyMatrix4(r),Re.multiplyScalar(1/Re.w),Le.multiplyScalar(1/Le.w),Re.x*=i.x/2,Re.y*=i.y/2,Le.x*=i.x/2,Le.y*=i.y/2,je.start.copy(Re),je.start.z=0,je.end.copy(Le),je.end.z=0;const e=je.closestPointToPointParameter(Ge,!0);je.at(e,We);const a=M.lerp(Re.z,Le.z,e),c=a>=-1&&a<=1,h=Ge.distanceTo(We)<.5*qe;if(c&&h){je.start.fromBufferAttribute(s,f),je.end.fromBufferAttribute(l,f),je.start.applyMatrix4(o),je.end.applyMatrix4(o);const e=new d,r=new d;Xe.distanceSqToSegment(je.start,je.end,r,e),n.push({point:r,pointOnLine:e,distance:Xe.origin.distanceTo(r),object:t,face:null,faceIndex:f,uv:null,[Ee]:null})}}}(this,r,e))}}onBeforeRender(t){const e=this.material.uniforms;e&&e.resolution&&(t.getViewport(Fe),this.material.uniforms.resolution.value.set(Fe.z,Fe.w))}}class Ke extends Ye{constructor(t=new Me,e=new Pe({color:0xffffff*Math.random()})){super(t,e),this.isLine2=!0,this.type="Line2"}}const Ze=r.forwardRef(function({points:t,color:e=0xffffff,vertexColors:n,linewidth:i,lineWidth:o,segments:a,dashed:s,...c},f){var p,v;const g=l(t=>t.size),m=r.useMemo(()=>a?new Ye:new Ke,[a]),[y]=r.useState(()=>new Pe),b=4===(null==n||null==(p=n[0])?void 0:p.length)?4:3,x=r.useMemo(()=>{const r=a?new Ae:new Me,i=t.map(t=>{const e=Array.isArray(t);return t instanceof d||t instanceof C?[t.x,t.y,t.z]:t instanceof h?[t.x,t.y,0]:e&&3===t.length?[t[0],t[1],t[2]]:e&&2===t.length?[t[0],t[1],0]:t});if(r.setPositions(i.flat()),n){e=0xffffff;const t=n.map(t=>t instanceof P?t.toArray():t);r.setColors(t.flat(),b)}return r},[t,a,n,b]);return r.useLayoutEffect(()=>{m.computeLineDistances()},[t,m]),r.useLayoutEffect(()=>{s?y.defines.USE_DASH="":delete y.defines.USE_DASH,y.needsUpdate=!0},[s,y]),r.useEffect(()=>()=>{x.dispose(),y.dispose()},[x]),r.createElement("primitive",u({object:m,ref:f},c),r.createElement("primitive",{object:x,attach:"geometry"}),r.createElement("primitive",u({object:y,attach:"material",color:e,vertexColors:Boolean(n),resolution:[g.width,g.height],linewidth:null!==(v=null!=i?i:o)&&void 0!==v?v:1,dashed:s,transparent:4===b},c)))});function Qe(){var t=Object.create(null);function e(r,i){var o=r.id,a=r.name,s=r.dependencies;void 0===s&&(s=[]);var l=r.init;void 0===l&&(l=function(){});var c=r.getTransferables;if(void 0===c&&(c=null),!t[o])try{s=s.map(function(n){return n&&n.isWorkerModule&&(e(n,function(t){if(t instanceof Error)throw t}),n=t[n.id].value),n}),l=n("<"+a+">.init",l),c&&(c=n("<"+a+">.getTransferables",c));var u=null;"function"==typeof l&&(u=l.apply(void 0,s)),t[o]={id:o,value:u,getTransferables:c},i(u)}catch(f){!f||f.noLog,i(f)}}function n(t,e){var n=void 0;self.troikaDefine=function(t){return n=t};var r=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+e+"\n)"],{type:"application/javascript"}));try{importScripts(r)}catch(i){}return URL.revokeObjectURL(r),delete self.troikaDefine,n}self.addEventListener("message",function(n){var r=n.data,i=r.messageId,o=r.action,a=r.data;try{"registerModule"===o&&e(a,function(t){t instanceof Error?postMessage({messageId:i,success:!1,error:t.message}):postMessage({messageId:i,success:!0,result:{isCallable:"function"==typeof t}})}),"callModule"===o&&function(e,n){var r,i=e.id,o=e.args;t[i]&&"function"==typeof t[i].value||n(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var a=(r=t[i]).value.apply(r,o);a&&"function"==typeof a.then?a.then(s,function(t){return n(t instanceof Error?t:new Error(""+t))}):s(a)}catch(l){n(l)}function s(e){try{var r=t[i].getTransferables&&t[i].getTransferables(e);r&&Array.isArray(r)&&r.length||(r=void 0),n(e,r)}catch(l){n(l)}}}(a,function(t,e){t instanceof Error?postMessage({messageId:i,success:!1,error:t.message}):postMessage({messageId:i,success:!0,result:t},e||void 0)})}catch(s){postMessage({messageId:i,success:!1,error:s.stack})}})}var Je=function(){var t=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),t=!0}catch(e){}return Je=function(){return t},t},tn=0,en=0,nn=!1,rn=Object.create(null),on=Object.create(null),an=Object.create(null);function sn(t){if(!(t&&"function"==typeof t.init||nn))throw new Error("requires `options.init` function");var e=t.dependencies,n=t.init,r=t.getTransferables,i=t.workerId,o=function(t){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(e){if("function"==typeof e)return e.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var n=t.dependencies,r=t.init;n=Array.isArray(n)?n.map(function(t){return t&&(t=t.onMainThread||t)._getInitResult&&(t=t._getInitResult()),t}):[];var i=Promise.all(n).then(function(t){return r.apply(null,t)});return e._getInitResult=function(){return i},i},e}(t);null==i&&(i="#default");var a="workerModule"+ ++tn,s=t.name||a,l=null;function c(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(!Je())return o.apply(void 0,t);if(!l){l=cn(i,"registerModule",c.workerModuleData);var n=function(){l=null,on[i].delete(n)};(on[i]||(on[i]=new Set)).add(n)}return l.then(function(e){if(e.isCallable)return cn(i,"callModule",{id:a,args:t});throw new Error("Worker module function was called but `init` did not return a callable function")})}return e=e&&e.map(function(t){return"function"!=typeof t||t.workerModuleData||(nn=!0,t=sn({workerId:i,name:"<"+s+"> function dependency: "+t.name,init:"function(){return (\n"+ln(t)+"\n)}"}),nn=!1),t&&t.workerModuleData&&(t=t.workerModuleData),t}),c.workerModuleData={isWorkerModule:!0,id:a,name:s,dependencies:e,init:ln(n),getTransferables:r&&ln(r)},c.onMainThread=o,c}function ln(t){var e=t.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function cn(t,e,n){return new Promise(function(r,i){var o=++en;an[o]=function(t){t.success?r(t.result):i(new Error("Error in worker "+e+" call: "+t.error))},function(t){var e=rn[t];if(!e){var n=ln(Qe);(e=rn[t]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+t.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(t){var e=t.data,n=e.messageId,r=an[n];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete an[n],r(e)}}return e}(t).postMessage({messageId:o,action:e,data:n})})}function un(){var t=function(t){function e(t,e,n,r,i,o,a,s){var l=1-a;s.x=l*l*t+2*l*a*n+a*a*i,s.y=l*l*e+2*l*a*r+a*a*o}function n(t,e,n,r,i,o,a,s,l,c){var u=1-l;c.x=u*u*u*t+3*u*u*l*n+3*u*l*l*i+l*l*l*a,c.y=u*u*u*e+3*u*u*l*r+3*u*l*l*o+l*l*l*s}function r(t,e){for(var n,r,i,o,a,s=/([MLQCZ])([^MLQCZ]*)/g;n=s.exec(t);){var l=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(t){return parseFloat(t)});switch(n[1]){case"M":o=r=l[0],a=i=l[1];break;case"L":l[0]===o&&l[1]===a||e("L",o,a,o=l[0],a=l[1]);break;case"Q":e("Q",o,a,o=l[2],a=l[3],l[0],l[1]);break;case"C":e("C",o,a,o=l[4],a=l[5],l[0],l[1],l[2],l[3]);break;case"Z":o===r&&a===i||e("L",o,a,r,i)}}}function i(t,i,o){void 0===o&&(o=16);var a={x:0,y:0};r(t,function(t,r,s,l,c,u,f,d,h){switch(t){case"L":i(r,s,l,c);break;case"Q":for(var p=r,v=s,g=1;g<o;g++)e(r,s,u,f,l,c,g/(o-1),a),i(p,v,a.x,a.y),p=a.x,v=a.y;break;case"C":for(var m=r,y=s,b=1;b<o;b++)n(r,s,u,f,d,h,l,c,b/(o-1),a),i(m,y,a.x,a.y),m=a.x,y=a.y}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a=new WeakMap,s={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(t,e){var n=t.getContext?t.getContext("webgl",s):t,r=a.get(n);if(!r){var i="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,o={},l={},c={},u=-1,f=[];function d(t){var e=o[t];if(!e&&!(e=o[t]=n.getExtension(t)))throw new Error(t+" not supported");return e}function h(t,e){var r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}function p(t,e,r,o){if(!l[t]){var a={},s={},c=n.createProgram();n.attachShader(c,h(e,n.VERTEX_SHADER)),n.attachShader(c,h(r,n.FRAGMENT_SHADER)),n.linkProgram(c),l[t]={program:c,transaction:function(t){n.useProgram(c),t({setUniform:function(t,e){for(var r=[],i=arguments.length-2;i-- >0;)r[i]=arguments[i+2];var o=s[e]||(s[e]=n.getUniformLocation(c,e));n["uniform"+t].apply(n,[o].concat(r))},setAttribute:function(t,e,r,o,s){var l=a[t];l||(l=a[t]={buf:n.createBuffer(),loc:n.getAttribLocation(c,t),data:null}),n.bindBuffer(n.ARRAY_BUFFER,l.buf),n.vertexAttribPointer(l.loc,e,n.FLOAT,!1,0,0),n.enableVertexAttribArray(l.loc),i?n.vertexAttribDivisor(l.loc,o):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,o),s!==l.data&&(n.bufferData(n.ARRAY_BUFFER,s,r),l.data=s)}})}}}l[t].transaction(o)}function v(t,e){u++;try{n.activeTexture(n.TEXTURE0+u);var r=c[t];r||(r=c[t]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,r),e(r,u)}finally{u--}}function g(t,e,r){var i=n.createFramebuffer();f.push(i),n.bindFramebuffer(n.FRAMEBUFFER,i),n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);try{r(i)}finally{n.deleteFramebuffer(i),n.bindFramebuffer(n.FRAMEBUFFER,f[--f.length-1]||null)}}function m(){o={},l={},c={},u=-1,f.length=0}n.canvas.addEventListener("webglcontextlost",function(t){m(),t.preventDefault()},!1),a.set(n,r={gl:n,isWebGL2:i,getExtension:d,withProgram:p,withTexture:v,withTextureFramebuffer:g,handleContextLoss:m})}e(r)}function c(t,e,n,r,i,a,s,c){void 0===s&&(s=15),void 0===c&&(c=null),l(t,function(t){var l=t.gl,u=t.withProgram;(0,t.withTexture)("copy",function(t,f){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,i,a,0,l.RGBA,l.UNSIGNED_BYTE,e),u("copy",o,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(t){var e=t.setUniform;(0,t.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),e("1i","image",f),l.bindFramebuffer(l.FRAMEBUFFER,c||null),l.disable(l.BLEND),l.colorMask(8&s,4&s,2&s,1&s),l.viewport(n,r,i,a),l.scissor(n,r,i,a),l.drawArrays(l.TRIANGLES,0,3)})})})}var u=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:c,resizeWebGLCanvasWithoutClearing:function(t,e,n){var r=t.width,i=t.height;l(t,function(o){var a=o.gl,s=new Uint8Array(r*i*4);a.readPixels(0,0,r,i,a.RGBA,a.UNSIGNED_BYTE,s),t.width=e,t.height=n,c(a,s,0,0,r,i)})}});function f(t,e,n,r,o,a){void 0===a&&(a=1);var s=new Uint8Array(t*e),l=r[2]-r[0],c=r[3]-r[1],u=[];i(n,function(t,e,n,r){u.push({x1:t,y1:e,x2:n,y2:r,minX:Math.min(t,n),minY:Math.min(e,r),maxX:Math.max(t,n),maxY:Math.max(e,r)})}),u.sort(function(t,e){return t.maxX-e.maxX});for(var f=0;f<t;f++)for(var d=0;d<e;d++){var h=g(r[0]+l*(f+.5)/t,r[1]+c*(d+.5)/e),v=Math.pow(1-Math.abs(h)/o,a)/2;h<0&&(v=1-v),v=Math.max(0,Math.min(255,Math.round(255*v))),s[d*t+f]=v}return s;function g(t,e){for(var n=1/0,r=1/0,i=u.length;i--;){var o=u[i];if(o.maxX+r<=t)break;if(t+r>o.minX&&e-r<o.maxY&&e+r>o.minY){var a=p(t,e,o.x1,o.y1,o.x2,o.y2);a<n&&(n=a,r=Math.sqrt(n))}}return function(t,e){for(var n=0,r=u.length;r--;){var i=u[r];if(i.maxX<=t)break;i.y1>e!=i.y2>e&&t<(i.x2-i.x1)*(e-i.y1)/(i.y2-i.y1)+i.x1&&(n+=i.y1<i.y2?1:-1)}return 0!==n}(t,e)&&(r=-r),r}}function d(t,e,n,r,i,o,a,s,l,c){void 0===o&&(o=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),h(t,e,n,r,i,o,a,null,s,l,c)}function h(t,e,n,r,i,o,a,s,l,u,d){void 0===o&&(o=1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===d&&(d=0);for(var h=f(t,e,n,r,i,o),p=new Uint8Array(4*h.length),v=0;v<h.length;v++)p[4*v+d]=h[v];c(a,p,l,u,t,e,1<<3-d,s)}function p(t,e,n,r,i,o){var a=i-n,s=o-r,l=a*a+s*s,c=l?Math.max(0,Math.min(1,((t-n)*a+(e-r)*s)/l)):0,u=t-(n+c*a),f=e-(r+c*s);return u*u+f*f}var v=Object.freeze({__proto__:null,generate:f,generateIntoCanvas:d,generateIntoFramebuffer:h}),g=new Float32Array([0,0,2,0,0,2]),m=null,y=!1,b={},x=new WeakMap;function S(t){if(!y&&!k(t))throw new Error("WebGL generation not supported")}function w(t,e,n,r,i,o,a){if(void 0===o&&(o=1),void 0===a&&(a=null),!a&&!(a=m)){var s="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!s)throw new Error("OffscreenCanvas or DOM canvas not supported");a=m=s.getContext("webgl",{depth:!1})}S(a);var c=new Uint8Array(t*e*4);l(a,function(a){var s=a.gl,l=a.withTexture,u=a.withTextureFramebuffer;l("readable",function(a,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,s.UNSIGNED_BYTE,null),u(a,l,function(a){U(t,e,n,r,i,o,s,a,0,0,0),s.readPixels(0,0,t,e,s.RGBA,s.UNSIGNED_BYTE,c)})})});for(var u=new Uint8Array(t*e),f=0,d=0;f<c.length;f+=4)u[d++]=c[f];return u}function _(t,e,n,r,i,o,a,s,l,c){void 0===o&&(o=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),U(t,e,n,r,i,o,a,null,s,l,c)}function U(t,e,n,r,a,s,c,u,f,d,h){void 0===s&&(s=1),void 0===f&&(f=0),void 0===d&&(d=0),void 0===h&&(h=0),S(c);var p=[];i(n,function(t,e,n,r){p.push(t,e,n,r)}),p=new Float32Array(p),l(c,function(n){var i=n.gl,l=n.isWebGL2,c=n.getExtension,v=n.withProgram,m=n.withTexture,y=n.withTextureFramebuffer,b=n.handleContextLoss;if(m("rawDistances",function(n,m){t===n._lastWidth&&e===n._lastHeight||i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n._lastWidth=t,n._lastHeight=e,0,i.RGBA,i.UNSIGNED_BYTE,null),v("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(o){var u=o.setAttribute,f=o.setUniform,d=!l&&c("ANGLE_instanced_arrays"),h=!l&&c("EXT_blend_minmax");u("aUV",2,i.STATIC_DRAW,0,g),u("aLineSegment",4,i.DYNAMIC_DRAW,1,p),f.apply(void 0,["4f","uGlyphBounds"].concat(r)),f("1f","uMaxDistance",a),f("1f","uExponent",s),y(n,m,function(n){i.enable(i.BLEND),i.colorMask(!0,!0,!0,!0),i.viewport(0,0,t,e),i.scissor(0,0,t,e),i.blendFunc(i.ONE,i.ONE),i.blendEquationSeparate(i.FUNC_ADD,l?i.MAX:h.MAX_EXT),i.clear(i.COLOR_BUFFER_BIT),l?i.drawArraysInstanced(i.TRIANGLES,0,3,p.length/4):d.drawArraysInstancedANGLE(i.TRIANGLES,0,3,p.length/4)})}),v("post",o,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(n){n.setAttribute("aUV",2,i.STATIC_DRAW,0,g),n.setUniform("1i","tex",m),i.bindFramebuffer(i.FRAMEBUFFER,u),i.disable(i.BLEND),i.colorMask(0===h,1===h,2===h,3===h),i.viewport(f,d,t,e),i.scissor(f,d,t,e),i.drawArrays(i.TRIANGLES,0,3)})}),i.isContextLost())throw b(),new Error("webgl context lost")})}function k(t){var e=t&&t!==m?t.canvas||t:b,n=x.get(e);if(void 0===n){y=!0;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],i=w(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,t);(n=i&&r.length===i.length&&i.every(function(t,e){return t===r[e]}))||"bad trial run results"}catch(o){n=!1,o.message}y=!1,x.set(e,n)}return n}var T=Object.freeze({__proto__:null,generate:w,generateIntoCanvas:_,generateIntoFramebuffer:U,isSupported:k});return t.forEachPathCommand=r,t.generate=function(t,e,n,r,i,o){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===o&&(o=1);try{return w.apply(T,arguments)}catch(a){return f.apply(v,arguments)}},t.generateIntoCanvas=function(t,e,n,r,i,o,a,s,l,c){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===o&&(o=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return _.apply(T,arguments)}catch(u){return d.apply(v,arguments)}},t.javascript=v,t.pathToLineSegments=i,t.webgl=T,t.webglUtils=u,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return t}const fn=/\bvoid\s+main\s*\(\s*\)\s*{/g;function dn(t){return t.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(t,e){let n=R[e];return n?dn(n):t})}const hn=[];for(let Pr=0;Pr<256;Pr++)hn[Pr]=(Pr<16?"0":"")+Pr.toString(16);const pn=Object.assign||function(){let t=arguments[0];for(let e=1,n=arguments.length;e<n;e++){let n=arguments[e];if(n)for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},vn=Date.now(),gn=new WeakMap,mn=new Map;let yn=1e10;function bn(t,e){const n=function(t){const e=JSON.stringify(t,Sn);let n=_n.get(e);null==n&&_n.set(e,n=++wn);return n}(e);let r=gn.get(t);if(r||gn.set(t,r=Object.create(null)),r[n])return new r[n];const i=`_onBeforeCompile${n}`,o=function(r,o){t.onBeforeCompile.call(this,r,o);const a=this.customProgramCacheKey()+"|"+r.vertexShader+"|"+r.fragmentShader;let s=mn[a];if(!s){const t=function(t,{vertexShader:e,fragmentShader:n},r,i){let{vertexDefs:o,vertexMainIntro:a,vertexMainOutro:s,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:p}=r;o=o||"",a=a||"",s=s||"",c=c||"",u=u||"",f=f||"",(l||h)&&(e=dn(e));(d||h)&&(n=dn(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(h){let t=h({vertexShader:e,fragmentShader:n});e=t.vertexShader,n=t.fragmentShader}if(d){let t=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,e=>(t.push(e),"")),f=`${d}
${t.join("\n")}
${f}`}if(p){const t=`
uniform float ${p};
`;o=t+o,c=t+c}l&&(o=`${o}
void troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,a=`
troika_position_${i} = vec3(position);
troika_normal_${i} = vec3(normal);
troika_uv_${i} = vec2(uv);
troikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});
${a}
`,e=(e=`vec3 troika_position_${i};
vec3 troika_normal_${i};
vec2 troika_uv_${i};
${e}
`).replace(/\b(position|normal|uv)\b/g,(t,e,n,r)=>/\battribute\s+vec[23]\s+$/.test(r.substr(0,n))?e:`troika_${e}_${i}`),t.map&&t.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${i}`)));return e=xn(e,i,o,a,s),n=xn(n,i,c,u,f),{vertexShader:e,fragmentShader:n}}(this,r,e,n);s=mn[a]=t}r.vertexShader=s.vertexShader,r.fragmentShader=s.fragmentShader,pn(r.uniforms,this.uniforms),e.timeUniform&&(r.uniforms[e.timeUniform]={get value(){return Date.now()-vn}}),this[i]&&this[i](r)},a=function(){return s(e.chained?t:t.clone())},s=function(r){const i=Object.create(r,l);return Object.defineProperty(i,"baseMaterial",{value:t}),Object.defineProperty(i,"id",{value:yn++}),i.uuid=function(){const t=0xffffffff*Math.random()|0,e=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0;return(hn[255&t]+hn[t>>8&255]+hn[t>>16&255]+hn[t>>24&255]+"-"+hn[255&e]+hn[e>>8&255]+"-"+hn[e>>16&15|64]+hn[e>>24&255]+"-"+hn[63&n|128]+hn[n>>8&255]+"-"+hn[n>>16&255]+hn[n>>24&255]+hn[255&r]+hn[r>>8&255]+hn[r>>16&255]+hn[r>>24&255]).toUpperCase()}(),i.uniforms=pn({},r.uniforms,e.uniforms),i.defines=pn({},r.defines,e.defines),i.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",i.extensions=pn({},r.extensions,e.extensions),i._listeners=void 0,i},l={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>t.type,set:e=>{t.type=e}},isDerivedFrom:{writable:!0,configurable:!0,value:function(t){const e=this.baseMaterial;return t===e||e.isDerivedMaterial&&e.isDerivedFrom(t)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>o,set(t){this[i]=t}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(pn(this.extensions,e.extensions),pn(this.defines,e.defines),pn(this.uniforms,k.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const e=new t.constructor;return s(e).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=bn(t.isDerivedMaterial?t.getDepthMaterial():new O({depthPacking:I}),e),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=bn(t.isDerivedMaterial?t.getDistanceMaterial():new F,e),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:e,_distanceMaterial:n}=this;e&&e.dispose(),n&&n.dispose(),t.dispose.call(this)}}};return r[n]=a,new a}function xn(t,e,n,r,i){return(r||i||n)&&(t=t.replace(fn,`
${n}
void troikaOrigMain${e}() {`),t+=`
void main() {
  ${r}
  troikaOrigMain${e}();
  ${i}
}`),t}function Sn(t,e){return"uniforms"===t?void 0:"function"==typeof e?e.toString():e}let wn=0;const _n=new Map;const Un=sn({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(t){var e={parse:function(t){var n=e._bin,r=new Uint8Array(t);if("ttcf"==n.readASCII(r,0,4)){var i=4;n.readUshort(r,i),i+=2,n.readUshort(r,i),i+=2;var o=n.readUint(r,i);i+=4;for(var a=[],s=0;s<o;s++){var l=n.readUint(r,i);i+=4,a.push(e._readFont(r,l))}return a}return[e._readFont(r,0)]},_readFont:function(t,n){var r=e._bin,i=n;r.readFixed(t,n),n+=4;var o=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},l={},c=0;c<o;c++){var u=r.readASCII(t,n,4);n+=4,r.readUint(t,n),n+=4;var f=r.readUint(t,n);n+=4;var d=r.readUint(t,n);n+=4,l[u]={offset:f,length:d}}for(c=0;c<a.length;c++){var h=a[c];l[h]&&(s[h.trim()]=e[h.trim()].parse(t,l[h].offset,l[h].length,s))}return s},_tabOffset:function(t,n,r){for(var i=e._bin,o=i.readUshort(t,r+4),a=r+12,s=0;s<o;s++){var l=i.readASCII(t,a,4);a+=4,i.readUint(t,a),a+=4;var c=i.readUint(t,a);if(a+=4,i.readUint(t,a),a+=4,l==n)return c}return 0}};e._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,n){return e._bin.readShort(t,n)/16384},readInt:function(t,n){return e._bin._view(t).getInt32(n)},readInt8:function(t,n){return e._bin._view(t).getInt8(n)},readShort:function(t,n){return e._bin._view(t).getInt16(n)},readUshort:function(t,n){return e._bin._view(t).getUint16(n)},readUshorts:function(t,n,r){for(var i=[],o=0;o<r;o++)i.push(e._bin.readUshort(t,n+2*o));return i},readUint:function(t,n){return e._bin._view(t).getUint32(n)},readUint64:function(t,n){return 0x100000000*e._bin.readUint(t,n)+e._bin.readUint(t,n+4)},readASCII:function(t,e,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(t[e+i]);return r},readUnicode:function(t,e,n){for(var r="",i=0;i<n;i++){var o=t[e++]<<8|t[e++];r+=String.fromCharCode(o)}return r},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,n,r){var i=e._bin._tdec;return i&&0==n&&r==t.length?i.decode(t):e._bin.readASCII(t,n,r)},readBytes:function(t,e,n){for(var r=[],i=0;i<n;i++)r.push(t[e+i]);return r},readASCIIArray:function(t,e,n){for(var r=[],i=0;i<n;i++)r.push(String.fromCharCode(t[e+i]));return r},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},e._lctf={},e._lctf.parse=function(t,n,r,i,o){var a=e._bin,s={},l=n;a.readFixed(t,n),n+=4;var c=a.readUshort(t,n);n+=2;var u=a.readUshort(t,n);n+=2;var f=a.readUshort(t,n);return n+=2,s.scriptList=e._lctf.readScriptList(t,l+c),s.featureList=e._lctf.readFeatureList(t,l+u),s.lookupList=e._lctf.readLookupList(t,l+f,o),s},e._lctf.readLookupList=function(t,n,r){var i=e._bin,o=n,a=[],s=i.readUshort(t,n);n+=2;for(var l=0;l<s;l++){var c=i.readUshort(t,n);n+=2;var u=e._lctf.readLookupTable(t,o+c,r);a.push(u)}return a},e._lctf.readLookupTable=function(t,n,r){var i=e._bin,o=n,a={tabs:[]};a.ltype=i.readUshort(t,n),n+=2,a.flag=i.readUshort(t,n),n+=2;var s=i.readUshort(t,n);n+=2;for(var l=a.ltype,c=0;c<s;c++){var u=i.readUshort(t,n);n+=2;var f=r(t,l,o+u,a);a.tabs.push(f)}return a},e._lctf.numOfOnes=function(t){for(var e=0,n=0;n<32;n++)t>>>n&1&&e++;return e},e._lctf.readClassDef=function(t,n){var r=e._bin,i=[],o=r.readUshort(t,n);if(n+=2,1==o){var a=r.readUshort(t,n);n+=2;var s=r.readUshort(t,n);n+=2;for(var l=0;l<s;l++)i.push(a+l),i.push(a+l),i.push(r.readUshort(t,n)),n+=2}if(2==o){var c=r.readUshort(t,n);for(n+=2,l=0;l<c;l++)i.push(r.readUshort(t,n)),n+=2,i.push(r.readUshort(t,n)),n+=2,i.push(r.readUshort(t,n)),n+=2}return i},e._lctf.getInterval=function(t,e){for(var n=0;n<t.length;n+=3){var r=t[n],i=t[n+1];if(t[n+2],r<=e&&e<=i)return n}return-1},e._lctf.readCoverage=function(t,n){var r=e._bin,i={};i.fmt=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);return n+=2,1==i.fmt&&(i.tab=r.readUshorts(t,n,o)),2==i.fmt&&(i.tab=r.readUshorts(t,n,3*o)),i},e._lctf.coverageIndex=function(t,n){var r=t.tab;if(1==t.fmt)return r.indexOf(n);if(2==t.fmt){var i=e._lctf.getInterval(r,n);if(-1!=i)return r[i+2]+(n-r[i])}return-1},e._lctf.readFeatureList=function(t,n){var r=e._bin,i=n,o=[],a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=r.readASCII(t,n,4);n+=4;var c=r.readUshort(t,n);n+=2;var u=e._lctf.readFeatureTable(t,i+c);u.tag=l.trim(),o.push(u)}return o},e._lctf.readFeatureTable=function(t,n){var r=e._bin,i=n,o={},a=r.readUshort(t,n);n+=2,a>0&&(o.featureParams=i+a);var s=r.readUshort(t,n);n+=2,o.tab=[];for(var l=0;l<s;l++)o.tab.push(r.readUshort(t,n+2*l));return o},e._lctf.readScriptList=function(t,n){var r=e._bin,i=n,o={},a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=r.readASCII(t,n,4);n+=4;var c=r.readUshort(t,n);n+=2,o[l.trim()]=e._lctf.readScriptTable(t,i+c)}return o},e._lctf.readScriptTable=function(t,n){var r=e._bin,i=n,o={},a=r.readUshort(t,n);n+=2,a>0&&(o.default=e._lctf.readLangSysTable(t,i+a));var s=r.readUshort(t,n);n+=2;for(var l=0;l<s;l++){var c=r.readASCII(t,n,4);n+=4;var u=r.readUshort(t,n);n+=2,o[c.trim()]=e._lctf.readLangSysTable(t,i+u)}return o},e._lctf.readLangSysTable=function(t,n){var r=e._bin,i={};r.readUshort(t,n),n+=2,i.reqFeature=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);return n+=2,i.features=r.readUshorts(t,n,o),i},e.CFF={},e.CFF.parse=function(t,n,r){var i=e._bin;(t=new Uint8Array(t.buffer,n,r))[n=0],t[++n],t[++n],t[++n],n++;var o=[];n=e.CFF.readIndex(t,n,o);for(var a=[],s=0;s<o.length-1;s++)a.push(i.readASCII(t,n+o[s],o[s+1]-o[s]));n+=o[o.length-1];var l=[];n=e.CFF.readIndex(t,n,l);var c=[];for(s=0;s<l.length-1;s++)c.push(e.CFF.readDict(t,n+l[s],n+l[s+1]));n+=l[l.length-1];var u=c[0],f=[];n=e.CFF.readIndex(t,n,f);var d=[];for(s=0;s<f.length-1;s++)d.push(i.readASCII(t,n+f[s],f[s+1]-f[s]));if(n+=f[f.length-1],e.CFF.readSubrs(t,n,u),u.CharStrings){n=u.CharStrings,f=[],n=e.CFF.readIndex(t,n,f);var h=[];for(s=0;s<f.length-1;s++)h.push(i.readBytes(t,n+f[s],f[s+1]-f[s]));u.CharStrings=h}if(u.ROS){n=u.FDArray;var p=[];for(n=e.CFF.readIndex(t,n,p),u.FDArray=[],s=0;s<p.length-1;s++){var v=e.CFF.readDict(t,n+p[s],n+p[s+1]);e.CFF._readFDict(t,v,d),u.FDArray.push(v)}n+=p[p.length-1],n=u.FDSelect,u.FDSelect=[];var g=t[n];if(n++,3!=g)throw g;var m=i.readUshort(t,n);for(n+=2,s=0;s<m+1;s++)u.FDSelect.push(i.readUshort(t,n),t[n+2]),n+=3}return u.Encoding&&(u.Encoding=e.CFF.readEncoding(t,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=e.CFF.readCharset(t,u.charset,u.CharStrings.length)),e.CFF._readFDict(t,u,d),u},e.CFF._readFDict=function(t,n,r){var i;for(var o in n.Private&&(i=n.Private[1],n.Private=e.CFF.readDict(t,i,i+n.Private[0]),n.Private.Subrs&&e.CFF.readSubrs(t,i+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)&&(n[o]=r[n[o]-426+35])},e.CFF.readSubrs=function(t,n,r){var i=e._bin,o=[];n=e.CFF.readIndex(t,n,o);var a,s=o.length;a=s<1240?107:s<33900?1131:32768,r.Bias=a,r.Subrs=[];for(var l=0;l<o.length-1;l++)r.Subrs.push(i.readBytes(t,n+o[l],o[l+1]-o[l]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(t,e){for(var n=0;n<t.charset.length;n++)if(t.charset[n]==e)return n;return-1},e.CFF.glyphBySE=function(t,n){return n<0||n>255?-1:e.CFF.glyphByUnicode(t,e.CFF.tableSE[n])},e.CFF.readEncoding=function(t,n,r){e._bin;var i=[".notdef"],o=t[n];if(n++,0!=o)throw"error: unknown encoding format: "+o;var a=t[n];n++;for(var s=0;s<a;s++)i.push(t[n+s]);return i},e.CFF.readCharset=function(t,n,r){var i=e._bin,o=[".notdef"],a=t[n];if(n++,0==a)for(var s=0;s<r;s++){var l=i.readUshort(t,n);n+=2,o.push(l)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;o.length<r;){l=i.readUshort(t,n),n+=2;var c=0;for(1==a?(c=t[n],n++):(c=i.readUshort(t,n),n+=2),s=0;s<=c;s++)o.push(l),l++}}return o},e.CFF.readIndex=function(t,n,r){var i=e._bin,o=i.readUshort(t,n)+1,a=t[n+=2];if(n++,1==a)for(var s=0;s<o;s++)r.push(t[n+s]);else if(2==a)for(s=0;s<o;s++)r.push(i.readUshort(t,n+2*s));else if(3==a)for(s=0;s<o;s++)r.push(0xffffff&i.readUint(t,n+3*s-1));else if(1!=o)throw"unsupported offset size: "+a+", count: "+o;return(n+=o*a)-1},e.CFF.getCharString=function(t,n,r){var i=e._bin,o=t[n],a=t[n+1];t[n+2],t[n+3],t[n+4];var s=1,l=null,c=null;o<=20&&(l=o,s=1),12==o&&(l=100*o+a,s=2),21<=o&&o<=27&&(l=o,s=1),28==o&&(c=i.readShort(t,n+1),s=3),29<=o&&o<=31&&(l=o,s=1),32<=o&&o<=246&&(c=o-139,s=1),247<=o&&o<=250&&(c=256*(o-247)+a+108,s=2),251<=o&&o<=254&&(c=256*-(o-251)-a-108,s=2),255==o&&(c=i.readInt(t,n+1)/65535,s=5),r.val=null!=c?c:"o"+l,r.size=s},e.CFF.readCharString=function(t,n,r){for(var i=n+r,o=e._bin,a=[];n<i;){var s=t[n],l=t[n+1];t[n+2],t[n+3],t[n+4];var c=1,u=null,f=null;s<=20&&(u=s,c=1),12==s&&(u=100*s+l,c=2),19!=s&&20!=s||(u=s,c=2),21<=s&&s<=27&&(u=s,c=1),28==s&&(f=o.readShort(t,n+1),c=3),29<=s&&s<=31&&(u=s,c=1),32<=s&&s<=246&&(f=s-139,c=1),247<=s&&s<=250&&(f=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(f=256*-(s-251)-l-108,c=2),255==s&&(f=o.readInt(t,n+1)/65535,c=5),a.push(null!=f?f:"o"+u),n+=c}return a},e.CFF.readDict=function(t,n,r){for(var i=e._bin,o={},a=[];n<r;){var s=t[n],l=t[n+1];t[n+2],t[n+3],t[n+4];var c=1,u=null,f=null;if(28==s&&(f=i.readShort(t,n+1),c=3),29==s&&(f=i.readInt(t,n+1),c=5),32<=s&&s<=246&&(f=s-139,c=1),247<=s&&s<=250&&(f=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(f=256*-(s-251)-l-108,c=2),255==s)throw f=i.readInt(t,n+1)/65535,c=5,"unknown number";if(30==s){var d=[];for(c=1;;){var h=t[n+c];c++;var p=h>>4,v=15&h;if(15!=p&&d.push(p),15!=v&&d.push(v),15==v)break}for(var g="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<d.length;y++)g+=m[d[y]];f=parseFloat(g)}s<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],c=1,12==s&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=u?(o[u]=1==a.length?a[0]:a,a=[]):a.push(f),n+=c}return o},e.cmap={},e.cmap.parse=function(t,n,r){t=new Uint8Array(t.buffer,n,r),n=0;var i=e._bin,o={};i.readUshort(t,n),n+=2;var a=i.readUshort(t,n);n+=2;var s=[];o.tables=[];for(var l=0;l<a;l++){var c=i.readUshort(t,n);n+=2;var u=i.readUshort(t,n);n+=2;var f=i.readUint(t,n);n+=4;var d="p"+c+"e"+u,h=s.indexOf(f);if(-1==h){var p;h=o.tables.length,s.push(f);var v=i.readUshort(t,f);0==v?p=e.cmap.parse0(t,f):4==v?p=e.cmap.parse4(t,f):6==v?p=e.cmap.parse6(t,f):12==v&&(p=e.cmap.parse12(t,f)),o.tables.push(p)}if(null!=o[d])throw"multiple tables for one platform+encoding";o[d]=h}return o},e.cmap.parse0=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2,i.map=[];for(var a=0;a<o-6;a++)i.map.push(t[n+a]);return i},e.cmap.parse4=function(t,n){var r=e._bin,i=n,o={};o.format=r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2;var s=r.readUshort(t,n);n+=2;var l=s/2;o.searchRange=r.readUshort(t,n),n+=2,o.entrySelector=r.readUshort(t,n),n+=2,o.rangeShift=r.readUshort(t,n),n+=2,o.endCount=r.readUshorts(t,n,l),n+=2*l,n+=2,o.startCount=r.readUshorts(t,n,l),n+=2*l,o.idDelta=[];for(var c=0;c<l;c++)o.idDelta.push(r.readShort(t,n)),n+=2;for(o.idRangeOffset=r.readUshorts(t,n,l),n+=2*l,o.glyphIdArray=[];n<i+a;)o.glyphIdArray.push(r.readUshort(t,n)),n+=2;return o},e.cmap.parse6=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,i.firstCode=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);n+=2,i.glyphIdArray=[];for(var a=0;a<o;a++)i.glyphIdArray.push(r.readUshort(t,n)),n+=2;return i},e.cmap.parse12=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2,n+=2,r.readUint(t,n),n+=4,r.readUint(t,n),n+=4;var o=r.readUint(t,n);n+=4,i.groups=[];for(var a=0;a<o;a++){var s=n+12*a,l=r.readUint(t,s+0),c=r.readUint(t,s+4),u=r.readUint(t,s+8);i.groups.push([l,c,u])}return i},e.glyf={},e.glyf.parse=function(t,e,n,r){for(var i=[],o=0;o<r.maxp.numGlyphs;o++)i.push(null);return i},e.glyf._parseGlyf=function(t,n){var r=e._bin,i=t._data,o=e._tabOffset(i,"glyf",t._offset)+t.loca[n];if(t.loca[n]==t.loca[n+1])return null;var a={};if(a.noc=r.readShort(i,o),o+=2,a.xMin=r.readShort(i,o),o+=2,a.yMin=r.readShort(i,o),o+=2,a.xMax=r.readShort(i,o),o+=2,a.yMax=r.readShort(i,o),o+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var s=0;s<a.noc;s++)a.endPts.push(r.readUshort(i,o)),o+=2;var l=r.readUshort(i,o);if(o+=2,i.length-o<l)return null;a.instructions=r.readBytes(i,o,l),o+=l;var c=a.endPts[a.noc-1]+1;for(a.flags=[],s=0;s<c;s++){var u=i[o];if(o++,a.flags.push(u),8&u){var f=i[o];o++;for(var d=0;d<f;d++)a.flags.push(u),s++}}for(a.xs=[],s=0;s<c;s++){var h=!!(2&a.flags[s]),p=!!(16&a.flags[s]);h?(a.xs.push(p?i[o]:-i[o]),o++):p?a.xs.push(0):(a.xs.push(r.readShort(i,o)),o+=2)}for(a.ys=[],s=0;s<c;s++)h=!!(4&a.flags[s]),p=!!(32&a.flags[s]),h?(a.ys.push(p?i[o]:-i[o]),o++):p?a.ys.push(0):(a.ys.push(r.readShort(i,o)),o+=2);var v=0,g=0;for(s=0;s<c;s++)v+=a.xs[s],g+=a.ys[s],a.xs[s]=v,a.ys[s]=g}else{var m;a.parts=[];do{m=r.readUshort(i,o),o+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(y),y.glyphIndex=r.readUshort(i,o),o+=2,1&m){var b=r.readShort(i,o);o+=2;var x=r.readShort(i,o);o+=2}else b=r.readInt8(i,o),o++,x=r.readInt8(i,o),o++;2&m?(y.m.tx=b,y.m.ty=x):(y.p1=b,y.p2=x),8&m?(y.m.a=y.m.d=r.readF2dot14(i,o),o+=2):64&m?(y.m.a=r.readF2dot14(i,o),o+=2,y.m.d=r.readF2dot14(i,o),o+=2):128&m&&(y.m.a=r.readF2dot14(i,o),o+=2,y.m.b=r.readF2dot14(i,o),o+=2,y.m.c=r.readF2dot14(i,o),o+=2,y.m.d=r.readF2dot14(i,o),o+=2)}while(32&m);if(256&m){var S=r.readUshort(i,o);for(o+=2,a.instr=[],s=0;s<S;s++)a.instr.push(i[o]),o++}}return a},e.GDEF={},e.GDEF.parse=function(t,n,r,i){var o=n;n+=4;var a=e._bin.readUshort(t,n);return{glyphClassDef:0===a?null:e._lctf.readClassDef(t,o+a)}},e.GPOS={},e.GPOS.parse=function(t,n,r,i){return e._lctf.parse(t,n,r,i,e.GPOS.subt)},e.GPOS.subt=function(t,n,r,i){var o=e._bin,a=r,s={};if(s.fmt=o.readUshort(t,r),r+=2,1==n||2==n||3==n||7==n||8==n&&s.fmt<=2){var l=o.readUshort(t,r);r+=2,s.coverage=e._lctf.readCoverage(t,l+a)}if(1==n&&1==s.fmt){var c=o.readUshort(t,r);r+=2,0!=c&&(s.pos=e.GPOS.readValueRecord(t,r,c))}else if(2==n&&s.fmt>=1&&s.fmt<=2){c=o.readUshort(t,r),r+=2;var u=o.readUshort(t,r);r+=2;var f=e._lctf.numOfOnes(c),d=e._lctf.numOfOnes(u);if(1==s.fmt){s.pairsets=[];var h=o.readUshort(t,r);r+=2;for(var p=0;p<h;p++){var v=a+o.readUshort(t,r);r+=2;var g=o.readUshort(t,v);v+=2;for(var m=[],y=0;y<g;y++){var b=o.readUshort(t,v);v+=2,0!=c&&(k=e.GPOS.readValueRecord(t,v,c),v+=2*f),0!=u&&(T=e.GPOS.readValueRecord(t,v,u),v+=2*d),m.push({gid2:b,val1:k,val2:T})}s.pairsets.push(m)}}if(2==s.fmt){var x=o.readUshort(t,r);r+=2;var S=o.readUshort(t,r);r+=2;var w=o.readUshort(t,r);r+=2;var _=o.readUshort(t,r);for(r+=2,s.classDef1=e._lctf.readClassDef(t,a+x),s.classDef2=e._lctf.readClassDef(t,a+S),s.matrix=[],p=0;p<w;p++){var U=[];for(y=0;y<_;y++){var k=null,T=null;0!=c&&(k=e.GPOS.readValueRecord(t,r,c),r+=2*f),0!=u&&(T=e.GPOS.readValueRecord(t,r,u),r+=2*d),U.push({val1:k,val2:T})}s.matrix.push(U)}}}else if(4==n&&1==s.fmt)s.markCoverage=e._lctf.readCoverage(t,o.readUshort(t,r)+a),s.baseCoverage=e._lctf.readCoverage(t,o.readUshort(t,r+2)+a),s.markClassCount=o.readUshort(t,r+4),s.markArray=e.GPOS.readMarkArray(t,o.readUshort(t,r+6)+a),s.baseArray=e.GPOS.readBaseArray(t,o.readUshort(t,r+8)+a,s.markClassCount);else if(6==n&&1==s.fmt)s.mark1Coverage=e._lctf.readCoverage(t,o.readUshort(t,r)+a),s.mark2Coverage=e._lctf.readCoverage(t,o.readUshort(t,r+2)+a),s.markClassCount=o.readUshort(t,r+4),s.mark1Array=e.GPOS.readMarkArray(t,o.readUshort(t,r+6)+a),s.mark2Array=e.GPOS.readBaseArray(t,o.readUshort(t,r+8)+a,s.markClassCount);else if(9==n&&1==s.fmt){var E=o.readUshort(t,r);r+=2;var C=o.readUint(t,r);if(r+=4,9==i.ltype)i.ltype=E;else if(i.ltype!=E)throw"invalid extension substitution";return e.GPOS.subt(t,i.ltype,a+C)}return s},e.GPOS.readValueRecord=function(t,n,r){var i=e._bin,o=[];return o.push(1&r?i.readShort(t,n):0),n+=1&r?2:0,o.push(2&r?i.readShort(t,n):0),n+=2&r?2:0,o.push(4&r?i.readShort(t,n):0),n+=4&r?2:0,o.push(8&r?i.readShort(t,n):0),n+=8&r?2:0,o},e.GPOS.readBaseArray=function(t,n,r){var i=e._bin,o=[],a=n,s=i.readUshort(t,n);n+=2;for(var l=0;l<s;l++){for(var c=[],u=0;u<r;u++)c.push(e.GPOS.readAnchorRecord(t,a+i.readUshort(t,n))),n+=2;o.push(c)}return o},e.GPOS.readMarkArray=function(t,n){var r=e._bin,i=[],o=n,a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=e.GPOS.readAnchorRecord(t,r.readUshort(t,n+2)+o);l.markClass=r.readUshort(t,n),i.push(l),n+=4}return i},e.GPOS.readAnchorRecord=function(t,n){var r=e._bin,i={};return i.fmt=r.readUshort(t,n),i.x=r.readShort(t,n+2),i.y=r.readShort(t,n+4),i},e.GSUB={},e.GSUB.parse=function(t,n,r,i){return e._lctf.parse(t,n,r,i,e.GSUB.subt)},e.GSUB.subt=function(t,n,r,i){var o=e._bin,a=r,s={};if(s.fmt=o.readUshort(t,r),r+=2,1!=n&&2!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||2==n||4==n||5==n&&s.fmt<=2||6==n&&s.fmt<=2){var l=o.readUshort(t,r);r+=2,s.coverage=e._lctf.readCoverage(t,a+l)}if(1==n&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=o.readShort(t,r),r+=2;else if(2==s.fmt){var c=o.readUshort(t,r);r+=2,s.newg=o.readUshorts(t,r,c),r+=2*s.newg.length}}else if(2==n&&1==s.fmt){c=o.readUshort(t,r),r+=2,s.seqs=[];for(var u=0;u<c;u++){var f=o.readUshort(t,r)+a;r+=2;var d=o.readUshort(t,f);s.seqs.push(o.readUshorts(t,f+2,d))}}else if(4==n)for(s.vals=[],c=o.readUshort(t,r),r+=2,u=0;u<c;u++){var h=o.readUshort(t,r);r+=2,s.vals.push(e.GSUB.readLigatureSet(t,a+h))}else if(5==n&&2==s.fmt){if(2==s.fmt){var p=o.readUshort(t,r);r+=2,s.cDef=e._lctf.readClassDef(t,a+p),s.scset=[];var v=o.readUshort(t,r);for(r+=2,u=0;u<v;u++){var g=o.readUshort(t,r);r+=2,s.scset.push(0==g?null:e.GSUB.readSubClassSet(t,a+g))}}}else if(6==n&&3==s.fmt){if(3==s.fmt){for(u=0;u<3;u++){c=o.readUshort(t,r),r+=2;for(var m=[],y=0;y<c;y++)m.push(e._lctf.readCoverage(t,a+o.readUshort(t,r+2*y)));r+=2*c,0==u&&(s.backCvg=m),1==u&&(s.inptCvg=m),2==u&&(s.ahedCvg=m)}c=o.readUshort(t,r),r+=2,s.lookupRec=e.GSUB.readSubstLookupRecords(t,r,c)}}else if(7==n&&1==s.fmt){var b=o.readUshort(t,r);r+=2;var x=o.readUint(t,r);if(r+=4,9==i.ltype)i.ltype=b;else if(i.ltype!=b)throw"invalid extension substitution";return e.GSUB.subt(t,i.ltype,a+x)}return s},e.GSUB.readSubClassSet=function(t,n){var r=e._bin.readUshort,i=n,o=[],a=r(t,n);n+=2;for(var s=0;s<a;s++){var l=r(t,n);n+=2,o.push(e.GSUB.readSubClassRule(t,i+l))}return o},e.GSUB.readSubClassRule=function(t,n){var r=e._bin.readUshort,i={},o=r(t,n),a=r(t,n+=2);n+=2,i.input=[];for(var s=0;s<o-1;s++)i.input.push(r(t,n)),n+=2;return i.substLookupRecords=e.GSUB.readSubstLookupRecords(t,n,a),i},e.GSUB.readSubstLookupRecords=function(t,n,r){for(var i=e._bin.readUshort,o=[],a=0;a<r;a++)o.push(i(t,n),i(t,n+2)),n+=4;return o},e.GSUB.readChainSubClassSet=function(t,n){var r=e._bin,i=n,o=[],a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=r.readUshort(t,n);n+=2,o.push(e.GSUB.readChainSubClassRule(t,i+l))}return o},e.GSUB.readChainSubClassRule=function(t,n){for(var r=e._bin,i={},o=["backtrack","input","lookahead"],a=0;a<o.length;a++){var s=r.readUshort(t,n);n+=2,1==a&&s--,i[o[a]]=r.readUshorts(t,n,s),n+=2*i[o[a]].length}return s=r.readUshort(t,n),n+=2,i.subst=r.readUshorts(t,n,2*s),n+=2*i.subst.length,i},e.GSUB.readLigatureSet=function(t,n){var r=e._bin,i=n,o=[],a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=r.readUshort(t,n);n+=2,o.push(e.GSUB.readLigature(t,i+l))}return o},e.GSUB.readLigature=function(t,n){var r=e._bin,i={chain:[]};i.nglyph=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);n+=2;for(var a=0;a<o-1;a++)i.chain.push(r.readUshort(t,n)),n+=2;return i},e.head={},e.head.parse=function(t,n,r){var i=e._bin,o={};return i.readFixed(t,n),n+=4,o.fontRevision=i.readFixed(t,n),n+=4,i.readUint(t,n),n+=4,i.readUint(t,n),n+=4,o.flags=i.readUshort(t,n),n+=2,o.unitsPerEm=i.readUshort(t,n),n+=2,o.created=i.readUint64(t,n),n+=8,o.modified=i.readUint64(t,n),n+=8,o.xMin=i.readShort(t,n),n+=2,o.yMin=i.readShort(t,n),n+=2,o.xMax=i.readShort(t,n),n+=2,o.yMax=i.readShort(t,n),n+=2,o.macStyle=i.readUshort(t,n),n+=2,o.lowestRecPPEM=i.readUshort(t,n),n+=2,o.fontDirectionHint=i.readShort(t,n),n+=2,o.indexToLocFormat=i.readShort(t,n),n+=2,o.glyphDataFormat=i.readShort(t,n),n+=2,o},e.hhea={},e.hhea.parse=function(t,n,r){var i=e._bin,o={};return i.readFixed(t,n),n+=4,o.ascender=i.readShort(t,n),n+=2,o.descender=i.readShort(t,n),n+=2,o.lineGap=i.readShort(t,n),n+=2,o.advanceWidthMax=i.readUshort(t,n),n+=2,o.minLeftSideBearing=i.readShort(t,n),n+=2,o.minRightSideBearing=i.readShort(t,n),n+=2,o.xMaxExtent=i.readShort(t,n),n+=2,o.caretSlopeRise=i.readShort(t,n),n+=2,o.caretSlopeRun=i.readShort(t,n),n+=2,o.caretOffset=i.readShort(t,n),n+=2,n+=8,o.metricDataFormat=i.readShort(t,n),n+=2,o.numberOfHMetrics=i.readUshort(t,n),n+=2,o},e.hmtx={},e.hmtx.parse=function(t,n,r,i){for(var o=e._bin,a={aWidth:[],lsBearing:[]},s=0,l=0,c=0;c<i.maxp.numGlyphs;c++)c<i.hhea.numberOfHMetrics&&(s=o.readUshort(t,n),n+=2,l=o.readShort(t,n),n+=2),a.aWidth.push(s),a.lsBearing.push(l);return a},e.kern={},e.kern.parse=function(t,n,r,i){var o=e._bin,a=o.readUshort(t,n);if(n+=2,1==a)return e.kern.parseV1(t,n-2,r,i);var s=o.readUshort(t,n);n+=2;for(var l={glyph1:[],rval:[]},c=0;c<s;c++){n+=2,r=o.readUshort(t,n),n+=2;var u=o.readUshort(t,n);n+=2;var f=u>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;n=e.kern.readFormat0(t,n,l)}return l},e.kern.parseV1=function(t,n,r,i){var o=e._bin;o.readFixed(t,n),n+=4;var a=o.readUint(t,n);n+=4;for(var s={glyph1:[],rval:[]},l=0;l<a;l++){o.readUint(t,n),n+=4;var c=o.readUshort(t,n);n+=2,o.readUshort(t,n),n+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;n=e.kern.readFormat0(t,n,s)}return s},e.kern.readFormat0=function(t,n,r){var i=e._bin,o=-1,a=i.readUshort(t,n);n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2;for(var s=0;s<a;s++){var l=i.readUshort(t,n);n+=2;var c=i.readUshort(t,n);n+=2;var u=i.readShort(t,n);n+=2,l!=o&&(r.glyph1.push(l),r.rval.push({glyph2:[],vals:[]}));var f=r.rval[r.rval.length-1];f.glyph2.push(c),f.vals.push(u),o=l}return n},e.loca={},e.loca.parse=function(t,n,r,i){var o=e._bin,a=[],s=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(0==s)for(var c=0;c<l;c++)a.push(o.readUshort(t,n+(c<<1))<<1);if(1==s)for(c=0;c<l;c++)a.push(o.readUint(t,n+(c<<2)));return a},e.maxp={},e.maxp.parse=function(t,n,r){var i=e._bin,o={},a=i.readUint(t,n);return n+=4,o.numGlyphs=i.readUshort(t,n),n+=2,65536==a&&(o.maxPoints=i.readUshort(t,n),n+=2,o.maxContours=i.readUshort(t,n),n+=2,o.maxCompositePoints=i.readUshort(t,n),n+=2,o.maxCompositeContours=i.readUshort(t,n),n+=2,o.maxZones=i.readUshort(t,n),n+=2,o.maxTwilightPoints=i.readUshort(t,n),n+=2,o.maxStorage=i.readUshort(t,n),n+=2,o.maxFunctionDefs=i.readUshort(t,n),n+=2,o.maxInstructionDefs=i.readUshort(t,n),n+=2,o.maxStackElements=i.readUshort(t,n),n+=2,o.maxSizeOfInstructions=i.readUshort(t,n),n+=2,o.maxComponentElements=i.readUshort(t,n),n+=2,o.maxComponentDepth=i.readUshort(t,n),n+=2),o},e.name={},e.name.parse=function(t,n,r){var i=e._bin,o={};i.readUshort(t,n),n+=2;var a=i.readUshort(t,n);n+=2,i.readUshort(t,n);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=n+=2,u=0;u<a;u++){var f=i.readUshort(t,n);n+=2;var d=i.readUshort(t,n);n+=2;var h=i.readUshort(t,n);n+=2;var p=i.readUshort(t,n);n+=2;var v=i.readUshort(t,n);n+=2;var g=i.readUshort(t,n);n+=2;var m,y=l[p],b=c+12*a+g;if(0==f)m=i.readUnicode(t,b,v/2);else if(3==f&&0==d)m=i.readUnicode(t,b,v/2);else if(0==d)m=i.readASCII(t,b,v);else if(1==d)m=i.readUnicode(t,b,v/2);else if(3==d)m=i.readUnicode(t,b,v/2);else{if(1!=f)throw"unknown encoding "+d+", platformID: "+f;m=i.readASCII(t,b,v)}var x="p"+f+","+h.toString(16);null==o[x]&&(o[x]={}),o[x][void 0!==y?y:p]=m,o[x]._lang=h}for(var S in o)if(null!=o[S].postScriptName&&1033==o[S]._lang)return o[S];for(var S in o)if(null!=o[S].postScriptName&&0==o[S]._lang)return o[S];for(var S in o)if(null!=o[S].postScriptName&&3084==o[S]._lang)return o[S];for(var S in o)if(null!=o[S].postScriptName)return o[S];for(var S in o){s=S;break}return o[s]},e["OS/2"]={},e["OS/2"].parse=function(t,n,r){var i=e._bin.readUshort(t,n);n+=2;var o={};if(0==i)e["OS/2"].version0(t,n,o);else if(1==i)e["OS/2"].version1(t,n,o);else if(2==i||3==i||4==i)e["OS/2"].version2(t,n,o);else{if(5!=i)throw"unknown OS/2 table version: "+i;e["OS/2"].version5(t,n,o)}return o},e["OS/2"].version0=function(t,n,r){var i=e._bin;return r.xAvgCharWidth=i.readShort(t,n),n+=2,r.usWeightClass=i.readUshort(t,n),n+=2,r.usWidthClass=i.readUshort(t,n),n+=2,r.fsType=i.readUshort(t,n),n+=2,r.ySubscriptXSize=i.readShort(t,n),n+=2,r.ySubscriptYSize=i.readShort(t,n),n+=2,r.ySubscriptXOffset=i.readShort(t,n),n+=2,r.ySubscriptYOffset=i.readShort(t,n),n+=2,r.ySuperscriptXSize=i.readShort(t,n),n+=2,r.ySuperscriptYSize=i.readShort(t,n),n+=2,r.ySuperscriptXOffset=i.readShort(t,n),n+=2,r.ySuperscriptYOffset=i.readShort(t,n),n+=2,r.yStrikeoutSize=i.readShort(t,n),n+=2,r.yStrikeoutPosition=i.readShort(t,n),n+=2,r.sFamilyClass=i.readShort(t,n),n+=2,r.panose=i.readBytes(t,n,10),n+=10,r.ulUnicodeRange1=i.readUint(t,n),n+=4,r.ulUnicodeRange2=i.readUint(t,n),n+=4,r.ulUnicodeRange3=i.readUint(t,n),n+=4,r.ulUnicodeRange4=i.readUint(t,n),n+=4,r.achVendID=[i.readInt8(t,n),i.readInt8(t,n+1),i.readInt8(t,n+2),i.readInt8(t,n+3)],n+=4,r.fsSelection=i.readUshort(t,n),n+=2,r.usFirstCharIndex=i.readUshort(t,n),n+=2,r.usLastCharIndex=i.readUshort(t,n),n+=2,r.sTypoAscender=i.readShort(t,n),n+=2,r.sTypoDescender=i.readShort(t,n),n+=2,r.sTypoLineGap=i.readShort(t,n),n+=2,r.usWinAscent=i.readUshort(t,n),n+=2,r.usWinDescent=i.readUshort(t,n),n+2},e["OS/2"].version1=function(t,n,r){var i=e._bin;return n=e["OS/2"].version0(t,n,r),r.ulCodePageRange1=i.readUint(t,n),n+=4,r.ulCodePageRange2=i.readUint(t,n),n+4},e["OS/2"].version2=function(t,n,r){var i=e._bin;return n=e["OS/2"].version1(t,n,r),r.sxHeight=i.readShort(t,n),n+=2,r.sCapHeight=i.readShort(t,n),n+=2,r.usDefault=i.readUshort(t,n),n+=2,r.usBreak=i.readUshort(t,n),n+=2,r.usMaxContext=i.readUshort(t,n),n+2},e["OS/2"].version5=function(t,n,r){var i=e._bin;return n=e["OS/2"].version2(t,n,r),r.usLowerOpticalPointSize=i.readUshort(t,n),n+=2,r.usUpperOpticalPointSize=i.readUshort(t,n),n+2},e.post={},e.post.parse=function(t,n,r){var i=e._bin,o={};return o.version=i.readFixed(t,n),n+=4,o.italicAngle=i.readFixed(t,n),n+=4,o.underlinePosition=i.readShort(t,n),n+=2,o.underlineThickness=i.readShort(t,n),n+=2,o},null==e&&(e={}),null==e.U&&(e.U={}),e.U.codeToGlyph=function(t,e){var n=t.cmap,r=-1;if(null!=n.p0e4?r=n.p0e4:null!=n.p3e1?r=n.p3e1:null!=n.p1e0?r=n.p1e0:null!=n.p0e3&&(r=n.p0e3),-1==r)throw"no familiar platform and encoding!";var i=n.tables[r];if(0==i.format)return e>=i.map.length?0:i.map[e];if(4==i.format){for(var o=-1,a=0;a<i.endCount.length;a++)if(e<=i.endCount[a]){o=a;break}return-1==o||i.startCount[o]>e?0:65535&(0!=i.idRangeOffset[o]?i.glyphIdArray[e-i.startCount[o]+(i.idRangeOffset[o]>>1)-(i.idRangeOffset.length-o)]:e+i.idDelta[o])}if(12==i.format){if(e>i.groups[i.groups.length-1][1])return 0;for(a=0;a<i.groups.length;a++){var s=i.groups[a];if(s[0]<=e&&e<=s[1])return s[2]+(e-s[0])}return 0}throw"unknown cmap table format "+i.format},e.U.glyphToPath=function(t,n){var r={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[n]){var i=t.SVG.entries[n];return null==i?r:("string"==typeof i&&(i=e.SVG.toPath(i),t.SVG.entries[n]=i),i)}if(t.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},a=t.CFF,s=t.CFF.Private;if(a.ROS){for(var l=0;a.FDSelect[l+2]<=n;)l+=2;s=a.FDArray[a.FDSelect[l+1]].Private}e.U._drawCFF(t.CFF.CharStrings[n],o,a,s,r)}else t.glyf&&e.U._drawGlyf(n,t,r);return r},e.U._drawGlyf=function(t,n,r){var i=n.glyf[t];null==i&&(i=n.glyf[t]=e.glyf._parseGlyf(n,t)),null!=i&&(i.noc>-1?e.U._simpleGlyph(i,r):e.U._compoGlyph(i,n,r))},e.U._simpleGlyph=function(t,n){for(var r=0;r<t.noc;r++){for(var i=0==r?0:t.endPts[r-1]+1,o=t.endPts[r],a=i;a<=o;a++){var s=a==i?o:a-1,l=a==o?i:a+1,c=1&t.flags[a],u=1&t.flags[s],f=1&t.flags[l],d=t.xs[a],h=t.ys[a];if(a==i)if(c){if(!u){e.U.P.moveTo(n,d,h);continue}e.U.P.moveTo(n,t.xs[s],t.ys[s])}else u?e.U.P.moveTo(n,t.xs[s],t.ys[s]):e.U.P.moveTo(n,(t.xs[s]+d)/2,(t.ys[s]+h)/2);c?u&&e.U.P.lineTo(n,d,h):f?e.U.P.qcurveTo(n,d,h,t.xs[l],t.ys[l]):e.U.P.qcurveTo(n,d,h,(d+t.xs[l])/2,(h+t.ys[l])/2)}e.U.P.closePath(n)}},e.U._compoGlyph=function(t,n,r){for(var i=0;i<t.parts.length;i++){var o={cmds:[],crds:[]},a=t.parts[i];e.U._drawGlyf(a.glyphIndex,n,o);for(var s=a.m,l=0;l<o.crds.length;l+=2){var c=o.crds[l],u=o.crds[l+1];r.crds.push(c*s.a+u*s.b+s.tx),r.crds.push(c*s.c+u*s.d+s.ty)}for(l=0;l<o.cmds.length;l++)r.cmds.push(o.cmds[l])}},e.U._getGlyphClass=function(t,n){var r=e._lctf.getInterval(n,t);return-1==r?0:n[r+2]},e.U._applySubs=function(t,n,r,i){for(var o=t.length-n-1,a=0;a<r.tabs.length;a++)if(null!=r.tabs[a]){var s,l=r.tabs[a];if(!l.coverage||-1!=(s=e._lctf.coverageIndex(l.coverage,t[n])))if(1==r.ltype)t[n],1==l.fmt?t[n]=t[n]+l.delta:t[n]=l.newg[s];else if(4==r.ltype)for(var c=l.vals[s],u=0;u<c.length;u++){var f=c[u],d=f.chain.length;if(!(d>o)){for(var h=!0,p=0,v=0;v<d;v++){for(;-1==t[n+p+(1+v)];)p++;f.chain[v]!=t[n+p+(1+v)]&&(h=!1)}if(h){for(t[n]=f.nglyph,v=0;v<d+p;v++)t[n+v+1]=-1;break}}}else if(5==r.ltype&&2==l.fmt)for(var g=e._lctf.getInterval(l.cDef,t[n]),m=l.cDef[g+2],y=l.scset[m],b=0;b<y.length;b++){var x=y[b],S=x.input;if(!(S.length>o)){for(h=!0,v=0;v<S.length;v++){var w=e._lctf.getInterval(l.cDef,t[n+1+v]);if(-1==g&&l.cDef[w+2]!=S[v]){h=!1;break}}if(h){var _=x.substLookupRecords;for(u=0;u<_.length;u+=2)_[u],_[u+1]}}}else if(6==r.ltype&&3==l.fmt){if(!e.U._glsCovered(t,l.backCvg,n-l.backCvg.length))continue;if(!e.U._glsCovered(t,l.inptCvg,n))continue;if(!e.U._glsCovered(t,l.ahedCvg,n+l.inptCvg.length))continue;var U=l.lookupRec;for(b=0;b<U.length;b+=2){g=U[b];var k=i[U[b+1]];e.U._applySubs(t,n+g,k,i)}}}},e.U._glsCovered=function(t,n,r){for(var i=0;i<n.length;i++)if(-1==e._lctf.coverageIndex(n[i],t[r+i]))return!1;return!0},e.U.glyphsToPath=function(t,n,r){for(var i={cmds:[],crds:[]},o=0,a=0;a<n.length;a++){var s=n[a];if(-1!=s){for(var l=a<n.length-1&&-1!=n[a+1]?n[a+1]:0,c=e.U.glyphToPath(t,s),u=0;u<c.crds.length;u+=2)i.crds.push(c.crds[u]+o),i.crds.push(c.crds[u+1]);for(r&&i.cmds.push(r),u=0;u<c.cmds.length;u++)i.cmds.push(c.cmds[u]);r&&i.cmds.push("X"),o+=t.hmtx.aWidth[s],a<n.length-1&&(o+=e.U.getPairAdjustment(t,s,l))}}return i},e.U.P={},e.U.P.moveTo=function(t,e,n){t.cmds.push("M"),t.crds.push(e,n)},e.U.P.lineTo=function(t,e,n){t.cmds.push("L"),t.crds.push(e,n)},e.U.P.curveTo=function(t,e,n,r,i,o,a){t.cmds.push("C"),t.crds.push(e,n,r,i,o,a)},e.U.P.qcurveTo=function(t,e,n,r,i){t.cmds.push("Q"),t.crds.push(e,n,r,i)},e.U.P.closePath=function(t){t.cmds.push("Z")},e.U._drawCFF=function(t,n,r,i,o){for(var a=n.stack,s=n.nStems,l=n.haveWidth,c=n.width,u=n.open,f=0,d=n.x,h=n.y,p=0,v=0,g=0,m=0,y=0,b=0,x=0,S=0,w=0,_=0,U={val:0,size:0};f<t.length;){e.CFF.getCharString(t,f,U);var k=U.val;if(f+=U.size,"o1"==k||"o18"==k)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0;else if("o3"==k||"o23"==k)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0;else if("o4"==k)a.length>1&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),u&&e.U.P.closePath(o),h+=a.pop(),e.U.P.moveTo(o,d,h),u=!0;else if("o5"==k)for(;a.length>0;)d+=a.shift(),h+=a.shift(),e.U.P.lineTo(o,d,h);else if("o6"==k||"o7"==k)for(var T=a.length,E="o6"==k,C=0;C<T;C++){var D=a.shift();E?d+=D:h+=D,E=!E,e.U.P.lineTo(o,d,h)}else if("o8"==k||"o24"==k){T=a.length;for(var A=0;A+6<=T;)p=d+a.shift(),v=h+a.shift(),g=p+a.shift(),m=v+a.shift(),d=g+a.shift(),h=m+a.shift(),e.U.P.curveTo(o,p,v,g,m,d,h),A+=6;"o24"==k&&(d+=a.shift(),h+=a.shift(),e.U.P.lineTo(o,d,h))}else{if("o11"==k)break;if("o1234"==k||"o1235"==k||"o1236"==k||"o1237"==k)"o1234"==k&&(v=h,g=(p=d+a.shift())+a.shift(),_=m=v+a.shift(),b=m,S=h,d=(x=(y=(w=g+a.shift())+a.shift())+a.shift())+a.shift(),e.U.P.curveTo(o,p,v,g,m,w,_),e.U.P.curveTo(o,y,b,x,S,d,h)),"o1235"==k&&(p=d+a.shift(),v=h+a.shift(),g=p+a.shift(),m=v+a.shift(),w=g+a.shift(),_=m+a.shift(),y=w+a.shift(),b=_+a.shift(),x=y+a.shift(),S=b+a.shift(),d=x+a.shift(),h=S+a.shift(),a.shift(),e.U.P.curveTo(o,p,v,g,m,w,_),e.U.P.curveTo(o,y,b,x,S,d,h)),"o1236"==k&&(p=d+a.shift(),v=h+a.shift(),g=p+a.shift(),_=m=v+a.shift(),b=m,x=(y=(w=g+a.shift())+a.shift())+a.shift(),S=b+a.shift(),d=x+a.shift(),e.U.P.curveTo(o,p,v,g,m,w,_),e.U.P.curveTo(o,y,b,x,S,d,h)),"o1237"==k&&(p=d+a.shift(),v=h+a.shift(),g=p+a.shift(),m=v+a.shift(),w=g+a.shift(),_=m+a.shift(),y=w+a.shift(),b=_+a.shift(),x=y+a.shift(),S=b+a.shift(),Math.abs(x-d)>Math.abs(S-h)?d=x+a.shift():h=S+a.shift(),e.U.P.curveTo(o,p,v,g,m,w,_),e.U.P.curveTo(o,y,b,x,S,d,h));else if("o14"==k){if(a.length>0&&!l&&(c=a.shift()+r.nominalWidthX,l=!0),4==a.length){var M=a.shift(),P=a.shift(),F=a.shift(),O=a.shift(),I=e.CFF.glyphBySE(r,F),R=e.CFF.glyphBySE(r,O);e.U._drawCFF(r.CharStrings[I],n,r,i,o),n.x=M,n.y=P,e.U._drawCFF(r.CharStrings[R],n,r,i,o)}u&&(e.U.P.closePath(o),u=!1)}else if("o19"==k||"o20"==k)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0,f+=s+7>>3;else if("o21"==k)a.length>2&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),h+=a.pop(),d+=a.pop(),u&&e.U.P.closePath(o),e.U.P.moveTo(o,d,h),u=!0;else if("o22"==k)a.length>1&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),d+=a.pop(),u&&e.U.P.closePath(o),e.U.P.moveTo(o,d,h),u=!0;else if("o25"==k){for(;a.length>6;)d+=a.shift(),h+=a.shift(),e.U.P.lineTo(o,d,h);p=d+a.shift(),v=h+a.shift(),g=p+a.shift(),m=v+a.shift(),d=g+a.shift(),h=m+a.shift(),e.U.P.curveTo(o,p,v,g,m,d,h)}else if("o26"==k)for(a.length%2&&(d+=a.shift());a.length>0;)p=d,v=h+a.shift(),d=g=p+a.shift(),h=(m=v+a.shift())+a.shift(),e.U.P.curveTo(o,p,v,g,m,d,h);else if("o27"==k)for(a.length%2&&(h+=a.shift());a.length>0;)v=h,g=(p=d+a.shift())+a.shift(),m=v+a.shift(),d=g+a.shift(),h=m,e.U.P.curveTo(o,p,v,g,m,d,h);else if("o10"==k||"o29"==k){var L="o10"==k?i:r;if(0==a.length);else{var B=a.pop(),G=L.Subrs[B+L.Bias];n.x=d,n.y=h,n.nStems=s,n.haveWidth=l,n.width=c,n.open=u,e.U._drawCFF(G,n,r,i,o),d=n.x,h=n.y,s=n.nStems,l=n.haveWidth,c=n.width,u=n.open}}else if("o30"==k||"o31"==k){var z=a.length,j=(A=0,"o31"==k);for(A+=z-(T=-3&z);A<T;)j?(v=h,g=(p=d+a.shift())+a.shift(),h=(m=v+a.shift())+a.shift(),T-A==5?(d=g+a.shift(),A++):d=g,j=!1):(p=d,v=h+a.shift(),g=p+a.shift(),m=v+a.shift(),d=g+a.shift(),T-A==5?(h=m+a.shift(),A++):h=m,j=!0),e.U.P.curveTo(o,p,v,g,m,d,h),A+=4}else{if("o"==(k+"").charAt(0))throw k;a.push(k)}}}n.x=d,n.y=h,n.nStems=s,n.haveWidth=l,n.width=c,n.open=u};var n=e,r={Typr:n};return t.Typr=n,t.default=r,Object.defineProperty(t,"__esModule",{value:!0}),t}({}).Typr},function(){return function(t){var e=Uint8Array,n=Uint16Array,r=Uint32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(t,e){for(var i=new n(31),o=0;o<31;++o)i[o]=e+=1<<t[o-1];var a=new r(i[30]);for(o=1;o<30;++o)for(var s=i[o];s<i[o+1];++s)a[s]=s-i[o]<<5|o;return[i,a]},l=s(i,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var f=s(o,0)[0],d=new n(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(t,e,r){for(var i=t.length,o=0,a=new n(e);o<i;++o)++a[t[o]-1];var s,l=new n(e);for(o=0;o<e;++o)l[o]=l[o-1]+a[o-1]<<1;s=new n(1<<e);var c=15-e;for(o=0;o<i;++o)if(t[o])for(var u=o<<4|t[o],f=e-t[o],h=l[t[o]-1]++<<f,p=h|(1<<f)-1;h<=p;++h)s[d[h]>>>c]=u;return s},g=new e(288);for(h=0;h<144;++h)g[h]=8;for(h=144;h<256;++h)g[h]=9;for(h=256;h<280;++h)g[h]=7;for(h=280;h<288;++h)g[h]=8;var m=new e(32);for(h=0;h<32;++h)m[h]=5;var y=v(g,9),b=v(m,5),x=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},S=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},w=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(t,e,n){var r=new Error(e||_[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,U),!n)throw r;return r},k=function(t,s,l){var u=t.length;if(!u||l&&!l.l&&u<5)return s||new e(0);var d=!s||l,h=!l||l.i;l||(l={}),s||(s=new e(3*u));var p,g=function(t){var n=s.length;if(t>n){var r=new e(Math.max(2*n,t));r.set(s),s=r}},m=l.f||0,_=l.p||0,k=l.b||0,T=l.l,E=l.d,C=l.m,D=l.n,A=8*u;do{if(!T){l.f=m=S(t,_,1);var M=S(t,_+1,3);if(_+=3,!M){var P=t[(N=((p=_)/8|0)+(7&p&&1)+4)-4]|t[N-3]<<8,F=N+P;if(F>u){h&&U(0);break}d&&g(k+P),s.set(t.subarray(N,F),k),l.b=k+=P,l.p=_=8*F;continue}if(1==M)T=y,E=b,C=9,D=5;else if(2==M){var O=S(t,_,31)+257,I=S(t,_+10,15)+4,R=O+S(t,_+5,31)+1;_+=14;for(var L=new e(R),B=new e(19),G=0;G<I;++G)B[a[G]]=S(t,_+3*G,7);_+=3*I;var z=x(B),j=(1<<z)-1,W=v(B,z);for(G=0;G<R;){var N,V=W[S(t,_,j)];if(_+=15&V,(N=V>>>4)<16)L[G++]=N;else{var H=0,X=0;for(16==N?(X=3+S(t,_,3),_+=2,H=L[G-1]):17==N?(X=3+S(t,_,7),_+=3):18==N&&(X=11+S(t,_,127),_+=7);X--;)L[G++]=H}}var q=L.subarray(0,O),$=L.subarray(O);C=x(q),D=x($),T=v(q,C),E=v($,D)}else U(1);if(_>A){h&&U(0);break}}d&&g(k+131072);for(var Y=(1<<C)-1,K=(1<<D)-1,Z=_;;Z=_){var Q=(H=T[w(t,_)&Y])>>>4;if((_+=15&H)>A){h&&U(0);break}if(H||U(2),Q<256)s[k++]=Q;else{if(256==Q){Z=_,T=null;break}var J=Q-254;if(Q>264){var tt=i[G=Q-257];J=S(t,_,(1<<tt)-1)+c[G],_+=tt}var et=E[w(t,_)&K],nt=et>>>4;if(et||U(3),_+=15&et,$=f[nt],nt>3&&(tt=o[nt],$+=w(t,_)&(1<<tt)-1,_+=tt),_>A){h&&U(0);break}d&&g(k+131072);for(var rt=k+J;k<rt;k+=4)s[k]=s[k-$],s[k+1]=s[k+1-$],s[k+2]=s[k+2-$],s[k+3]=s[k+3-$];k=rt}}l.l=T,l.p=Z,l.b=k,T&&(m=1,l.m=C,l.d=E,l.n=D)}while(!m);return k==s.length?s:function(t,i,o){(null==o||o>t.length)&&(o=t.length);var a=new(t instanceof n?n:t instanceof r?r:e)(o-0);return a.set(t.subarray(0,o)),a}(s,0,k)},T=new e(0),E="undefined"!=typeof TextDecoder&&new TextDecoder;try{E.decode(T,{stream:!0})}catch(t){}return t.convert_streams=function(t){var e=new DataView(t),n=0;function r(){var t=e.getUint16(n);return n+=2,t}function i(){var t=e.getUint32(n);return n+=4,t}function o(t){m.setUint16(y,t),y+=2}function a(t){m.setUint32(y,t),y+=4}for(var s={signature:i(),flavor:i(),length:i(),numTables:r(),reserved:r(),totalSfntSize:i(),majorVersion:r(),minorVersion:r(),metaOffset:i(),metaLength:i(),metaOrigLength:i(),privOffset:i(),privLength:i()},l=0;Math.pow(2,l)<=s.numTables;)l++;l--;for(var c=16*Math.pow(2,l),u=16*s.numTables-c,f=12,d=[],h=0;h<s.numTables;h++)d.push({tag:i(),offset:i(),compLength:i(),origLength:i(),origChecksum:i()}),f+=16;var p,v=new Uint8Array(12+16*d.length+d.reduce(function(t,e){return t+e.origLength+4},0)),g=v.buffer,m=new DataView(g),y=0;return a(s.flavor),o(s.numTables),o(c),o(l),o(u),d.forEach(function(t){a(t.tag),a(t.origChecksum),a(f),a(t.origLength),t.outOffset=f,(f+=t.origLength)%4!=0&&(f+=4-f%4)}),d.forEach(function(e){var n,r=t.slice(e.offset,e.offset+e.compLength);if(e.compLength!=e.origLength){var i=new Uint8Array(e.origLength);n=new Uint8Array(r,2),k(n,i)}else i=new Uint8Array(r);v.set(i,e.outOffset);var o=0;(f=e.outOffset+e.origLength)%4!=0&&(o=4-f%4),v.set(new Uint8Array(o).buffer,e.outOffset+e.origLength),p=f+o}),g.slice(0,p)},Object.defineProperty(t,"__esModule",{value:!0}),t}({}).convert_streams},function(t,e){const n={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let i;function o(t){if(!i){const t={R:2,L:1,D:4,C:16,U:32,T:8};i=new Map;for(let e in r){let n=0;r[e].split(",").forEach(r=>{let[o,a]=r.split("+");o=parseInt(o,36),a=a?parseInt(a,36):0,i.set(n+=o,t[e]);for(let s=a;s--;)i.set(++n,t[e])})}}return i.get(t)||32}const a=[null,"isol","init","fina","medi"];function s(t){const e=new Uint8Array(t.length);let n=32,r=1,i=-1;for(let a=0;a<t.length;a++){const s=t.codePointAt(a);let l=0|o(s),c=1;8&l||(21&n?22&l?(c=3,1!==r&&3!==r||e[i]++):33&l&&(2!==r&&4!==r||e[i]--):34&n&&(2!==r&&4!==r||e[i]--),r=e[a]=c,n=l,i=a,s>65535&&a++)}return e}function l(e,n){const r=e.GDEF&&e.GDEF.glyphClassDef;return r?t.U._getGlyphClass(n,r):0}function c(...t){for(let e=0;e<t.length;e++)if("number"==typeof t[e])return t[e]}function u(e){const r=Object.create(null),i=e["OS/2"],o=e.hhea,u=e.head.unitsPerEm,f=c(i&&i.sTypoAscender,o&&o.ascender,u),d={unitsPerEm:u,ascender:f,descender:c(i&&i.sTypoDescender,o&&o.descender,0),capHeight:c(i&&i.sCapHeight,f),xHeight:c(i&&i.sxHeight,f),lineGap:c(i&&i.sTypoLineGap,o&&o.lineGap),supportsCodePoint:n=>t.U.codeToGlyph(e,n)>0,forEachGlyph(i,o,c,u){let f=0;const h=1/d.unitsPerEm*o,p=function(e,n){const r=[];for(let o=0;o<n.length;o++){const i=n.codePointAt(o);i>65535&&o++,r.push(t.U.codeToGlyph(e,i))}const i=e.GSUB;if(i){const{lookupList:e,featureList:o}=i;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,u=[];o.forEach(i=>{if(c.test(i.tag))for(let o=0;o<i.tab.length;o++){if(u[i.tab[o]])continue;u[i.tab[o]]=!0;const c=e[i.tab[o]],f=/^(isol|init|fina|medi)$/.test(i.tag);f&&!l&&(l=s(n));for(let n=0;n<r.length;n++)l&&f&&a[l[n]]!==i.tag||t.U._applySubs(r,n,c,e)}})}return r}(e,i);let v=0;const g=function(e,n){const r=new Int16Array(3*n.length);let i=0;for(;i<n.length;i++){const c=n[i];if(-1===c)continue;r[3*i+2]=e.hmtx.aWidth[c];const u=e.GPOS;if(u){const f=u.lookupList;for(let u=0;u<f.length;u++){const d=f[u];for(let u=0;u<d.tabs.length;u++){const f=d.tabs[u];if(1===d.ltype){if(-1!==t._lctf.coverageIndex(f.coverage,c)&&f.pos){s(f.pos,i);break}}else if(2===d.ltype){let e=null,r=o();if(-1!==r){const o=t._lctf.coverageIndex(f.coverage,n[r]);if(-1!==o){if(1===f.fmt){const t=f.pairsets[o];for(let n=0;n<t.length;n++)t[n].gid2===c&&(e=t[n])}else if(2===f.fmt){const i=t.U._getGlyphClass(n[r],f.classDef1),o=t.U._getGlyphClass(c,f.classDef2);e=f.matrix[i][o]}if(e){e.val1&&s(e.val1,r),e.val2&&s(e.val2,i);break}}}}else if(4===d.ltype){const e=t._lctf.coverageIndex(f.markCoverage,c);if(-1!==e){const s=o(a),l=-1===s?-1:t._lctf.coverageIndex(f.baseCoverage,n[s]);if(-1!==l){const t=f.markArray[e],n=f.baseArray[l][t.markClass];r[3*i]=n.x-t.x+r[3*s]-r[3*s+2],r[3*i+1]=n.y-t.y+r[3*s+1];break}}}else if(6===d.ltype){const a=t._lctf.coverageIndex(f.mark1Coverage,c);if(-1!==a){const s=o();if(-1!==s){const o=n[s];if(3===l(e,o)){const e=t._lctf.coverageIndex(f.mark2Coverage,o);if(-1!==e){const t=f.mark1Array[a],n=f.mark2Array[e][t.markClass];r[3*i]=n.x-t.x+r[3*s]-r[3*s+2],r[3*i+1]=n.y-t.y+r[3*s+1];break}}}}}}}}else if(e.kern&&!e.cff){const t=o();if(-1!==t){const i=e.kern.glyph1.indexOf(n[t]);if(-1!==i){const n=e.kern.rval[i].glyph2.indexOf(c);-1!==n&&(r[3*t+2]+=e.kern.rval[i].vals[n])}}}}return r;function o(t){for(let e=i-1;e>=0;e--)if(-1!==n[e]&&(!t||t(n[e])))return e;return-1}function a(t){return 1===l(e,t)}function s(t,e){for(let n=0;n<3;n++)r[3*e+n]+=t[n]||0}}(e,p);return p.forEach((a,s)=>{if(-1!==a){let i=r[a];if(!i){const{cmds:o,crds:s}=t.U.glyphToPath(e,a);let l,c,u,f,d="",h=0;for(let t=0,e=o.length;t<e;t++){const e=n[o[t]];d+=o[t];for(let t=1;t<=e;t++)d+=(t>1?",":"")+s[h++]}if(s.length){l=c=1/0,u=f=-1/0;for(let t=0,e=s.length;t<e;t+=2){let e=s[t],n=s[t+1];e<l&&(l=e),n<c&&(c=n),e>u&&(u=e),n>f&&(f=n)}}else l=u=c=f=0;i=r[a]={index:a,advanceWidth:e.hmtx.aWidth[a],xMin:l,yMin:c,xMax:u,yMax:f,path:d}}u.call(null,i,f+g[3*s]*h,g[3*s+1]*h,v),f+=g[3*s+2]*h,c&&(f+=c*o)}v+=i.codePointAt(v)>65535?2:1}),f}};return d}return function(n){const r=new Uint8Array(n,0,4),i=t._bin.readASCII(r,0,4);if("wOFF"===i)n=e(n);else if("wOF2"===i)throw new Error("woff2 fonts not supported");return u(t.parse(n)[0])}}],init:(t,e,n)=>n(t(),e())});const kn=sn({name:"FontResolver",dependencies:[function(t,e){const n=Object.create(null),r=Object.create(null);function i(e,i){let o=n[e];o?i(o):r[e]?r[e].push(i):(r[e]=[i],function(e,n){const r=t=>{};try{const i=new XMLHttpRequest;i.open("get",e,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)new Error(i.statusText);else if(i.status>0)try{const r=t(i.response);r.src=e,n(r)}catch(r){}},i.onerror=r,i.send()}catch(i){}}(e,t=>{t.src=e,n[e]=t,r[e].forEach(e=>e(t)),delete r[e]}))}return function(t,r,{lang:o,fonts:a=[],style:s="normal",weight:l="normal",unicodeFontsURL:c}={}){const u=new Uint8Array(t.length),f=[];t.length||v();const d=new Map,h=[];if("italic"!==s&&(s="normal"),"number"!=typeof l&&(l="bold"===l?700:400),a&&!Array.isArray(a)&&(a=[a]),(a=a.slice().filter(t=>!t.lang||t.lang.test(o)).reverse()).length){const e=1,r=2;let o=0;!function s(l=0){for(let c=l,p=t.length;c<p;c++){const l=t.codePointAt(c);if(o===e&&f[u[c-1]].supportsCodePoint(l)||c>0&&/\s/.test(t[c]))u[c]=u[c-1],o===r&&(h[h.length-1][1]=c);else for(let t=u[c],p=a.length;t<=p;t++)if(t===p){(o===r?h[h.length-1]:h[h.length]=[c,c])[1]=c,o=r}else{u[c]=t;const{src:r,unicodeRange:h}=a[t];if(!h||g(l,h)){const t=n[r];if(!t)return void i(r,()=>{s(c)});if(t.supportsCodePoint(l)){let n=d.get(t);"number"!=typeof n&&(n=f.length,f.push(t),d.set(t,n)),u[c]=n,o=e;break}}}l>65535&&c+1<p&&(u[c+1]=u[c],c++,o===r&&(h[h.length-1][1]=c))}p()}()}else h.push([0,t.length-1]),p();function p(){if(h.length){const n=h.map(e=>t.substring(e[0],e[1]+1)).join("\n");e.getFontsForString(n,{lang:o||void 0,style:s,weight:l,dataUrl:c}).then(({fontUrls:t,chars:e})=>{const n=f.length;let r=0;h.forEach(t=>{for(let i=0,o=t[1]-t[0];i<=o;i++)u[t[0]+i]=e[r++]+n;r++});let o=0;t.forEach((e,r)=>{i(e,e=>{f[r+n]=e,++o===t.length&&v()})})})}else v()}function v(){r({chars:u,fonts:f})}function g(t,e){for(let n=0;n<e.length;n++){const[r,i=r]=e[n];if(r<=t&&t<=i)return!0}return!1}}},Un,function(){return function(t){var e=function(){this.buckets=new Map};e.prototype.add=function(t){var e=t>>5;this.buckets.set(e,(this.buckets.get(e)||0)|1<<(31&t))},e.prototype.has=function(t){var e=this.buckets.get(t>>5);return void 0!==e&&!!(e&1<<(31&t))},e.prototype.serialize=function(){var t=[];return this.buckets.forEach(function(e,n){t.push((+n).toString(36)+":"+e.toString(36))}),t.join(",")},e.prototype.deserialize=function(t){var e=this;this.buckets.clear(),t.split(",").forEach(function(t){var n=t.split(":");e.buckets.set(parseInt(n[0],36),parseInt(n[1],36))})};var n=Math.pow(2,8),r=n-1,i=~r;function o(t){var e=function(t){return t&i}(t).toString(16),r=function(t){return(t&i)+n-1}(t).toString(16);return"codepoint-index/plane"+(t>>16)+"/"+e+"-"+r+".json"}function a(t,e){var n=t&r,i=e.codePointAt(n/6|0);return!!((i=(i||48)-48)&1<<n%6)}function s(t,e){!function(t,e){var n;(n=t,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(t){return t.split("-").map(function(t){return parseInt(t.trim(),16)})})).forEach(function(t){var n=t[0],r=t[1];void 0===r&&(r=n),e(n,r)})}(t,function(t,n){for(var r=t;r<=n;r++)e(r)})}var l={},c={},u=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(t){var n=u.get(t);return n||(n=new e,s(t.ranges,function(t){return n.add(t)}),u.set(t,n)),n}var h,p=new Map;function v(t,e,n){return t[e]?e:t[n]?n:function(t){for(var e in t)return e}(t)}function g(t,e){var n=e;if(!t.includes(n)){n=1/0;for(var r=0;r<t.length;r++)Math.abs(t[r]-e)<Math.abs(n-e)&&(n=t[r])}return n}function m(t){return h||(h=new Set,s("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(t){h.add(t)})),h.has(t)}return t.CodePointSet=e,t.clearCache=function(){l={},c={}},t.getFontsForString=function(t,e){void 0===e&&(e={});var n,r=e.lang;void 0===r&&(r=/\p{Script=Hangul}/u.test(n=t)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(n)?"ja":"en");var i=e.category;void 0===i&&(i="sans-serif");var s=e.style;void 0===s&&(s="normal");var u=e.weight;void 0===u&&(u=400);var h=(e.dataUrl||f).replace(/\/$/g,""),y=new Map,b=new Uint8Array(t.length),x={},S={},w=new Array(t.length),_=new Map,U=!1;function k(t){var e=p.get(t);return e||(e=fetch(h+"/"+t).then(function(t){if(!t.ok)throw new Error(t.statusText);return t.json().then(function(t){if(!Array.isArray(t)||1!==t[0])throw new Error("Incorrect schema version; need 1, got "+t[0]);return t[1]})}).catch(function(e){if(h!==f)return U||(U=!0),h=f,p.delete(t),k(t);throw e}),p.set(t,e)),e}for(var T=function(e){var n=t.codePointAt(e),r=o(n);w[e]=r,l[r]||_.has(r)||_.set(r,k(r).then(function(t){l[r]=t})),n>65535&&(e++,E=e)},E=0;E<t.length;E++)T(E);return Promise.all(_.values()).then(function(){_.clear();for(var e=function(e){var i=t.codePointAt(e),o=null,s=l[w[e]],u=void 0;for(var f in s){var d=S[f];if(void 0===d&&(d=S[f]=new RegExp(f).test(r||"en")),d){for(var h in u=f,s[f])if(a(i,s[f][h])){o=h;break}break}}if(!o)t:for(var p in s)if(p!==u)for(var v in s[p])if(a(i,s[p][v])){o=v;break t}o||(o="latin"),w[e]=o,c[o]||_.has(o)||_.set(o,k("font-meta/"+o+".json").then(function(t){c[o]=t})),i>65535&&(e++,n=e)},n=0;n<t.length;n++)e(n);return Promise.all(_.values())}).then(function(){for(var e,n=null,r=0;r<t.length;r++){var o=t.codePointAt(r);if(n&&(m(o)||d(n).has(o)))b[r]=b[r-1];else{n=c[w[r]];var a=x[n.id];if(!a){var l=n.typeforms,f=v(l,i,"sans-serif"),p=v(l[f],s,"normal"),S=g(null===(e=l[f])||void 0===e?void 0:e[p],u);a=x[n.id]=h+"/font-files/"+n.id+"/"+f+"."+p+"."+S+".woff"}var _=y.get(a);null==_&&(_=y.size,y.set(a,_)),b[r]=_}o>65535&&(r++,b[r]=b[r-1])}return{fontUrls:Array.from(y.keys()),chars:b}})},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}],init:(t,e,n)=>t(e,n())});const Tn=()=>(self.performance||Date).now(),En=un();let Cn;const Dn=[];let An=0;function Mn(){const t=Tn();for(;Dn.length&&Tn()-t<5;)Dn.shift()();An=Dn.length?setTimeout(Mn,0):0}const Pn=(...t)=>new Promise((e,n)=>{Dn.push(()=>{const r=Tn();try{En.webgl.generateIntoCanvas(...t),e({timing:Tn()-r})}catch(i){n(i)}}),An||(An=setTimeout(Mn,0))}),Fn=4,On=2e3,In={};let Rn=0;function Ln(t,e,n,r,i,o,a,s,l,c){const u="TroikaTextSDFGenerator_JS_"+Rn++%Fn;let f=In[u];return f||(f=In[u]={workerModule:sn({name:u,workerId:u,dependencies:[un,Tn],init(t,e){const n=t().javascript.generate;return function(...t){const r=e();return{textureData:n(...t),timing:e()-r}}},getTransferables:t=>[t.textureData.buffer]}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(t,e,n,r,i,o).then(({textureData:n,timing:r})=>{const i=Tn(),o=new Uint8Array(4*n.length);for(let t=0;t<n.length;t++)o[4*t+c]=n[t];return En.webglUtils.renderImageData(a,o,s,l,t,e,1<<3-c),r+=Tn()-i,0===--f.requests&&(f.idleTimer=setTimeout(()=>{!function(t){on[t]&&on[t].forEach(function(t){t()}),rn[t]&&(rn[t].terminate(),delete rn[t])}(u)},On)),{timing:r}})}const Bn=En.webglUtils.resizeWebGLCanvasWithoutClearing,Gn={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},zn=new P;function jn(){return(self.performance||Date).now()}const Wn=Object.create(null);function Nn(t,e){t=function(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({},t);const n=jn(),r=[];if(t.font&&r.push({label:"user",src:Xn(t.font)}),t.font=r,t.text=""+t.text,t.sdfGlyphSize=t.sdfGlyphSize||Gn.sdfGlyphSize,t.unicodeFontsURL=t.unicodeFontsURL||Gn.unicodeFontsURL,null!=t.colorRanges){let e={};for(let n in t.colorRanges)if(t.colorRanges.hasOwnProperty(n)){let r=t.colorRanges[n];"number"!=typeof r&&(r=zn.set(r).getHex()),e[n]=r}t.colorRanges=e}Object.freeze(t);const{textureWidth:i,sdfExponent:o}=Gn,{sdfGlyphSize:a}=t,s=i/a*4;let l=Wn[a];if(!l){const t=document.createElement("canvas");t.width=i,t.height=256*a/s,l=Wn[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:t,sdfTexture:new G(t,void 0,void 0,void 0,z,z),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,function(t){const e=t.sdfCanvas;e.addEventListener("webglcontextlost",e=>{e.preventDefault(),t.contextLost=!0}),e.addEventListener("webglcontextrestored",e=>{t.contextLost=!1;const n=[];t.glyphsByFont.forEach(e=>{e.forEach(e=>{n.push(Vn(e,t,!0))})}),Promise.all(n).then(()=>{qn(t),t.sdfTexture.needsUpdate=!0})})}(l)}const{sdfTexture:c,sdfCanvas:u}=l;Yn(t).then(r=>{const{glyphIds:f,glyphFontIndices:d,fontData:h,glyphPositions:p,fontSize:v,timings:g}=r,m=[],y=new Float32Array(4*f.length);let b=0,x=0;const S=jn(),w=h.map(t=>{let e=l.glyphsByFont.get(t.src);return e||l.glyphsByFont.set(t.src,e=new Map),e});f.forEach((t,e)=>{const n=d[e],{src:i,unitsPerEm:o}=h[n];let s=w[n].get(t);if(!s){const{path:e,pathBounds:o}=r.glyphData[i][t],c=Math.max(o[2]-o[0],o[3]-o[1])/a*(Gn.sdfMargin*a+.5),u=l.glyphCount++,f=[o[0]-c,o[1]-c,o[2]+c,o[3]+c];w[n].set(t,s={path:e,atlasIndex:u,sdfViewBox:f}),m.push(s)}const{sdfViewBox:c}=s,u=p[x++],g=p[x++],S=v/o;y[b++]=u+c[0]*S,y[b++]=g+c[1]*S,y[b++]=u+c[2]*S,y[b++]=g+c[3]*S,f[e]=s.atlasIndex}),g.quads=(g.quads||0)+(jn()-S);const _=jn();g.sdf={};const U=u.height,k=Math.ceil(l.glyphCount/s),T=Math.pow(2,Math.ceil(Math.log2(k*a)));T>U&&(Bn(u,i,T),c.dispose()),Promise.all(m.map(e=>Vn(e,l,t.gpuAccelerateSDF).then(({timing:t})=>{g.sdf[e.atlasIndex]=t}))).then(()=>{m.length&&!l.contextLost&&(qn(l),c.needsUpdate=!0),g.sdfTotal=jn()-_,g.total=jn()-n,e(Object.freeze({parameters:t,sdfTexture:c,sdfGlyphSize:a,sdfExponent:o,glyphBounds:y,glyphAtlasIndices:f,glyphColors:r.glyphColors,caretPositions:r.caretPositions,chunkedBounds:r.chunkedBounds,ascender:r.ascender,descender:r.descender,lineHeight:r.lineHeight,capHeight:r.capHeight,xHeight:r.xHeight,topBaseline:r.topBaseline,blockBounds:r.blockBounds,visibleBounds:r.visibleBounds,timings:r.timings}))})}),Promise.resolve().then(()=>{var t;l.contextLost||(t=u)._warm||(En.webgl.isSupported(t),t._warm=!0)})}function Vn({path:t,atlasIndex:e,sdfViewBox:n},{sdfGlyphSize:r,sdfCanvas:i,contextLost:o},a){if(o)return Promise.resolve({timing:-1});const{textureWidth:s,sdfExponent:l}=Gn,c=Math.max(n[2]-n[0],n[3]-n[1]),u=Math.floor(e/4);return function(t,e,n,r,i,o,a,s,l,c,u=!0){return u?Pn(t,e,n,r,i,o,a,s,l,c).then(null,u=>(Cn||(Cn=!0),Ln(t,e,n,r,i,o,a,s,l,c))):Ln(t,e,n,r,i,o,a,s,l,c)}(r,r,t,n,c,l,i,u%(s/r)*r,Math.floor(u/(s/r))*r,e%4,a)}let Hn;function Xn(t){return Hn||(Hn="undefined"==typeof document?{}:document.createElement("a")),Hn.href=t,Hn.href}function qn(t){if("function"!=typeof createImageBitmap){const{sdfCanvas:e,sdfTexture:n}=t,{width:r,height:i}=e,o=t.sdfCanvas.getContext("webgl");let a=n.image.data;a&&a.length===r*i*4||(a=new Uint8Array(r*i*4),n.image={width:r,height:i,data:a},n.flipY=!1,n.isDataTexture=!0),o.readPixels(0,0,r,i,o.RGBA,o.UNSIGNED_BYTE,a)}}const $n=sn({name:"Typesetter",dependencies:[function(t,e){const n=1/0,r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,i="[^\\S\\u00A0]",o=new RegExp(`${i}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:a="",font:f,lang:d,sdfGlyphSize:h=64,fontSize:p=400,fontWeight:v=1,fontStyle:g="normal",letterSpacing:m=0,lineHeight:y="normal",maxWidth:b=n,direction:x,textAlign:S="left",textIndent:w=0,whiteSpace:_="normal",overflowWrap:U="normal",anchorX:k=0,anchorY:T=0,metricsOnly:E=!1,unicodeFontsURL:C,preResolvedFonts:D=null,includeCaretPositions:A=!1,chunkedBoundsSize:M=8192,colorRanges:P=null},F){const O=c(),I={fontLoad:0,typesetting:0};a.indexOf("\r")>-1&&(a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,m=+m,b=+b,y=y||"normal",w=+w,function({text:e,lang:n,fonts:r,style:i,weight:o,preResolvedFonts:a,unicodeFontsURL:s},l){const c=({chars:t,fonts:e})=>{let n,r;const i=[];for(let o=0;o<t.length;o++)t[o]!==r?(r=t[o],i.push(n={start:o,end:o,fontObj:e[t[o]]})):n.end=o;l(i)};a?c(a):t(e,c,{lang:n,fonts:r,style:i,weight:o,unicodeFontsURL:s})}({text:a,lang:d,style:g,weight:v,fonts:"string"==typeof f?[{src:f}]:f,unicodeFontsURL:C,preResolvedFonts:D},t=>{I.fontLoad=c()-O;const f=isFinite(b);let d=null,h=null,v=null,g=null,C=null,D=null,R=null,L=null,B=0,G=0,z="nowrap"!==_;const j=new Map,W=c();let N=w,V=0,H=new u;const X=[H];t.forEach(t=>{const{fontObj:e}=t,{ascender:n,descender:s,unitsPerEm:l,lineGap:c,capHeight:d,xHeight:h}=e;let v=j.get(e);if(!v){const t=p/l,r="normal"===y?(n-s+c)*t:y*p,i=(r-(n-s)*t)/2,o=Math.min(r,(n-s)*t),a=(n+s)/2*t+o/2;v={index:j.size,src:e.src,fontObj:e,fontSizeMult:t,unitsPerEm:l,ascender:n*t,descender:s*t,capHeight:d*t,xHeight:h*t,lineHeight:r,baseline:-i-n*t,caretTop:a,caretBottom:a-o},j.set(e,v)}const{fontSizeMult:g}=v,x=a.slice(t.start,t.end+1);let S,_;e.forEachGlyph(x,p,m,(e,n,s,l)=>{n+=V,l+=t.start,S=n,_=e;const c=a.charAt(l),d=e.advanceWidth*g,h=H.count;let y;if("isEmpty"in e||(e.isWhitespace=!!c&&new RegExp(i).test(c),e.canBreakAfter=!!c&&o.test(c),e.isEmpty=e.xMin===e.xMax||e.yMin===e.yMax||r.test(c)),e.isWhitespace||e.isEmpty||G++,z&&f&&!e.isWhitespace&&n+d+N>b&&h){if(H.glyphAt(h-1).glyphObj.canBreakAfter)y=new u,N=-n;else for(let t=h;t--;){if(0===t&&"break-word"===U){y=new u,N=-n;break}if(H.glyphAt(t).glyphObj.canBreakAfter){y=H.splitAt(t+1);const e=y.glyphAt(0).x;N-=e;for(let t=y.count;t--;)y.glyphAt(t).x-=e;break}}y&&(H.isSoftWrapped=!0,H=y,X.push(H),B=b)}let x=H.glyphAt(H.count);x.glyphObj=e,x.x=n+N,x.y=s,x.width=d,x.charIndex=l,x.fontData=v,"\n"===c&&(H=new u,X.push(H),N=-(n+d+m*p)+w)}),V=S+_.advanceWidth*g+m*p});let q=0;X.forEach(t=>{let e=!0;for(let n=t.count;n--;){const r=t.glyphAt(n);e&&!r.glyphObj.isWhitespace&&(t.width=r.x+r.width,t.width>B&&(B=t.width),e=!1);let{lineHeight:i,capHeight:o,xHeight:a,baseline:s}=r.fontData;i>t.lineHeight&&(t.lineHeight=i);const l=s-t.baseline;l<0&&(t.baseline+=l,t.cap+=l,t.ex+=l),t.cap=Math.max(t.cap,t.baseline+o),t.ex=Math.max(t.ex,t.baseline+a)}t.baseline-=q,t.cap-=q,t.ex-=q,q+=t.lineHeight});let $=0,Y=0;if(k&&("number"==typeof k?$=-k:"string"==typeof k&&($=-B*("left"===k?0:"center"===k?.5:"right"===k?1:s(k)))),T&&("number"==typeof T?Y=-T:"string"==typeof T&&(Y="top"===T?0:"top-baseline"===T?-X[0].baseline:"top-cap"===T?-X[0].cap:"top-ex"===T?-X[0].ex:"middle"===T?q/2:"bottom"===T?q:"bottom-baseline"===T?-X[X.length-1].baseline:s(T)*q)),!E){const t=e.getEmbeddingLevels(a,x);d=new Uint16Array(G),h=new Uint8Array(G),v=new Float32Array(2*G),g={},R=[n,n,-1/0,-1/0],L=[],A&&(D=new Float32Array(4*a.length)),P&&(C=new Uint8Array(3*G));let r,i,o=0,s=-1,c=-1;if(X.forEach((u,f)=>{let{count:p,width:m}=u;if(p>0){let f=0;for(let t=p;t--&&u.glyphAt(t).glyphObj.isWhitespace;)f++;let y=0,b=0;if("center"===S)y=(B-m)/2;else if("right"===S)y=B-m;else if("justify"===S&&u.isSoftWrapped){let t=0;for(let e=p-f;e--;)u.glyphAt(e).glyphObj.isWhitespace&&t++;b=(B-m)/t}if(b||y){let t=0;for(let e=0;e<p;e++){let n=u.glyphAt(e);const r=n.glyphObj;n.x+=y+t,0!==b&&r.isWhitespace&&e<p-f&&(t+=b,n.width+=b)}}const x=e.getReorderSegments(a,t,u.glyphAt(0).charIndex,u.glyphAt(u.count-1).charIndex);for(let t=0;t<x.length;t++){const[e,n]=x[t];let r=1/0,i=-1/0;for(let t=0;t<p;t++)if(u.glyphAt(t).charIndex>=e){let e=t,o=t;for(;o<p;o++){let t=u.glyphAt(o);if(t.charIndex>n)break;o<p-f&&(r=Math.min(r,t.x),i=Math.max(i,t.x+t.width))}for(let t=e;t<o;t++){const e=u.glyphAt(t);e.x=i-(e.x+e.width-r)}break}}let w;const _=t=>w=t;for(let m=0;m<p;m++){const f=u.glyphAt(m);w=f.glyphObj;const p=w.index,y=1&t.levels[f.charIndex];if(y){const t=e.getMirroredCharacter(a[f.charIndex]);t&&f.fontData.fontObj.forEachGlyph(t,0,0,_)}if(A){const{charIndex:t,fontData:e}=f,n=f.x+$,r=f.x+f.width+$;D[4*t]=y?r:n,D[4*t+1]=y?n:r,D[4*t+2]=u.baseline+e.caretBottom+Y,D[4*t+3]=u.baseline+e.caretTop+Y;const i=t-s;i>1&&l(D,s,i),s=t}if(P){const{charIndex:t}=f;for(;t>c;)c++,P.hasOwnProperty(c)&&(i=P[c])}if(!w.isWhitespace&&!w.isEmpty){const t=o++,{fontSizeMult:e,src:a,index:s}=f.fontData,l=g[a]||(g[a]={});l[p]||(l[p]={path:w.path,pathBounds:[w.xMin,w.yMin,w.xMax,w.yMax]});const c=f.x+$,m=f.y+u.baseline+Y;v[2*t]=c,v[2*t+1]=m;const y=c+w.xMin*e,b=m+w.yMin*e,x=c+w.xMax*e,S=m+w.yMax*e;y<R[0]&&(R[0]=y),b<R[1]&&(R[1]=b),x>R[2]&&(R[2]=x),S>R[3]&&(R[3]=S),t%M===0&&(r={start:t,end:t,rect:[n,n,-1/0,-1/0]},L.push(r)),r.end++;const _=r.rect;if(y<_[0]&&(_[0]=y),b<_[1]&&(_[1]=b),x>_[2]&&(_[2]=x),S>_[3]&&(_[3]=S),d[t]=p,h[t]=s,P){const e=3*t;C[e]=i>>16&255,C[e+1]=i>>8&255,C[e+2]=255&i}}}}}),D){const t=a.length-s;t>1&&l(D,s,t)}}const K=[];j.forEach(({index:t,src:e,unitsPerEm:n,ascender:r,descender:i,lineHeight:o,capHeight:a,xHeight:s})=>{K[t]={src:e,unitsPerEm:n,ascender:r,descender:i,lineHeight:o,capHeight:a,xHeight:s}}),I.typesetting=c()-W,F({glyphIds:d,glyphFontIndices:h,glyphPositions:v,glyphData:g,fontData:K,caretPositions:D,glyphColors:C,chunkedBounds:L,fontSize:p,topBaseline:Y+X[0].baseline,blockBounds:[$,Y-q,$+B,Y],visibleBounds:R,timings:I})})}function s(t){let e=t.match(/^([\d.]+)%$/),n=e?parseFloat(e[1]):NaN;return isNaN(n)?0:n/100}function l(t,e,n){const r=t[4*e],i=t[4*e+1],o=t[4*e+2],a=t[4*e+3],s=(i-r)/n;for(let l=0;l<n;l++){const n=4*(e+l);t[n]=r+s*l,t[n+1]=r+s*(l+1),t[n+2]=o,t[n+3]=a}}function c(){return(self.performance||Date).now()}function u(){this.data=[]}const f=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(t){let e=u.flyweight;return e.data=this.data,e.index=t,e},splitAt(t){let e=new u;return e.data=this.data.splice(t*f.length),e}},u.flyweight=f.reduce((t,e,n,r)=>(Object.defineProperty(t,e,{get(){return this.data[this.index*f.length+n]},set(t){this.data[this.index*f.length+n]=t}}),t),{data:null,index:0}),{typeset:a,measure:function(t,e){a({...t,metricsOnly:!0},t=>{const[n,r,i,o]=t.blockBounds;e({width:i-n,height:o-r})})}}},kn,function(){return function(t){var e={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(e).forEach(function(t,e){n[t]=1<<e+1,r[n[t]]=t}),Object.freeze(n);var i=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,s=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,l=n.S|n.WS|n.B|i|n.PDI|s,c=null;function u(t){return function(){if(!c){c=new Map;var t=function(t){if(e.hasOwnProperty(t)){var r=0;e[t].split(",").forEach(function(e){var i=e.split("+"),o=i[0],a=i[1];o=parseInt(o,36),a=a?parseInt(a,36):0,c.set(r+=o,n[t]);for(var s=0;s<a;s++)c.set(++r,n[t])})}};for(var r in e)t(r)}}(),c.get(t.codePointAt(0))||n.L}var f,d,h,p="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",v="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function g(t,e){var n,r=0,i=new Map,o=e&&new Map;return t.split(",").forEach(function t(a){if(-1!==a.indexOf("+"))for(var s=+a;s--;)t(n);else{n=a;var l=a.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(r+=parseInt(c,36)),u=String.fromCodePoint(r+=parseInt(u,36)),i.set(c,u),e&&o.set(u,c)}}),{map:i,reverseMap:o}}function m(){if(!f){var t=g(p,!0),e=t.map,n=t.reverseMap;f=e,d=n,h=g(v,!1).map}}function y(t){return m(),f.get(t)||null}function b(t){return m(),d.get(t)||null}function x(t){return m(),h.get(t)||null}var S=n.L,w=n.R,_=n.EN,U=n.ES,k=n.ET,T=n.AN,E=n.CS,C=n.B,D=n.S,A=n.ON,M=n.BN,P=n.NSM,F=n.AL,O=n.LRO,I=n.RLO,R=n.LRE,L=n.RLE,B=n.PDF,G=n.LRI,z=n.RLI,j=n.FSI,W=n.PDI;var N;function V(t){return function(){if(!N){var t=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),e=t.map;t.reverseMap.forEach(function(t,n){e.set(n,t)}),N=e}}(),N.get(t)||null}function H(t,e,n,r){var i=t.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);var o=[];return e.paragraphs.forEach(function(i){var a=Math.max(n,i.start),s=Math.min(r,i.end);if(a<s){for(var c=e.levels.slice(a,s+1),f=s;f>=a&&u(t[f])&l;f--)c[f]=i.level;for(var d=i.level,h=1/0,p=0;p<c.length;p++){var v=c[p];v>d&&(d=v),v<h&&(h=1|v)}for(var g=d;g>=h;g--)for(var m=0;m<c.length;m++)if(c[m]>=g){for(var y=m;m+1<c.length&&c[m+1]>=g;)m++;m>y&&o.push([y+a,m+a])}}}),o}function X(t,e,n,r){for(var i=H(t,e,n,r),o=[],a=0;a<t.length;a++)o[a]=a;return i.forEach(function(t){for(var e=t[0],n=t[1],r=o.slice(e,n+1),i=r.length;i--;)o[n-i]=r[i]}),o}return t.closingToOpeningBracket=b,t.getBidiCharType=u,t.getBidiCharTypeName=function(t){return r[u(t)]},t.getCanonicalBracket=x,t.getEmbeddingLevels=function(t,e){for(var n=new Uint32Array(t.length),r=0;r<t.length;r++)n[r]=u(t[r]);var c=new Map;function f(t,e){var r=n[t];n[t]=e,c.set(r,c.get(r)-1),r&a&&c.set(a,c.get(a)-1),c.set(e,(c.get(e)||0)+1),e&a&&c.set(a,(c.get(a)||0)+1)}for(var d=new Uint8Array(t.length),h=new Map,p=[],v=null,g=0;g<t.length;g++)v||p.push(v={start:g,end:t.length-1,level:"rtl"===e?1:"ltr"===e?0:je(g,!1)}),n[g]&C&&(v.end=g,v=null);for(var m=L|R|I|O|i|W|B|C,N=function(t){return t+(1&t?1:2)},V=function(t){return t+(1&t?2:1)},H=0;H<p.length;H++){var X=[{_level:(v=p[H]).level,_override:0,_isolate:0}],q=void 0,$=0,Y=0,K=0;c.clear();for(var Z=v.start;Z<=v.end;Z++){var Q=n[Z];if(q=X[X.length-1],c.set(Q,(c.get(Q)||0)+1),Q&a&&c.set(a,(c.get(a)||0)+1),Q&m)if(Q&(L|R)){d[Z]=q._level;var J=(Q===L?V:N)(q._level);J<=125&&!$&&!Y?X.push({_level:J,_override:0,_isolate:0}):$||Y++}else if(Q&(I|O)){d[Z]=q._level;var tt=(Q===I?V:N)(q._level);tt<=125&&!$&&!Y?X.push({_level:tt,_override:Q&I?w:S,_isolate:0}):$||Y++}else if(Q&i){Q&j&&(Q=1===je(Z+1,!0)?z:G),d[Z]=q._level,q._override&&f(Z,q._override);var et=(Q===z?V:N)(q._level);et<=125&&0===$&&0===Y?(K++,X.push({_level:et,_override:0,_isolate:1,_isolInitIndex:Z})):$++}else if(Q&W){if($>0)$--;else if(K>0){for(Y=0;!X[X.length-1]._isolate;)X.pop();var nt=X[X.length-1]._isolInitIndex;null!=nt&&(h.set(nt,Z),h.set(Z,nt)),X.pop(),K--}q=X[X.length-1],d[Z]=q._level,q._override&&f(Z,q._override)}else Q&B?(0===$&&(Y>0?Y--:!q._isolate&&X.length>1&&(X.pop(),q=X[X.length-1])),d[Z]=q._level):Q&C&&(d[Z]=v.level);else d[Z]=q._level,q._override&&Q!==M&&f(Z,q._override)}for(var rt=[],it=null,ot=v.start;ot<=v.end;ot++){var at=n[ot];if(!(at&s)){var st=d[ot],lt=at&i,ct=at===W;it&&st===it._level?(it._end=ot,it._endsWithIsolInit=lt):rt.push(it={_start:ot,_end:ot,_level:st,_startsWithPDI:ct,_endsWithIsolInit:lt})}}for(var ut=[],ft=0;ft<rt.length;ft++){var dt=rt[ft];if(!dt._startsWithPDI||dt._startsWithPDI&&!h.has(dt._start)){for(var ht=[it=dt],pt=void 0;it&&it._endsWithIsolInit&&null!=(pt=h.get(it._end));)for(var vt=ft+1;vt<rt.length;vt++)if(rt[vt]._start===pt){ht.push(it=rt[vt]);break}for(var gt=[],mt=0;mt<ht.length;mt++)for(var yt=ht[mt],bt=yt._start;bt<=yt._end;bt++)gt.push(bt);for(var xt=d[gt[0]],St=v.level,wt=gt[0]-1;wt>=0;wt--)if(!(n[wt]&s)){St=d[wt];break}var _t=gt[gt.length-1],Ut=d[_t],kt=v.level;if(!(n[_t]&i))for(var Tt=_t+1;Tt<=v.end;Tt++)if(!(n[Tt]&s)){kt=d[Tt];break}ut.push({_seqIndices:gt,_sosType:Math.max(St,xt)%2?w:S,_eosType:Math.max(kt,Ut)%2?w:S})}}for(var Et=0;Et<ut.length;Et++){var Ct=ut[Et],Dt=Ct._seqIndices,At=Ct._sosType,Mt=Ct._eosType,Pt=1&d[Dt[0]]?w:S;if(c.get(P))for(var Ft=0;Ft<Dt.length;Ft++){var Ot=Dt[Ft];if(n[Ot]&P){for(var It=At,Rt=Ft-1;Rt>=0;Rt--)if(!(n[Dt[Rt]]&s)){It=n[Dt[Rt]];break}f(Ot,It&(i|W)?A:It)}}if(c.get(_))for(var Lt=0;Lt<Dt.length;Lt++){var Bt=Dt[Lt];if(n[Bt]&_)for(var Gt=Lt-1;Gt>=-1;Gt--){var zt=-1===Gt?At:n[Dt[Gt]];if(zt&o){zt===F&&f(Bt,T);break}}}if(c.get(F))for(var jt=0;jt<Dt.length;jt++){var Wt=Dt[jt];n[Wt]&F&&f(Wt,w)}if(c.get(U)||c.get(E))for(var Nt=1;Nt<Dt.length-1;Nt++){var Vt=Dt[Nt];if(n[Vt]&(U|E)){for(var Ht=0,Xt=0,qt=Nt-1;qt>=0&&(Ht=n[Dt[qt]])&s;qt--);for(var $t=Nt+1;$t<Dt.length&&(Xt=n[Dt[$t]])&s;$t++);Ht===Xt&&(n[Vt]===U?Ht===_:Ht&(_|T))&&f(Vt,Ht)}}if(c.get(_))for(var Yt=0;Yt<Dt.length;Yt++){var Kt=Dt[Yt];if(n[Kt]&_){for(var Zt=Yt-1;Zt>=0&&n[Dt[Zt]]&(k|s);Zt--)f(Dt[Zt],_);for(Yt++;Yt<Dt.length&&n[Dt[Yt]]&(k|s|_);Yt++)n[Dt[Yt]]!==_&&f(Dt[Yt],_)}}if(c.get(k)||c.get(U)||c.get(E))for(var Qt=0;Qt<Dt.length;Qt++){var Jt=Dt[Qt];if(n[Jt]&(k|U|E)){f(Jt,A);for(var te=Qt-1;te>=0&&n[Dt[te]]&s;te--)f(Dt[te],A);for(var ee=Qt+1;ee<Dt.length&&n[Dt[ee]]&s;ee++)f(Dt[ee],A)}}if(c.get(_))for(var ne=0,re=At;ne<Dt.length;ne++){var ie=Dt[ne],oe=n[ie];oe&_?re===S&&f(ie,S):oe&o&&(re=oe)}if(c.get(a)){for(var ae=w|_|T,se=ae|S,le=[],ce=[],ue=0;ue<Dt.length;ue++)if(n[Dt[ue]]&a){var fe=t[Dt[ue]],de=void 0;if(null!==y(fe)){if(!(ce.length<63))break;ce.push({char:fe,seqIndex:ue})}else if(null!==(de=b(fe)))for(var he=ce.length-1;he>=0;he--){var pe=ce[he].char;if(pe===de||pe===b(x(fe))||y(x(pe))===fe){le.push([ce[he].seqIndex,ue]),ce.length=he;break}}}le.sort(function(t,e){return t[0]-e[0]});for(var ve=0;ve<le.length;ve++){for(var ge=le[ve],me=ge[0],ye=ge[1],be=!1,xe=0,Se=me+1;Se<ye;Se++){var we=Dt[Se];if(n[we]&se){be=!0;var _e=n[we]&ae?w:S;if(_e===Pt){xe=_e;break}}}if(be&&!xe){xe=At;for(var Ue=me-1;Ue>=0;Ue--){var ke=Dt[Ue];if(n[ke]&se){var Te=n[ke]&ae?w:S;xe=Te!==Pt?Te:Pt;break}}}if(xe){if(n[Dt[me]]=n[Dt[ye]]=xe,xe!==Pt)for(var Ee=me+1;Ee<Dt.length;Ee++)if(!(n[Dt[Ee]]&s)){u(t[Dt[Ee]])&P&&(n[Dt[Ee]]=xe);break}if(xe!==Pt)for(var Ce=ye+1;Ce<Dt.length;Ce++)if(!(n[Dt[Ce]]&s)){u(t[Dt[Ce]])&P&&(n[Dt[Ce]]=xe);break}}}for(var De=0;De<Dt.length;De++)if(n[Dt[De]]&a){for(var Ae=De,Me=De,Pe=At,Fe=De-1;Fe>=0;Fe--){if(!(n[Dt[Fe]]&s)){Pe=n[Dt[Fe]]&ae?w:S;break}Ae=Fe}for(var Oe=Mt,Ie=De+1;Ie<Dt.length;Ie++){if(!(n[Dt[Ie]]&(a|s))){Oe=n[Dt[Ie]]&ae?w:S;break}Me=Ie}for(var Re=Ae;Re<=Me;Re++)n[Dt[Re]]=Pe===Oe?Pe:Pt;De=Me}}}for(var Le=v.start;Le<=v.end;Le++){var Be=d[Le],Ge=n[Le];if(1&Be?Ge&(S|_|T)&&d[Le]++:Ge&w?d[Le]++:Ge&(T|_)&&(d[Le]+=2),Ge&s&&(d[Le]=0===Le?v.level:d[Le-1]),Le===v.end||u(t[Le])&(D|C))for(var ze=Le;ze>=0&&u(t[ze])&l;ze--)d[ze]=v.level}}return{levels:d,paragraphs:p};function je(e,r){for(var o=e;o<t.length;o++){var a=n[o];if(a&(w|F))return 1;if(a&(C|S)||r&&a===W)return 0;if(a&i){var s=We(o);o=-1===s?t.length:s}}return 0}function We(e){for(var r=1,o=e+1;o<t.length;o++){var a=n[o];if(a&C)break;if(a&W){if(0===--r)return o}else a&i&&r++}return-1}},t.getMirroredCharacter=V,t.getMirroredCharactersMap=function(t,e,n,r){var i=t.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);for(var o=new Map,a=n;a<=r;a++)if(1&e[a]){var s=V(t[a]);null!==s&&o.set(a,s)}return o},t.getReorderSegments=H,t.getReorderedIndices=X,t.getReorderedString=function(t,e,n,r){var i=X(t,e,n,r),o=[].concat(t);return i.forEach(function(n,r){o[r]=(1&e.levels[n]?V(t[n]):null)||t[n]}),o.join("")},t.openingToClosingBracket=y,Object.defineProperty(t,"__esModule",{value:!0}),t}({})}],init:(t,e,n)=>t(e,n())}),Yn=sn({name:"Typesetter",dependencies:[$n],init:t=>function(e){return new Promise(n=>{t.typeset(e,n)})},getTransferables(t){const e=[];for(let n in t)t[n]&&t[n].buffer&&e.push(t[n].buffer);return e}});Yn.onMainThread;const Kn={};const Zn="aTroikaGlyphIndex";class Qn extends m{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new _,this.boundingBox=new w}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,("number"!=typeof t||t<1)&&(t=1);let e=function(t){let e=Kn[t];return e||(e=Kn[t]=new W(1,1,t,t).translate(.5,.5,0)),e}(t);["position","normal","uv"].forEach(t=>{this.attributes[t]=e.attributes[t].clone()}),this.setIndex(e.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,e,n,r,i){this.updateAttributeData("aTroikaGlyphBounds",t,4),this.updateAttributeData(Zn,e,1),this.updateAttributeData("aTroikaGlyphColor",i,3),this._blockBounds=n,this._chunkedBounds=r,this.instanceCount=e.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:e,boundingBox:n}=this;if(e){const{PI:r,floor:i,min:o,max:a,sin:s,cos:l}=Math,c=r/2,u=2*r,f=Math.abs(e),d=t[0]/f,h=t[2]/f,p=i((d+c)/u)!==i((h+c)/u)?-f:o(s(d)*f,s(h)*f),v=i((d-c)/u)!==i((h-c)/u)?f:a(s(d)*f,s(h)*f),g=i((d+r)/u)!==i((h+r)/u)?2*f:a(f-l(d)*f,f-l(h)*f);n.min.set(p,t[1],e<0?-g:0),n.max.set(v,t[3],e<0?0:g)}else n.min.set(t[0],t[1],0),n.max.set(t[2],t[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let e=this.getAttribute(Zn).count,n=this._chunkedBounds;if(n)for(let r=n.length;r--;){e=n[r].end;let i=n[r].rect;if(i[1]<t.w&&i[3]>t.y&&i[0]<t.z&&i[2]>t.x)break}this.instanceCount=e}updateAttributeData(t,e,n){const r=this.getAttribute(t);e?r&&r.array.length===e.length?(r.array.set(e),r.needsUpdate=!0):(this.setAttribute(t,new B(e,n)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(t)}}const Jn=new L({color:0xffffff,side:f,transparent:!0}),tr=8421504,er=new A,nr=new d,rr=new d,ir=[],or=new d,ar="+x+y";function sr(t){return Array.isArray(t)?t[0]:t}let lr=()=>{const t=new E(new W(1,1),Jn);return lr=()=>t,t},cr=()=>{const t=new E(new W(1,1,32,1),Jn);return cr=()=>t,t};const ur={type:"syncstart"},fr={type:"synccomplete"},dr=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],hr=dr.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let pr=class extends E{constructor(){super(new Qn,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=tr,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=ar,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(ur),Nn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},e=>{this._isSyncing=!1,this._textRenderInfo=e,this.geometry.updateGlyphs(e.glyphBounds,e.glyphAtlasIndices,e.blockBounds,e.chunkedBounds,e.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(t=>t&&t())})),this.dispatchEvent(fr),t&&t()})))}onBeforeRender(t,e,n,r,i,o){this.sync(),i.isTroikaTextMaterial&&this._prepareForRender(i)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return function(t){const e=bn(t,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new h},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new C(0,0,0,0)},uTroikaClipRect:{value:new C(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new h},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new P},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new j},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:t,fragmentShader:e}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(e)&&(e=e.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(t)||(t=t.replace(fn,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:e}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}(t)}get material(){let t=this._derivedMaterial;const e=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Jn.clone());if(t&&t.isDerivedFrom(e)||(t=this._derivedMaterial=this.createDerivedMaterial(e),e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),t.dispose()})),this.hasOutline()){let e=t._outlineMtl;return e||(e=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),e.isTextOutlineMaterial=!0,e.depthWrite=!1,e.map=null,t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),[e,t]}return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return sr(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return sr(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const e=t.isTextOutlineMaterial,n=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:t,blockBounds:i}=r;n.uTroikaSDFTexture.value=t,n.uTroikaSDFTextureSize.value.set(t.image.width,t.image.height),n.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,n.uTroikaSDFExponent.value=r.sdfExponent,n.uTroikaTotalBounds.value.fromArray(i),n.uTroikaUseGlyphColors.value=!e&&!!r.glyphColors;let o,a,s,l=0,c=0,u=0,f=0,d=0;if(e){let{outlineWidth:t,outlineOffsetX:e,outlineOffsetY:n,outlineBlur:r,outlineOpacity:i}=this;l=this._parsePercent(t)||0,c=Math.max(0,this._parsePercent(r)||0),o=i,f=this._parsePercent(e)||0,d=this._parsePercent(n)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(s=this.strokeColor,n.uTroikaStrokeColor.value.set(null==s?tr:s),a=this.strokeOpacity,null==a&&(a=1)),o=this.fillOpacity;n.uTroikaEdgeOffset.value=l,n.uTroikaPositionOffset.value.set(f,d),n.uTroikaBlurRadius.value=c,n.uTroikaStrokeWidth.value=u,n.uTroikaStrokeOpacity.value=a,n.uTroikaFillOpacity.value=null==o?1:o,n.uTroikaCurveRadius.value=this.curveRadius||0;let h=this.clipRect;if(h&&Array.isArray(h)&&4===h.length)n.uTroikaClipRect.value.fromArray(h);else{const t=100*(this.fontSize||.1);n.uTroikaClipRect.value.set(i[0]-t,i[1]-t,i[2]+t,i[3]+t)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const i=e?this.outlineColor||0:this.color;if(null==i)delete t.color;else{const e=t.hasOwnProperty("color")?t.color:t.color=new P;i===e._input&&"object"!=typeof i||e.set(e._input=i)}let o=this.orientation||ar;if(o!==t._orientation){let e=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let r=o!==ar&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,t,n,i,o]=r;nr.set(0,0,0)[n]="-"===t?1:-1,rr.set(0,0,0)[o]="-"===i?-1:1,er.lookAt(or,nr.cross(rr),rr),e.setFromMatrix4(er)}else e.identity();t._orientation=o}}_parsePercent(t){if("string"==typeof t){let e=t.match(/^(-?[\d.]+)%$/),n=e?parseFloat(e[1]):NaN;t=(isNaN(n)?0:n/100)*this.fontSize}return t}localPositionToTextCoords(t,e=new h){e.copy(t);const n=this.curveRadius;return n&&(e.x=Math.atan2(t.x,Math.abs(n)-Math.abs(t.z))*Math.abs(n)),e}worldPositionToTextCoords(t,e=new h){return nr.copy(t),this.localPositionToTextCoords(this.worldToLocal(nr),e)}raycast(t,e){const{textRenderInfo:n,curveRadius:r}=this;if(n){const i=n.blockBounds,o=r?cr():lr(),a=o.geometry,{position:s,uv:l}=a.attributes;for(let t=0;t<l.count;t++){let e=i[0]+l.getX(t)*(i[2]-i[0]);const n=i[1]+l.getY(t)*(i[3]-i[1]);let o=0;r&&(o=r-Math.cos(e/r)*r,e=Math.sin(e/r)*r),s.setXYZ(t,e,n,o)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,ir.length=0,o.raycast(t,ir);for(let t=0;t<ir.length;t++)ir[t].object=this,e.push(ir[t])}}copy(t){const e=this.geometry;return super.copy(t),this.geometry=e,hr.forEach(e=>{this[e]=t[e]}),this}clone(){return(new this.constructor).copy(this)}};dr.forEach(t=>{const e="_private_"+t;Object.defineProperty(pr.prototype,t,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})}),new w,new P;const vr=r.forwardRef(({sdfGlyphSize:t=64,anchorX:e="center",anchorY:n="middle",font:i,fontSize:o=1,children:a,characters:s,onSync:c,...f},d)=>{const h=l(({invalidate:t})=>t),[p]=r.useState(()=>new pr),[v,g]=r.useMemo(()=>{const t=[];let e="";return r.Children.forEach(a,n=>{"string"==typeof n||"number"==typeof n?e+=n:t.push(n)}),[t,e]},[a]);return rt(()=>new Promise(t=>function({font:t,characters:e,sdfGlyphSize:n},r){Nn({font:t,sdfGlyphSize:n,text:Array.isArray(e)?e.join("\n"):""+e},r)}({font:i,characters:s},t)),["troika-text",i,s]),r.useLayoutEffect(()=>{p.sync(()=>{h(),c&&c(p)})}),r.useEffect(()=>()=>p.dispose(),[p]),r.createElement("primitive",u({object:p,ref:d,font:i,text:g,anchorX:e,anchorY:n,fontSize:o,sdfGlyphSize:t},f),v)});function gr(t,e,n,r){var i;return(i=class extends U{constructor(r){super({vertexShader:e,fragmentShader:n,...r});for(const e in t)this.uniforms[e]=new N(t[e]),Object.defineProperty(this,e,{get(){return this.uniforms[e].value},set(t){this.uniforms[e].value=t}});this.uniforms=k.clone(this.uniforms)}}).key=M.generateUUID(),i}const mr=(()=>parseInt(g.replace(/\D+/g,"")))();function yr(t,e,n){const i=l(t=>t.size),o=l(t=>t.viewport),a="number"==typeof t?t:i.width*o.dpr,s=i.height*o.dpr,c=("number"==typeof t?n:t)||{},{samples:u=0,depth:f,...d}=c,h=null!=f?f:c.depthBuffer,p=r.useMemo(()=>{const t=new V(a,s,{minFilter:z,magFilter:z,type:H,...d});return h&&(t.depthTexture=new X(a,s,q)),t.samples=u,t},[]);return r.useLayoutEffect(()=>{p.setSize(a,s),u&&(p.samples=u)},[u,p,a,s]),r.useEffect(()=>()=>p.dispose(),[]),p}const br=r.forwardRef(({envMap:t,resolution:e=256,frames:n=1/0,children:i,makeDefault:o,...a},s)=>{const f=l(({set:t})=>t),d=l(({camera:t})=>t),h=l(({size:t})=>t),p=r.useRef(null);r.useImperativeHandle(s,()=>p.current,[]);const v=r.useRef(null),g=yr(e);r.useLayoutEffect(()=>{a.manual||p.current.updateProjectionMatrix()},[h,a]),r.useLayoutEffect(()=>{p.current.updateProjectionMatrix()}),r.useLayoutEffect(()=>{if(o){const t=d;return f(()=>({camera:p.current})),()=>f(()=>({camera:t}))}},[p,o,f]);let m=0,y=null;const b="function"==typeof i;return c(e=>{b&&(n===1/0||m<n)&&(v.current.visible=!1,e.gl.setRenderTarget(g),y=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,p.current),e.scene.background=y,e.gl.setRenderTarget(null),v.current.visible=!0,m++)}),r.createElement(r.Fragment,null,r.createElement("orthographicCamera",u({left:h.width/-2,right:h.width/2,top:h.height/2,bottom:h.height/-2,ref:p},a),!b&&i),r.createElement("group",{ref:v},b&&i(g.texture)))}),xr=r.forwardRef(({envMap:t,resolution:e=256,frames:n=1/0,makeDefault:i,children:o,...a},s)=>{const f=l(({set:t})=>t),d=l(({camera:t})=>t),h=l(({size:t})=>t),p=r.useRef(null);r.useImperativeHandle(s,()=>p.current,[]);const v=r.useRef(null),g=yr(e);r.useLayoutEffect(()=>{a.manual||(p.current.aspect=h.width/h.height)},[h,a]),r.useLayoutEffect(()=>{p.current.updateProjectionMatrix()});let m=0,y=null;const b="function"==typeof o;return c(e=>{b&&(n===1/0||m<n)&&(v.current.visible=!1,e.gl.setRenderTarget(g),y=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,p.current),e.scene.background=y,e.gl.setRenderTarget(null),v.current.visible=!0,m++)}),r.useLayoutEffect(()=>{if(i){const t=d;return f(()=>({camera:p.current})),()=>f(()=>({camera:t}))}},[p,i,f]),r.createElement(r.Fragment,null,r.createElement("perspectiveCamera",u({ref:p},a),!b&&o),r.createElement("group",{ref:v},b&&o(g.texture)))}),Sr=gr({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new P,sectionColor:new P,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new d,worldPlanePosition:new d},"\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform vec3 worldPlanePosition;\n    uniform float fadeDistance;\n    uniform bool infiniteGrid;\n    uniform bool followCamera;\n\n    void main() {\n      localPosition = position.xzy;\n      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n      \n      worldPosition = modelMatrix * vec4(localPosition, 1.0);\n      if (followCamera) {\n        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n        localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n      }\n\n      gl_Position = projectionMatrix * viewMatrix * worldPosition;\n    }\n  ",`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${mr>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),wr=r.forwardRef(({args:t,cellColor:e="#000000",sectionColor:n="#2080ff",cellSize:i=.5,sectionSize:o=1,followCamera:a=!1,infiniteGrid:s=!1,fadeDistance:l=100,fadeStrength:f=1,fadeFrom:h=1,cellThickness:p=.5,sectionThickness:v=1,side:g=Y,...m},y)=>{$({GridMaterial:Sr});const b=r.useRef(null);r.useImperativeHandle(y,()=>b.current,[]);const x=new K,S=new d(0,1,0),w=new d(0,0,0);c(t=>{x.setFromNormalAndCoplanarPoint(S,w).applyMatrix4(b.current.matrixWorld);const e=b.current.material,n=e.uniforms.worldCamProjPosition,r=e.uniforms.worldPlanePosition;x.projectPoint(t.camera.position,n.value),r.value.set(0,0,0).applyMatrix4(b.current.matrixWorld)});const _={cellSize:i,sectionSize:o,cellColor:e,sectionColor:n,cellThickness:p,sectionThickness:v},U={fadeDistance:l,fadeStrength:f,fadeFrom:h,infiniteGrid:s,followCamera:a};return r.createElement("mesh",u({ref:b,frustumCulled:!1},m),r.createElement("gridMaterial",u({transparent:!0,"extensions-derivatives":!0,side:g},_,U)),r.createElement("planeGeometry",{args:t}))});function _r(t,e){const n=t+"Geometry";return r.forwardRef(({args:t,children:i,...o},a)=>{const s=r.useRef(null);return r.useImperativeHandle(a,()=>s.current),r.useLayoutEffect(()=>{null==e||e(s.current)}),r.createElement("mesh",u({ref:s},o),r.createElement(n,{attach:"geometry",args:t}),i)})}const Ur=_r("circle"),kr={showLabels:!0,showNodeDetails:!0,nodeScale:1,edgeWidth:2,hierarchyDepth:0,linkDistance:300,chargeStrength:-5e3,gravity:.005,friction:.4,maxFPS:60,lodEnabled:!0,highContrast:!1,reducedMotion:!1},Tr=Z(t=>({sidebarOpen:!0,sidebarTab:"details",menuOpen:null,loadingProgress:0,loadingMessage:"",notifications:[],isDragging:!1,viewport:{zoom:1,rotation:[0,0,0],target:[0,0,0],mode:"2d"},settings:kr,toggleSidebar:()=>t(t=>({sidebarOpen:!t.sidebarOpen})),setSidebarTab:e=>t({sidebarTab:e}),setMenuOpen:e=>t({menuOpen:e}),setLoadingProgress:(e,n)=>t({loadingProgress:e,loadingMessage:n||""}),addNotification:e=>t(n=>{const r=`notification-${Date.now()}-${Math.random()}`,i={...e,id:r};return 0!==e.duration&&setTimeout(()=>{t(t=>({notifications:t.notifications.filter(t=>t.id!==r)}))},e.duration||5e3),{notifications:[...n.notifications,i]}}),removeNotification:e=>t(t=>({notifications:t.notifications.filter(t=>t.id!==e)})),setZoom:e=>t(t=>({viewport:{...t.viewport,zoom:e}})),setRotation:e=>t(t=>({viewport:{...t.viewport,rotation:e}})),setTarget:e=>t(t=>({viewport:{...t.viewport,target:e}})),toggleViewMode:()=>t(t=>({viewport:{...t.viewport,mode:"2d"===t.viewport.mode?"3d":"2d"}})),setDragging:e=>t({isDragging:e}),updateSettings:e=>t(t=>({settings:{...t.settings,...e}})),resetSettings:()=>t({settings:kr})}));function Er({node:t,onDragStart:e,onDragEnd:i}){const a=r.useRef(null),[s,u]=r.useState(!1),[h,p]=r.useState(!1),v=o(),{camera:g,size:m}=l(),{selectNode:y,hoverNode:b,selectedNode:x,updateNodePosition:S}=Q(),{settings:w,viewport:_}=Tr(),U=x===t.id;_.mode;const k=t.properties?.instances||0,T=(k>0?.1*Math.sqrt(k)+1.6:1.6)*w.nodeScale,E=(C={onDrag:({delta:[n,r],first:o,last:s})=>{if(o&&(p(!0),Tr.getState().setDragging(!0),e?.()),a.current){const e=g.position.z/m.height*2,i=n*e,o=-r*e;S(t.id,[t.position.x+i,t.position.y+o,t.position.z])}s&&(p(!1),Tr.getState().setDragging(!1),i?.())},onClick:e=>{if(2===e.event.detail||e.event.metaKey||e.event.ctrlKey){const e=t.properties?.term_id||t.label;v(`/page/${encodeURIComponent(e)}`)}else y(U?null:t.id)}},ke([se,ue,fe,de,ce,le])(C,{}));var C;return c(()=>{if(a.current&&!t.pinned){const e=new d(t.position.x,t.position.y,t.position.z);a.current.position.lerp(e,.1)}}),n.jsxs("group",{children:[n.jsx(Ur,{ref:a,args:[T,32],position:[t.position.x,t.position.y,t.position.z],...E(),onPointerOver:e=>{e.stopPropagation(),u(!0),b(t.id),document.body.style.cursor=h?"grabbing":"grab"},onPointerOut:()=>{h||(u(!1),b(null),document.body.style.cursor="auto")},children:n.jsx("meshBasicMaterial",{color:h?"#ff6b6b":U?"#67bc0f":s?"#8cd0f0":"#aaccee",transparent:!0,opacity:t.opacity||1})}),n.jsx(Ur,{args:[T+2,32],position:[t.position.x,t.position.y,t.position.z-.1],children:n.jsx("meshBasicMaterial",{color:U?"#67bc0f":"#333",transparent:!0,opacity:U?.5:.2,side:f})}),w.showLabels&&n.jsx(vr,{position:[t.position.x,t.position.y-T-3,t.position.z+1],fontSize:1.4,color:"#ffffff",outlineWidth:.1,outlineColor:"#000000",renderOrder:10,anchorX:"center",anchorY:"middle",maxWidth:4*T,textAlign:"center",children:t.label}),w.showNodeDetails&&k>0&&n.jsx(vr,{position:[t.position.x,t.position.y,t.position.z+2],fontSize:1,color:"#ffffff",outlineWidth:.05,outlineColor:"#000000",anchorX:"center",anchorY:"middle",children:k}),U&&n.jsx(Ur,{args:[T+8,32],position:[t.position.x,t.position.y,t.position.z-.2],children:n.jsx("meshBasicMaterial",{color:"#67bc0f",transparent:!0,opacity:.3,side:f})}),s&&!U&&n.jsx(Ur,{args:[T+5,32],position:[t.position.x,t.position.y,t.position.z-.15],children:n.jsx("meshBasicMaterial",{color:"#8cd0f0",transparent:!0,opacity:.2,side:f})})]})}function Cr({edge:t}){const{nodes:e,selectedEdge:i}=Q(),{settings:o}=Tr(),a=i===t.id,s=e.get(t.source),l=e.get(t.target),c=r.useMemo(()=>{if(!s||!l)return null;if(!s.position||!l.position)return null;const t=s.position.x,e=s.position.y,n=s.position.z,r=l.position.x,i=l.position.y,o=l.position.z;return"number"!=typeof t||"number"!=typeof e||"number"!=typeof n||"number"!=typeof r||"number"!=typeof i||"number"!=typeof o||isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(o)?null:[new d(t,e,n),new d(r,i,o)]},[s,l]),u=r.useMemo(()=>c?new d((c[0].x+c[1].x)/2,(c[0].y+c[1].y)/2,(c[0].z+c[1].z)/2+1):null,[c]),f=r.useMemo(()=>{if(!c)return null;return(new d).subVectors(c[1],c[0]).normalize()},[c]),h=()=>a?"#67bc0f":"#ff0000",p=()=>.5*o.edgeWidth,v=()=>{if("disjoint"===t.type)return[5,5]};return c&&s&&l&&u&&f?n.jsxs("group",{children:[n.jsx(Ze,{points:c,color:h(),lineWidth:p(),transparent:!0,opacity:.5,dashed:!!v(),dashSize:v()?.[0],gapSize:v()?.[1]}),o.showLabels&&t.label&&n.jsx(vr,{position:u,fontSize:10,color:"#ffffff",outlineWidth:.1,outlineColor:"#000000",renderOrder:10,anchorX:"center",anchorY:"middle",maxWidth:200,textAlign:"center",children:t.label}),"disjoint"!==t.type&&n.jsxs("mesh",{position:[l.position.x-25*f.x,l.position.y-25*f.y,l.position.z],rotation:[0,0,Math.atan2(f.y,f.x)],children:[n.jsx("coneGeometry",{args:[5,10,8]}),n.jsx("meshBasicMaterial",{color:h(),transparent:!0,opacity:.5})]}),a&&n.jsx(Ze,{points:c,color:"#67bc0f",lineWidth:p()+4,transparent:!0,opacity:.3})]}):null}function Dr(){const{nodes:t,edges:i,filteredNodes:o,filteredEdges:a}=Q(),{isRunning:s,fixNodePosition:l,releaseNode:u}=function(t={}){const{autoStart:n=!0,iterations:i}=t,o=r.useRef(null),[a,s]=r.useState(!1),[l,u]=r.useState(!1),[f,d]=r.useState(1),h=r.useRef(0),p=r.useRef(null),{nodes:v,edges:g,updateNodePosition:m,updateGraphData:y}=Q(),{settings:b}=Tr();return r.useEffect(()=>{let t=!0;return async function(){try{let r;try{r=await e(()=>import("./webvowl_wasm-D0y6hcYx.js"),[])}catch(n){throw new Error("WASM module not found. Ensure WASM is built and installed (npm install).")}if(await r.default(),!t)return;o.current=new r.WebVowl,s(!0),o.current.setCenter(0,0),o.current.setLinkDistance(b.linkDistance),o.current.setChargeStrength(b.chargeStrength)}catch(r){}}(),()=>{t=!1,o.current&&(o.current=null)}},[]),r.useEffect(()=>{if(!o.current||!a)return;if(0===v.size)return;const t=new Set(Array.from(v.values()).map(t=>t.id)),e=Array.from(g.values()).filter(e=>{const n=e.source&&t.has(e.source),r=e.target&&t.has(e.target);return n&&r}),r={header:{title:{en:"Ontology Graph"}},namespace:[],class:Array.from(v.values()).map(t=>({id:t.id,type:t.type})),classAttribute:Array.from(v.values()).map(t=>({id:t.id,label:{en:t.label},iri:t.iri})),property:e.map(t=>({id:t.id,type:"subclass"===t.type?"rdfs:subClassOf":"objectProperty"===t.type?"owl:ObjectProperty":"owl:DatatypeProperty",domain:t.source,range:t.target,label:t.label||t.id,iri:t.iri||`http://example.org/${t.id}`}))};try{const t=r.property.filter(t=>!t.domain||!t.range);if(t.length>0)throw new Error(`Invalid properties: ${t.map(t=>t.id).join(", ")}`);r.property.length>0&&r.property[0],r.property.find(t=>"1244"===t.id),o.current.loadOntology(JSON.stringify(r)),o.current.initSimulation(),"function"==typeof o.current.filterHierarchy&&o.current.filterHierarchy(b.hierarchyDepth),n&&(i?(o.current.runSimulation(i),u(!1)):(h.current=Date.now(),u(!0),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{u(!1)},1e4)))}catch(s){}return()=>{p.current&&clearTimeout(p.current)}},[v,g,a,n,i]),r.useEffect(()=>{o.current&&(o.current.setLinkDistance(b.linkDistance),o.current.setChargeStrength(b.chargeStrength))},[a,v,g,b.linkDistance,b.chargeStrength,b.gravity,b.friction]),r.useEffect(()=>{if(o.current&&a&&"function"==typeof o.current.filterHierarchy){o.current.filterHierarchy(b.hierarchyDepth);const t=o.current.getGraphData();y(t.nodes)}},[b.hierarchyDepth,a,y]),c(()=>{const t=o.current;if(t&&l)try{const e=(Date.now()-h.current)/1e3,n=10;if(t.isFinished()||e>=n)return u(!1),void d(0);t.tick();const r=t.getAlpha();d(r),Math.random();const i=t.getGraphData();i&&i.nodes&&y(i.nodes,i.edges)}catch(e){u(!1)}}),{isInitialized:a,isRunning:l,alpha:f,start:()=>{o.current&&!l&&u(!0)},stop:()=>{u(!1)},reset:()=>{o.current&&(o.current.initSimulation(),d(1),n&&u(!0))},step:()=>{if(o.current&&!l){o.current.tick();const t=o.current.getGraphData();t&&t.nodes&&t.nodes.forEach(t=>{m(t.id,[t.x,t.y,0])}),d(o.current.getAlpha())}},fixNodePosition:t=>{},releaseNode:t=>{},reheat:()=>{o.current&&(o.current.initSimulation(),d(1),h.current=Date.now(),u(!0))}}}(),f=Array.from(t.values()).filter(t=>o.has(t.id)),d=Array.from(i.values()).filter(t=>a.has(t.id));return n.jsxs("group",{children:[d.map(t=>n.jsx(Cr,{edge:t},t.id)),f.map(t=>n.jsx(Er,{node:t,onDragStart:()=>l(t.id),onDragEnd:()=>u(t.id)},t.id)),s&&n.jsx(pt,{position:[0,250,0],center:!0,style:{pointerEvents:"none",userSelect:"none"},children:n.jsx("div",{style:{background:"rgba(0, 0, 0, 0.7)",color:"white",padding:"8px 16px",borderRadius:"4px",fontSize:"14px",fontFamily:"system-ui, sans-serif"},children:"Simulating..."})}),0===t.size&&n.jsx(pt,{center:!0,children:n.jsxs("div",{style:{textAlign:"center",color:"#999",fontSize:"18px",fontFamily:"system-ui, sans-serif"},children:[n.jsx("h2",{children:"No ontology loaded"}),n.jsx("p",{children:"Drop a JSON file or select from the menu"})]})})]})}function Ar(){const{viewport:t,isDragging:e}=Tr(),i=r.useRef(null),o="3d"===t.mode;return n.jsx("div",{style:{width:"100%",height:"100vh",background:"#f5f5f5"},children:n.jsxs(J,{gl:{antialias:!0,alpha:!0,powerPreference:"high-performance"},dpr:[1,2],children:[o?n.jsx(xr,{makeDefault:!0,position:[0,300,500],fov:50}):n.jsx(br,{makeDefault:!0,position:[0,0,500],zoom:1,near:.1,far:2e3}),n.jsx(tt,{ref:i,enabled:!e,enableDamping:!0,dampingFactor:.05,minDistance:50,maxDistance:2e3,enableRotate:o,enablePan:!0,mouseButtons:{LEFT:2,MIDDLE:1,RIGHT:0}}),n.jsx("ambientLight",{intensity:.6}),n.jsx("directionalLight",{position:[10,10,5],intensity:.5}),n.jsx("pointLight",{position:[-10,-10,-5],intensity:.3}),o&&n.jsx(wr,{args:[1e3,1e3],cellColor:"#cccccc",sectionColor:"#aaaaaa",fadeDistance:800,fadeStrength:1}),n.jsx(Dr,{})]})})}Mr=function(){const{nodeId:t}=s(),e=o(),[i,l]=r.useState(!0),[c,u]=r.useState(null),f=Q(t=>t.setSelectedNode),d=Q(t=>t.loadOntology),h=Q(t=>t.nodes.size),[p,v]=function(){const[t,e]=a();return[{zoom:parseFloat(t.get("zoom")||"1"),rotation:t.get("rotation")?.split(",").map(Number)||[0,0,0],selectedNode:t.get("selected")||null},r.useCallback(t=>{e(e=>{const n=new URLSearchParams(e);return void 0!==t.zoom&&n.set("zoom",t.zoom.toString()),void 0!==t.rotation&&n.set("rotation",t.rotation.join(",")),void 0!==t.selectedNode&&(null===t.selectedNode?n.delete("selected"):n.set("selected",t.selectedNode)),n},{replace:!0})},[e])]}();r.useEffect(()=>{(async()=>{if(h>0)l(!1);else try{const t=await fetch("/data/ontology.json");if(!t.ok)throw new Error(`Failed to fetch ontology: ${t.status} ${t.statusText}`);const e=await t.json();if(!e.class||!Array.isArray(e.class))throw new Error("Invalid ontology format: missing class array");const n={header:e.header,namespace:e.namespace,class:e.class,property:e.property||[],datatype:e.datatype,classAttribute:e.classAttribute,propertyAttribute:e.propertyAttribute};d(n),l(!1)}catch(t){u(t instanceof Error?t.message:"Unknown error"),l(!1)}})()},[d,h]),r.useEffect(()=>{t&&f(t)},[t,f]);return i?n.jsx("div",{className:"ontology-view loading",children:n.jsxs("div",{className:"loading-container",children:[n.jsx("div",{className:"spinner"}),n.jsx("p",{children:"Loading ontology visualization..."})]})}):c?n.jsx("div",{className:"ontology-view error",children:n.jsxs("div",{className:"error-container",children:[n.jsx("h2",{children:"Failed to Load Ontology"}),n.jsx("p",{children:c}),n.jsx("button",{onClick:()=>window.location.reload(),children:"Retry"})]})}):n.jsx("div",{className:"ontology-view",children:n.jsx(Ar,{onNodeClick:t=>{const n=Q.getState().nodes.get(t);if(n){v({selectedNode:t});const r=n.properties?.term_id||n.label;r&&e(`/page/${encodeURIComponent(r)}`)}}})})}});export{Mr as default,__tla};