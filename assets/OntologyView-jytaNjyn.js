import{k as t,j as e}from"./index-Dr-OJML1.js";import{b as n,f as r,u as i,h as o,e as a}from"./vendor-F3clTgvh.js";import{a as s,b as l,_ as c,D as u,V as h,c as f,P as d,d as p,R as v,I as g,F as m,e as y,f as x,W as b,B as _,S as w,g as S,U,h as k,M as T,i as E,L as M,j as A,k as C,l as D,m as P,n as F,o as O,p as z,q as I,r as R,T as L,s as B,t as G,v as N,w as j,x as W,H as V,y as H,z as q,A as X,E as $,G as Y,J as K,u as Z,C as Q,O as J}from"./useGraphStore-CVKb3Off.js";import"./fuse-DRqTZInw.js";const tt=[];function et(t,e,n=(t,e)=>t===e){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}const nt=(t,e,n)=>function(t,e=null,n=!1,r={}){null===e&&(e=[t]);for(const a of tt)if(et(e,a.keys,a.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return r.lifespan&&r.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,r.lifespan)),a.response;if(!n)throw a.promise}const i={keys:e,equal:r.equal,remove:()=>{const t=tt.indexOf(i);-1!==t&&tt.splice(t,1)},promise:(o=t,"object"==typeof o&&"function"==typeof o.then?t:t(...e)).then(t=>{i.response=t,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(t=>i.error=t)};var o;if(tt.push(i),!n)throw i.promise}(t,e,!1,n),rt=new h,it=new h,ot=new h,at=new f;function st(t,e,n){const r=rt.setFromMatrixPosition(t.matrixWorld);r.project(e);const i=n.width/2,o=n.height/2;return[r.x*i+i,-r.y*o+o]}const lt=t=>Math.abs(t)<1e-10?0:t;function ct(t,e,n=""){let r="matrix3d(";for(let i=0;16!==i;i++)r+=lt(e[i]*t.elements[i])+(15!==i?",":")");return n+r}const ut=(ht=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],t=>ct(t,ht));var ht;const ft=(t,e)=>{return ct(t,[1/(n=e),1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1],"translate(-50%,-50%)");var n};const dt=n.forwardRef(({children:e,eps:r=.001,style:i,className:o,prepend:a,center:f,fullscreen:v,portal:g,distanceFactor:m,sprite:y=!1,transform:x=!1,occlude:b,onOcclude:_,castShadow:w,receiveShadow:S,material:U,geometry:k,zIndexRange:T=[16777271,0],calculatePosition:E=st,as:M="div",wrapperClass:A,pointerEvents:C="auto",...D},P)=>{const{gl:F,camera:O,scene:z,size:I,raycaster:R,events:L,viewport:B}=s(),[G]=n.useState(()=>document.createElement(M)),N=n.useRef(null),j=n.useRef(null),W=n.useRef(0),V=n.useRef([0,0]),H=n.useRef(null),q=n.useRef(null),X=(null==g?void 0:g.current)||L.connected||F.domElement.parentNode,$=n.useRef(null),Y=n.useRef(!1),K=n.useMemo(()=>b&&"blending"!==b||Array.isArray(b)&&b.length&&function(t){return t&&"object"==typeof t&&"current"in t}(b[0]),[b]);n.useLayoutEffect(()=>{const t=F.domElement;b&&"blending"===b?(t.style.zIndex=`${Math.floor(T[0]/2)}`,t.style.position="absolute",t.style.pointerEvents="none"):(t.style.zIndex=null,t.style.position=null,t.style.pointerEvents=null)},[b]),n.useLayoutEffect(()=>{if(j.current){const e=N.current=t.createRoot(G);if(z.updateMatrixWorld(),x)G.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const t=E(j.current,O,I);G.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${t[0]}px,${t[1]}px,0);transform-origin:0 0;`}return X&&(a?X.prepend(G):X.appendChild(G)),()=>{X&&X.removeChild(G),e.unmount()}}},[X,x]),n.useLayoutEffect(()=>{A&&(G.className=A)},[A]);const Z=n.useMemo(()=>x?{position:"absolute",top:0,left:0,width:I.width,height:I.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:f?"translate3d(-50%,-50%,0)":"none",...v&&{top:-I.height/2,left:-I.width/2,width:I.width,height:I.height},...i},[i,f,v,I,x]),Q=n.useMemo(()=>({position:"absolute",pointerEvents:C}),[C]);n.useLayoutEffect(()=>{var t,r;(Y.current=!1,x)?null==(t=N.current)||t.render(n.createElement("div",{ref:H,style:Z},n.createElement("div",{ref:q,style:Q},n.createElement("div",{ref:P,className:o,style:i,children:e})))):null==(r=N.current)||r.render(n.createElement("div",{ref:P,style:Z,className:o,children:e}))});const J=n.useRef(!0);l(t=>{if(j.current){O.updateMatrixWorld(),j.current.updateWorldMatrix(!0,!1);const t=x?V.current:E(j.current,O,I);if(x||Math.abs(W.current-O.zoom)>r||Math.abs(V.current[0]-t[0])>r||Math.abs(V.current[1]-t[1])>r){const e=function(t,e){const n=rt.setFromMatrixPosition(t.matrixWorld),r=it.setFromMatrixPosition(e.matrixWorld),i=n.sub(r),o=e.getWorldDirection(ot);return i.angleTo(o)>Math.PI/2}(j.current,O);let n=!1;K&&(Array.isArray(b)?n=b.map(t=>t.current):"blending"!==b&&(n=[z]));const r=J.current;if(n){const t=function(t,e,n,r){const i=rt.setFromMatrixPosition(t.matrixWorld),o=i.clone();o.project(e),at.set(o.x,o.y),n.setFromCamera(at,e);const a=n.intersectObjects(r,!0);if(a.length){const t=a[0].distance;return i.distanceTo(n.ray.origin)<t}return!0}(j.current,O,R,n);J.current=t&&!e}else J.current=!e;r!==J.current&&(_?_(!J.current):G.style.display=J.current?"block":"none");const i=Math.floor(T[0]/2),o=b?K?[T[0],i]:[i-1,0]:T;if(G.style.zIndex=`${function(t,e,n){if(e instanceof d||e instanceof p){const r=rt.setFromMatrixPosition(t.matrixWorld),i=it.setFromMatrixPosition(e.matrixWorld),o=r.distanceTo(i),a=(n[1]-n[0])/(e.far-e.near),s=n[1]-a*e.far;return Math.round(a*o+s)}}(j.current,O,o)}`,x){const[t,e]=[I.width/2,I.height/2],n=O.projectionMatrix.elements[5]*e,{isOrthographicCamera:r,top:i,left:o,bottom:a,right:s}=O,l=ut(O.matrixWorldInverse),c=r?`scale(${n})translate(${lt(-(s+o)/2)}px,${lt((i+a)/2)}px)`:`translateZ(${n}px)`;let u=j.current.matrixWorld;y&&(u=O.matrixWorldInverse.clone().transpose().copyPosition(u).scale(j.current.scale),u.elements[3]=u.elements[7]=u.elements[11]=0,u.elements[15]=1),G.style.width=I.width+"px",G.style.height=I.height+"px",G.style.perspective=r?"":`${n}px`,H.current&&q.current&&(H.current.style.transform=`${c}${l}translate(${t}px,${e}px)`,q.current.style.transform=ft(u,1/((m||10)/400)))}else{const e=void 0===m?1:function(t,e){if(e instanceof p)return e.zoom;if(e instanceof d){const n=rt.setFromMatrixPosition(t.matrixWorld),r=it.setFromMatrixPosition(e.matrixWorld),i=e.fov*Math.PI/180,o=n.distanceTo(r);return 1/(2*Math.tan(i/2)*o)}return 1}(j.current,O)*m;G.style.transform=`translate3d(${t[0]}px,${t[1]}px,0) scale(${e})`}V.current=t,W.current=O.zoom}}if(!K&&$.current&&!Y.current)if(x){if(H.current){const t=H.current.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const{isOrthographicCamera:e}=O;if(e||k)D.scale&&(Array.isArray(D.scale)?D.scale instanceof h?$.current.scale.copy(D.scale.clone().divideScalar(1)):$.current.scale.set(1/D.scale[0],1/D.scale[1],1/D.scale[2]):$.current.scale.setScalar(1/D.scale));else{const e=(m||10)/400,n=t.clientWidth*e,r=t.clientHeight*e;$.current.scale.set(n,r,1)}Y.current=!0}}}else{const e=G.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const t=1/B.factor,n=e.clientWidth*t,r=e.clientHeight*t;$.current.scale.set(n,r,1),Y.current=!0}$.current.lookAt(t.camera.position)}});const tt=n.useMemo(()=>({vertexShader:x?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "}),[x]);return n.createElement("group",c({},D,{ref:j}),b&&!K&&n.createElement("mesh",{castShadow:w,receiveShadow:S,ref:$},k||n.createElement("planeGeometry",null),U||n.createElement("shaderMaterial",{side:u,vertexShader:tt.vertexShader,fragmentShader:tt.fragmentShader})))});const pt={toVector:(t,e)=>(void 0===t&&(t=e),Array.isArray(t)?t:[t,t]),add:(t,e)=>[t[0]+e[0],t[1]+e[1]],sub:(t,e)=>[t[0]-e[0],t[1]-e[1]],addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function vt(t,e,n){return 0===e||Math.abs(e)===1/0?Math.pow(t,5*n):t*e*n/(e+n*t)}function gt(t,e,n,r=.15){return 0===r?function(t,e,n){return Math.max(e,Math.min(t,n))}(t,e,n):t<e?-vt(e-t,n-e,r)+e:t>n?+vt(t-n,n-e,r)+n:t}function mt(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function yt(t,e,n){return(e=mt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xt(Object(n),!0).forEach(function(e){yt(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const _t={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function wt(t){return t?t[0].toUpperCase()+t.slice(1):""}const St=["enter","leave"];function Ut(t,e="",n=!1){const r=_t[t],i=r&&r[e]||e;return"on"+wt(t)+wt(i)+(function(t=!1,e){return t&&!St.includes(e)}(n,i)?"Capture":"")}const kt=["gotpointercapture","lostpointercapture"];function Tt(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=kt.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function Et(t){return"touches"in t}function Mt(t){return Et(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function At(t){return Et(t)?function(t){return"touchend"===t.type||"touchcancel"===t.type?t.changedTouches:t.targetTouches}(t)[0]:t}function Ct(t,e){try{const n=e.clientX-t.clientX,r=e.clientY-t.clientY,i=(e.clientX+t.clientX)/2,o=(e.clientY+t.clientY)/2,a=Math.hypot(n,r),s=-180*Math.atan2(n,r)/Math.PI;return{angle:s,distance:a,origin:[i,o]}}catch(n){}return null}function Dt(t){return function(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||(null===(n=t.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,e.target))})}(t).map(t=>t.identifier)}function Pt(t,e){const[n,r]=Array.from(t.touches).filter(t=>e.includes(t.identifier));return Ct(n,r)}function Ft(t){const e=At(t);return Et(t)?e.identifier:e.pointerId}function Ot(t){const e=At(t);return[e.clientX,e.clientY]}function zt(t){let{deltaX:e,deltaY:n,deltaMode:r}=t;return 1===r?(e*=40,n*=40):2===r&&(e*=800,n*=800),[e,n]}function It(t,...e){return"function"==typeof t?t(...e):t}function Rt(){}function Lt(...t){return 0===t.length?Rt:1===t.length?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function Bt(t,e){return Object.assign({},e,t||{})}class Gt{constructor(t,e,n){this.ctrl=t,this.args=e,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:e,ingKey:n,args:r}=this;e[n]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=r,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const e=this.state,n=this.config;e._active||(this.reset(),this.computeInitial(),e._active=!0,e.target=t.target,e.currentTarget=t.currentTarget,e.lastOffset=n.from?It(n.from,e):e.offset,e.offset=e.lastOffset,e.startTime=e.timeStamp=t.timeStamp)}computeValues(t){const e=this.state;e._values=t,e.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:e,config:n,shared:r}=this;e.args=this.args;let i=0;if(t&&(e.event=t,n.preventDefault&&t.cancelable&&e.event.preventDefault(),e.type=t.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return e}(t)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=t.timeStamp-e.timeStamp,e.timeStamp=t.timeStamp,e.elapsedTime=e.timeStamp-e.startTime),e._active){const t=e._delta.map(Math.abs);pt.addTo(e._distance,t)}this.axisIntent&&this.axisIntent(t);const[o,a]=e._movement,[s,l]=n.threshold,{_step:c,values:u}=e;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=s&&u[0]),!1===c[1]&&(c[1]=Math.abs(a)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=s&&Math.sign(o)*s),!1===c[1]&&(c[1]=Math.abs(a)>=l&&Math.sign(a)*l)),e.intentional=!1!==c[0]||!1!==c[1],!e.intentional)return;const h=[0,0];if(n.hasCustomTransform){const[t,e]=u;h[0]=!1!==c[0]?t-c[0]:0,h[1]=!1!==c[1]?e-c[1]:0}else h[0]=!1!==c[0]?o-c[0]:0,h[1]=!1!==c[1]?a-c[1]:0;this.restrictToAxis&&!e._blocked&&this.restrictToAxis(h);const f=e.offset,d=e._active&&!e._blocked||e.active;d&&(e.first=e._active&&!e.active,e.last=!e._active&&e.active,e.active=r[this.ingKey]=e._active,t&&(e.first&&("bounds"in n&&(e._bounds=It(n.bounds,e)),this.setup&&this.setup()),e.movement=h,this.computeOffset()));const[p,v]=e.offset,[[g,m],[y,x]]=e._bounds;e.overflow=[p<g?-1:p>m?1:0,v<y?-1:v>x?1:0],e._movementBound[0]=!!e.overflow[0]&&(!1===e._movementBound[0]?e._movement[0]:e._movementBound[0]),e._movementBound[1]=!!e.overflow[1]&&(!1===e._movementBound[1]?e._movement[1]:e._movementBound[1]);const b=e._active&&n.rubberband||[0,0];if(e.offset=function(t,[e,n],[r,i]){const[[o,a],[s,l]]=t;return[gt(e,o,a,r),gt(n,s,l,i)]}(e._bounds,e.offset,b),e.delta=pt.sub(e.offset,f),this.computeMovement(),d&&(!e.last||i>32)){e.delta=pt.sub(e.offset,f);const t=e.delta.map(Math.abs);pt.addTo(e.distance,t),e.direction=e.delta.map(Math.sign),e._direction=e._delta.map(Math.sign),!e.first&&i>0&&(e.velocity=[t[0]/i,t[1]/i],e.timeDelta=i)}}emit(){const t=this.state,e=this.shared,n=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!n.triggerAllEvents)return;const r=this.handler(bt(bt(bt({},e),t),{},{[this.aliasKey]:t.values}));void 0!==r&&(t.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class Nt extends Gt{constructor(...t){super(...t),yt(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=pt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=pt.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const e=this.state,n=this.config;if(!e.axis&&t){const r="object"==typeof n.axisThreshold?n.axisThreshold[Mt(t)]:n.axisThreshold;e.axis=function([t,e],n){const r=Math.abs(t),i=Math.abs(e);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}(e._movement,r)}e._blocked=(n.lockDirection||!!n.axis)&&!e.axis||!!n.axis&&n.axis!==e.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0}}}const jt=t=>t,Wt={enabled:(t=!0)=>t,eventOptions:(t,e,n)=>bt(bt({},n.shared.eventOptions),t),preventDefault:(t=!1)=>t,triggerAllEvents:(t=!1)=>t,rubberband(t=0){switch(t){case!0:return[.15,.15];case!1:return[0,0];default:return pt.toVector(t)}},from:t=>"function"==typeof t?t:null!=t?pt.toVector(t):void 0,transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||jt},threshold:t=>pt.toVector(t,0)},Vt=bt(bt({},Wt),{},{axis(t,e,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(t=0)=>t,bounds(t={}){if("function"==typeof t)return e=>Vt.bounds(t(e));if("current"in t)return()=>t.current;if("function"==typeof HTMLElement&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=t;return[[e,n],[r,i]]}}),Ht={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};const qt="undefined"!=typeof window&&window.document&&window.document.createElement;function Xt(){return qt&&"ontouchstart"in window}const $t={isBrowser:qt,gesture:function(){try{return"constructor"in GestureEvent}catch(t){return!1}}(),touch:Xt(),touchscreen:Xt()||qt&&window.navigator.maxTouchPoints>1,pointer:qt&&"onpointerdown"in window,pointerLock:qt&&"exitPointerLock"in window.document},Yt={mouse:0,touch:0,pen:8},Kt=bt(bt({},Vt),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&$t.pointerLock,$t.touch&&n?"touch":this.pointerLock?"mouse":$t.pointer&&!i?"pointer":$t.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&t?250:void 0,$t.touchscreen&&!1!==n)return t||(void 0!==n?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){const o=pt.toVector(t,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:t=.5,distance:e=50,duration:n=250}={}){return{velocity:this.transform(pt.toVector(t)),distance:this.transform(pt.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return 180;case!1:return 0;default:return t}},axisThreshold:t=>t?bt(bt({},Yt),t):Yt,keyboardDisplacement:(t=10)=>t});function Zt(t){const[e,n]=t.overflow,[r,i]=t._delta,[o,a]=t._direction;(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&i>0&&a<0||n>0&&i<0&&a>0)&&(t._movement[1]=t._movementBound[1])}const Qt=bt(bt({},Wt),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!$t.touch&&$t.gesture)return"gesture";if($t.touch&&r)return"touch";if($t.touchscreen){if($t.pointer)return"pointer";if($t.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const i=t=>{const e=Bt(It(n,t),{min:-1/0,max:1/0});return[e.min,e.max]},o=t=>{const e=Bt(It(r,t),{min:-1/0,max:1/0});return[e.min,e.max]};return"function"!=typeof n&&"function"!=typeof r?[i(),o()]:t=>[i(t),o(t)]},threshold(t,e,n){this.lockDirection="lock"===n.axis;return pt.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey:t=>void 0===t?"ctrlKey":t,pinchOnWheel:(t=!0)=>t});const Jt=bt(bt({},Vt),{},{mouseOnly:(t=!0)=>t});const te=Vt;const ee=Vt;const ne=bt(bt({},Vt),{},{mouseOnly:(t=!0)=>t}),re=new Map,ie=new Map;function oe(t){re.set(t.key,t.engine),ie.set(t.key,t.resolver)}const ae={key:"drag",engine:class extends Nt{constructor(...t){super(...t),yt(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const e=t._bounds.getBoundingClientRect(),n=t.currentTarget.getBoundingClientRect(),r={left:e.left-n.left+t.offset[0],right:e.right-n.right+t.offset[0],top:e.top-n.top+t.offset[1],bottom:e.bottom-n.bottom+t.offset[1]};t._bounds=Vt.bounds(r)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const e=this.config,n=this.state;if(null!=t.buttons&&(Array.isArray(e.pointerButtons)?!e.pointerButtons.includes(t.buttons):-1!==e.pointerButtons&&e.pointerButtons!==t.buttons))return;const r=this.ctrl.setEventIds(t);e.pointerCapture&&t.target.setPointerCapture(t.pointerId),r&&r.size>1&&n._pointerActive||(this.start(t),this.setupPointer(t),n._pointerId=Ft(t),n._pointerActive=!0,this.computeValues(Ot(t)),this.computeInitial(),e.preventScrollAxis&&"mouse"!==Mt(t)?(n._active=!1,this.setupScrollPrevention(t)):e.delay>0?(this.setupDelayTrigger(t),e.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const e=this.state;e._active=!0,e._preventScroll=!0,e._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const e=this.state,n=this.config;if(!e._pointerActive)return;const r=Ft(t);if(void 0!==e._pointerId&&r!==e._pointerId)return;const i=Ot(t);return document.pointerLockElement===t.target?e._delta=[t.movementX,t.movementY]:(e._delta=pt.sub(i,e._values),this.computeValues(i)),pt.addTo(e._movement,e._delta),this.compute(t),e._delayed&&e.intentional?(this.timeoutStore.remove("dragDelay"),e.active=!1,void this.startPointerDrag(t)):n.preventScrollAxis&&!e._preventScroll?e.axis?e.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(e._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(t)):void 0:void this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch(a){}const e=this.state,n=this.config;if(!e._active||!e._pointerActive)return;const r=Ft(t);if(void 0!==e._pointerId&&r!==e._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[i,o]=e._distance;if(e.tap=i<=n.tapsThreshold&&o<=n.tapsThreshold,e.tap&&n.filterTaps)e._force=!0;else{const[t,r]=e._delta,[i,o]=e._movement,[a,s]=n.swipe.velocity,[l,c]=n.swipe.distance,u=n.swipe.duration;if(e.elapsedTime<u){const n=Math.abs(t/e.timeDelta),u=Math.abs(r/e.timeDelta);n>a&&Math.abs(i)>l&&(e.swipe[0]=Math.sign(t)),u>s&&Math.abs(o)>c&&(e.swipe[1]=Math.sign(r))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const e=this.config,n=e.device;e.pointerLock&&t.currentTarget.requestPointerLock(),e.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,function(t){"persist"in t&&"function"==typeof t.persist&&t.persist()}(t);const e=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",e),this.eventStore.add(this.sharedConfig.window,"touch","cancel",e),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const e=Ht[t.key];if(e){const n=this.state,r=t.shiftKey?10:t.altKey?.1:1;this.start(t),n._delta=e(this.config.keyboardDisplacement,r),n._keyboardActive=!0,pt.addTo(n._movement,n._delta),this.compute(t),this.emit()}}keyUp(t){t.key in Ht&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const e=this.config.device;t(e,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(e,"change",this.pointerMove.bind(this)),t(e,"end",this.pointerUp.bind(this)),t(e,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}},resolver:Kt},se={key:"hover",engine:class extends Nt{constructor(...t){super(...t),yt(this,"ingKey","hovering")}enter(t){this.config.mouseOnly&&"mouse"!==t.pointerType||(this.start(t),this.computeValues(Ot(t)),this.compute(t),this.emit())}leave(t){if(this.config.mouseOnly&&"mouse"!==t.pointerType)return;const e=this.state;if(!e._active)return;e._active=!1;const n=Ot(t);e._movement=e._delta=pt.sub(n,e._values),this.computeValues(n),this.compute(t),e.delta=e.movement,this.emit()}bind(t){t("pointer","enter",this.enter.bind(this)),t("pointer","leave",this.leave.bind(this))}},resolver:ne},le={key:"move",engine:class extends Nt{constructor(...t){super(...t),yt(this,"ingKey","moving")}move(t){this.config.mouseOnly&&"mouse"!==t.pointerType||(this.state._active?this.moveChange(t):this.moveStart(t),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(t){this.start(t),this.computeValues(Ot(t)),this.compute(t),this.computeInitial(),this.emit()}moveChange(t){if(!this.state._active)return;const e=Ot(t),n=this.state;n._delta=pt.sub(e,n._values),pt.addTo(n._movement,n._delta),this.computeValues(e),this.compute(t),this.emit()}moveEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}bind(t){t("pointer","change",this.move.bind(this)),t("pointer","leave",this.moveEnd.bind(this))}},resolver:Jt},ce={key:"pinch",engine:class extends Gt{constructor(...t){super(...t),yt(this,"ingKey","pinching"),yt(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:e,lastOffset:n}=this.state;this.state.offset="wheel"===t?pt.add(e,n):[(1+e[0])*n[0],e[1]+n[1]]}computeMovement(){const{offset:t,lastOffset:e}=this.state;this.state.movement=[t[0]/e[0],t[1]-e[1]]}axisIntent(){const t=this.state,[e,n]=t._movement;if(!t.axis){const r=30*Math.abs(e)-Math.abs(n);r<0?t.axis="angle":r>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&("scale"===this.state.axis?t[1]=0:"angle"===this.state.axis&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const e=this.state,n=this.ctrl.touchIds;if(e._active&&e._touchIds.every(t=>n.has(t)))return;if(n.size<2)return;this.start(t),e._touchIds=Array.from(n).slice(0,2);const r=Pt(t,e._touchIds);r&&this.pinchStart(t,r)}pointerStart(t){if(null!=t.buttons&&t.buttons%2!=1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const e=this.state,n=e._pointerEvents,r=this.ctrl.pointerIds;if(e._active&&Array.from(n.keys()).every(t=>r.has(t)))return;if(n.size<2&&n.set(t.pointerId,t),e._pointerEvents.size<2)return;this.start(t);const i=Ct(...Array.from(n.values()));i&&this.pinchStart(t,i)}pinchStart(t,e){this.state.origin=e.origin,this.computeValues([e.distance,e.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const e=Pt(t,this.state._touchIds);e&&this.pinchMove(t,e)}pointerMove(t){const e=this.state._pointerEvents;if(e.has(t.pointerId)&&e.set(t.pointerId,t),!this.state._active)return;const n=Ct(...Array.from(e.values()));n&&this.pinchMove(t,n)}pinchMove(t,e){const n=this.state,r=n._values[1],i=e.angle-r;let o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([e.distance,e.angle-360*o]),n.origin=e.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const e=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch(n){}e._pointerEvents.has(t.pointerId)&&e._pointerEvents.delete(t.pointerId),e._active&&e._pointerEvents.size<2&&(e._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const e=this.state;e._active||(this.start(t),this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const e=this.state;this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY];const n=e._movement;e._movement=[t.scale-1,t.rotation],e._delta=pt.sub(e._movement,n),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const e=this.config.modifierKey;e&&!(Array.isArray(e)?e.find(e=>t[e]):t[e])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const e=this.state;e._delta=[-zt(t)[1]/100*e.offset[0],0],pt.addTo(e._movement,e._delta),Zt(e),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const e=this.config.device;e&&(t(e,"start",this[e+"Start"].bind(this)),t(e,"change",this[e+"Move"].bind(this)),t(e,"end",this[e+"End"].bind(this)),t(e,"cancel",this[e+"End"].bind(this)),t("lostPointerCapture","",this[e+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:Qt},ue={key:"scroll",engine:class extends Nt{constructor(...t){super(...t),yt(this,"ingKey","scrolling")}scroll(t){this.state._active||this.start(t),this.scrollChange(t),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(t){t.cancelable&&t.preventDefault();const e=this.state,n=function(t){var e,n;const{scrollX:r,scrollY:i,scrollLeft:o,scrollTop:a}=t.currentTarget;return[null!==(e=null!=r?r:o)&&void 0!==e?e:0,null!==(n=null!=i?i:a)&&void 0!==n?n:0]}(t);e._delta=pt.sub(n,e._values),pt.addTo(e._movement,e._delta),this.computeValues(n),this.compute(t),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("scroll","",this.scroll.bind(this))}},resolver:te},he={key:"wheel",engine:class extends Nt{constructor(...t){super(...t),yt(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const e=this.state;e._delta=zt(t),pt.addTo(e._movement,e._delta),Zt(e),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}},resolver:ee};function fe(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}const de={target(t){if(t)return()=>"current"in t?t.current:t},enabled:(t=!0)=>t,window:(t=($t.isBrowser?window:void 0))=>t,eventOptions:({passive:t=!0,capture:e=!1}={})=>({passive:t,capture:e}),transform:t=>t},pe=["target","eventOptions","window","enabled","transform"];function ve(t={},e){const n={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":n[r]=i.call(n,t[r],r,t);break;case"object":n[r]=ve(t[r],i);break;case"boolean":i&&(n[r]=t[r])}return n}class ge{constructor(t,e){yt(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=e}add(t,e,n,r,i){const o=this._listeners,a=function(t,e=""){const n=_t[t];return t+(n&&n[e]||e)}(e,n),s=bt(bt({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);t.addEventListener(a,r,s);const l=()=>{t.removeEventListener(a,r,s),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}}class me{constructor(){yt(this,"_timeouts",new Map)}add(t,e,n=140,...r){this.remove(t),this._timeouts.set(t,window.setTimeout(e,n,...r))}remove(t){const e=this._timeouts.get(t);e&&window.clearTimeout(e)}clean(){this._timeouts.forEach(t=>{window.clearTimeout(t)}),this._timeouts.clear()}}class ye{constructor(t){yt(this,"gestures",new Set),yt(this,"_targetEventStore",new ge(this)),yt(this,"gestureEventStores",{}),yt(this,"gestureTimeoutStores",{}),yt(this,"handlers",{}),yt(this,"config",{}),yt(this,"pointerIds",new Set),yt(this,"touchIds",new Set),yt(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(t,e){e.drag&&xe(t,"drag");e.wheel&&xe(t,"wheel");e.scroll&&xe(t,"scroll");e.move&&xe(t,"move");e.pinch&&xe(t,"pinch");e.hover&&xe(t,"hover")}(this,t)}setEventIds(t){return Et(t)?(this.touchIds=new Set(Dt(t)),this.touchIds):"pointerId"in t?("pointerup"===t.type||"pointercancel"===t.type?this.pointerIds.delete(t.pointerId):"pointerdown"===t.type&&this.pointerIds.add(t.pointerId),this.pointerIds):void 0}applyHandlers(t,e){this.handlers=t,this.nativeHandlers=e}applyConfig(t,e){this.config=function(t,e,n={}){const r=t,{target:i,eventOptions:o,window:a,enabled:s,transform:l}=r,c=fe(r,pe);if(n.shared=ve({target:i,eventOptions:o,window:a,enabled:s,transform:l},de),e){const t=ie.get(e);n[e]=ve(bt({shared:n.shared},c),t)}else for(const u in c){const t=ie.get(u);t&&(n[u]=ve(bt({shared:n.shared},c[u]),t))}return n}(t,e,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const e=this.config.shared,n={};let r;if(!e.target||(r=e.target(),r)){if(e.enabled){for(const e of this.gestures){const i=this.config[e],o=be(n,i.eventOptions,!!r);if(i.enabled){new(re.get(e))(this,t,e).bind(o)}}const i=be(n,e.eventOptions,!!r);for(const e in this.nativeHandlers)i(e,"",n=>this.nativeHandlers[e](bt(bt({},this.state.shared),{},{event:n,args:t})),void 0,!0)}for(const t in n)n[t]=Lt(...n[t]);if(!r)return n;for(const t in n){const{device:e,capture:i,passive:o}=Tt(t);this._targetEventStore.add(r,e,"",n[t],{capture:i,passive:o})}}}}function xe(t,e){t.gestures.add(e),t.gestureEventStores[e]=new ge(t,e),t.gestureTimeoutStores[e]=new me}const be=(t,e,n)=>(r,i,o,a={},s=!1)=>{var l,c;const u=null!==(l=a.capture)&&void 0!==l?l:e.capture,h=null!==(c=a.passive)&&void 0!==c?c:e.passive;let f=s?r:Ut(r,i,u);n&&h&&(f+="Passive"),t[f]=t[f]||[],t[f].push(o)},_e=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function we(t,e,n,r,i,o){if(!t.has(n))return;if(!re.has(r))return;const a=n+"Start",s=n+"End";i[r]=t=>{let r;return t.first&&a in e&&e[a](t),n in e&&(r=e[n](t)),t.last&&s in e&&e[s](t),r},o[r]=o[r]||{}}function Se(t,e){const[n,r,i]=function(t){const e={},n={},r=new Set;for(let i in t)_e.test(i)?(r.add(RegExp.lastMatch),n[i]=t[i]):e[i]=t[i];return[n,e,r]}(t),o={};return we(i,n,"onDrag","drag",o,e),we(i,n,"onWheel","wheel",o,e),we(i,n,"onScroll","scroll",o,e),we(i,n,"onPinch","pinch",o,e),we(i,n,"onMove","move",o,e),we(i,n,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:r}}function Ue(t){return t.forEach(oe),function(t,e){const{handlers:n,nativeHandlers:i,config:o}=Se(t,e||{});return function(t,e={},n,i){const o=r.useMemo(()=>new ye(t),[]);if(o.applyHandlers(t,i),o.applyConfig(e,n),r.useEffect(o.effect.bind(o)),r.useEffect(()=>o.clean.bind(o),[]),void 0===e.target)return o.bind.bind(o)}(n,o,void 0,i)}}const ke=(()=>parseInt(v.replace(/\D+/g,"")))(),Te=ke>=125?"uv1":"uv2",Ee=new _,Me=new h;class Ae extends g{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new m([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new m([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(t){const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const n=new y(e,6,1);return this.setAttribute("instanceStart",new x(n,3,0)),this.setAttribute("instanceEnd",new x(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t,e=3){let n;t instanceof Float32Array?n=t:Array.isArray(t)&&(n=new Float32Array(t));const r=new y(n,2*e,1);return this.setAttribute("instanceColorStart",new x(r,e,0)),this.setAttribute("instanceColorEnd",new x(r,e,e)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new b(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new _);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),Ee.setFromBufferAttribute(e),this.boundingBox.union(Ee))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new w),null===this.boundingBox&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let i=0,o=t.count;i<o;i++)Me.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(Me)),Me.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(Me));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)}}toJSON(){}applyMatrix(t){return this.applyMatrix4(t)}}class Ce extends Ae{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const e=t.length-3,n=new Float32Array(2*e);for(let r=0;r<e;r+=3)n[2*r]=t[r],n[2*r+1]=t[r+1],n[2*r+2]=t[r+2],n[2*r+3]=t[r+3],n[2*r+4]=t[r+4],n[2*r+5]=t[r+5];return super.setPositions(n),this}setColors(t,e=3){const n=t.length-e,r=new Float32Array(2*n);if(3===e)for(let i=0;i<n;i+=e)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5];else for(let i=0;i<n;i+=e)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5],r[2*i+6]=t[i+6],r[2*i+7]=t[i+7];return super.setColors(r,e),this}fromLine(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}}class De extends S{constructor(t){super({type:"LineMaterial",uniforms:U.clone(U.merge([k.common,k.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new f(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\t\tuniform float linewidth;\n\t\t\t\tuniform vec2 resolution;\n\n\t\t\t\tattribute vec3 instanceStart;\n\t\t\t\tattribute vec3 instanceEnd;\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t\tattribute vec4 instanceColorStart;\n\t\t\t\t\t\tattribute vec4 instanceColorEnd;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t\tattribute vec3 instanceColorStart;\n\t\t\t\t\t\tattribute vec3 instanceColorEnd;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashScale;\n\t\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#endif\n\n\t\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t\t// conservative estimate of the near plane\n\t\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\t\tvLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t\t// camera space\n\t\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// clip space\n\t\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t\t// ndc space\n\t\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t\t// direction\n\t\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\t\tdir.x *= aspect;\n\t\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\t\tvec3 offset;\n\t\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t\t// set the world position\n\t\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t\t// project the worldpos\n\t\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t\t// select end\n\t\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t\t// back to clip space\n\t\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tgl_Position = clip;\n\n\t\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:`\n\t\t\t\tuniform vec3 diffuse;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform float linewidth;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashOffset;\n\t\t\t\t\tuniform float dashSize;\n\t\t\t\t\tuniform float gapSize;\n\n\t\t\t\t#endif\n\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\t\tfloat mua;\n\t\t\t\t\tfloat mub;\n\n\t\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\t\tmua = numer / denom;\n\t\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\t\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\t\tdiffuseColor *= vLineColor;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tdiffuseColor.rgb *= vLineColor;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\t\t\tgl_FragColor = diffuseColor;\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <${ke>=154?"colorspace_fragment":"encodings_fragment"}>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\t\t\t`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){!0===t?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===t?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===t?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}}const Pe=new E,Fe=new h,Oe=new h,ze=new E,Ie=new E,Re=new E,Le=new h,Be=new A,Ge=new M,Ne=new h,je=new _,We=new w,Ve=new E;let He,qe;function Xe(t,e,n){return Ve.set(0,0,-e,1).applyMatrix4(t.projectionMatrix),Ve.multiplyScalar(1/Ve.w),Ve.x=qe/n.width,Ve.y=qe/n.height,Ve.applyMatrix4(t.projectionMatrixInverse),Ve.multiplyScalar(1/Ve.w),Math.abs(Math.max(Ve.x,Ve.y))}class $e extends T{constructor(t=new Ae,e=new De({color:16777215*Math.random()})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,r=new Float32Array(2*e.count);for(let o=0,a=0,s=e.count;o<s;o++,a+=2)Fe.fromBufferAttribute(e,o),Oe.fromBufferAttribute(n,o),r[a]=0===a?0:r[a-1],r[a+1]=r[a]+Fe.distanceTo(Oe);const i=new y(r,2,1);return t.setAttribute("instanceDistanceStart",new x(i,1,0)),t.setAttribute("instanceDistanceEnd",new x(i,1,1)),this}raycast(t,e){const n=this.material.worldUnits,r=t.camera,i=void 0!==t.params.Line2&&t.params.Line2.threshold||0;He=t.ray;const o=this.matrixWorld,a=this.geometry,s=this.material;let l,c;if(qe=s.linewidth+i,null===a.boundingSphere&&a.computeBoundingSphere(),We.copy(a.boundingSphere).applyMatrix4(o),n)l=.5*qe;else{l=Xe(r,Math.max(r.near,We.distanceToPoint(He.origin)),s.resolution)}if(We.radius+=l,!1!==He.intersectsSphere(We)){if(null===a.boundingBox&&a.computeBoundingBox(),je.copy(a.boundingBox).applyMatrix4(o),n)c=.5*qe;else{c=Xe(r,Math.max(r.near,je.distanceToPoint(He.origin)),s.resolution)}je.expandByScalar(c),!1!==He.intersectsBox(je)&&(n?function(t,e){const n=t.matrixWorld,r=t.geometry,i=r.attributes.instanceStart,o=r.attributes.instanceEnd;for(let a=0,s=Math.min(r.instanceCount,i.count);a<s;a++){Ge.start.fromBufferAttribute(i,a),Ge.end.fromBufferAttribute(o,a),Ge.applyMatrix4(n);const r=new h,s=new h;He.distanceSqToSegment(Ge.start,Ge.end,s,r),s.distanceTo(r)<.5*qe&&e.push({point:s,pointOnLine:r,distance:He.origin.distanceTo(s),object:t,face:null,faceIndex:a,uv:null,[Te]:null})}}(this,e):function(t,e,n){const r=e.projectionMatrix,i=t.material.resolution,o=t.matrixWorld,a=t.geometry,s=a.attributes.instanceStart,l=a.attributes.instanceEnd,c=Math.min(a.instanceCount,s.count),u=-e.near;He.at(1,Re),Re.w=1,Re.applyMatrix4(e.matrixWorldInverse),Re.applyMatrix4(r),Re.multiplyScalar(1/Re.w),Re.x*=i.x/2,Re.y*=i.y/2,Re.z=0,Le.copy(Re),Be.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,d=c;f<d;f++){if(ze.fromBufferAttribute(s,f),Ie.fromBufferAttribute(l,f),ze.w=1,Ie.w=1,ze.applyMatrix4(Be),Ie.applyMatrix4(Be),ze.z>u&&Ie.z>u)continue;if(ze.z>u){const t=ze.z-Ie.z,e=(ze.z-u)/t;ze.lerp(Ie,e)}else if(Ie.z>u){const t=Ie.z-ze.z,e=(Ie.z-u)/t;Ie.lerp(ze,e)}ze.applyMatrix4(r),Ie.applyMatrix4(r),ze.multiplyScalar(1/ze.w),Ie.multiplyScalar(1/Ie.w),ze.x*=i.x/2,ze.y*=i.y/2,Ie.x*=i.x/2,Ie.y*=i.y/2,Ge.start.copy(ze),Ge.start.z=0,Ge.end.copy(Ie),Ge.end.z=0;const e=Ge.closestPointToPointParameter(Le,!0);Ge.at(e,Ne);const a=C.lerp(ze.z,Ie.z,e),c=a>=-1&&a<=1,d=Le.distanceTo(Ne)<.5*qe;if(c&&d){Ge.start.fromBufferAttribute(s,f),Ge.end.fromBufferAttribute(l,f),Ge.start.applyMatrix4(o),Ge.end.applyMatrix4(o);const e=new h,r=new h;He.distanceSqToSegment(Ge.start,Ge.end,r,e),n.push({point:r,pointOnLine:e,distance:He.origin.distanceTo(r),object:t,face:null,faceIndex:f,uv:null,[Te]:null})}}}(this,r,e))}}onBeforeRender(t){const e=this.material.uniforms;e&&e.resolution&&(t.getViewport(Pe),this.material.uniforms.resolution.value.set(Pe.z,Pe.w))}}class Ye extends $e{constructor(t=new Ce,e=new De({color:16777215*Math.random()})){super(t,e),this.isLine2=!0,this.type="Line2"}}const Ke=n.forwardRef(function({points:t,color:e=16777215,vertexColors:r,linewidth:i,lineWidth:o,segments:a,dashed:l,...u},d){var p,v;const g=s(t=>t.size),m=n.useMemo(()=>a?new $e:new Ye,[a]),[y]=n.useState(()=>new De),x=4===(null==r||null==(p=r[0])?void 0:p.length)?4:3,b=n.useMemo(()=>{const n=a?new Ae:new Ce,i=t.map(t=>{const e=Array.isArray(t);return t instanceof h||t instanceof E?[t.x,t.y,t.z]:t instanceof f?[t.x,t.y,0]:e&&3===t.length?[t[0],t[1],t[2]]:e&&2===t.length?[t[0],t[1],0]:t});if(n.setPositions(i.flat()),r){e=16777215;const t=r.map(t=>t instanceof D?t.toArray():t);n.setColors(t.flat(),x)}return n},[t,a,r,x]);return n.useLayoutEffect(()=>{m.computeLineDistances()},[t,m]),n.useLayoutEffect(()=>{l?y.defines.USE_DASH="":delete y.defines.USE_DASH,y.needsUpdate=!0},[l,y]),n.useEffect(()=>()=>{b.dispose(),y.dispose()},[b]),n.createElement("primitive",c({object:m,ref:d},u),n.createElement("primitive",{object:b,attach:"geometry"}),n.createElement("primitive",c({object:y,attach:"material",color:e,vertexColors:Boolean(r),resolution:[g.width,g.height],linewidth:null!==(v=null!=i?i:o)&&void 0!==v?v:1,dashed:l,transparent:4===x},u)))});function Ze(){var t=Object.create(null);function e(r,i){var o=r.id,a=r.name,s=r.dependencies;void 0===s&&(s=[]);var l=r.init;void 0===l&&(l=function(){});var c=r.getTransferables;if(void 0===c&&(c=null),!t[o])try{s=s.map(function(n){return n&&n.isWorkerModule&&(e(n,function(t){if(t instanceof Error)throw t}),n=t[n.id].value),n}),l=n("<"+a+">.init",l),c&&(c=n("<"+a+">.getTransferables",c));var u=null;"function"==typeof l&&(u=l.apply(void 0,s)),t[o]={id:o,value:u,getTransferables:c},i(u)}catch(h){!h||h.noLog,i(h)}}function n(t,e){var n=void 0;self.troikaDefine=function(t){return n=t};var r=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+e+"\n)"],{type:"application/javascript"}));try{importScripts(r)}catch(i){}return URL.revokeObjectURL(r),delete self.troikaDefine,n}self.addEventListener("message",function(n){var r=n.data,i=r.messageId,o=r.action,a=r.data;try{"registerModule"===o&&e(a,function(t){t instanceof Error?postMessage({messageId:i,success:!1,error:t.message}):postMessage({messageId:i,success:!0,result:{isCallable:"function"==typeof t}})}),"callModule"===o&&function(e,n){var r,i=e.id,o=e.args;t[i]&&"function"==typeof t[i].value||n(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var a=(r=t[i]).value.apply(r,o);a&&"function"==typeof a.then?a.then(s,function(t){return n(t instanceof Error?t:new Error(""+t))}):s(a)}catch(l){n(l)}function s(e){try{var r=t[i].getTransferables&&t[i].getTransferables(e);r&&Array.isArray(r)&&r.length||(r=void 0),n(e,r)}catch(l){n(l)}}}(a,function(t,e){t instanceof Error?postMessage({messageId:i,success:!1,error:t.message}):postMessage({messageId:i,success:!0,result:t},e||void 0)})}catch(s){postMessage({messageId:i,success:!1,error:s.stack})}})}var Qe=function(){var t=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),t=!0}catch(e){}return Qe=function(){return t},t},Je=0,tn=0,en=!1,nn=Object.create(null),rn=Object.create(null),on=Object.create(null);function an(t){if(!(t&&"function"==typeof t.init||en))throw new Error("requires `options.init` function");var e=t.dependencies,n=t.init,r=t.getTransferables,i=t.workerId,o=function(t){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(e){if("function"==typeof e)return e.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var n=t.dependencies,r=t.init;n=Array.isArray(n)?n.map(function(t){return t&&(t=t.onMainThread||t)._getInitResult&&(t=t._getInitResult()),t}):[];var i=Promise.all(n).then(function(t){return r.apply(null,t)});return e._getInitResult=function(){return i},i},e}(t);null==i&&(i="#default");var a="workerModule"+ ++Je,s=t.name||a,l=null;function c(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(!Qe())return o.apply(void 0,t);if(!l){l=ln(i,"registerModule",c.workerModuleData);var n=function(){l=null,rn[i].delete(n)};(rn[i]||(rn[i]=new Set)).add(n)}return l.then(function(e){if(e.isCallable)return ln(i,"callModule",{id:a,args:t});throw new Error("Worker module function was called but `init` did not return a callable function")})}return e=e&&e.map(function(t){return"function"!=typeof t||t.workerModuleData||(en=!0,t=an({workerId:i,name:"<"+s+"> function dependency: "+t.name,init:"function(){return (\n"+sn(t)+"\n)}"}),en=!1),t&&t.workerModuleData&&(t=t.workerModuleData),t}),c.workerModuleData={isWorkerModule:!0,id:a,name:s,dependencies:e,init:sn(n),getTransferables:r&&sn(r)},c.onMainThread=o,c}function sn(t){var e=t.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function ln(t,e,n){return new Promise(function(r,i){var o=++tn;on[o]=function(t){t.success?r(t.result):i(new Error("Error in worker "+e+" call: "+t.error))},function(t){var e=nn[t];if(!e){var n=sn(Ze);(e=nn[t]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+t.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(t){var e=t.data,n=e.messageId,r=on[n];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete on[n],r(e)}}return e}(t).postMessage({messageId:o,action:e,data:n})})}function cn(){var t=function(t){function e(t,e,n,r,i,o,a,s){var l=1-a;s.x=l*l*t+2*l*a*n+a*a*i,s.y=l*l*e+2*l*a*r+a*a*o}function n(t,e,n,r,i,o,a,s,l,c){var u=1-l;c.x=u*u*u*t+3*u*u*l*n+3*u*l*l*i+l*l*l*a,c.y=u*u*u*e+3*u*u*l*r+3*u*l*l*o+l*l*l*s}function r(t,e){for(var n,r,i,o,a,s=/([MLQCZ])([^MLQCZ]*)/g;n=s.exec(t);){var l=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(t){return parseFloat(t)});switch(n[1]){case"M":o=r=l[0],a=i=l[1];break;case"L":l[0]===o&&l[1]===a||e("L",o,a,o=l[0],a=l[1]);break;case"Q":e("Q",o,a,o=l[2],a=l[3],l[0],l[1]);break;case"C":e("C",o,a,o=l[4],a=l[5],l[0],l[1],l[2],l[3]);break;case"Z":o===r&&a===i||e("L",o,a,r,i)}}}function i(t,i,o){void 0===o&&(o=16);var a={x:0,y:0};r(t,function(t,r,s,l,c,u,h,f,d){switch(t){case"L":i(r,s,l,c);break;case"Q":for(var p=r,v=s,g=1;g<o;g++)e(r,s,u,h,l,c,g/(o-1),a),i(p,v,a.x,a.y),p=a.x,v=a.y;break;case"C":for(var m=r,y=s,x=1;x<o;x++)n(r,s,u,h,f,d,l,c,x/(o-1),a),i(m,y,a.x,a.y),m=a.x,y=a.y}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a=new WeakMap,s={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(t,e){var n=t.getContext?t.getContext("webgl",s):t,r=a.get(n);if(!r){var i="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,o={},l={},c={},u=-1,h=[];function f(t){var e=o[t];if(!e&&!(e=o[t]=n.getExtension(t)))throw new Error(t+" not supported");return e}function d(t,e){var r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}function p(t,e,r,o){if(!l[t]){var a={},s={},c=n.createProgram();n.attachShader(c,d(e,n.VERTEX_SHADER)),n.attachShader(c,d(r,n.FRAGMENT_SHADER)),n.linkProgram(c),l[t]={program:c,transaction:function(t){n.useProgram(c),t({setUniform:function(t,e){for(var r=[],i=arguments.length-2;i-- >0;)r[i]=arguments[i+2];var o=s[e]||(s[e]=n.getUniformLocation(c,e));n["uniform"+t].apply(n,[o].concat(r))},setAttribute:function(t,e,r,o,s){var l=a[t];l||(l=a[t]={buf:n.createBuffer(),loc:n.getAttribLocation(c,t),data:null}),n.bindBuffer(n.ARRAY_BUFFER,l.buf),n.vertexAttribPointer(l.loc,e,n.FLOAT,!1,0,0),n.enableVertexAttribArray(l.loc),i?n.vertexAttribDivisor(l.loc,o):f("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,o),s!==l.data&&(n.bufferData(n.ARRAY_BUFFER,s,r),l.data=s)}})}}}l[t].transaction(o)}function v(t,e){u++;try{n.activeTexture(n.TEXTURE0+u);var r=c[t];r||(r=c[t]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,r),e(r,u)}finally{u--}}function g(t,e,r){var i=n.createFramebuffer();h.push(i),n.bindFramebuffer(n.FRAMEBUFFER,i),n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);try{r(i)}finally{n.deleteFramebuffer(i),n.bindFramebuffer(n.FRAMEBUFFER,h[--h.length-1]||null)}}function m(){o={},l={},c={},u=-1,h.length=0}n.canvas.addEventListener("webglcontextlost",function(t){m(),t.preventDefault()},!1),a.set(n,r={gl:n,isWebGL2:i,getExtension:f,withProgram:p,withTexture:v,withTextureFramebuffer:g,handleContextLoss:m})}e(r)}function c(t,e,n,r,i,a,s,c){void 0===s&&(s=15),void 0===c&&(c=null),l(t,function(t){var l=t.gl,u=t.withProgram;(0,t.withTexture)("copy",function(t,h){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,i,a,0,l.RGBA,l.UNSIGNED_BYTE,e),u("copy",o,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(t){var e=t.setUniform;(0,t.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),e("1i","image",h),l.bindFramebuffer(l.FRAMEBUFFER,c||null),l.disable(l.BLEND),l.colorMask(8&s,4&s,2&s,1&s),l.viewport(n,r,i,a),l.scissor(n,r,i,a),l.drawArrays(l.TRIANGLES,0,3)})})})}var u=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:c,resizeWebGLCanvasWithoutClearing:function(t,e,n){var r=t.width,i=t.height;l(t,function(o){var a=o.gl,s=new Uint8Array(r*i*4);a.readPixels(0,0,r,i,a.RGBA,a.UNSIGNED_BYTE,s),t.width=e,t.height=n,c(a,s,0,0,r,i)})}});function h(t,e,n,r,o,a){void 0===a&&(a=1);var s=new Uint8Array(t*e),l=r[2]-r[0],c=r[3]-r[1],u=[];i(n,function(t,e,n,r){u.push({x1:t,y1:e,x2:n,y2:r,minX:Math.min(t,n),minY:Math.min(e,r),maxX:Math.max(t,n),maxY:Math.max(e,r)})}),u.sort(function(t,e){return t.maxX-e.maxX});for(var h=0;h<t;h++)for(var f=0;f<e;f++){var d=g(r[0]+l*(h+.5)/t,r[1]+c*(f+.5)/e),v=Math.pow(1-Math.abs(d)/o,a)/2;d<0&&(v=1-v),v=Math.max(0,Math.min(255,Math.round(255*v))),s[f*t+h]=v}return s;function g(t,e){for(var n=1/0,r=1/0,i=u.length;i--;){var o=u[i];if(o.maxX+r<=t)break;if(t+r>o.minX&&e-r<o.maxY&&e+r>o.minY){var a=p(t,e,o.x1,o.y1,o.x2,o.y2);a<n&&(n=a,r=Math.sqrt(n))}}return function(t,e){for(var n=0,r=u.length;r--;){var i=u[r];if(i.maxX<=t)break;i.y1>e!=i.y2>e&&t<(i.x2-i.x1)*(e-i.y1)/(i.y2-i.y1)+i.x1&&(n+=i.y1<i.y2?1:-1)}return 0!==n}(t,e)&&(r=-r),r}}function f(t,e,n,r,i,o,a,s,l,c){void 0===o&&(o=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),d(t,e,n,r,i,o,a,null,s,l,c)}function d(t,e,n,r,i,o,a,s,l,u,f){void 0===o&&(o=1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===f&&(f=0);for(var d=h(t,e,n,r,i,o),p=new Uint8Array(4*d.length),v=0;v<d.length;v++)p[4*v+f]=d[v];c(a,p,l,u,t,e,1<<3-f,s)}function p(t,e,n,r,i,o){var a=i-n,s=o-r,l=a*a+s*s,c=l?Math.max(0,Math.min(1,((t-n)*a+(e-r)*s)/l)):0,u=t-(n+c*a),h=e-(r+c*s);return u*u+h*h}var v=Object.freeze({__proto__:null,generate:h,generateIntoCanvas:f,generateIntoFramebuffer:d}),g=new Float32Array([0,0,2,0,0,2]),m=null,y=!1,x={},b=new WeakMap;function _(t){if(!y&&!k(t))throw new Error("WebGL generation not supported")}function w(t,e,n,r,i,o,a){if(void 0===o&&(o=1),void 0===a&&(a=null),!a&&!(a=m)){var s="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!s)throw new Error("OffscreenCanvas or DOM canvas not supported");a=m=s.getContext("webgl",{depth:!1})}_(a);var c=new Uint8Array(t*e*4);l(a,function(a){var s=a.gl,l=a.withTexture,u=a.withTextureFramebuffer;l("readable",function(a,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,s.UNSIGNED_BYTE,null),u(a,l,function(a){U(t,e,n,r,i,o,s,a,0,0,0),s.readPixels(0,0,t,e,s.RGBA,s.UNSIGNED_BYTE,c)})})});for(var u=new Uint8Array(t*e),h=0,f=0;h<c.length;h+=4)u[f++]=c[h];return u}function S(t,e,n,r,i,o,a,s,l,c){void 0===o&&(o=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),U(t,e,n,r,i,o,a,null,s,l,c)}function U(t,e,n,r,a,s,c,u,h,f,d){void 0===s&&(s=1),void 0===h&&(h=0),void 0===f&&(f=0),void 0===d&&(d=0),_(c);var p=[];i(n,function(t,e,n,r){p.push(t,e,n,r)}),p=new Float32Array(p),l(c,function(n){var i=n.gl,l=n.isWebGL2,c=n.getExtension,v=n.withProgram,m=n.withTexture,y=n.withTextureFramebuffer,x=n.handleContextLoss;if(m("rawDistances",function(n,m){t===n._lastWidth&&e===n._lastHeight||i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n._lastWidth=t,n._lastHeight=e,0,i.RGBA,i.UNSIGNED_BYTE,null),v("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(o){var u=o.setAttribute,h=o.setUniform,f=!l&&c("ANGLE_instanced_arrays"),d=!l&&c("EXT_blend_minmax");u("aUV",2,i.STATIC_DRAW,0,g),u("aLineSegment",4,i.DYNAMIC_DRAW,1,p),h.apply(void 0,["4f","uGlyphBounds"].concat(r)),h("1f","uMaxDistance",a),h("1f","uExponent",s),y(n,m,function(n){i.enable(i.BLEND),i.colorMask(!0,!0,!0,!0),i.viewport(0,0,t,e),i.scissor(0,0,t,e),i.blendFunc(i.ONE,i.ONE),i.blendEquationSeparate(i.FUNC_ADD,l?i.MAX:d.MAX_EXT),i.clear(i.COLOR_BUFFER_BIT),l?i.drawArraysInstanced(i.TRIANGLES,0,3,p.length/4):f.drawArraysInstancedANGLE(i.TRIANGLES,0,3,p.length/4)})}),v("post",o,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(n){n.setAttribute("aUV",2,i.STATIC_DRAW,0,g),n.setUniform("1i","tex",m),i.bindFramebuffer(i.FRAMEBUFFER,u),i.disable(i.BLEND),i.colorMask(0===d,1===d,2===d,3===d),i.viewport(h,f,t,e),i.scissor(h,f,t,e),i.drawArrays(i.TRIANGLES,0,3)})}),i.isContextLost())throw x(),new Error("webgl context lost")})}function k(t){var e=t&&t!==m?t.canvas||t:x,n=b.get(e);if(void 0===n){y=!0;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],i=w(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,t);(n=i&&r.length===i.length&&i.every(function(t,e){return t===r[e]}))||"bad trial run results"}catch(o){n=!1,o.message}y=!1,b.set(e,n)}return n}var T=Object.freeze({__proto__:null,generate:w,generateIntoCanvas:S,generateIntoFramebuffer:U,isSupported:k});return t.forEachPathCommand=r,t.generate=function(t,e,n,r,i,o){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===o&&(o=1);try{return w.apply(T,arguments)}catch(a){return h.apply(v,arguments)}},t.generateIntoCanvas=function(t,e,n,r,i,o,a,s,l,c){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===o&&(o=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return S.apply(T,arguments)}catch(u){return f.apply(v,arguments)}},t.javascript=v,t.pathToLineSegments=i,t.webgl=T,t.webglUtils=u,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return t}const un=/\bvoid\s+main\s*\(\s*\)\s*{/g;function hn(t){return t.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(t,e){let n=z[e];return n?hn(n):t})}const fn=[];for(let Bi=0;Bi<256;Bi++)fn[Bi]=(Bi<16?"0":"")+Bi.toString(16);const dn=Object.assign||function(){let t=arguments[0];for(let e=1,n=arguments.length;e<n;e++){let n=arguments[e];if(n)for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},pn=Date.now(),vn=new WeakMap,gn=new Map;let mn=1e10;function yn(t,e){const n=function(t){const e=JSON.stringify(t,bn);let n=wn.get(e);null==n&&wn.set(e,n=++_n);return n}
/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/(e);let r=vn.get(t);if(r||vn.set(t,r=Object.create(null)),r[n])return new r[n];const i=`_onBeforeCompile${n}`,o=function(r,o){t.onBeforeCompile.call(this,r,o);const a=this.customProgramCacheKey()+"|"+r.vertexShader+"|"+r.fragmentShader;let s=gn[a];if(!s){const t=function(t,{vertexShader:e,fragmentShader:n},r,i){let{vertexDefs:o,vertexMainIntro:a,vertexMainOutro:s,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:f,customRewriter:d,timeUniform:p}=r;o=o||"",a=a||"",s=s||"",c=c||"",u=u||"",h=h||"",(l||d)&&(e=hn(e));(f||d)&&(n=hn(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(d){let t=d({vertexShader:e,fragmentShader:n});e=t.vertexShader,n=t.fragmentShader}if(f){let t=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,e=>(t.push(e),"")),h=`${f}\n${t.join("\n")}\n${h}`}if(p){const t=`\nuniform float ${p};\n`;o=t+o,c=t+c}l&&(o=`${o}\nvoid troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${l}\n}\n`,a=`\ntroika_position_${i} = vec3(position);\ntroika_normal_${i} = vec3(normal);\ntroika_uv_${i} = vec2(uv);\ntroikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});\n${a}\n`,e=(e=`vec3 troika_position_${i};\nvec3 troika_normal_${i};\nvec2 troika_uv_${i};\n${e}\n`).replace(/\b(position|normal|uv)\b/g,(t,e,n,r)=>/\battribute\s+vec[23]\s+$/.test(r.substr(0,n))?e:`troika_${e}_${i}`),t.map&&t.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${i}`)));return e=xn(e,i,o,a,s),n=xn(n,i,c,u,h),{vertexShader:e,fragmentShader:n}}(this,r,e,n);s=gn[a]=t}r.vertexShader=s.vertexShader,r.fragmentShader=s.fragmentShader,dn(r.uniforms,this.uniforms),e.timeUniform&&(r.uniforms[e.timeUniform]={get value(){return Date.now()-pn}}),this[i]&&this[i](r)},a=function(){return s(e.chained?t:t.clone())},s=function(r){const i=Object.create(r,l);return Object.defineProperty(i,"baseMaterial",{value:t}),Object.defineProperty(i,"id",{value:mn++}),i.uuid=function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(fn[255&t]+fn[t>>8&255]+fn[t>>16&255]+fn[t>>24&255]+"-"+fn[255&e]+fn[e>>8&255]+"-"+fn[e>>16&15|64]+fn[e>>24&255]+"-"+fn[63&n|128]+fn[n>>8&255]+"-"+fn[n>>16&255]+fn[n>>24&255]+fn[255&r]+fn[r>>8&255]+fn[r>>16&255]+fn[r>>24&255]).toUpperCase()}(),i.uniforms=dn({},r.uniforms,e.uniforms),i.defines=dn({},r.defines,e.defines),i.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",i.extensions=dn({},r.extensions,e.extensions),i._listeners=void 0,i},l={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>t.type,set:e=>{t.type=e}},isDerivedFrom:{writable:!0,configurable:!0,value:function(t){const e=this.baseMaterial;return t===e||e.isDerivedMaterial&&e.isDerivedFrom(t)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>o,set(t){this[i]=t}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(dn(this.extensions,e.extensions),dn(this.defines,e.defines),dn(this.uniforms,U.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const e=new t.constructor;return s(e).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=yn(t.isDerivedMaterial?t.getDepthMaterial():new F({depthPacking:O}),e),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=yn(t.isDerivedMaterial?t.getDistanceMaterial():new P,e),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:e,_distanceMaterial:n}=this;e&&e.dispose(),n&&n.dispose(),t.dispose.call(this)}}};return r[n]=a,new a}function xn(t,e,n,r,i){return(r||i||n)&&(t=t.replace(un,`\n${n}\nvoid troikaOrigMain${e}() {`),t+=`\nvoid main() {\n  ${r}\n  troikaOrigMain${e}();\n  ${i}\n}`),t}function bn(t,e){return"uniforms"===t?void 0:"function"==typeof e?e.toString():e}let _n=0;const wn=new Map;const Sn=an({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(t){var e={parse:function(t){var n=e._bin,r=new Uint8Array(t);if("ttcf"==n.readASCII(r,0,4)){var i=4;n.readUshort(r,i),i+=2,n.readUshort(r,i),i+=2;var o=n.readUint(r,i);i+=4;for(var a=[],s=0;s<o;s++){var l=n.readUint(r,i);i+=4,a.push(e._readFont(r,l))}return a}return[e._readFont(r,0)]},_readFont:function(t,n){var r=e._bin,i=n;r.readFixed(t,n),n+=4;var o=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},l={},c=0;c<o;c++){var u=r.readASCII(t,n,4);n+=4,r.readUint(t,n),n+=4;var h=r.readUint(t,n);n+=4;var f=r.readUint(t,n);n+=4,l[u]={offset:h,length:f}}for(c=0;c<a.length;c++){var d=a[c];l[d]&&(s[d.trim()]=e[d.trim()].parse(t,l[d].offset,l[d].length,s))}return s},_tabOffset:function(t,n,r){for(var i=e._bin,o=i.readUshort(t,r+4),a=r+12,s=0;s<o;s++){var l=i.readASCII(t,a,4);a+=4,i.readUint(t,a),a+=4;var c=i.readUint(t,a);if(a+=4,i.readUint(t,a),a+=4,l==n)return c}return 0}};e._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,n){return e._bin.readShort(t,n)/16384},readInt:function(t,n){return e._bin._view(t).getInt32(n)},readInt8:function(t,n){return e._bin._view(t).getInt8(n)},readShort:function(t,n){return e._bin._view(t).getInt16(n)},readUshort:function(t,n){return e._bin._view(t).getUint16(n)},readUshorts:function(t,n,r){for(var i=[],o=0;o<r;o++)i.push(e._bin.readUshort(t,n+2*o));return i},readUint:function(t,n){return e._bin._view(t).getUint32(n)},readUint64:function(t,n){return 4294967296*e._bin.readUint(t,n)+e._bin.readUint(t,n+4)},readASCII:function(t,e,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(t[e+i]);return r},readUnicode:function(t,e,n){for(var r="",i=0;i<n;i++){var o=t[e++]<<8|t[e++];r+=String.fromCharCode(o)}return r},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,n,r){var i=e._bin._tdec;return i&&0==n&&r==t.length?i.decode(t):e._bin.readASCII(t,n,r)},readBytes:function(t,e,n){for(var r=[],i=0;i<n;i++)r.push(t[e+i]);return r},readASCIIArray:function(t,e,n){for(var r=[],i=0;i<n;i++)r.push(String.fromCharCode(t[e+i]));return r},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},e._lctf={},e._lctf.parse=function(t,n,r,i,o){var a=e._bin,s={},l=n;a.readFixed(t,n),n+=4;var c=a.readUshort(t,n);n+=2;var u=a.readUshort(t,n);n+=2;var h=a.readUshort(t,n);return n+=2,s.scriptList=e._lctf.readScriptList(t,l+c),s.featureList=e._lctf.readFeatureList(t,l+u),s.lookupList=e._lctf.readLookupList(t,l+h,o),s},e._lctf.readLookupList=function(t,n,r){var i=e._bin,o=n,a=[],s=i.readUshort(t,n);n+=2;for(var l=0;l<s;l++){var c=i.readUshort(t,n);n+=2;var u=e._lctf.readLookupTable(t,o+c,r);a.push(u)}return a},e._lctf.readLookupTable=function(t,n,r){var i=e._bin,o=n,a={tabs:[]};a.ltype=i.readUshort(t,n),n+=2,a.flag=i.readUshort(t,n),n+=2;var s=i.readUshort(t,n);n+=2;for(var l=a.ltype,c=0;c<s;c++){var u=i.readUshort(t,n);n+=2;var h=r(t,l,o+u,a);a.tabs.push(h)}return a},e._lctf.numOfOnes=function(t){for(var e=0,n=0;n<32;n++)t>>>n&1&&e++;return e},e._lctf.readClassDef=function(t,n){var r=e._bin,i=[],o=r.readUshort(t,n);if(n+=2,1==o){var a=r.readUshort(t,n);n+=2;var s=r.readUshort(t,n);n+=2;for(var l=0;l<s;l++)i.push(a+l),i.push(a+l),i.push(r.readUshort(t,n)),n+=2}if(2==o){var c=r.readUshort(t,n);for(n+=2,l=0;l<c;l++)i.push(r.readUshort(t,n)),n+=2,i.push(r.readUshort(t,n)),n+=2,i.push(r.readUshort(t,n)),n+=2}return i},e._lctf.getInterval=function(t,e){for(var n=0;n<t.length;n+=3){var r=t[n],i=t[n+1];if(t[n+2],r<=e&&e<=i)return n}return-1},e._lctf.readCoverage=function(t,n){var r=e._bin,i={};i.fmt=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);return n+=2,1==i.fmt&&(i.tab=r.readUshorts(t,n,o)),2==i.fmt&&(i.tab=r.readUshorts(t,n,3*o)),i},e._lctf.coverageIndex=function(t,n){var r=t.tab;if(1==t.fmt)return r.indexOf(n);if(2==t.fmt){var i=e._lctf.getInterval(r,n);if(-1!=i)return r[i+2]+(n-r[i])}return-1},e._lctf.readFeatureList=function(t,n){var r=e._bin,i=n,o=[],a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=r.readASCII(t,n,4);n+=4;var c=r.readUshort(t,n);n+=2;var u=e._lctf.readFeatureTable(t,i+c);u.tag=l.trim(),o.push(u)}return o},e._lctf.readFeatureTable=function(t,n){var r=e._bin,i=n,o={},a=r.readUshort(t,n);n+=2,a>0&&(o.featureParams=i+a);var s=r.readUshort(t,n);n+=2,o.tab=[];for(var l=0;l<s;l++)o.tab.push(r.readUshort(t,n+2*l));return o},e._lctf.readScriptList=function(t,n){var r=e._bin,i=n,o={},a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=r.readASCII(t,n,4);n+=4;var c=r.readUshort(t,n);n+=2,o[l.trim()]=e._lctf.readScriptTable(t,i+c)}return o},e._lctf.readScriptTable=function(t,n){var r=e._bin,i=n,o={},a=r.readUshort(t,n);n+=2,a>0&&(o.default=e._lctf.readLangSysTable(t,i+a));var s=r.readUshort(t,n);n+=2;for(var l=0;l<s;l++){var c=r.readASCII(t,n,4);n+=4;var u=r.readUshort(t,n);n+=2,o[c.trim()]=e._lctf.readLangSysTable(t,i+u)}return o},e._lctf.readLangSysTable=function(t,n){var r=e._bin,i={};r.readUshort(t,n),n+=2,i.reqFeature=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);return n+=2,i.features=r.readUshorts(t,n,o),i},e.CFF={},e.CFF.parse=function(t,n,r){var i=e._bin;(t=new Uint8Array(t.buffer,n,r))[n=0],t[++n],t[++n],t[++n],n++;var o=[];n=e.CFF.readIndex(t,n,o);for(var a=[],s=0;s<o.length-1;s++)a.push(i.readASCII(t,n+o[s],o[s+1]-o[s]));n+=o[o.length-1];var l=[];n=e.CFF.readIndex(t,n,l);var c=[];for(s=0;s<l.length-1;s++)c.push(e.CFF.readDict(t,n+l[s],n+l[s+1]));n+=l[l.length-1];var u=c[0],h=[];n=e.CFF.readIndex(t,n,h);var f=[];for(s=0;s<h.length-1;s++)f.push(i.readASCII(t,n+h[s],h[s+1]-h[s]));if(n+=h[h.length-1],e.CFF.readSubrs(t,n,u),u.CharStrings){n=u.CharStrings,h=[],n=e.CFF.readIndex(t,n,h);var d=[];for(s=0;s<h.length-1;s++)d.push(i.readBytes(t,n+h[s],h[s+1]-h[s]));u.CharStrings=d}if(u.ROS){n=u.FDArray;var p=[];for(n=e.CFF.readIndex(t,n,p),u.FDArray=[],s=0;s<p.length-1;s++){var v=e.CFF.readDict(t,n+p[s],n+p[s+1]);e.CFF._readFDict(t,v,f),u.FDArray.push(v)}n+=p[p.length-1],n=u.FDSelect,u.FDSelect=[];var g=t[n];if(n++,3!=g)throw g;var m=i.readUshort(t,n);for(n+=2,s=0;s<m+1;s++)u.FDSelect.push(i.readUshort(t,n),t[n+2]),n+=3}return u.Encoding&&(u.Encoding=e.CFF.readEncoding(t,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=e.CFF.readCharset(t,u.charset,u.CharStrings.length)),e.CFF._readFDict(t,u,f),u},e.CFF._readFDict=function(t,n,r){var i;for(var o in n.Private&&(i=n.Private[1],n.Private=e.CFF.readDict(t,i,i+n.Private[0]),n.Private.Subrs&&e.CFF.readSubrs(t,i+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)&&(n[o]=r[n[o]-426+35])},e.CFF.readSubrs=function(t,n,r){var i=e._bin,o=[];n=e.CFF.readIndex(t,n,o);var a,s=o.length;a=s<1240?107:s<33900?1131:32768,r.Bias=a,r.Subrs=[];for(var l=0;l<o.length-1;l++)r.Subrs.push(i.readBytes(t,n+o[l],o[l+1]-o[l]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(t,e){for(var n=0;n<t.charset.length;n++)if(t.charset[n]==e)return n;return-1},e.CFF.glyphBySE=function(t,n){return n<0||n>255?-1:e.CFF.glyphByUnicode(t,e.CFF.tableSE[n])},e.CFF.readEncoding=function(t,n,r){e._bin;var i=[".notdef"],o=t[n];if(n++,0!=o)throw"error: unknown encoding format: "+o;var a=t[n];n++;for(var s=0;s<a;s++)i.push(t[n+s]);return i},e.CFF.readCharset=function(t,n,r){var i=e._bin,o=[".notdef"],a=t[n];if(n++,0==a)for(var s=0;s<r;s++){var l=i.readUshort(t,n);n+=2,o.push(l)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;o.length<r;){l=i.readUshort(t,n),n+=2;var c=0;for(1==a?(c=t[n],n++):(c=i.readUshort(t,n),n+=2),s=0;s<=c;s++)o.push(l),l++}}return o},e.CFF.readIndex=function(t,n,r){var i=e._bin,o=i.readUshort(t,n)+1,a=t[n+=2];if(n++,1==a)for(var s=0;s<o;s++)r.push(t[n+s]);else if(2==a)for(s=0;s<o;s++)r.push(i.readUshort(t,n+2*s));else if(3==a)for(s=0;s<o;s++)r.push(16777215&i.readUint(t,n+3*s-1));else if(1!=o)throw"unsupported offset size: "+a+", count: "+o;return(n+=o*a)-1},e.CFF.getCharString=function(t,n,r){var i=e._bin,o=t[n],a=t[n+1];t[n+2],t[n+3],t[n+4];var s=1,l=null,c=null;o<=20&&(l=o,s=1),12==o&&(l=100*o+a,s=2),21<=o&&o<=27&&(l=o,s=1),28==o&&(c=i.readShort(t,n+1),s=3),29<=o&&o<=31&&(l=o,s=1),32<=o&&o<=246&&(c=o-139,s=1),247<=o&&o<=250&&(c=256*(o-247)+a+108,s=2),251<=o&&o<=254&&(c=256*-(o-251)-a-108,s=2),255==o&&(c=i.readInt(t,n+1)/65535,s=5),r.val=null!=c?c:"o"+l,r.size=s},e.CFF.readCharString=function(t,n,r){for(var i=n+r,o=e._bin,a=[];n<i;){var s=t[n],l=t[n+1];t[n+2],t[n+3],t[n+4];var c=1,u=null,h=null;s<=20&&(u=s,c=1),12==s&&(u=100*s+l,c=2),19!=s&&20!=s||(u=s,c=2),21<=s&&s<=27&&(u=s,c=1),28==s&&(h=o.readShort(t,n+1),c=3),29<=s&&s<=31&&(u=s,c=1),32<=s&&s<=246&&(h=s-139,c=1),247<=s&&s<=250&&(h=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(h=256*-(s-251)-l-108,c=2),255==s&&(h=o.readInt(t,n+1)/65535,c=5),a.push(null!=h?h:"o"+u),n+=c}return a},e.CFF.readDict=function(t,n,r){for(var i=e._bin,o={},a=[];n<r;){var s=t[n],l=t[n+1];t[n+2],t[n+3],t[n+4];var c=1,u=null,h=null;if(28==s&&(h=i.readShort(t,n+1),c=3),29==s&&(h=i.readInt(t,n+1),c=5),32<=s&&s<=246&&(h=s-139,c=1),247<=s&&s<=250&&(h=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(h=256*-(s-251)-l-108,c=2),255==s)throw h=i.readInt(t,n+1)/65535,c=5,"unknown number";if(30==s){var f=[];for(c=1;;){var d=t[n+c];c++;var p=d>>4,v=15&d;if(15!=p&&f.push(p),15!=v&&f.push(v),15==v)break}for(var g="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<f.length;y++)g+=m[f[y]];h=parseFloat(g)}s<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],c=1,12==s&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=u?(o[u]=1==a.length?a[0]:a,a=[]):a.push(h),n+=c}return o},e.cmap={},e.cmap.parse=function(t,n,r){t=new Uint8Array(t.buffer,n,r),n=0;var i=e._bin,o={};i.readUshort(t,n),n+=2;var a=i.readUshort(t,n);n+=2;var s=[];o.tables=[];for(var l=0;l<a;l++){var c=i.readUshort(t,n);n+=2;var u=i.readUshort(t,n);n+=2;var h=i.readUint(t,n);n+=4;var f="p"+c+"e"+u,d=s.indexOf(h);if(-1==d){var p;d=o.tables.length,s.push(h);var v=i.readUshort(t,h);0==v?p=e.cmap.parse0(t,h):4==v?p=e.cmap.parse4(t,h):6==v?p=e.cmap.parse6(t,h):12==v&&(p=e.cmap.parse12(t,h)),o.tables.push(p)}if(null!=o[f])throw"multiple tables for one platform+encoding";o[f]=d}return o},e.cmap.parse0=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2,i.map=[];for(var a=0;a<o-6;a++)i.map.push(t[n+a]);return i},e.cmap.parse4=function(t,n){var r=e._bin,i=n,o={};o.format=r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2;var s=r.readUshort(t,n);n+=2;var l=s/2;o.searchRange=r.readUshort(t,n),n+=2,o.entrySelector=r.readUshort(t,n),n+=2,o.rangeShift=r.readUshort(t,n),n+=2,o.endCount=r.readUshorts(t,n,l),n+=2*l,n+=2,o.startCount=r.readUshorts(t,n,l),n+=2*l,o.idDelta=[];for(var c=0;c<l;c++)o.idDelta.push(r.readShort(t,n)),n+=2;for(o.idRangeOffset=r.readUshorts(t,n,l),n+=2*l,o.glyphIdArray=[];n<i+a;)o.glyphIdArray.push(r.readUshort(t,n)),n+=2;return o},e.cmap.parse6=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,i.firstCode=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);n+=2,i.glyphIdArray=[];for(var a=0;a<o;a++)i.glyphIdArray.push(r.readUshort(t,n)),n+=2;return i},e.cmap.parse12=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2,n+=2,r.readUint(t,n),n+=4,r.readUint(t,n),n+=4;var o=r.readUint(t,n);n+=4,i.groups=[];for(var a=0;a<o;a++){var s=n+12*a,l=r.readUint(t,s+0),c=r.readUint(t,s+4),u=r.readUint(t,s+8);i.groups.push([l,c,u])}return i},e.glyf={},e.glyf.parse=function(t,e,n,r){for(var i=[],o=0;o<r.maxp.numGlyphs;o++)i.push(null);return i},e.glyf._parseGlyf=function(t,n){var r=e._bin,i=t._data,o=e._tabOffset(i,"glyf",t._offset)+t.loca[n];if(t.loca[n]==t.loca[n+1])return null;var a={};if(a.noc=r.readShort(i,o),o+=2,a.xMin=r.readShort(i,o),o+=2,a.yMin=r.readShort(i,o),o+=2,a.xMax=r.readShort(i,o),o+=2,a.yMax=r.readShort(i,o),o+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var s=0;s<a.noc;s++)a.endPts.push(r.readUshort(i,o)),o+=2;var l=r.readUshort(i,o);if(o+=2,i.length-o<l)return null;a.instructions=r.readBytes(i,o,l),o+=l;var c=a.endPts[a.noc-1]+1;for(a.flags=[],s=0;s<c;s++){var u=i[o];if(o++,a.flags.push(u),8&u){var h=i[o];o++;for(var f=0;f<h;f++)a.flags.push(u),s++}}for(a.xs=[],s=0;s<c;s++){var d=!!(2&a.flags[s]),p=!!(16&a.flags[s]);d?(a.xs.push(p?i[o]:-i[o]),o++):p?a.xs.push(0):(a.xs.push(r.readShort(i,o)),o+=2)}for(a.ys=[],s=0;s<c;s++)d=!!(4&a.flags[s]),p=!!(32&a.flags[s]),d?(a.ys.push(p?i[o]:-i[o]),o++):p?a.ys.push(0):(a.ys.push(r.readShort(i,o)),o+=2);var v=0,g=0;for(s=0;s<c;s++)v+=a.xs[s],g+=a.ys[s],a.xs[s]=v,a.ys[s]=g}else{var m;a.parts=[];do{m=r.readUshort(i,o),o+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(y),y.glyphIndex=r.readUshort(i,o),o+=2,1&m){var x=r.readShort(i,o);o+=2;var b=r.readShort(i,o);o+=2}else x=r.readInt8(i,o),o++,b=r.readInt8(i,o),o++;2&m?(y.m.tx=x,y.m.ty=b):(y.p1=x,y.p2=b),8&m?(y.m.a=y.m.d=r.readF2dot14(i,o),o+=2):64&m?(y.m.a=r.readF2dot14(i,o),o+=2,y.m.d=r.readF2dot14(i,o),o+=2):128&m&&(y.m.a=r.readF2dot14(i,o),o+=2,y.m.b=r.readF2dot14(i,o),o+=2,y.m.c=r.readF2dot14(i,o),o+=2,y.m.d=r.readF2dot14(i,o),o+=2)}while(32&m);if(256&m){var _=r.readUshort(i,o);for(o+=2,a.instr=[],s=0;s<_;s++)a.instr.push(i[o]),o++}}return a},e.GDEF={},e.GDEF.parse=function(t,n,r,i){var o=n;n+=4;var a=e._bin.readUshort(t,n);return{glyphClassDef:0===a?null:e._lctf.readClassDef(t,o+a)}},e.GPOS={},e.GPOS.parse=function(t,n,r,i){return e._lctf.parse(t,n,r,i,e.GPOS.subt)},e.GPOS.subt=function(t,n,r,i){var o=e._bin,a=r,s={};if(s.fmt=o.readUshort(t,r),r+=2,1==n||2==n||3==n||7==n||8==n&&s.fmt<=2){var l=o.readUshort(t,r);r+=2,s.coverage=e._lctf.readCoverage(t,l+a)}if(1==n&&1==s.fmt){var c=o.readUshort(t,r);r+=2,0!=c&&(s.pos=e.GPOS.readValueRecord(t,r,c))}else if(2==n&&s.fmt>=1&&s.fmt<=2){c=o.readUshort(t,r),r+=2;var u=o.readUshort(t,r);r+=2;var h=e._lctf.numOfOnes(c),f=e._lctf.numOfOnes(u);if(1==s.fmt){s.pairsets=[];var d=o.readUshort(t,r);r+=2;for(var p=0;p<d;p++){var v=a+o.readUshort(t,r);r+=2;var g=o.readUshort(t,v);v+=2;for(var m=[],y=0;y<g;y++){var x=o.readUshort(t,v);v+=2,0!=c&&(k=e.GPOS.readValueRecord(t,v,c),v+=2*h),0!=u&&(T=e.GPOS.readValueRecord(t,v,u),v+=2*f),m.push({gid2:x,val1:k,val2:T})}s.pairsets.push(m)}}if(2==s.fmt){var b=o.readUshort(t,r);r+=2;var _=o.readUshort(t,r);r+=2;var w=o.readUshort(t,r);r+=2;var S=o.readUshort(t,r);for(r+=2,s.classDef1=e._lctf.readClassDef(t,a+b),s.classDef2=e._lctf.readClassDef(t,a+_),s.matrix=[],p=0;p<w;p++){var U=[];for(y=0;y<S;y++){var k=null,T=null;0!=c&&(k=e.GPOS.readValueRecord(t,r,c),r+=2*h),0!=u&&(T=e.GPOS.readValueRecord(t,r,u),r+=2*f),U.push({val1:k,val2:T})}s.matrix.push(U)}}}else if(4==n&&1==s.fmt)s.markCoverage=e._lctf.readCoverage(t,o.readUshort(t,r)+a),s.baseCoverage=e._lctf.readCoverage(t,o.readUshort(t,r+2)+a),s.markClassCount=o.readUshort(t,r+4),s.markArray=e.GPOS.readMarkArray(t,o.readUshort(t,r+6)+a),s.baseArray=e.GPOS.readBaseArray(t,o.readUshort(t,r+8)+a,s.markClassCount);else if(6==n&&1==s.fmt)s.mark1Coverage=e._lctf.readCoverage(t,o.readUshort(t,r)+a),s.mark2Coverage=e._lctf.readCoverage(t,o.readUshort(t,r+2)+a),s.markClassCount=o.readUshort(t,r+4),s.mark1Array=e.GPOS.readMarkArray(t,o.readUshort(t,r+6)+a),s.mark2Array=e.GPOS.readBaseArray(t,o.readUshort(t,r+8)+a,s.markClassCount);else if(9==n&&1==s.fmt){var E=o.readUshort(t,r);r+=2;var M=o.readUint(t,r);if(r+=4,9==i.ltype)i.ltype=E;else if(i.ltype!=E)throw"invalid extension substitution";return e.GPOS.subt(t,i.ltype,a+M)}return s},e.GPOS.readValueRecord=function(t,n,r){var i=e._bin,o=[];return o.push(1&r?i.readShort(t,n):0),n+=1&r?2:0,o.push(2&r?i.readShort(t,n):0),n+=2&r?2:0,o.push(4&r?i.readShort(t,n):0),n+=4&r?2:0,o.push(8&r?i.readShort(t,n):0),n+=8&r?2:0,o},e.GPOS.readBaseArray=function(t,n,r){var i=e._bin,o=[],a=n,s=i.readUshort(t,n);n+=2;for(var l=0;l<s;l++){for(var c=[],u=0;u<r;u++)c.push(e.GPOS.readAnchorRecord(t,a+i.readUshort(t,n))),n+=2;o.push(c)}return o},e.GPOS.readMarkArray=function(t,n){var r=e._bin,i=[],o=n,a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=e.GPOS.readAnchorRecord(t,r.readUshort(t,n+2)+o);l.markClass=r.readUshort(t,n),i.push(l),n+=4}return i},e.GPOS.readAnchorRecord=function(t,n){var r=e._bin,i={};return i.fmt=r.readUshort(t,n),i.x=r.readShort(t,n+2),i.y=r.readShort(t,n+4),i},e.GSUB={},e.GSUB.parse=function(t,n,r,i){return e._lctf.parse(t,n,r,i,e.GSUB.subt)},e.GSUB.subt=function(t,n,r,i){var o=e._bin,a=r,s={};if(s.fmt=o.readUshort(t,r),r+=2,1!=n&&2!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||2==n||4==n||5==n&&s.fmt<=2||6==n&&s.fmt<=2){var l=o.readUshort(t,r);r+=2,s.coverage=e._lctf.readCoverage(t,a+l)}if(1==n&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=o.readShort(t,r),r+=2;else if(2==s.fmt){var c=o.readUshort(t,r);r+=2,s.newg=o.readUshorts(t,r,c),r+=2*s.newg.length}}else if(2==n&&1==s.fmt){c=o.readUshort(t,r),r+=2,s.seqs=[];for(var u=0;u<c;u++){var h=o.readUshort(t,r)+a;r+=2;var f=o.readUshort(t,h);s.seqs.push(o.readUshorts(t,h+2,f))}}else if(4==n)for(s.vals=[],c=o.readUshort(t,r),r+=2,u=0;u<c;u++){var d=o.readUshort(t,r);r+=2,s.vals.push(e.GSUB.readLigatureSet(t,a+d))}else if(5==n&&2==s.fmt){if(2==s.fmt){var p=o.readUshort(t,r);r+=2,s.cDef=e._lctf.readClassDef(t,a+p),s.scset=[];var v=o.readUshort(t,r);for(r+=2,u=0;u<v;u++){var g=o.readUshort(t,r);r+=2,s.scset.push(0==g?null:e.GSUB.readSubClassSet(t,a+g))}}}else if(6==n&&3==s.fmt){if(3==s.fmt){for(u=0;u<3;u++){c=o.readUshort(t,r),r+=2;for(var m=[],y=0;y<c;y++)m.push(e._lctf.readCoverage(t,a+o.readUshort(t,r+2*y)));r+=2*c,0==u&&(s.backCvg=m),1==u&&(s.inptCvg=m),2==u&&(s.ahedCvg=m)}c=o.readUshort(t,r),r+=2,s.lookupRec=e.GSUB.readSubstLookupRecords(t,r,c)}}else if(7==n&&1==s.fmt){var x=o.readUshort(t,r);r+=2;var b=o.readUint(t,r);if(r+=4,9==i.ltype)i.ltype=x;else if(i.ltype!=x)throw"invalid extension substitution";return e.GSUB.subt(t,i.ltype,a+b)}return s},e.GSUB.readSubClassSet=function(t,n){var r=e._bin.readUshort,i=n,o=[],a=r(t,n);n+=2;for(var s=0;s<a;s++){var l=r(t,n);n+=2,o.push(e.GSUB.readSubClassRule(t,i+l))}return o},e.GSUB.readSubClassRule=function(t,n){var r=e._bin.readUshort,i={},o=r(t,n),a=r(t,n+=2);n+=2,i.input=[];for(var s=0;s<o-1;s++)i.input.push(r(t,n)),n+=2;return i.substLookupRecords=e.GSUB.readSubstLookupRecords(t,n,a),i},e.GSUB.readSubstLookupRecords=function(t,n,r){for(var i=e._bin.readUshort,o=[],a=0;a<r;a++)o.push(i(t,n),i(t,n+2)),n+=4;return o},e.GSUB.readChainSubClassSet=function(t,n){var r=e._bin,i=n,o=[],a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=r.readUshort(t,n);n+=2,o.push(e.GSUB.readChainSubClassRule(t,i+l))}return o},e.GSUB.readChainSubClassRule=function(t,n){for(var r=e._bin,i={},o=["backtrack","input","lookahead"],a=0;a<o.length;a++){var s=r.readUshort(t,n);n+=2,1==a&&s--,i[o[a]]=r.readUshorts(t,n,s),n+=2*i[o[a]].length}return s=r.readUshort(t,n),n+=2,i.subst=r.readUshorts(t,n,2*s),n+=2*i.subst.length,i},e.GSUB.readLigatureSet=function(t,n){var r=e._bin,i=n,o=[],a=r.readUshort(t,n);n+=2;for(var s=0;s<a;s++){var l=r.readUshort(t,n);n+=2,o.push(e.GSUB.readLigature(t,i+l))}return o},e.GSUB.readLigature=function(t,n){var r=e._bin,i={chain:[]};i.nglyph=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);n+=2;for(var a=0;a<o-1;a++)i.chain.push(r.readUshort(t,n)),n+=2;return i},e.head={},e.head.parse=function(t,n,r){var i=e._bin,o={};return i.readFixed(t,n),n+=4,o.fontRevision=i.readFixed(t,n),n+=4,i.readUint(t,n),n+=4,i.readUint(t,n),n+=4,o.flags=i.readUshort(t,n),n+=2,o.unitsPerEm=i.readUshort(t,n),n+=2,o.created=i.readUint64(t,n),n+=8,o.modified=i.readUint64(t,n),n+=8,o.xMin=i.readShort(t,n),n+=2,o.yMin=i.readShort(t,n),n+=2,o.xMax=i.readShort(t,n),n+=2,o.yMax=i.readShort(t,n),n+=2,o.macStyle=i.readUshort(t,n),n+=2,o.lowestRecPPEM=i.readUshort(t,n),n+=2,o.fontDirectionHint=i.readShort(t,n),n+=2,o.indexToLocFormat=i.readShort(t,n),n+=2,o.glyphDataFormat=i.readShort(t,n),n+=2,o},e.hhea={},e.hhea.parse=function(t,n,r){var i=e._bin,o={};return i.readFixed(t,n),n+=4,o.ascender=i.readShort(t,n),n+=2,o.descender=i.readShort(t,n),n+=2,o.lineGap=i.readShort(t,n),n+=2,o.advanceWidthMax=i.readUshort(t,n),n+=2,o.minLeftSideBearing=i.readShort(t,n),n+=2,o.minRightSideBearing=i.readShort(t,n),n+=2,o.xMaxExtent=i.readShort(t,n),n+=2,o.caretSlopeRise=i.readShort(t,n),n+=2,o.caretSlopeRun=i.readShort(t,n),n+=2,o.caretOffset=i.readShort(t,n),n+=2,n+=8,o.metricDataFormat=i.readShort(t,n),n+=2,o.numberOfHMetrics=i.readUshort(t,n),n+=2,o},e.hmtx={},e.hmtx.parse=function(t,n,r,i){for(var o=e._bin,a={aWidth:[],lsBearing:[]},s=0,l=0,c=0;c<i.maxp.numGlyphs;c++)c<i.hhea.numberOfHMetrics&&(s=o.readUshort(t,n),n+=2,l=o.readShort(t,n),n+=2),a.aWidth.push(s),a.lsBearing.push(l);return a},e.kern={},e.kern.parse=function(t,n,r,i){var o=e._bin,a=o.readUshort(t,n);if(n+=2,1==a)return e.kern.parseV1(t,n-2,r,i);var s=o.readUshort(t,n);n+=2;for(var l={glyph1:[],rval:[]},c=0;c<s;c++){n+=2,r=o.readUshort(t,n),n+=2;var u=o.readUshort(t,n);n+=2;var h=u>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;n=e.kern.readFormat0(t,n,l)}return l},e.kern.parseV1=function(t,n,r,i){var o=e._bin;o.readFixed(t,n),n+=4;var a=o.readUint(t,n);n+=4;for(var s={glyph1:[],rval:[]},l=0;l<a;l++){o.readUint(t,n),n+=4;var c=o.readUshort(t,n);n+=2,o.readUshort(t,n),n+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;n=e.kern.readFormat0(t,n,s)}return s},e.kern.readFormat0=function(t,n,r){var i=e._bin,o=-1,a=i.readUshort(t,n);n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2;for(var s=0;s<a;s++){var l=i.readUshort(t,n);n+=2;var c=i.readUshort(t,n);n+=2;var u=i.readShort(t,n);n+=2,l!=o&&(r.glyph1.push(l),r.rval.push({glyph2:[],vals:[]}));var h=r.rval[r.rval.length-1];h.glyph2.push(c),h.vals.push(u),o=l}return n},e.loca={},e.loca.parse=function(t,n,r,i){var o=e._bin,a=[],s=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(0==s)for(var c=0;c<l;c++)a.push(o.readUshort(t,n+(c<<1))<<1);if(1==s)for(c=0;c<l;c++)a.push(o.readUint(t,n+(c<<2)));return a},e.maxp={},e.maxp.parse=function(t,n,r){var i=e._bin,o={},a=i.readUint(t,n);return n+=4,o.numGlyphs=i.readUshort(t,n),n+=2,65536==a&&(o.maxPoints=i.readUshort(t,n),n+=2,o.maxContours=i.readUshort(t,n),n+=2,o.maxCompositePoints=i.readUshort(t,n),n+=2,o.maxCompositeContours=i.readUshort(t,n),n+=2,o.maxZones=i.readUshort(t,n),n+=2,o.maxTwilightPoints=i.readUshort(t,n),n+=2,o.maxStorage=i.readUshort(t,n),n+=2,o.maxFunctionDefs=i.readUshort(t,n),n+=2,o.maxInstructionDefs=i.readUshort(t,n),n+=2,o.maxStackElements=i.readUshort(t,n),n+=2,o.maxSizeOfInstructions=i.readUshort(t,n),n+=2,o.maxComponentElements=i.readUshort(t,n),n+=2,o.maxComponentDepth=i.readUshort(t,n),n+=2),o},e.name={},e.name.parse=function(t,n,r){var i=e._bin,o={};i.readUshort(t,n),n+=2;var a=i.readUshort(t,n);n+=2,i.readUshort(t,n);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=n+=2,u=0;u<a;u++){var h=i.readUshort(t,n);n+=2;var f=i.readUshort(t,n);n+=2;var d=i.readUshort(t,n);n+=2;var p=i.readUshort(t,n);n+=2;var v=i.readUshort(t,n);n+=2;var g=i.readUshort(t,n);n+=2;var m,y=l[p],x=c+12*a+g;if(0==h)m=i.readUnicode(t,x,v/2);else if(3==h&&0==f)m=i.readUnicode(t,x,v/2);else if(0==f)m=i.readASCII(t,x,v);else if(1==f)m=i.readUnicode(t,x,v/2);else if(3==f)m=i.readUnicode(t,x,v/2);else{if(1!=h)throw"unknown encoding "+f+", platformID: "+h;m=i.readASCII(t,x,v)}var b="p"+h+","+d.toString(16);null==o[b]&&(o[b]={}),o[b][void 0!==y?y:p]=m,o[b]._lang=d}for(var _ in o)if(null!=o[_].postScriptName&&1033==o[_]._lang)return o[_];for(var _ in o)if(null!=o[_].postScriptName&&0==o[_]._lang)return o[_];for(var _ in o)if(null!=o[_].postScriptName&&3084==o[_]._lang)return o[_];for(var _ in o)if(null!=o[_].postScriptName)return o[_];for(var _ in o){s=_;break}return o[s]},e["OS/2"]={},e["OS/2"].parse=function(t,n,r){var i=e._bin.readUshort(t,n);n+=2;var o={};if(0==i)e["OS/2"].version0(t,n,o);else if(1==i)e["OS/2"].version1(t,n,o);else if(2==i||3==i||4==i)e["OS/2"].version2(t,n,o);else{if(5!=i)throw"unknown OS/2 table version: "+i;e["OS/2"].version5(t,n,o)}return o},e["OS/2"].version0=function(t,n,r){var i=e._bin;return r.xAvgCharWidth=i.readShort(t,n),n+=2,r.usWeightClass=i.readUshort(t,n),n+=2,r.usWidthClass=i.readUshort(t,n),n+=2,r.fsType=i.readUshort(t,n),n+=2,r.ySubscriptXSize=i.readShort(t,n),n+=2,r.ySubscriptYSize=i.readShort(t,n),n+=2,r.ySubscriptXOffset=i.readShort(t,n),n+=2,r.ySubscriptYOffset=i.readShort(t,n),n+=2,r.ySuperscriptXSize=i.readShort(t,n),n+=2,r.ySuperscriptYSize=i.readShort(t,n),n+=2,r.ySuperscriptXOffset=i.readShort(t,n),n+=2,r.ySuperscriptYOffset=i.readShort(t,n),n+=2,r.yStrikeoutSize=i.readShort(t,n),n+=2,r.yStrikeoutPosition=i.readShort(t,n),n+=2,r.sFamilyClass=i.readShort(t,n),n+=2,r.panose=i.readBytes(t,n,10),n+=10,r.ulUnicodeRange1=i.readUint(t,n),n+=4,r.ulUnicodeRange2=i.readUint(t,n),n+=4,r.ulUnicodeRange3=i.readUint(t,n),n+=4,r.ulUnicodeRange4=i.readUint(t,n),n+=4,r.achVendID=[i.readInt8(t,n),i.readInt8(t,n+1),i.readInt8(t,n+2),i.readInt8(t,n+3)],n+=4,r.fsSelection=i.readUshort(t,n),n+=2,r.usFirstCharIndex=i.readUshort(t,n),n+=2,r.usLastCharIndex=i.readUshort(t,n),n+=2,r.sTypoAscender=i.readShort(t,n),n+=2,r.sTypoDescender=i.readShort(t,n),n+=2,r.sTypoLineGap=i.readShort(t,n),n+=2,r.usWinAscent=i.readUshort(t,n),n+=2,r.usWinDescent=i.readUshort(t,n),n+2},e["OS/2"].version1=function(t,n,r){var i=e._bin;return n=e["OS/2"].version0(t,n,r),r.ulCodePageRange1=i.readUint(t,n),n+=4,r.ulCodePageRange2=i.readUint(t,n),n+4},e["OS/2"].version2=function(t,n,r){var i=e._bin;return n=e["OS/2"].version1(t,n,r),r.sxHeight=i.readShort(t,n),n+=2,r.sCapHeight=i.readShort(t,n),n+=2,r.usDefault=i.readUshort(t,n),n+=2,r.usBreak=i.readUshort(t,n),n+=2,r.usMaxContext=i.readUshort(t,n),n+2},e["OS/2"].version5=function(t,n,r){var i=e._bin;return n=e["OS/2"].version2(t,n,r),r.usLowerOpticalPointSize=i.readUshort(t,n),n+=2,r.usUpperOpticalPointSize=i.readUshort(t,n),n+2},e.post={},e.post.parse=function(t,n,r){var i=e._bin,o={};return o.version=i.readFixed(t,n),n+=4,o.italicAngle=i.readFixed(t,n),n+=4,o.underlinePosition=i.readShort(t,n),n+=2,o.underlineThickness=i.readShort(t,n),n+=2,o},null==e&&(e={}),null==e.U&&(e.U={}),e.U.codeToGlyph=function(t,e){var n=t.cmap,r=-1;if(null!=n.p0e4?r=n.p0e4:null!=n.p3e1?r=n.p3e1:null!=n.p1e0?r=n.p1e0:null!=n.p0e3&&(r=n.p0e3),-1==r)throw"no familiar platform and encoding!";var i=n.tables[r];if(0==i.format)return e>=i.map.length?0:i.map[e];if(4==i.format){for(var o=-1,a=0;a<i.endCount.length;a++)if(e<=i.endCount[a]){o=a;break}return-1==o||i.startCount[o]>e?0:65535&(0!=i.idRangeOffset[o]?i.glyphIdArray[e-i.startCount[o]+(i.idRangeOffset[o]>>1)-(i.idRangeOffset.length-o)]:e+i.idDelta[o])}if(12==i.format){if(e>i.groups[i.groups.length-1][1])return 0;for(a=0;a<i.groups.length;a++){var s=i.groups[a];if(s[0]<=e&&e<=s[1])return s[2]+(e-s[0])}return 0}throw"unknown cmap table format "+i.format},e.U.glyphToPath=function(t,n){var r={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[n]){var i=t.SVG.entries[n];return null==i?r:("string"==typeof i&&(i=e.SVG.toPath(i),t.SVG.entries[n]=i),i)}if(t.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},a=t.CFF,s=t.CFF.Private;if(a.ROS){for(var l=0;a.FDSelect[l+2]<=n;)l+=2;s=a.FDArray[a.FDSelect[l+1]].Private}e.U._drawCFF(t.CFF.CharStrings[n],o,a,s,r)}else t.glyf&&e.U._drawGlyf(n,t,r);return r},e.U._drawGlyf=function(t,n,r){var i=n.glyf[t];null==i&&(i=n.glyf[t]=e.glyf._parseGlyf(n,t)),null!=i&&(i.noc>-1?e.U._simpleGlyph(i,r):e.U._compoGlyph(i,n,r))},e.U._simpleGlyph=function(t,n){for(var r=0;r<t.noc;r++){for(var i=0==r?0:t.endPts[r-1]+1,o=t.endPts[r],a=i;a<=o;a++){var s=a==i?o:a-1,l=a==o?i:a+1,c=1&t.flags[a],u=1&t.flags[s],h=1&t.flags[l],f=t.xs[a],d=t.ys[a];if(a==i)if(c){if(!u){e.U.P.moveTo(n,f,d);continue}e.U.P.moveTo(n,t.xs[s],t.ys[s])}else u?e.U.P.moveTo(n,t.xs[s],t.ys[s]):e.U.P.moveTo(n,(t.xs[s]+f)/2,(t.ys[s]+d)/2);c?u&&e.U.P.lineTo(n,f,d):h?e.U.P.qcurveTo(n,f,d,t.xs[l],t.ys[l]):e.U.P.qcurveTo(n,f,d,(f+t.xs[l])/2,(d+t.ys[l])/2)}e.U.P.closePath(n)}},e.U._compoGlyph=function(t,n,r){for(var i=0;i<t.parts.length;i++){var o={cmds:[],crds:[]},a=t.parts[i];e.U._drawGlyf(a.glyphIndex,n,o);for(var s=a.m,l=0;l<o.crds.length;l+=2){var c=o.crds[l],u=o.crds[l+1];r.crds.push(c*s.a+u*s.b+s.tx),r.crds.push(c*s.c+u*s.d+s.ty)}for(l=0;l<o.cmds.length;l++)r.cmds.push(o.cmds[l])}},e.U._getGlyphClass=function(t,n){var r=e._lctf.getInterval(n,t);return-1==r?0:n[r+2]},e.U._applySubs=function(t,n,r,i){for(var o=t.length-n-1,a=0;a<r.tabs.length;a++)if(null!=r.tabs[a]){var s,l=r.tabs[a];if(!l.coverage||-1!=(s=e._lctf.coverageIndex(l.coverage,t[n])))if(1==r.ltype)t[n],1==l.fmt?t[n]=t[n]+l.delta:t[n]=l.newg[s];else if(4==r.ltype)for(var c=l.vals[s],u=0;u<c.length;u++){var h=c[u],f=h.chain.length;if(!(f>o)){for(var d=!0,p=0,v=0;v<f;v++){for(;-1==t[n+p+(1+v)];)p++;h.chain[v]!=t[n+p+(1+v)]&&(d=!1)}if(d){for(t[n]=h.nglyph,v=0;v<f+p;v++)t[n+v+1]=-1;break}}}else if(5==r.ltype&&2==l.fmt)for(var g=e._lctf.getInterval(l.cDef,t[n]),m=l.cDef[g+2],y=l.scset[m],x=0;x<y.length;x++){var b=y[x],_=b.input;if(!(_.length>o)){for(d=!0,v=0;v<_.length;v++){var w=e._lctf.getInterval(l.cDef,t[n+1+v]);if(-1==g&&l.cDef[w+2]!=_[v]){d=!1;break}}if(d){var S=b.substLookupRecords;for(u=0;u<S.length;u+=2)S[u],S[u+1]}}}else if(6==r.ltype&&3==l.fmt){if(!e.U._glsCovered(t,l.backCvg,n-l.backCvg.length))continue;if(!e.U._glsCovered(t,l.inptCvg,n))continue;if(!e.U._glsCovered(t,l.ahedCvg,n+l.inptCvg.length))continue;var U=l.lookupRec;for(x=0;x<U.length;x+=2){g=U[x];var k=i[U[x+1]];e.U._applySubs(t,n+g,k,i)}}}},e.U._glsCovered=function(t,n,r){for(var i=0;i<n.length;i++)if(-1==e._lctf.coverageIndex(n[i],t[r+i]))return!1;return!0},e.U.glyphsToPath=function(t,n,r){for(var i={cmds:[],crds:[]},o=0,a=0;a<n.length;a++){var s=n[a];if(-1!=s){for(var l=a<n.length-1&&-1!=n[a+1]?n[a+1]:0,c=e.U.glyphToPath(t,s),u=0;u<c.crds.length;u+=2)i.crds.push(c.crds[u]+o),i.crds.push(c.crds[u+1]);for(r&&i.cmds.push(r),u=0;u<c.cmds.length;u++)i.cmds.push(c.cmds[u]);r&&i.cmds.push("X"),o+=t.hmtx.aWidth[s],a<n.length-1&&(o+=e.U.getPairAdjustment(t,s,l))}}return i},e.U.P={},e.U.P.moveTo=function(t,e,n){t.cmds.push("M"),t.crds.push(e,n)},e.U.P.lineTo=function(t,e,n){t.cmds.push("L"),t.crds.push(e,n)},e.U.P.curveTo=function(t,e,n,r,i,o,a){t.cmds.push("C"),t.crds.push(e,n,r,i,o,a)},e.U.P.qcurveTo=function(t,e,n,r,i){t.cmds.push("Q"),t.crds.push(e,n,r,i)},e.U.P.closePath=function(t){t.cmds.push("Z")},e.U._drawCFF=function(t,n,r,i,o){for(var a=n.stack,s=n.nStems,l=n.haveWidth,c=n.width,u=n.open,h=0,f=n.x,d=n.y,p=0,v=0,g=0,m=0,y=0,x=0,b=0,_=0,w=0,S=0,U={val:0,size:0};h<t.length;){e.CFF.getCharString(t,h,U);var k=U.val;if(h+=U.size,"o1"==k||"o18"==k)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0;else if("o3"==k||"o23"==k)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0;else if("o4"==k)a.length>1&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),u&&e.U.P.closePath(o),d+=a.pop(),e.U.P.moveTo(o,f,d),u=!0;else if("o5"==k)for(;a.length>0;)f+=a.shift(),d+=a.shift(),e.U.P.lineTo(o,f,d);else if("o6"==k||"o7"==k)for(var T=a.length,E="o6"==k,M=0;M<T;M++){var A=a.shift();E?f+=A:d+=A,E=!E,e.U.P.lineTo(o,f,d)}else if("o8"==k||"o24"==k){T=a.length;for(var C=0;C+6<=T;)p=f+a.shift(),v=d+a.shift(),g=p+a.shift(),m=v+a.shift(),f=g+a.shift(),d=m+a.shift(),e.U.P.curveTo(o,p,v,g,m,f,d),C+=6;"o24"==k&&(f+=a.shift(),d+=a.shift(),e.U.P.lineTo(o,f,d))}else{if("o11"==k)break;if("o1234"==k||"o1235"==k||"o1236"==k||"o1237"==k)"o1234"==k&&(v=d,g=(p=f+a.shift())+a.shift(),S=m=v+a.shift(),x=m,_=d,f=(b=(y=(w=g+a.shift())+a.shift())+a.shift())+a.shift(),e.U.P.curveTo(o,p,v,g,m,w,S),e.U.P.curveTo(o,y,x,b,_,f,d)),"o1235"==k&&(p=f+a.shift(),v=d+a.shift(),g=p+a.shift(),m=v+a.shift(),w=g+a.shift(),S=m+a.shift(),y=w+a.shift(),x=S+a.shift(),b=y+a.shift(),_=x+a.shift(),f=b+a.shift(),d=_+a.shift(),a.shift(),e.U.P.curveTo(o,p,v,g,m,w,S),e.U.P.curveTo(o,y,x,b,_,f,d)),"o1236"==k&&(p=f+a.shift(),v=d+a.shift(),g=p+a.shift(),S=m=v+a.shift(),x=m,b=(y=(w=g+a.shift())+a.shift())+a.shift(),_=x+a.shift(),f=b+a.shift(),e.U.P.curveTo(o,p,v,g,m,w,S),e.U.P.curveTo(o,y,x,b,_,f,d)),"o1237"==k&&(p=f+a.shift(),v=d+a.shift(),g=p+a.shift(),m=v+a.shift(),w=g+a.shift(),S=m+a.shift(),y=w+a.shift(),x=S+a.shift(),b=y+a.shift(),_=x+a.shift(),Math.abs(b-f)>Math.abs(_-d)?f=b+a.shift():d=_+a.shift(),e.U.P.curveTo(o,p,v,g,m,w,S),e.U.P.curveTo(o,y,x,b,_,f,d));else if("o14"==k){if(a.length>0&&!l&&(c=a.shift()+r.nominalWidthX,l=!0),4==a.length){var D=a.shift(),P=a.shift(),F=a.shift(),O=a.shift(),z=e.CFF.glyphBySE(r,F),I=e.CFF.glyphBySE(r,O);e.U._drawCFF(r.CharStrings[z],n,r,i,o),n.x=D,n.y=P,e.U._drawCFF(r.CharStrings[I],n,r,i,o)}u&&(e.U.P.closePath(o),u=!1)}else if("o19"==k||"o20"==k)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0,h+=s+7>>3;else if("o21"==k)a.length>2&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),d+=a.pop(),f+=a.pop(),u&&e.U.P.closePath(o),e.U.P.moveTo(o,f,d),u=!0;else if("o22"==k)a.length>1&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),f+=a.pop(),u&&e.U.P.closePath(o),e.U.P.moveTo(o,f,d),u=!0;else if("o25"==k){for(;a.length>6;)f+=a.shift(),d+=a.shift(),e.U.P.lineTo(o,f,d);p=f+a.shift(),v=d+a.shift(),g=p+a.shift(),m=v+a.shift(),f=g+a.shift(),d=m+a.shift(),e.U.P.curveTo(o,p,v,g,m,f,d)}else if("o26"==k)for(a.length%2&&(f+=a.shift());a.length>0;)p=f,v=d+a.shift(),f=g=p+a.shift(),d=(m=v+a.shift())+a.shift(),e.U.P.curveTo(o,p,v,g,m,f,d);else if("o27"==k)for(a.length%2&&(d+=a.shift());a.length>0;)v=d,g=(p=f+a.shift())+a.shift(),m=v+a.shift(),f=g+a.shift(),d=m,e.U.P.curveTo(o,p,v,g,m,f,d);else if("o10"==k||"o29"==k){var R="o10"==k?i:r;if(0==a.length);else{var L=a.pop(),B=R.Subrs[L+R.Bias];n.x=f,n.y=d,n.nStems=s,n.haveWidth=l,n.width=c,n.open=u,e.U._drawCFF(B,n,r,i,o),f=n.x,d=n.y,s=n.nStems,l=n.haveWidth,c=n.width,u=n.open}}else if("o30"==k||"o31"==k){var G=a.length,N=(C=0,"o31"==k);for(C+=G-(T=-3&G);C<T;)N?(v=d,g=(p=f+a.shift())+a.shift(),d=(m=v+a.shift())+a.shift(),T-C==5?(f=g+a.shift(),C++):f=g,N=!1):(p=f,v=d+a.shift(),g=p+a.shift(),m=v+a.shift(),f=g+a.shift(),T-C==5?(d=m+a.shift(),C++):d=m,N=!0),e.U.P.curveTo(o,p,v,g,m,f,d),C+=4}else{if("o"==(k+"").charAt(0))throw k;a.push(k)}}}n.x=f,n.y=d,n.nStems=s,n.haveWidth=l,n.width=c,n.open=u};var n=e,r={Typr:n};return t.Typr=n,t.default=r,Object.defineProperty(t,"__esModule",{value:!0}),t}({}).Typr}
/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/,function(){return function(t){var e=Uint8Array,n=Uint16Array,r=Uint32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(t,e){for(var i=new n(31),o=0;o<31;++o)i[o]=e+=1<<t[o-1];var a=new r(i[30]);for(o=1;o<30;++o)for(var s=i[o];s<i[o+1];++s)a[s]=s-i[o]<<5|o;return[i,a]},l=s(i,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=s(o,0)[0],f=new n(32768),d=0;d<32768;++d){var p=(43690&d)>>>1|(21845&d)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,f[d]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(t,e,r){for(var i=t.length,o=0,a=new n(e);o<i;++o)++a[t[o]-1];var s,l=new n(e);for(o=0;o<e;++o)l[o]=l[o-1]+a[o-1]<<1;s=new n(1<<e);var c=15-e;for(o=0;o<i;++o)if(t[o])for(var u=o<<4|t[o],h=e-t[o],d=l[t[o]-1]++<<h,p=d|(1<<h)-1;d<=p;++d)s[f[d]>>>c]=u;return s},g=new e(288);for(d=0;d<144;++d)g[d]=8;for(d=144;d<256;++d)g[d]=9;for(d=256;d<280;++d)g[d]=7;for(d=280;d<288;++d)g[d]=8;var m=new e(32);for(d=0;d<32;++d)m[d]=5;var y=v(g,9),x=v(m,5),b=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},_=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},w=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},S=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(t,e,n){var r=new Error(e||S[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,U),!n)throw r;return r},k=function(t,s,l){var u=t.length;if(!u||l&&!l.l&&u<5)return s||new e(0);var f=!s||l,d=!l||l.i;l||(l={}),s||(s=new e(3*u));var p,g=function(t){var n=s.length;if(t>n){var r=new e(Math.max(2*n,t));r.set(s),s=r}},m=l.f||0,S=l.p||0,k=l.b||0,T=l.l,E=l.d,M=l.m,A=l.n,C=8*u;do{if(!T){l.f=m=_(t,S,1);var D=_(t,S+1,3);if(S+=3,!D){var P=t[(W=((p=S)/8|0)+(7&p&&1)+4)-4]|t[W-3]<<8,F=W+P;if(F>u){d&&U(0);break}f&&g(k+P),s.set(t.subarray(W,F),k),l.b=k+=P,l.p=S=8*F;continue}if(1==D)T=y,E=x,M=9,A=5;else if(2==D){var O=_(t,S,31)+257,z=_(t,S+10,15)+4,I=O+_(t,S+5,31)+1;S+=14;for(var R=new e(I),L=new e(19),B=0;B<z;++B)L[a[B]]=_(t,S+3*B,7);S+=3*z;var G=b(L),N=(1<<G)-1,j=v(L,G);for(B=0;B<I;){var W,V=j[_(t,S,N)];if(S+=15&V,(W=V>>>4)<16)R[B++]=W;else{var H=0,q=0;for(16==W?(q=3+_(t,S,3),S+=2,H=R[B-1]):17==W?(q=3+_(t,S,7),S+=3):18==W&&(q=11+_(t,S,127),S+=7);q--;)R[B++]=H}}var X=R.subarray(0,O),$=R.subarray(O);M=b(X),A=b($),T=v(X,M),E=v($,A)}else U(1);if(S>C){d&&U(0);break}}f&&g(k+131072);for(var Y=(1<<M)-1,K=(1<<A)-1,Z=S;;Z=S){var Q=(H=T[w(t,S)&Y])>>>4;if((S+=15&H)>C){d&&U(0);break}if(H||U(2),Q<256)s[k++]=Q;else{if(256==Q){Z=S,T=null;break}var J=Q-254;if(Q>264){var tt=i[B=Q-257];J=_(t,S,(1<<tt)-1)+c[B],S+=tt}var et=E[w(t,S)&K],nt=et>>>4;if(et||U(3),S+=15&et,$=h[nt],nt>3&&(tt=o[nt],$+=w(t,S)&(1<<tt)-1,S+=tt),S>C){d&&U(0);break}f&&g(k+131072);for(var rt=k+J;k<rt;k+=4)s[k]=s[k-$],s[k+1]=s[k+1-$],s[k+2]=s[k+2-$],s[k+3]=s[k+3-$];k=rt}}l.l=T,l.p=Z,l.b=k,T&&(m=1,l.m=M,l.d=E,l.n=A)}while(!m);return k==s.length?s:function(t,i,o){(null==o||o>t.length)&&(o=t.length);var a=new(t instanceof n?n:t instanceof r?r:e)(o-0);return a.set(t.subarray(0,o)),a}(s,0,k)},T=new e(0),E="undefined"!=typeof TextDecoder&&new TextDecoder;try{E.decode(T,{stream:!0})}catch(t){}return t.convert_streams=function(t){var e=new DataView(t),n=0;function r(){var t=e.getUint16(n);return n+=2,t}function i(){var t=e.getUint32(n);return n+=4,t}function o(t){m.setUint16(y,t),y+=2}function a(t){m.setUint32(y,t),y+=4}for(var s={signature:i(),flavor:i(),length:i(),numTables:r(),reserved:r(),totalSfntSize:i(),majorVersion:r(),minorVersion:r(),metaOffset:i(),metaLength:i(),metaOrigLength:i(),privOffset:i(),privLength:i()},l=0;Math.pow(2,l)<=s.numTables;)l++;l--;for(var c=16*Math.pow(2,l),u=16*s.numTables-c,h=12,f=[],d=0;d<s.numTables;d++)f.push({tag:i(),offset:i(),compLength:i(),origLength:i(),origChecksum:i()}),h+=16;var p,v=new Uint8Array(12+16*f.length+f.reduce(function(t,e){return t+e.origLength+4},0)),g=v.buffer,m=new DataView(g),y=0;return a(s.flavor),o(s.numTables),o(c),o(l),o(u),f.forEach(function(t){a(t.tag),a(t.origChecksum),a(h),a(t.origLength),t.outOffset=h,(h+=t.origLength)%4!=0&&(h+=4-h%4)}),f.forEach(function(e){var n,r=t.slice(e.offset,e.offset+e.compLength);if(e.compLength!=e.origLength){var i=new Uint8Array(e.origLength);n=new Uint8Array(r,2),k(n,i)}else i=new Uint8Array(r);v.set(i,e.outOffset);var o=0;(h=e.outOffset+e.origLength)%4!=0&&(o=4-h%4),v.set(new Uint8Array(o).buffer,e.outOffset+e.origLength),p=h+o}),g.slice(0,p)},Object.defineProperty(t,"__esModule",{value:!0}),t}({}).convert_streams},function(t,e){const n={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let i;function o(t){if(!i){const t={R:2,L:1,D:4,C:16,U:32,T:8};i=new Map;for(let e in r){let n=0;r[e].split(",").forEach(r=>{let[o,a]=r.split("+");o=parseInt(o,36),a=a?parseInt(a,36):0,i.set(n+=o,t[e]);for(let s=a;s--;)i.set(++n,t[e])})}}return i.get(t)||32}const a=[null,"isol","init","fina","medi"];function s(t){const e=new Uint8Array(t.length);let n=32,r=1,i=-1;for(let a=0;a<t.length;a++){const s=t.codePointAt(a);let l=0|o(s),c=1;8&l||(21&n?22&l?(c=3,1!==r&&3!==r||e[i]++):33&l&&(2!==r&&4!==r||e[i]--):34&n&&(2!==r&&4!==r||e[i]--),r=e[a]=c,n=l,i=a,s>65535&&a++)}return e}function l(e,n){const r=e.GDEF&&e.GDEF.glyphClassDef;return r?t.U._getGlyphClass(n,r):0}function c(...t){for(let e=0;e<t.length;e++)if("number"==typeof t[e])return t[e]}function u(e){const r=Object.create(null),i=e["OS/2"],o=e.hhea,u=e.head.unitsPerEm,h=c(i&&i.sTypoAscender,o&&o.ascender,u),f={unitsPerEm:u,ascender:h,descender:c(i&&i.sTypoDescender,o&&o.descender,0),capHeight:c(i&&i.sCapHeight,h),xHeight:c(i&&i.sxHeight,h),lineGap:c(i&&i.sTypoLineGap,o&&o.lineGap),supportsCodePoint:n=>t.U.codeToGlyph(e,n)>0,forEachGlyph(i,o,c,u){let h=0;const d=1/f.unitsPerEm*o,p=function(e,n){const r=[];for(let o=0;o<n.length;o++){const i=n.codePointAt(o);i>65535&&o++,r.push(t.U.codeToGlyph(e,i))}const i=e.GSUB;if(i){const{lookupList:e,featureList:o}=i;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,u=[];o.forEach(i=>{if(c.test(i.tag))for(let o=0;o<i.tab.length;o++){if(u[i.tab[o]])continue;u[i.tab[o]]=!0;const c=e[i.tab[o]],h=/^(isol|init|fina|medi)$/.test(i.tag);h&&!l&&(l=s(n));for(let n=0;n<r.length;n++)l&&h&&a[l[n]]!==i.tag||t.U._applySubs(r,n,c,e)}})}return r}(e,i);let v=0;const g=function(e,n){const r=new Int16Array(3*n.length);let i=0;for(;i<n.length;i++){const c=n[i];if(-1===c)continue;r[3*i+2]=e.hmtx.aWidth[c];const u=e.GPOS;if(u){const h=u.lookupList;for(let u=0;u<h.length;u++){const f=h[u];for(let u=0;u<f.tabs.length;u++){const h=f.tabs[u];if(1===f.ltype){if(-1!==t._lctf.coverageIndex(h.coverage,c)&&h.pos){s(h.pos,i);break}}else if(2===f.ltype){let e=null,r=o();if(-1!==r){const o=t._lctf.coverageIndex(h.coverage,n[r]);if(-1!==o){if(1===h.fmt){const t=h.pairsets[o];for(let n=0;n<t.length;n++)t[n].gid2===c&&(e=t[n])}else if(2===h.fmt){const i=t.U._getGlyphClass(n[r],h.classDef1),o=t.U._getGlyphClass(c,h.classDef2);e=h.matrix[i][o]}if(e){e.val1&&s(e.val1,r),e.val2&&s(e.val2,i);break}}}}else if(4===f.ltype){const e=t._lctf.coverageIndex(h.markCoverage,c);if(-1!==e){const s=o(a),l=-1===s?-1:t._lctf.coverageIndex(h.baseCoverage,n[s]);if(-1!==l){const t=h.markArray[e],n=h.baseArray[l][t.markClass];r[3*i]=n.x-t.x+r[3*s]-r[3*s+2],r[3*i+1]=n.y-t.y+r[3*s+1];break}}}else if(6===f.ltype){const a=t._lctf.coverageIndex(h.mark1Coverage,c);if(-1!==a){const s=o();if(-1!==s){const o=n[s];if(3===l(e,o)){const e=t._lctf.coverageIndex(h.mark2Coverage,o);if(-1!==e){const t=h.mark1Array[a],n=h.mark2Array[e][t.markClass];r[3*i]=n.x-t.x+r[3*s]-r[3*s+2],r[3*i+1]=n.y-t.y+r[3*s+1];break}}}}}}}}else if(e.kern&&!e.cff){const t=o();if(-1!==t){const i=e.kern.glyph1.indexOf(n[t]);if(-1!==i){const n=e.kern.rval[i].glyph2.indexOf(c);-1!==n&&(r[3*t+2]+=e.kern.rval[i].vals[n])}}}}return r;function o(t){for(let e=i-1;e>=0;e--)if(-1!==n[e]&&(!t||t(n[e])))return e;return-1}function a(t){return 1===l(e,t)}function s(t,e){for(let n=0;n<3;n++)r[3*e+n]+=t[n]||0}}(e,p);return p.forEach((a,s)=>{if(-1!==a){let i=r[a];if(!i){const{cmds:o,crds:s}=t.U.glyphToPath(e,a);let l,c,u,h,f="",d=0;for(let t=0,e=o.length;t<e;t++){const e=n[o[t]];f+=o[t];for(let t=1;t<=e;t++)f+=(t>1?",":"")+s[d++]}if(s.length){l=c=1/0,u=h=-1/0;for(let t=0,e=s.length;t<e;t+=2){let e=s[t],n=s[t+1];e<l&&(l=e),n<c&&(c=n),e>u&&(u=e),n>h&&(h=n)}}else l=u=c=h=0;i=r[a]={index:a,advanceWidth:e.hmtx.aWidth[a],xMin:l,yMin:c,xMax:u,yMax:h,path:f}}u.call(null,i,h+g[3*s]*d,g[3*s+1]*d,v),h+=g[3*s+2]*d,c&&(h+=c*o)}v+=i.codePointAt(v)>65535?2:1}),h}};return f}return function(n){const r=new Uint8Array(n,0,4),i=t._bin.readASCII(r,0,4);if("wOFF"===i)n=e(n);else if("wOF2"===i)throw new Error("woff2 fonts not supported");return u(t.parse(n)[0])}}],init:(t,e,n)=>n(t(),e())});
/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/const Un=an({name:"FontResolver",dependencies:[function(t,e){const n=Object.create(null),r=Object.create(null);function i(e,i){let o=n[e];o?i(o):r[e]?r[e].push(i):(r[e]=[i],function(e,n){const r=t=>{};try{const i=new XMLHttpRequest;i.open("get",e,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)new Error(i.statusText);else if(i.status>0)try{const r=t(i.response);r.src=e,n(r)}catch(r){}},i.onerror=r,i.send()}catch(i){}}(e,t=>{t.src=e,n[e]=t,r[e].forEach(e=>e(t)),delete r[e]}))}return function(t,r,{lang:o,fonts:a=[],style:s="normal",weight:l="normal",unicodeFontsURL:c}={}){const u=new Uint8Array(t.length),h=[];t.length||v();const f=new Map,d=[];if("italic"!==s&&(s="normal"),"number"!=typeof l&&(l="bold"===l?700:400),a&&!Array.isArray(a)&&(a=[a]),(a=a.slice().filter(t=>!t.lang||t.lang.test(o)).reverse()).length){const e=1,r=2;let o=0;!function s(l=0){for(let c=l,p=t.length;c<p;c++){const l=t.codePointAt(c);if(o===e&&h[u[c-1]].supportsCodePoint(l)||c>0&&/\s/.test(t[c]))u[c]=u[c-1],o===r&&(d[d.length-1][1]=c);else for(let t=u[c],p=a.length;t<=p;t++)if(t===p){(o===r?d[d.length-1]:d[d.length]=[c,c])[1]=c,o=r}else{u[c]=t;const{src:r,unicodeRange:d}=a[t];if(!d||g(l,d)){const t=n[r];if(!t)return void i(r,()=>{s(c)});if(t.supportsCodePoint(l)){let n=f.get(t);"number"!=typeof n&&(n=h.length,h.push(t),f.set(t,n)),u[c]=n,o=e;break}}}l>65535&&c+1<p&&(u[c+1]=u[c],c++,o===r&&(d[d.length-1][1]=c))}p()}()}else d.push([0,t.length-1]),p();function p(){if(d.length){const n=d.map(e=>t.substring(e[0],e[1]+1)).join("\n");e.getFontsForString(n,{lang:o||void 0,style:s,weight:l,dataUrl:c}).then(({fontUrls:t,chars:e})=>{const n=h.length;let r=0;d.forEach(t=>{for(let i=0,o=t[1]-t[0];i<=o;i++)u[t[0]+i]=e[r++]+n;r++});let o=0;t.forEach((e,r)=>{i(e,e=>{h[r+n]=e,++o===t.length&&v()})})})}else v()}function v(){r({chars:u,fonts:h})}function g(t,e){for(let n=0;n<e.length;n++){const[r,i=r]=e[n];if(r<=t&&t<=i)return!0}return!1}}},Sn,function(){return function(t){var e=function(){this.buckets=new Map};e.prototype.add=function(t){var e=t>>5;this.buckets.set(e,(this.buckets.get(e)||0)|1<<(31&t))},e.prototype.has=function(t){var e=this.buckets.get(t>>5);return void 0!==e&&!!(e&1<<(31&t))},e.prototype.serialize=function(){var t=[];return this.buckets.forEach(function(e,n){t.push((+n).toString(36)+":"+e.toString(36))}),t.join(",")},e.prototype.deserialize=function(t){var e=this;this.buckets.clear(),t.split(",").forEach(function(t){var n=t.split(":");e.buckets.set(parseInt(n[0],36),parseInt(n[1],36))})};var n=Math.pow(2,8),r=n-1,i=~r;function o(t){var e=function(t){return t&i}(t).toString(16),r=function(t){return(t&i)+n-1}(t).toString(16);return"codepoint-index/plane"+(t>>16)+"/"+e+"-"+r+".json"}function a(t,e){var n=t&r,i=e.codePointAt(n/6|0);return!!((i=(i||48)-48)&1<<n%6)}function s(t,e){!function(t,e){var n;(n=t,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(t){return t.split("-").map(function(t){return parseInt(t.trim(),16)})})).forEach(function(t){var n=t[0],r=t[1];void 0===r&&(r=n),e(n,r)})}(t,function(t,n){for(var r=t;r<=n;r++)e(r)})}var l={},c={},u=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function f(t){var n=u.get(t);return n||(n=new e,s(t.ranges,function(t){return n.add(t)}),u.set(t,n)),n}var d,p=new Map;function v(t,e,n){return t[e]?e:t[n]?n:function(t){for(var e in t)return e}(t)}function g(t,e){var n=e;if(!t.includes(n)){n=1/0;for(var r=0;r<t.length;r++)Math.abs(t[r]-e)<Math.abs(n-e)&&(n=t[r])}return n}function m(t){return d||(d=new Set,s("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(t){d.add(t)})),d.has(t)}return t.CodePointSet=e,t.clearCache=function(){l={},c={}},t.getFontsForString=function(t,e){void 0===e&&(e={});var n,r=e.lang;void 0===r&&(r=/\p{Script=Hangul}/u.test(n=t)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(n)?"ja":"en");var i=e.category;void 0===i&&(i="sans-serif");var s=e.style;void 0===s&&(s="normal");var u=e.weight;void 0===u&&(u=400);var d=(e.dataUrl||h).replace(/\/$/g,""),y=new Map,x=new Uint8Array(t.length),b={},_={},w=new Array(t.length),S=new Map,U=!1;function k(t){var e=p.get(t);return e||(e=fetch(d+"/"+t).then(function(t){if(!t.ok)throw new Error(t.statusText);return t.json().then(function(t){if(!Array.isArray(t)||1!==t[0])throw new Error("Incorrect schema version; need 1, got "+t[0]);return t[1]})}).catch(function(e){if(d!==h)return U||(U=!0),d=h,p.delete(t),k(t);throw e}),p.set(t,e)),e}for(var T=function(e){var n=t.codePointAt(e),r=o(n);w[e]=r,l[r]||S.has(r)||S.set(r,k(r).then(function(t){l[r]=t})),n>65535&&(e++,E=e)},E=0;E<t.length;E++)T(E);return Promise.all(S.values()).then(function(){S.clear();for(var e=function(e){var i=t.codePointAt(e),o=null,s=l[w[e]],u=void 0;for(var h in s){var f=_[h];if(void 0===f&&(f=_[h]=new RegExp(h).test(r||"en")),f){for(var d in u=h,s[h])if(a(i,s[h][d])){o=d;break}break}}if(!o)t:for(var p in s)if(p!==u)for(var v in s[p])if(a(i,s[p][v])){o=v;break t}o||(o="latin"),w[e]=o,c[o]||S.has(o)||S.set(o,k("font-meta/"+o+".json").then(function(t){c[o]=t})),i>65535&&(e++,n=e)},n=0;n<t.length;n++)e(n);return Promise.all(S.values())}).then(function(){for(var e,n=null,r=0;r<t.length;r++){var o=t.codePointAt(r);if(n&&(m(o)||f(n).has(o)))x[r]=x[r-1];else{n=c[w[r]];var a=b[n.id];if(!a){var l=n.typeforms,h=v(l,i,"sans-serif"),p=v(l[h],s,"normal"),_=g(null===(e=l[h])||void 0===e?void 0:e[p],u);a=b[n.id]=d+"/font-files/"+n.id+"/"+h+"."+p+"."+_+".woff"}var S=y.get(a);null==S&&(S=y.size,y.set(a,S)),x[r]=S}o>65535&&(r++,x[r]=x[r-1])}return{fontUrls:Array.from(y.keys()),chars:x}})},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}],init:(t,e,n)=>t(e,n())});const kn=()=>(self.performance||Date).now(),Tn=cn();let En;const Mn=[];let An=0;function Cn(){const t=kn();for(;Mn.length&&kn()-t<5;)Mn.shift()();An=Mn.length?setTimeout(Cn,0):0}const Dn=(...t)=>new Promise((e,n)=>{Mn.push(()=>{const r=kn();try{Tn.webgl.generateIntoCanvas(...t),e({timing:kn()-r})}catch(i){n(i)}}),An||(An=setTimeout(Cn,0))}),Pn=4,Fn=2e3,On={};let zn=0;function In(t,e,n,r,i,o,a,s,l,c){const u="TroikaTextSDFGenerator_JS_"+zn++%Pn;let h=On[u];return h||(h=On[u]={workerModule:an({name:u,workerId:u,dependencies:[cn,kn],init(t,e){const n=t().javascript.generate;return function(...t){const r=e();return{textureData:n(...t),timing:e()-r}}},getTransferables:t=>[t.textureData.buffer]}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(t,e,n,r,i,o).then(({textureData:n,timing:r})=>{const i=kn(),o=new Uint8Array(4*n.length);for(let t=0;t<n.length;t++)o[4*t+c]=n[t];return Tn.webglUtils.renderImageData(a,o,s,l,t,e,1<<3-c),r+=kn()-i,0===--h.requests&&(h.idleTimer=setTimeout(()=>{!function(t){rn[t]&&rn[t].forEach(function(t){t()}),nn[t]&&(nn[t].terminate(),delete nn[t])}(u)},Fn)),{timing:r}})}const Rn=Tn.webglUtils.resizeWebGLCanvasWithoutClearing,Ln={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Bn=new D;function Gn(){return(self.performance||Date).now()}const Nn=Object.create(null);function jn(t,e){t=function(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({},t);const n=Gn(),r=[];if(t.font&&r.push({label:"user",src:Hn(t.font)}),t.font=r,t.text=""+t.text,t.sdfGlyphSize=t.sdfGlyphSize||Ln.sdfGlyphSize,t.unicodeFontsURL=t.unicodeFontsURL||Ln.unicodeFontsURL,null!=t.colorRanges){let e={};for(let n in t.colorRanges)if(t.colorRanges.hasOwnProperty(n)){let r=t.colorRanges[n];"number"!=typeof r&&(r=Bn.set(r).getHex()),e[n]=r}t.colorRanges=e}Object.freeze(t);const{textureWidth:i,sdfExponent:o}=Ln,{sdfGlyphSize:a}=t,s=i/a*4;let l=Nn[a];if(!l){const t=document.createElement("canvas");t.width=i,t.height=256*a/s,l=Nn[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:t,sdfTexture:new L(t,void 0,void 0,void 0,B,B),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,function(t){const e=t.sdfCanvas;e.addEventListener("webglcontextlost",e=>{e.preventDefault(),t.contextLost=!0}),e.addEventListener("webglcontextrestored",e=>{t.contextLost=!1;const n=[];t.glyphsByFont.forEach(e=>{e.forEach(e=>{n.push(Wn(e,t,!0))})}),Promise.all(n).then(()=>{qn(t),t.sdfTexture.needsUpdate=!0})})}(l)}const{sdfTexture:c,sdfCanvas:u}=l;$n(t).then(r=>{const{glyphIds:h,glyphFontIndices:f,fontData:d,glyphPositions:p,fontSize:v,timings:g}=r,m=[],y=new Float32Array(4*h.length);let x=0,b=0;const _=Gn(),w=d.map(t=>{let e=l.glyphsByFont.get(t.src);return e||l.glyphsByFont.set(t.src,e=new Map),e});h.forEach((t,e)=>{const n=f[e],{src:i,unitsPerEm:o}=d[n];let s=w[n].get(t);if(!s){const{path:e,pathBounds:o}=r.glyphData[i][t],c=Math.max(o[2]-o[0],o[3]-o[1])/a*(Ln.sdfMargin*a+.5),u=l.glyphCount++,h=[o[0]-c,o[1]-c,o[2]+c,o[3]+c];w[n].set(t,s={path:e,atlasIndex:u,sdfViewBox:h}),m.push(s)}const{sdfViewBox:c}=s,u=p[b++],g=p[b++],_=v/o;y[x++]=u+c[0]*_,y[x++]=g+c[1]*_,y[x++]=u+c[2]*_,y[x++]=g+c[3]*_,h[e]=s.atlasIndex}),g.quads=(g.quads||0)+(Gn()-_);const S=Gn();g.sdf={};const U=u.height,k=Math.ceil(l.glyphCount/s),T=Math.pow(2,Math.ceil(Math.log2(k*a)));T>U&&(Rn(u,i,T),c.dispose()),Promise.all(m.map(e=>Wn(e,l,t.gpuAccelerateSDF).then(({timing:t})=>{g.sdf[e.atlasIndex]=t}))).then(()=>{m.length&&!l.contextLost&&(qn(l),c.needsUpdate=!0),g.sdfTotal=Gn()-S,g.total=Gn()-n,e(Object.freeze({parameters:t,sdfTexture:c,sdfGlyphSize:a,sdfExponent:o,glyphBounds:y,glyphAtlasIndices:h,glyphColors:r.glyphColors,caretPositions:r.caretPositions,chunkedBounds:r.chunkedBounds,ascender:r.ascender,descender:r.descender,lineHeight:r.lineHeight,capHeight:r.capHeight,xHeight:r.xHeight,topBaseline:r.topBaseline,blockBounds:r.blockBounds,visibleBounds:r.visibleBounds,timings:r.timings}))})}),Promise.resolve().then(()=>{var t;l.contextLost||(t=u)._warm||(Tn.webgl.isSupported(t),t._warm=!0)})}function Wn({path:t,atlasIndex:e,sdfViewBox:n},{sdfGlyphSize:r,sdfCanvas:i,contextLost:o},a){if(o)return Promise.resolve({timing:-1});const{textureWidth:s,sdfExponent:l}=Ln,c=Math.max(n[2]-n[0],n[3]-n[1]),u=Math.floor(e/4);return function(t,e,n,r,i,o,a,s,l,c,u=!0){return u?Dn(t,e,n,r,i,o,a,s,l,c).then(null,u=>(En||(En=!0),In(t,e,n,r,i,o,a,s,l,c))):In(t,e,n,r,i,o,a,s,l,c)}(r,r,t,n,c,l,i,u%(s/r)*r,Math.floor(u/(s/r))*r,e%4,a)}let Vn;function Hn(t){return Vn||(Vn="undefined"==typeof document?{}:document.createElement("a")),Vn.href=t,Vn.href}function qn(t){if("function"!=typeof createImageBitmap){const{sdfCanvas:e,sdfTexture:n}=t,{width:r,height:i}=e,o=t.sdfCanvas.getContext("webgl");let a=n.image.data;a&&a.length===r*i*4||(a=new Uint8Array(r*i*4),n.image={width:r,height:i,data:a},n.flipY=!1,n.isDataTexture=!0),o.readPixels(0,0,r,i,o.RGBA,o.UNSIGNED_BYTE,a)}}const Xn=an({name:"Typesetter",dependencies:[function(t,e){const n=1/0,r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,i="[^\\S\\u00A0]",o=new RegExp(`${i}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:a="",font:h,lang:f,sdfGlyphSize:d=64,fontSize:p=400,fontWeight:v=1,fontStyle:g="normal",letterSpacing:m=0,lineHeight:y="normal",maxWidth:x=n,direction:b,textAlign:_="left",textIndent:w=0,whiteSpace:S="normal",overflowWrap:U="normal",anchorX:k=0,anchorY:T=0,metricsOnly:E=!1,unicodeFontsURL:M,preResolvedFonts:A=null,includeCaretPositions:C=!1,chunkedBoundsSize:D=8192,colorRanges:P=null},F){const O=c(),z={fontLoad:0,typesetting:0};a.indexOf("\r")>-1&&(a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,m=+m,x=+x,y=y||"normal",w=+w,function({text:e,lang:n,fonts:r,style:i,weight:o,preResolvedFonts:a,unicodeFontsURL:s},l){const c=({chars:t,fonts:e})=>{let n,r;const i=[];for(let o=0;o<t.length;o++)t[o]!==r?(r=t[o],i.push(n={start:o,end:o,fontObj:e[t[o]]})):n.end=o;l(i)};a?c(a):t(e,c,{lang:n,fonts:r,style:i,weight:o,unicodeFontsURL:s})}({text:a,lang:f,style:g,weight:v,fonts:"string"==typeof h?[{src:h}]:h,unicodeFontsURL:M,preResolvedFonts:A},t=>{z.fontLoad=c()-O;const h=isFinite(x);let f=null,d=null,v=null,g=null,M=null,A=null,I=null,R=null,L=0,B=0,G="nowrap"!==S;const N=new Map,j=c();let W=w,V=0,H=new u;const q=[H];t.forEach(t=>{const{fontObj:e}=t,{ascender:n,descender:s,unitsPerEm:l,lineGap:c,capHeight:f,xHeight:d}=e;let v=N.get(e);if(!v){const t=p/l,r="normal"===y?(n-s+c)*t:y*p,i=(r-(n-s)*t)/2,o=Math.min(r,(n-s)*t),a=(n+s)/2*t+o/2;v={index:N.size,src:e.src,fontObj:e,fontSizeMult:t,unitsPerEm:l,ascender:n*t,descender:s*t,capHeight:f*t,xHeight:d*t,lineHeight:r,baseline:-i-n*t,caretTop:a,caretBottom:a-o},N.set(e,v)}const{fontSizeMult:g}=v,b=a.slice(t.start,t.end+1);let _,S;e.forEachGlyph(b,p,m,(e,n,s,l)=>{n+=V,l+=t.start,_=n,S=e;const c=a.charAt(l),f=e.advanceWidth*g,d=H.count;let y;if("isEmpty"in e||(e.isWhitespace=!!c&&new RegExp(i).test(c),e.canBreakAfter=!!c&&o.test(c),e.isEmpty=e.xMin===e.xMax||e.yMin===e.yMax||r.test(c)),e.isWhitespace||e.isEmpty||B++,G&&h&&!e.isWhitespace&&n+f+W>x&&d){if(H.glyphAt(d-1).glyphObj.canBreakAfter)y=new u,W=-n;else for(let t=d;t--;){if(0===t&&"break-word"===U){y=new u,W=-n;break}if(H.glyphAt(t).glyphObj.canBreakAfter){y=H.splitAt(t+1);const e=y.glyphAt(0).x;W-=e;for(let t=y.count;t--;)y.glyphAt(t).x-=e;break}}y&&(H.isSoftWrapped=!0,H=y,q.push(H),L=x)}let b=H.glyphAt(H.count);b.glyphObj=e,b.x=n+W,b.y=s,b.width=f,b.charIndex=l,b.fontData=v,"\n"===c&&(H=new u,q.push(H),W=-(n+f+m*p)+w)}),V=_+S.advanceWidth*g+m*p});let X=0;q.forEach(t=>{let e=!0;for(let n=t.count;n--;){const r=t.glyphAt(n);e&&!r.glyphObj.isWhitespace&&(t.width=r.x+r.width,t.width>L&&(L=t.width),e=!1);let{lineHeight:i,capHeight:o,xHeight:a,baseline:s}=r.fontData;i>t.lineHeight&&(t.lineHeight=i);const l=s-t.baseline;l<0&&(t.baseline+=l,t.cap+=l,t.ex+=l),t.cap=Math.max(t.cap,t.baseline+o),t.ex=Math.max(t.ex,t.baseline+a)}t.baseline-=X,t.cap-=X,t.ex-=X,X+=t.lineHeight});let $=0,Y=0;if(k&&("number"==typeof k?$=-k:"string"==typeof k&&($=-L*("left"===k?0:"center"===k?.5:"right"===k?1:s(k)))),T&&("number"==typeof T?Y=-T:"string"==typeof T&&(Y="top"===T?0:"top-baseline"===T?-q[0].baseline:"top-cap"===T?-q[0].cap:"top-ex"===T?-q[0].ex:"middle"===T?X/2:"bottom"===T?X:"bottom-baseline"===T?-q[q.length-1].baseline:s(T)*X)),!E){const t=e.getEmbeddingLevels(a,b);f=new Uint16Array(B),d=new Uint8Array(B),v=new Float32Array(2*B),g={},I=[n,n,-1/0,-1/0],R=[],C&&(A=new Float32Array(4*a.length)),P&&(M=new Uint8Array(3*B));let r,i,o=0,s=-1,c=-1;if(q.forEach((u,h)=>{let{count:p,width:m}=u;if(p>0){let h=0;for(let t=p;t--&&u.glyphAt(t).glyphObj.isWhitespace;)h++;let y=0,x=0;if("center"===_)y=(L-m)/2;else if("right"===_)y=L-m;else if("justify"===_&&u.isSoftWrapped){let t=0;for(let e=p-h;e--;)u.glyphAt(e).glyphObj.isWhitespace&&t++;x=(L-m)/t}if(x||y){let t=0;for(let e=0;e<p;e++){let n=u.glyphAt(e);const r=n.glyphObj;n.x+=y+t,0!==x&&r.isWhitespace&&e<p-h&&(t+=x,n.width+=x)}}const b=e.getReorderSegments(a,t,u.glyphAt(0).charIndex,u.glyphAt(u.count-1).charIndex);for(let t=0;t<b.length;t++){const[e,n]=b[t];let r=1/0,i=-1/0;for(let t=0;t<p;t++)if(u.glyphAt(t).charIndex>=e){let e=t,o=t;for(;o<p;o++){let t=u.glyphAt(o);if(t.charIndex>n)break;o<p-h&&(r=Math.min(r,t.x),i=Math.max(i,t.x+t.width))}for(let t=e;t<o;t++){const e=u.glyphAt(t);e.x=i-(e.x+e.width-r)}break}}let w;const S=t=>w=t;for(let m=0;m<p;m++){const h=u.glyphAt(m);w=h.glyphObj;const p=w.index,y=1&t.levels[h.charIndex];if(y){const t=e.getMirroredCharacter(a[h.charIndex]);t&&h.fontData.fontObj.forEachGlyph(t,0,0,S)}if(C){const{charIndex:t,fontData:e}=h,n=h.x+$,r=h.x+h.width+$;A[4*t]=y?r:n,A[4*t+1]=y?n:r,A[4*t+2]=u.baseline+e.caretBottom+Y,A[4*t+3]=u.baseline+e.caretTop+Y;const i=t-s;i>1&&l(A,s,i),s=t}if(P){const{charIndex:t}=h;for(;t>c;)c++,P.hasOwnProperty(c)&&(i=P[c])}if(!w.isWhitespace&&!w.isEmpty){const t=o++,{fontSizeMult:e,src:a,index:s}=h.fontData,l=g[a]||(g[a]={});l[p]||(l[p]={path:w.path,pathBounds:[w.xMin,w.yMin,w.xMax,w.yMax]});const c=h.x+$,m=h.y+u.baseline+Y;v[2*t]=c,v[2*t+1]=m;const y=c+w.xMin*e,x=m+w.yMin*e,b=c+w.xMax*e,_=m+w.yMax*e;y<I[0]&&(I[0]=y),x<I[1]&&(I[1]=x),b>I[2]&&(I[2]=b),_>I[3]&&(I[3]=_),t%D===0&&(r={start:t,end:t,rect:[n,n,-1/0,-1/0]},R.push(r)),r.end++;const S=r.rect;if(y<S[0]&&(S[0]=y),x<S[1]&&(S[1]=x),b>S[2]&&(S[2]=b),_>S[3]&&(S[3]=_),f[t]=p,d[t]=s,P){const e=3*t;M[e]=i>>16&255,M[e+1]=i>>8&255,M[e+2]=255&i}}}}}),A){const t=a.length-s;t>1&&l(A,s,t)}}const K=[];N.forEach(({index:t,src:e,unitsPerEm:n,ascender:r,descender:i,lineHeight:o,capHeight:a,xHeight:s})=>{K[t]={src:e,unitsPerEm:n,ascender:r,descender:i,lineHeight:o,capHeight:a,xHeight:s}}),z.typesetting=c()-j,F({glyphIds:f,glyphFontIndices:d,glyphPositions:v,glyphData:g,fontData:K,caretPositions:A,glyphColors:M,chunkedBounds:R,fontSize:p,topBaseline:Y+q[0].baseline,blockBounds:[$,Y-X,$+L,Y],visibleBounds:I,timings:z})})}function s(t){let e=t.match(/^([\d.]+)%$/),n=e?parseFloat(e[1]):NaN;return isNaN(n)?0:n/100}function l(t,e,n){const r=t[4*e],i=t[4*e+1],o=t[4*e+2],a=t[4*e+3],s=(i-r)/n;for(let l=0;l<n;l++){const n=4*(e+l);t[n]=r+s*l,t[n+1]=r+s*(l+1),t[n+2]=o,t[n+3]=a}}function c(){return(self.performance||Date).now()}function u(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(t){let e=u.flyweight;return e.data=this.data,e.index=t,e},splitAt(t){let e=new u;return e.data=this.data.splice(t*h.length),e}},u.flyweight=h.reduce((t,e,n,r)=>(Object.defineProperty(t,e,{get(){return this.data[this.index*h.length+n]},set(t){this.data[this.index*h.length+n]=t}}),t),{data:null,index:0}),{typeset:a,measure:function(t,e){a({...t,metricsOnly:!0},t=>{const[n,r,i,o]=t.blockBounds;e({width:i-n,height:o-r})})}}},Un,function(){var t=function(t){var e={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(e).forEach(function(t,e){n[t]=1<<e+1,r[n[t]]=t}),Object.freeze(n);var i=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,s=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,l=n.S|n.WS|n.B|i|n.PDI|s,c=null;function u(t){return function(){if(!c){c=new Map;var t=function(t){if(e.hasOwnProperty(t)){var r=0;e[t].split(",").forEach(function(e){var i=e.split("+"),o=i[0],a=i[1];o=parseInt(o,36),a=a?parseInt(a,36):0,c.set(r+=o,n[t]);for(var s=0;s<a;s++)c.set(++r,n[t])})}};for(var r in e)t(r)}}(),c.get(t.codePointAt(0))||n.L}var h,f,d,p="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",v="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function g(t,e){var n,r=0,i=new Map,o=e&&new Map;return t.split(",").forEach(function t(a){if(-1!==a.indexOf("+"))for(var s=+a;s--;)t(n);else{n=a;var l=a.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(r+=parseInt(c,36)),u=String.fromCodePoint(r+=parseInt(u,36)),i.set(c,u),e&&o.set(u,c)}}),{map:i,reverseMap:o}}function m(){if(!h){var t=g(p,!0),e=t.map,n=t.reverseMap;h=e,f=n,d=g(v,!1).map}}function y(t){return m(),h.get(t)||null}function x(t){return m(),f.get(t)||null}function b(t){return m(),d.get(t)||null}var _=n.L,w=n.R,S=n.EN,U=n.ES,k=n.ET,T=n.AN,E=n.CS,M=n.B,A=n.S,C=n.ON,D=n.BN,P=n.NSM,F=n.AL,O=n.LRO,z=n.RLO,I=n.LRE,R=n.RLE,L=n.PDF,B=n.LRI,G=n.RLI,N=n.FSI,j=n.PDI;var W;function V(t){return function(){if(!W){var t=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),e=t.map;t.reverseMap.forEach(function(t,n){e.set(n,t)}),W=e}}(),W.get(t)||null}function H(t,e,n,r){var i=t.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);var o=[];return e.paragraphs.forEach(function(i){var a=Math.max(n,i.start),s=Math.min(r,i.end);if(a<s){for(var c=e.levels.slice(a,s+1),h=s;h>=a&&u(t[h])&l;h--)c[h]=i.level;for(var f=i.level,d=1/0,p=0;p<c.length;p++){var v=c[p];v>f&&(f=v),v<d&&(d=1|v)}for(var g=f;g>=d;g--)for(var m=0;m<c.length;m++)if(c[m]>=g){for(var y=m;m+1<c.length&&c[m+1]>=g;)m++;m>y&&o.push([y+a,m+a])}}}),o}function q(t,e,n,r){for(var i=H(t,e,n,r),o=[],a=0;a<t.length;a++)o[a]=a;return i.forEach(function(t){for(var e=t[0],n=t[1],r=o.slice(e,n+1),i=r.length;i--;)o[n-i]=r[i]}),o}return t.closingToOpeningBracket=x,t.getBidiCharType=u,t.getBidiCharTypeName=function(t){return r[u(t)]},t.getCanonicalBracket=b,t.getEmbeddingLevels=function(t,e){for(var n=new Uint32Array(t.length),r=0;r<t.length;r++)n[r]=u(t[r]);var c=new Map;function h(t,e){var r=n[t];n[t]=e,c.set(r,c.get(r)-1),r&a&&c.set(a,c.get(a)-1),c.set(e,(c.get(e)||0)+1),e&a&&c.set(a,(c.get(a)||0)+1)}for(var f=new Uint8Array(t.length),d=new Map,p=[],v=null,g=0;g<t.length;g++)v||p.push(v={start:g,end:t.length-1,level:"rtl"===e?1:"ltr"===e?0:Ne(g,!1)}),n[g]&M&&(v.end=g,v=null);for(var m=R|I|z|O|i|j|L|M,W=function(t){return t+(1&t?1:2)},V=function(t){return t+(1&t?2:1)},H=0;H<p.length;H++){var q=[{_level:(v=p[H]).level,_override:0,_isolate:0}],X=void 0,$=0,Y=0,K=0;c.clear();for(var Z=v.start;Z<=v.end;Z++){var Q=n[Z];if(X=q[q.length-1],c.set(Q,(c.get(Q)||0)+1),Q&a&&c.set(a,(c.get(a)||0)+1),Q&m)if(Q&(R|I)){f[Z]=X._level;var J=(Q===R?V:W)(X._level);J<=125&&!$&&!Y?q.push({_level:J,_override:0,_isolate:0}):$||Y++}else if(Q&(z|O)){f[Z]=X._level;var tt=(Q===z?V:W)(X._level);tt<=125&&!$&&!Y?q.push({_level:tt,_override:Q&z?w:_,_isolate:0}):$||Y++}else if(Q&i){Q&N&&(Q=1===Ne(Z+1,!0)?G:B),f[Z]=X._level,X._override&&h(Z,X._override);var et=(Q===G?V:W)(X._level);et<=125&&0===$&&0===Y?(K++,q.push({_level:et,_override:0,_isolate:1,_isolInitIndex:Z})):$++}else if(Q&j){if($>0)$--;else if(K>0){for(Y=0;!q[q.length-1]._isolate;)q.pop();var nt=q[q.length-1]._isolInitIndex;null!=nt&&(d.set(nt,Z),d.set(Z,nt)),q.pop(),K--}X=q[q.length-1],f[Z]=X._level,X._override&&h(Z,X._override)}else Q&L?(0===$&&(Y>0?Y--:!X._isolate&&q.length>1&&(q.pop(),X=q[q.length-1])),f[Z]=X._level):Q&M&&(f[Z]=v.level);else f[Z]=X._level,X._override&&Q!==D&&h(Z,X._override)}for(var rt=[],it=null,ot=v.start;ot<=v.end;ot++){var at=n[ot];if(!(at&s)){var st=f[ot],lt=at&i,ct=at===j;it&&st===it._level?(it._end=ot,it._endsWithIsolInit=lt):rt.push(it={_start:ot,_end:ot,_level:st,_startsWithPDI:ct,_endsWithIsolInit:lt})}}for(var ut=[],ht=0;ht<rt.length;ht++){var ft=rt[ht];if(!ft._startsWithPDI||ft._startsWithPDI&&!d.has(ft._start)){for(var dt=[it=ft],pt=void 0;it&&it._endsWithIsolInit&&null!=(pt=d.get(it._end));)for(var vt=ht+1;vt<rt.length;vt++)if(rt[vt]._start===pt){dt.push(it=rt[vt]);break}for(var gt=[],mt=0;mt<dt.length;mt++)for(var yt=dt[mt],xt=yt._start;xt<=yt._end;xt++)gt.push(xt);for(var bt=f[gt[0]],_t=v.level,wt=gt[0]-1;wt>=0;wt--)if(!(n[wt]&s)){_t=f[wt];break}var St=gt[gt.length-1],Ut=f[St],kt=v.level;if(!(n[St]&i))for(var Tt=St+1;Tt<=v.end;Tt++)if(!(n[Tt]&s)){kt=f[Tt];break}ut.push({_seqIndices:gt,_sosType:Math.max(_t,bt)%2?w:_,_eosType:Math.max(kt,Ut)%2?w:_})}}for(var Et=0;Et<ut.length;Et++){var Mt=ut[Et],At=Mt._seqIndices,Ct=Mt._sosType,Dt=Mt._eosType,Pt=1&f[At[0]]?w:_;if(c.get(P))for(var Ft=0;Ft<At.length;Ft++){var Ot=At[Ft];if(n[Ot]&P){for(var zt=Ct,It=Ft-1;It>=0;It--)if(!(n[At[It]]&s)){zt=n[At[It]];break}h(Ot,zt&(i|j)?C:zt)}}if(c.get(S))for(var Rt=0;Rt<At.length;Rt++){var Lt=At[Rt];if(n[Lt]&S)for(var Bt=Rt-1;Bt>=-1;Bt--){var Gt=-1===Bt?Ct:n[At[Bt]];if(Gt&o){Gt===F&&h(Lt,T);break}}}if(c.get(F))for(var Nt=0;Nt<At.length;Nt++){var jt=At[Nt];n[jt]&F&&h(jt,w)}if(c.get(U)||c.get(E))for(var Wt=1;Wt<At.length-1;Wt++){var Vt=At[Wt];if(n[Vt]&(U|E)){for(var Ht=0,qt=0,Xt=Wt-1;Xt>=0&&(Ht=n[At[Xt]])&s;Xt--);for(var $t=Wt+1;$t<At.length&&(qt=n[At[$t]])&s;$t++);Ht===qt&&(n[Vt]===U?Ht===S:Ht&(S|T))&&h(Vt,Ht)}}if(c.get(S))for(var Yt=0;Yt<At.length;Yt++){var Kt=At[Yt];if(n[Kt]&S){for(var Zt=Yt-1;Zt>=0&&n[At[Zt]]&(k|s);Zt--)h(At[Zt],S);for(Yt++;Yt<At.length&&n[At[Yt]]&(k|s|S);Yt++)n[At[Yt]]!==S&&h(At[Yt],S)}}if(c.get(k)||c.get(U)||c.get(E))for(var Qt=0;Qt<At.length;Qt++){var Jt=At[Qt];if(n[Jt]&(k|U|E)){h(Jt,C);for(var te=Qt-1;te>=0&&n[At[te]]&s;te--)h(At[te],C);for(var ee=Qt+1;ee<At.length&&n[At[ee]]&s;ee++)h(At[ee],C)}}if(c.get(S))for(var ne=0,re=Ct;ne<At.length;ne++){var ie=At[ne],oe=n[ie];oe&S?re===_&&h(ie,_):oe&o&&(re=oe)}if(c.get(a)){for(var ae=w|S|T,se=ae|_,le=[],ce=[],ue=0;ue<At.length;ue++)if(n[At[ue]]&a){var he=t[At[ue]],fe=void 0;if(null!==y(he)){if(!(ce.length<63))break;ce.push({char:he,seqIndex:ue})}else if(null!==(fe=x(he)))for(var de=ce.length-1;de>=0;de--){var pe=ce[de].char;if(pe===fe||pe===x(b(he))||y(b(pe))===he){le.push([ce[de].seqIndex,ue]),ce.length=de;break}}}le.sort(function(t,e){return t[0]-e[0]});for(var ve=0;ve<le.length;ve++){for(var ge=le[ve],me=ge[0],ye=ge[1],xe=!1,be=0,_e=me+1;_e<ye;_e++){var we=At[_e];if(n[we]&se){xe=!0;var Se=n[we]&ae?w:_;if(Se===Pt){be=Se;break}}}if(xe&&!be){be=Ct;for(var Ue=me-1;Ue>=0;Ue--){var ke=At[Ue];if(n[ke]&se){var Te=n[ke]&ae?w:_;be=Te!==Pt?Te:Pt;break}}}if(be){if(n[At[me]]=n[At[ye]]=be,be!==Pt)for(var Ee=me+1;Ee<At.length;Ee++)if(!(n[At[Ee]]&s)){u(t[At[Ee]])&P&&(n[At[Ee]]=be);break}if(be!==Pt)for(var Me=ye+1;Me<At.length;Me++)if(!(n[At[Me]]&s)){u(t[At[Me]])&P&&(n[At[Me]]=be);break}}}for(var Ae=0;Ae<At.length;Ae++)if(n[At[Ae]]&a){for(var Ce=Ae,De=Ae,Pe=Ct,Fe=Ae-1;Fe>=0;Fe--){if(!(n[At[Fe]]&s)){Pe=n[At[Fe]]&ae?w:_;break}Ce=Fe}for(var Oe=Dt,ze=Ae+1;ze<At.length;ze++){if(!(n[At[ze]]&(a|s))){Oe=n[At[ze]]&ae?w:_;break}De=ze}for(var Ie=Ce;Ie<=De;Ie++)n[At[Ie]]=Pe===Oe?Pe:Pt;Ae=De}}}for(var Re=v.start;Re<=v.end;Re++){var Le=f[Re],Be=n[Re];if(1&Le?Be&(_|S|T)&&f[Re]++:Be&w?f[Re]++:Be&(T|S)&&(f[Re]+=2),Be&s&&(f[Re]=0===Re?v.level:f[Re-1]),Re===v.end||u(t[Re])&(A|M))for(var Ge=Re;Ge>=0&&u(t[Ge])&l;Ge--)f[Ge]=v.level}}return{levels:f,paragraphs:p};function Ne(e,r){for(var o=e;o<t.length;o++){var a=n[o];if(a&(w|F))return 1;if(a&(M|_)||r&&a===j)return 0;if(a&i){var s=je(o);o=-1===s?t.length:s}}return 0}function je(e){for(var r=1,o=e+1;o<t.length;o++){var a=n[o];if(a&M)break;if(a&j){if(0===--r)return o}else a&i&&r++}return-1}},t.getMirroredCharacter=V,t.getMirroredCharactersMap=function(t,e,n,r){var i=t.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);for(var o=new Map,a=n;a<=r;a++)if(1&e[a]){var s=V(t[a]);null!==s&&o.set(a,s)}return o},t.getReorderSegments=H,t.getReorderedIndices=q,t.getReorderedString=function(t,e,n,r){var i=q(t,e,n,r),o=[].concat(t);return i.forEach(function(n,r){o[r]=(1&e.levels[n]?V(t[n]):null)||t[n]}),o.join("")},t.openingToClosingBracket=y,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return t}],init:(t,e,n)=>t(e,n())}),$n=an({name:"Typesetter",dependencies:[Xn],init:t=>function(e){return new Promise(n=>{t.typeset(e,n)})},getTransferables(t){const e=[];for(let n in t)t[n]&&t[n].buffer&&e.push(t[n].buffer);return e}});$n.onMainThread;const Yn={};const Kn="aTroikaGlyphIndex";class Zn extends g{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new w,this.boundingBox=new _}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,("number"!=typeof t||t<1)&&(t=1);let e=function(t){let e=Yn[t];return e||(e=Yn[t]=new N(1,1,t,t).translate(.5,.5,0)),e}(t);["position","normal","uv"].forEach(t=>{this.attributes[t]=e.attributes[t].clone()}),this.setIndex(e.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,e,n,r,i){this.updateAttributeData("aTroikaGlyphBounds",t,4),this.updateAttributeData(Kn,e,1),this.updateAttributeData("aTroikaGlyphColor",i,3),this._blockBounds=n,this._chunkedBounds=r,this.instanceCount=e.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:e,boundingBox:n}=this;if(e){const{PI:r,floor:i,min:o,max:a,sin:s,cos:l}=Math,c=r/2,u=2*r,h=Math.abs(e),f=t[0]/h,d=t[2]/h,p=i((f+c)/u)!==i((d+c)/u)?-h:o(s(f)*h,s(d)*h),v=i((f-c)/u)!==i((d-c)/u)?h:a(s(f)*h,s(d)*h),g=i((f+r)/u)!==i((d+r)/u)?2*h:a(h-l(f)*h,h-l(d)*h);n.min.set(p,t[1],e<0?-g:0),n.max.set(v,t[3],e<0?0:g)}else n.min.set(t[0],t[1],0),n.max.set(t[2],t[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let e=this.getAttribute(Kn).count,n=this._chunkedBounds;if(n)for(let r=n.length;r--;){e=n[r].end;let i=n[r].rect;if(i[1]<t.w&&i[3]>t.y&&i[0]<t.z&&i[2]>t.x)break}this.instanceCount=e}updateAttributeData(t,e,n){const r=this.getAttribute(t);e?r&&r.array.length===e.length?(r.array.set(e),r.needsUpdate=!0):(this.setAttribute(t,new R(e,n)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(t)}}const Qn=new I({color:16777215,side:u,transparent:!0}),Jn=8421504,tr=new A,er=new h,nr=new h,rr=[],ir=new h,or="+x+y";function ar(t){return Array.isArray(t)?t[0]:t}let sr=()=>{const t=new T(new N(1,1),Qn);return sr=()=>t,t},lr=()=>{const t=new T(new N(1,1,32,1),Qn);return lr=()=>t,t};const cr={type:"syncstart"},ur={type:"synccomplete"},hr=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],fr=hr.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let dr=class extends T{constructor(){super(new Zn,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Jn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=or,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(cr),jn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},e=>{this._isSyncing=!1,this._textRenderInfo=e,this.geometry.updateGlyphs(e.glyphBounds,e.glyphAtlasIndices,e.blockBounds,e.chunkedBounds,e.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(t=>t&&t())})),this.dispatchEvent(ur),t&&t()})))}onBeforeRender(t,e,n,r,i,o){this.sync(),i.isTroikaTextMaterial&&this._prepareForRender(i)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return function(t){const e=yn(t,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new f},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new E(0,0,0,0)},uTroikaClipRect:{value:new E(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new f},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new D},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new G},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:t,fragmentShader:e}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(e)&&(e=e.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(t)||(t=t.replace(un,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:e}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}(t)}get material(){let t=this._derivedMaterial;const e=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Qn.clone());if(t&&t.isDerivedFrom(e)||(t=this._derivedMaterial=this.createDerivedMaterial(e),e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),t.dispose()})),this.hasOutline()){let e=t._outlineMtl;return e||(e=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),e.isTextOutlineMaterial=!0,e.depthWrite=!1,e.map=null,t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),[e,t]}return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return ar(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return ar(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const e=t.isTextOutlineMaterial,n=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:t,blockBounds:i}=r;n.uTroikaSDFTexture.value=t,n.uTroikaSDFTextureSize.value.set(t.image.width,t.image.height),n.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,n.uTroikaSDFExponent.value=r.sdfExponent,n.uTroikaTotalBounds.value.fromArray(i),n.uTroikaUseGlyphColors.value=!e&&!!r.glyphColors;let o,a,s,l=0,c=0,u=0,h=0,f=0;if(e){let{outlineWidth:t,outlineOffsetX:e,outlineOffsetY:n,outlineBlur:r,outlineOpacity:i}=this;l=this._parsePercent(t)||0,c=Math.max(0,this._parsePercent(r)||0),o=i,h=this._parsePercent(e)||0,f=this._parsePercent(n)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(s=this.strokeColor,n.uTroikaStrokeColor.value.set(null==s?Jn:s),a=this.strokeOpacity,null==a&&(a=1)),o=this.fillOpacity;n.uTroikaEdgeOffset.value=l,n.uTroikaPositionOffset.value.set(h,f),n.uTroikaBlurRadius.value=c,n.uTroikaStrokeWidth.value=u,n.uTroikaStrokeOpacity.value=a,n.uTroikaFillOpacity.value=null==o?1:o,n.uTroikaCurveRadius.value=this.curveRadius||0;let d=this.clipRect;if(d&&Array.isArray(d)&&4===d.length)n.uTroikaClipRect.value.fromArray(d);else{const t=100*(this.fontSize||.1);n.uTroikaClipRect.value.set(i[0]-t,i[1]-t,i[2]+t,i[3]+t)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const i=e?this.outlineColor||0:this.color;if(null==i)delete t.color;else{const e=t.hasOwnProperty("color")?t.color:t.color=new D;i===e._input&&"object"!=typeof i||e.set(e._input=i)}let o=this.orientation||or;if(o!==t._orientation){let e=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let r=o!==or&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,t,n,i,o]=r;er.set(0,0,0)[n]="-"===t?1:-1,nr.set(0,0,0)[o]="-"===i?-1:1,tr.lookAt(ir,er.cross(nr),nr),e.setFromMatrix4(tr)}else e.identity();t._orientation=o}}_parsePercent(t){if("string"==typeof t){let e=t.match(/^(-?[\d.]+)%$/),n=e?parseFloat(e[1]):NaN;t=(isNaN(n)?0:n/100)*this.fontSize}return t}localPositionToTextCoords(t,e=new f){e.copy(t);const n=this.curveRadius;return n&&(e.x=Math.atan2(t.x,Math.abs(n)-Math.abs(t.z))*Math.abs(n)),e}worldPositionToTextCoords(t,e=new f){return er.copy(t),this.localPositionToTextCoords(this.worldToLocal(er),e)}raycast(t,e){const{textRenderInfo:n,curveRadius:r}=this;if(n){const i=n.blockBounds,o=r?lr():sr(),a=o.geometry,{position:s,uv:l}=a.attributes;for(let t=0;t<l.count;t++){let e=i[0]+l.getX(t)*(i[2]-i[0]);const n=i[1]+l.getY(t)*(i[3]-i[1]);let o=0;r&&(o=r-Math.cos(e/r)*r,e=Math.sin(e/r)*r),s.setXYZ(t,e,n,o)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,rr.length=0,o.raycast(t,rr);for(let t=0;t<rr.length;t++)rr[t].object=this,e.push(rr[t])}}copy(t){const e=this.geometry;return super.copy(t),this.geometry=e,fr.forEach(e=>{this[e]=t[e]}),this}clone(){return(new this.constructor).copy(this)}};hr.forEach(t=>{const e="_private_"+t;Object.defineProperty(dr.prototype,t,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})}),new _,new D;const pr=n.forwardRef(({sdfGlyphSize:t=64,anchorX:e="center",anchorY:r="middle",font:i,fontSize:o=1,children:a,characters:l,onSync:u,...h},f)=>{const d=s(({invalidate:t})=>t),[p]=n.useState(()=>new dr),[v,g]=n.useMemo(()=>{const t=[];let e="";return n.Children.forEach(a,n=>{"string"==typeof n||"number"==typeof n?e+=n:t.push(n)}),[t,e]},[a]);return nt(()=>new Promise(t=>function({font:t,characters:e,sdfGlyphSize:n},r){jn({font:t,sdfGlyphSize:n,text:Array.isArray(e)?e.join("\n"):""+e},r)}({font:i,characters:l},t)),["troika-text",i,l]),n.useLayoutEffect(()=>{p.sync(()=>{d(),u&&u(p)})}),n.useEffect(()=>()=>p.dispose(),[p]),n.createElement("primitive",c({object:p,ref:f,font:i,text:g,anchorX:e,anchorY:r,fontSize:o,sdfGlyphSize:t},h),v)});function vr(t,e,n,r){var i;return(i=class extends S{constructor(r){super({vertexShader:e,fragmentShader:n,...r});for(const e in t)this.uniforms[e]=new j(t[e]),Object.defineProperty(this,e,{get(){return this.uniforms[e].value},set(t){this.uniforms[e].value=t}});this.uniforms=U.clone(this.uniforms)}}).key=C.generateUUID(),i}const gr=(()=>parseInt(v.replace(/\D+/g,"")))();function mr(t,e,r){const i=s(t=>t.size),o=s(t=>t.viewport),a="number"==typeof t?t:i.width*o.dpr,l=i.height*o.dpr,c=("number"==typeof t?r:t)||{},{samples:u=0,depth:h,...f}=c,d=null!=h?h:c.depthBuffer,p=n.useMemo(()=>{const t=new W(a,l,{minFilter:B,magFilter:B,type:V,...f});return d&&(t.depthTexture=new H(a,l,q)),t.samples=u,t},[]);return n.useLayoutEffect(()=>{p.setSize(a,l),u&&(p.samples=u)},[u,p,a,l]),n.useEffect(()=>()=>p.dispose(),[]),p}const yr=n.forwardRef(({envMap:t,resolution:e=256,frames:r=1/0,children:i,makeDefault:o,...a},u)=>{const h=s(({set:t})=>t),f=s(({camera:t})=>t),d=s(({size:t})=>t),p=n.useRef(null);n.useImperativeHandle(u,()=>p.current,[]);const v=n.useRef(null),g=mr(e);n.useLayoutEffect(()=>{a.manual||p.current.updateProjectionMatrix()},[d,a]),n.useLayoutEffect(()=>{p.current.updateProjectionMatrix()}),n.useLayoutEffect(()=>{if(o){const t=f;return h(()=>({camera:p.current})),()=>h(()=>({camera:t}))}},[p,o,h]);let m=0,y=null;const x="function"==typeof i;return l(e=>{x&&(r===1/0||m<r)&&(v.current.visible=!1,e.gl.setRenderTarget(g),y=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,p.current),e.scene.background=y,e.gl.setRenderTarget(null),v.current.visible=!0,m++)}),n.createElement(n.Fragment,null,n.createElement("orthographicCamera",c({left:d.width/-2,right:d.width/2,top:d.height/2,bottom:d.height/-2,ref:p},a),!x&&i),n.createElement("group",{ref:v},x&&i(g.texture)))}),xr=n.forwardRef(({envMap:t,resolution:e=256,frames:r=1/0,makeDefault:i,children:o,...a},u)=>{const h=s(({set:t})=>t),f=s(({camera:t})=>t),d=s(({size:t})=>t),p=n.useRef(null);n.useImperativeHandle(u,()=>p.current,[]);const v=n.useRef(null),g=mr(e);n.useLayoutEffect(()=>{a.manual||(p.current.aspect=d.width/d.height)},[d,a]),n.useLayoutEffect(()=>{p.current.updateProjectionMatrix()});let m=0,y=null;const x="function"==typeof o;return l(e=>{x&&(r===1/0||m<r)&&(v.current.visible=!1,e.gl.setRenderTarget(g),y=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,p.current),e.scene.background=y,e.gl.setRenderTarget(null),v.current.visible=!0,m++)}),n.useLayoutEffect(()=>{if(i){const t=f;return h(()=>({camera:p.current})),()=>h(()=>({camera:t}))}},[p,i,h]),n.createElement(n.Fragment,null,n.createElement("perspectiveCamera",c({ref:p},a),!x&&o),n.createElement("group",{ref:v},x&&o(g.texture)))}),br=vr({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new D,sectionColor:new D,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new h,worldPlanePosition:new h},"\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform vec3 worldPlanePosition;\n    uniform float fadeDistance;\n    uniform bool infiniteGrid;\n    uniform bool followCamera;\n\n    void main() {\n      localPosition = position.xzy;\n      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n      \n      worldPosition = modelMatrix * vec4(localPosition, 1.0);\n      if (followCamera) {\n        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n        localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n      }\n\n      gl_Position = projectionMatrix * viewMatrix * worldPosition;\n    }\n  ",`\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform float cellSize;\n    uniform float sectionSize;\n    uniform vec3 cellColor;\n    uniform vec3 sectionColor;\n    uniform float fadeDistance;\n    uniform float fadeStrength;\n    uniform float fadeFrom;\n    uniform float cellThickness;\n    uniform float sectionThickness;\n\n    float getGrid(float size, float thickness) {\n      vec2 r = localPosition.xz / size;\n      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);\n      float line = min(grid.x, grid.y) + 1.0 - thickness;\n      return 1.0 - min(line, 1.0);\n    }\n\n    void main() {\n      float g1 = getGrid(cellSize, cellThickness);\n      float g2 = getGrid(sectionSize, sectionThickness);\n\n      vec3 from = worldCamProjPosition*vec3(fadeFrom);\n      float dist = distance(from, worldPosition.xyz);\n      float d = 1.0 - min(dist / fadeDistance, 1.0);\n      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));\n\n      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));\n      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);\n      if (gl_FragColor.a <= 0.0) discard;\n\n      #include <tonemapping_fragment>\n      #include <${gr>=154?"colorspace_fragment":"encodings_fragment"}>\n    }\n  `),_r=n.forwardRef(({args:t,cellColor:e="#000000",sectionColor:r="#2080ff",cellSize:i=.5,sectionSize:o=1,followCamera:a=!1,infiniteGrid:s=!1,fadeDistance:u=100,fadeStrength:f=1,fadeFrom:d=1,cellThickness:p=.5,sectionThickness:v=1,side:g=$,...m},y)=>{X({GridMaterial:br});const x=n.useRef(null);n.useImperativeHandle(y,()=>x.current,[]);const b=new Y,_=new h(0,1,0),w=new h(0,0,0);l(t=>{b.setFromNormalAndCoplanarPoint(_,w).applyMatrix4(x.current.matrixWorld);const e=x.current.material,n=e.uniforms.worldCamProjPosition,r=e.uniforms.worldPlanePosition;b.projectPoint(t.camera.position,n.value),r.value.set(0,0,0).applyMatrix4(x.current.matrixWorld)});const S={cellSize:i,sectionSize:o,cellColor:e,sectionColor:r,cellThickness:p,sectionThickness:v},U={fadeDistance:u,fadeStrength:f,fadeFrom:d,infiniteGrid:s,followCamera:a};return n.createElement("mesh",c({ref:x,frustumCulled:!1},m),n.createElement("gridMaterial",c({transparent:!0,"extensions-derivatives":!0,side:g},S,U)),n.createElement("planeGeometry",{args:t}))});function wr(t,e){const r=t+"Geometry";return n.forwardRef(({args:t,children:i,...o},a)=>{const s=n.useRef(null);return n.useImperativeHandle(a,()=>s.current),n.useLayoutEffect(()=>{null==e||e(s.current)}),n.createElement("mesh",c({ref:s},o),n.createElement(r,{attach:"geometry",args:t}),i)})}const Sr=wr("circle");function Ur(t,e,n){if(isNaN(e))return t;var r,i,o,a,s,l,c=t._root,u={data:n},h=t._x0,f=t._x1;if(!c)return t._root=u,t;for(;c.length;)if((a=e>=(i=(h+f)/2))?h=i:f=i,r=c,!(c=c[s=+a]))return r[s]=u,t;if(e===(o=+t._x.call(null,c.data)))return u.next=c,r?r[s]=u:t._root=u,t;do{r=r?r[s]=new Array(2):t._root=new Array(2),(a=e>=(i=(h+f)/2))?h=i:f=i}while((s=+a)===(l=+(o>=i)));return r[l]=c,r[s]=u,t}function kr(t,e,n){this.node=t,this.x0=e,this.x1=n}function Tr(t){return t[0]}function Er(t,e){var n=new Mr(null==e?Tr:e,NaN,NaN);return null==t?n:n.addAll(t)}function Mr(t,e,n){this._x=t,this._x0=e,this._x1=n,this._root=void 0}function Ar(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Cr=Er.prototype=Mr.prototype;function Dr(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,l,c,u,h,f,d=t._root,p={data:r},v=t._x0,g=t._y0,m=t._x1,y=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((c=e>=(o=(v+m)/2))?v=o:m=o,(u=n>=(a=(g+y)/2))?g=a:y=a,i=d,!(d=d[h=u<<1|c]))return i[h]=p,t;if(s=+t._x.call(null,d.data),l=+t._y.call(null,d.data),e===s&&n===l)return p.next=d,i?i[h]=p:t._root=p,t;do{i=i?i[h]=new Array(4):t._root=new Array(4),(c=e>=(o=(v+m)/2))?v=o:m=o,(u=n>=(a=(g+y)/2))?g=a:y=a}while((h=u<<1|c)==(f=(l>=a)<<1|s>=o));return i[f]=d,i[h]=p,t}function Pr(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function Fr(t){return t[0]}function Or(t){return t[1]}function zr(t,e,n){var r=new Ir(null==e?Fr:e,null==n?Or:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Ir(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function Rr(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}Cr.copy=function(){var t,e,n=new Mr(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=Ar(r),n;for(t=[{source:r,target:n._root=new Array(2)}];r=t.pop();)for(var i=0;i<2;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(2)}):r.target[i]=Ar(e));return n},Cr.add=function(t){const e=+this._x.call(null,t);return Ur(this.cover(e),e,t)},Cr.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e);let r=1/0,i=-1/0;for(let o,a=0;a<e;++a)isNaN(o=+this._x.call(null,t[a]))||(n[a]=o,o<r&&(r=o),o>i&&(i=o));if(r>i)return this;this.cover(r).cover(i);for(let o=0;o<e;++o)Ur(this,n[o],t[o]);return this},Cr.cover=function(t){if(isNaN(t=+t))return this;var e=this._x0,n=this._x1;if(isNaN(e))n=(e=Math.floor(t))+1;else{for(var r,i,o=n-e||1,a=this._root;e>t||t>=n;)switch(i=+(t<e),(r=new Array(2))[i]=a,a=r,o*=2,i){case 0:n=e+o;break;case 1:e=n-o}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._x1=n,this},Cr.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},Cr.extent=function(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},Cr.find=function(t,e){var n,r,i,o,a,s=this._x0,l=this._x1,c=[],u=this._root;for(u&&c.push(new kr(u,s,l)),null==e?e=1/0:(s=t-e,l=t+e);o=c.pop();)if(!(!(u=o.node)||(r=o.x0)>l||(i=o.x1)<s))if(u.length){var h=(r+i)/2;c.push(new kr(u[1],h,i),new kr(u[0],r,h)),(a=+(t>=h))&&(o=c[c.length-1],c[c.length-1]=c[c.length-1-a],c[c.length-1-a]=o)}else{var f=Math.abs(t-+this._x.call(null,u.data));f<e&&(e=f,s=t-f,l=t+f,n=u.data)}return n},Cr.remove=function(t){if(isNaN(o=+this._x.call(null,t)))return this;var e,n,r,i,o,a,s,l,c,u=this._root,h=this._x0,f=this._x1;if(!u)return this;if(u.length)for(;;){if((s=o>=(a=(h+f)/2))?h=a:f=a,e=u,!(u=u[l=+s]))return this;if(!u.length)break;e[l+1&1]&&(n=e,c=l)}for(;u.data!==t;)if(r=u,!(u=u.next))return this;return(i=u.next)&&delete u.next,r?(i?r.next=i:delete r.next,this):e?(i?e[l]=i:delete e[l],(u=e[0]||e[1])&&u===(e[1]||e[0])&&!u.length&&(n?n[c]=u:this._root=u),this):(this._root=i,this)},Cr.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Cr.root=function(){return this._root},Cr.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},Cr.visit=function(t){var e,n,r,i,o=[],a=this._root;for(a&&o.push(new kr(a,this._x0,this._x1));e=o.pop();)if(!t(a=e.node,r=e.x0,i=e.x1)&&a.length){var s=(r+i)/2;(n=a[1])&&o.push(new kr(n,s,i)),(n=a[0])&&o.push(new kr(n,r,s))}return this},Cr.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new kr(this._root,this._x0,this._x1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.x1,l=(a+s)/2;(o=i[0])&&n.push(new kr(o,a,l)),(o=i[1])&&n.push(new kr(o,l,s))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.x1);return this},Cr.x=function(t){return arguments.length?(this._x=t,this):this._x};var Lr=zr.prototype=Ir.prototype;function Br(t,e,n,r,i){if(isNaN(e)||isNaN(n)||isNaN(r))return t;var o,a,s,l,c,u,h,f,d,p,v,g,m=t._root,y={data:i},x=t._x0,b=t._y0,_=t._z0,w=t._x1,S=t._y1,U=t._z1;if(!m)return t._root=y,t;for(;m.length;)if((f=e>=(a=(x+w)/2))?x=a:w=a,(d=n>=(s=(b+S)/2))?b=s:S=s,(p=r>=(l=(_+U)/2))?_=l:U=l,o=m,!(m=m[v=p<<2|d<<1|f]))return o[v]=y,t;if(c=+t._x.call(null,m.data),u=+t._y.call(null,m.data),h=+t._z.call(null,m.data),e===c&&n===u&&r===h)return y.next=m,o?o[v]=y:t._root=y,t;do{o=o?o[v]=new Array(8):t._root=new Array(8),(f=e>=(a=(x+w)/2))?x=a:w=a,(d=n>=(s=(b+S)/2))?b=s:S=s,(p=r>=(l=(_+U)/2))?_=l:U=l}while((v=p<<2|d<<1|f)==(g=(h>=l)<<2|(u>=s)<<1|c>=a));return o[g]=m,o[v]=y,t}function Gr(t,e,n,r,i,o,a){this.node=t,this.x0=e,this.y0=n,this.z0=r,this.x1=i,this.y1=o,this.z1=a}Lr.copy=function(){var t,e,n=new Ir(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Rr(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=Rr(e));return n},Lr.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Dr(this.cover(e,n),e,n,t)},Lr.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),l=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<l&&(l=r),r>u&&(u=r),i<c&&(c=i),i>h&&(h=i));if(l>u||c>h)return this;for(this.cover(l,c).cover(u,h),n=0;n<o;++n)Dr(this,a[n],s[n],t[n]);return this},Lr.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a,s,l=i-n||1,c=this._root;n>t||t>=i||r>e||e>=o;)switch(s=(e<r)<<1|t<n,(a=new Array(4))[s]=c,c=a,l*=2,s){case 0:i=n+l,o=r+l;break;case 1:n=i-l,o=r+l;break;case 2:i=n+l,r=o-l;break;case 3:n=i-l,r=o-l}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},Lr.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},Lr.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Lr.find=function(t,e,n){var r,i,o,a,s,l,c,u=this._x0,h=this._y0,f=this._x1,d=this._y1,p=[],v=this._root;for(v&&p.push(new Pr(v,u,h,f,d)),null==n?n=1/0:(u=t-n,h=e-n,f=t+n,d=e+n,n*=n);l=p.pop();)if(!(!(v=l.node)||(i=l.x0)>f||(o=l.y0)>d||(a=l.x1)<u||(s=l.y1)<h))if(v.length){var g=(i+a)/2,m=(o+s)/2;p.push(new Pr(v[3],g,m,a,s),new Pr(v[2],i,m,g,s),new Pr(v[1],g,o,a,m),new Pr(v[0],i,o,g,m)),(c=(e>=m)<<1|t>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=l)}else{var y=t-+this._x.call(null,v.data),x=e-+this._y.call(null,v.data),b=y*y+x*x;if(b<n){var _=Math.sqrt(n=b);u=t-_,h=e-_,f=t+_,d=e+_,r=v.data}}return r},Lr.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,l,c,u,h,f,d=this._root,p=this._x0,v=this._y0,g=this._x1,m=this._y1;if(!d)return this;if(d.length)for(;;){if((c=o>=(s=(p+g)/2))?p=s:g=s,(u=a>=(l=(v+m)/2))?v=l:m=l,e=d,!(d=d[h=u<<1|c]))return this;if(!d.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,f=h)}for(;d.data!==t;)if(r=d,!(d=d.next))return this;return(i=d.next)&&delete d.next,r?(i?r.next=i:delete r.next,this):e?(i?e[h]=i:delete e[h],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[f]=d:this._root=d),this):(this._root=i,this)},Lr.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Lr.root=function(){return this._root},Lr.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},Lr.visit=function(t){var e,n,r,i,o,a,s=[],l=this._root;for(l&&s.push(new Pr(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&l.length){var c=(r+o)/2,u=(i+a)/2;(n=l[3])&&s.push(new Pr(n,c,u,o,a)),(n=l[2])&&s.push(new Pr(n,r,u,c,a)),(n=l[1])&&s.push(new Pr(n,c,i,o,u)),(n=l[0])&&s.push(new Pr(n,r,i,c,u))}return this},Lr.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Pr(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,l=e.x1,c=e.y1,u=(a+l)/2,h=(s+c)/2;(o=i[0])&&n.push(new Pr(o,a,s,u,h)),(o=i[1])&&n.push(new Pr(o,u,s,l,h)),(o=i[2])&&n.push(new Pr(o,a,h,u,c)),(o=i[3])&&n.push(new Pr(o,u,h,l,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Lr.x=function(t){return arguments.length?(this._x=t,this):this._x},Lr.y=function(t){return arguments.length?(this._y=t,this):this._y};const Nr=(t,e,n,r,i,o)=>Math.sqrt((t-r)**2+(e-i)**2+(n-o)**2);function jr(t){return t[0]}function Wr(t){return t[1]}function Vr(t){return t[2]}function Hr(t,e,n,r){var i=new qr(null==e?jr:e,null==n?Wr:n,null==r?Vr:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function qr(t,e,n,r,i,o,a,s,l){this._x=t,this._y=e,this._z=n,this._x0=r,this._y0=i,this._z0=o,this._x1=a,this._y1=s,this._z1=l,this._root=void 0}function Xr(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var $r=Hr.prototype=qr.prototype;function Yr(t){return function(){return t}}function Kr(t){return 1e-6*(t()-.5)}function Zr(t){return t.x+t.vx}function Qr(t){return t.y+t.vy}function Jr(t){return t.z+t.vz}function ti(t){return t.index}function ei(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}$r.copy=function(){var t,e,n=new qr(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=Xr(r),n;for(t=[{source:r,target:n._root=new Array(8)}];r=t.pop();)for(var i=0;i<8;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(8)}):r.target[i]=Xr(e));return n},$r.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t),r=+this._z.call(null,t);return Br(this.cover(e,n,r),e,n,r,t)},$r.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let o=1/0,a=1/0,s=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h,f,d,p,v=0;v<e;++v)isNaN(f=+this._x.call(null,h=t[v]))||isNaN(d=+this._y.call(null,h))||isNaN(p=+this._z.call(null,h))||(n[v]=f,r[v]=d,i[v]=p,f<o&&(o=f),f>l&&(l=f),d<a&&(a=d),d>c&&(c=d),p<s&&(s=p),p>u&&(u=p));if(o>l||a>c||s>u)return this;this.cover(o,a,s).cover(l,c,u);for(let h=0;h<e;++h)Br(this,n[h],r[h],i[h],t[h]);return this},$r.cover=function(t,e,n){if(isNaN(t=+t)||isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,o=this._z0,a=this._x1,s=this._y1,l=this._z1;if(isNaN(r))a=(r=Math.floor(t))+1,s=(i=Math.floor(e))+1,l=(o=Math.floor(n))+1;else{for(var c,u,h=a-r||1,f=this._root;r>t||t>=a||i>e||e>=s||o>n||n>=l;)switch(u=(n<o)<<2|(e<i)<<1|t<r,(c=new Array(8))[u]=f,f=c,h*=2,u){case 0:a=r+h,s=i+h,l=o+h;break;case 1:r=a-h,s=i+h,l=o+h;break;case 2:a=r+h,i=s-h,l=o+h;break;case 3:r=a-h,i=s-h,l=o+h;break;case 4:a=r+h,s=i+h,o=l-h;break;case 5:r=a-h,s=i+h,o=l-h;break;case 6:a=r+h,i=s-h,o=l-h;break;case 7:r=a-h,i=s-h,o=l-h}this._root&&this._root.length&&(this._root=f)}return this._x0=r,this._y0=i,this._z0=o,this._x1=a,this._y1=s,this._z1=l,this},$r.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},$r.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},$r.find=function(t,e,n,r){var i,o,a,s,l,c,u,h,f,d=this._x0,p=this._y0,v=this._z0,g=this._x1,m=this._y1,y=this._z1,x=[],b=this._root;for(b&&x.push(new Gr(b,d,p,v,g,m,y)),null==r?r=1/0:(d=t-r,p=e-r,v=n-r,g=t+r,m=e+r,y=n+r,r*=r);h=x.pop();)if(!(!(b=h.node)||(o=h.x0)>g||(a=h.y0)>m||(s=h.z0)>y||(l=h.x1)<d||(c=h.y1)<p||(u=h.z1)<v))if(b.length){var _=(o+l)/2,w=(a+c)/2,S=(s+u)/2;x.push(new Gr(b[7],_,w,S,l,c,u),new Gr(b[6],o,w,S,_,c,u),new Gr(b[5],_,a,S,l,w,u),new Gr(b[4],o,a,S,_,w,u),new Gr(b[3],_,w,s,l,c,S),new Gr(b[2],o,w,s,_,c,S),new Gr(b[1],_,a,s,l,w,S),new Gr(b[0],o,a,s,_,w,S)),(f=(n>=S)<<2|(e>=w)<<1|t>=_)&&(h=x[x.length-1],x[x.length-1]=x[x.length-1-f],x[x.length-1-f]=h)}else{var U=t-+this._x.call(null,b.data),k=e-+this._y.call(null,b.data),T=n-+this._z.call(null,b.data),E=U*U+k*k+T*T;if(E<r){var M=Math.sqrt(r=E);d=t-M,p=e-M,v=n-M,g=t+M,m=e+M,y=n+M,i=b.data}}return i},$r.findAllWithinRadius=function(t,e,n,r){const i=[],o=t-r,a=e-r,s=n-r,l=t+r,c=e+r,u=n+r;return this.visit((h,f,d,p,v,g,m)=>{if(!h.length)do{const o=h.data;Nr(t,e,n,this._x(o),this._y(o),this._z(o))<=r&&i.push(o)}while(h=h.next);return f>l||d>c||p>u||v<o||g<a||m<s}),i},$r.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t))||isNaN(s=+this._z.call(null,t)))return this;var e,n,r,i,o,a,s,l,c,u,h,f,d,p,v,g=this._root,m=this._x0,y=this._y0,x=this._z0,b=this._x1,_=this._y1,w=this._z1;if(!g)return this;if(g.length)for(;;){if((h=o>=(l=(m+b)/2))?m=l:b=l,(f=a>=(c=(y+_)/2))?y=c:_=c,(d=s>=(u=(x+w)/2))?x=u:w=u,e=g,!(g=g[p=d<<2|f<<1|h]))return this;if(!g.length)break;(e[p+1&7]||e[p+2&7]||e[p+3&7]||e[p+4&7]||e[p+5&7]||e[p+6&7]||e[p+7&7])&&(n=e,v=p)}for(;g.data!==t;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):e?(i?e[p]=i:delete e[p],(g=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&g===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!g.length&&(n?n[v]=g:this._root=g),this):(this._root=i,this)},$r.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},$r.root=function(){return this._root},$r.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},$r.visit=function(t){var e,n,r,i,o,a,s,l,c=[],u=this._root;for(u&&c.push(new Gr(u,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=c.pop();)if(!t(u=e.node,r=e.x0,i=e.y0,o=e.z0,a=e.x1,s=e.y1,l=e.z1)&&u.length){var h=(r+a)/2,f=(i+s)/2,d=(o+l)/2;(n=u[7])&&c.push(new Gr(n,h,f,d,a,s,l)),(n=u[6])&&c.push(new Gr(n,r,f,d,h,s,l)),(n=u[5])&&c.push(new Gr(n,h,i,d,a,f,l)),(n=u[4])&&c.push(new Gr(n,r,i,d,h,f,l)),(n=u[3])&&c.push(new Gr(n,h,f,o,a,s,d)),(n=u[2])&&c.push(new Gr(n,r,f,o,h,s,d)),(n=u[1])&&c.push(new Gr(n,h,i,o,a,f,d)),(n=u[0])&&c.push(new Gr(n,r,i,o,h,f,d))}return this},$r.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Gr(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,l=e.z0,c=e.x1,u=e.y1,h=e.z1,f=(a+c)/2,d=(s+u)/2,p=(l+h)/2;(o=i[0])&&n.push(new Gr(o,a,s,l,f,d,p)),(o=i[1])&&n.push(new Gr(o,f,s,l,c,d,p)),(o=i[2])&&n.push(new Gr(o,a,d,l,f,u,p)),(o=i[3])&&n.push(new Gr(o,f,d,l,c,u,p)),(o=i[4])&&n.push(new Gr(o,a,s,p,f,d,h)),(o=i[5])&&n.push(new Gr(o,f,s,p,c,d,h)),(o=i[6])&&n.push(new Gr(o,a,d,p,f,u,h)),(o=i[7])&&n.push(new Gr(o,f,d,p,c,u,h))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this},$r.x=function(t){return arguments.length?(this._x=t,this):this._x},$r.y=function(t){return arguments.length?(this._y=t,this):this._y},$r.z=function(t){return arguments.length?(this._z=t,this):this._z};var ni={value:()=>{}};function ri(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new ii(r)}function ii(t){this._=t}function oi(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function ai(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=ni,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}ii.prototype=ri.prototype={constructor:ii,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)i[n]=ai(i[n],t.name,e);else if(null==e)for(n in i)i[n]=ai(i[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=oi(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new ii(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var si,li,ci=0,ui=0,hi=0,fi=0,di=0,pi=0,vi="object"==typeof performance&&performance.now?performance:Date,gi="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function mi(){return di||(gi(yi),di=vi.now()+pi)}function yi(){di=0}function xi(){this._call=this._time=this._next=null}function bi(t,e,n){var r=new xi;return r.restart(t,e,n),r}function _i(){di=(fi=vi.now())+pi,ci=ui=0;try{!function(){mi(),++ci;for(var t,e=si;e;)(t=di-e._time)>=0&&e._call.call(void 0,t),e=e._next;--ci}()}finally{ci=0,function(){var t,e,n=si,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:si=e);li=t,Si(r)}(),di=0}}function wi(){var t=vi.now(),e=t-fi;e>1e3&&(pi-=e,fi=t)}function Si(t){ci||(ui&&(ui=clearTimeout(ui)),t-di>24?(t<1/0&&(ui=setTimeout(_i,t-vi.now()-pi)),hi&&(hi=clearInterval(hi))):(hi||(fi=vi.now(),hi=setInterval(wi,1e3)),ci=1,gi(_i)))}xi.prototype=bi.prototype={constructor:xi,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?mi():+n)+(null==e?0:+e),this._next||li===this||(li?li._next=this:si=this,li=this),this._call=t,this._time=n,Si()},stop:function(){this._call&&(this._call=null,this._time=1/0,Si())}};const Ui=4294967296;function ki(t){return t.x}function Ti(t){return t.y}function Ei(t){return t.z}var Mi=Math.PI*(3-Math.sqrt(5)),Ai=20*Math.PI/(9+Math.sqrt(221));function Ci(t,e){e=e||2;var n,r=Math.min(3,Math.max(1,Math.round(e))),i=1,o=.001,a=1-Math.pow(o,1/300),s=0,l=.6,c=new Map,u=bi(d),h=ri("tick","end"),f=function(){let t=1;return()=>(t=(1664525*t+1013904223)%Ui)/Ui}();function d(){p(),h.call("tick",n),i<o&&(u.stop(),h.call("end",n))}function p(e){var o,u,h=t.length;void 0===e&&(e=1);for(var f=0;f<e;++f)for(i+=(s-i)*a,c.forEach(function(t){t(i)}),o=0;o<h;++o)null==(u=t[o]).fx?u.x+=u.vx*=l:(u.x=u.fx,u.vx=0),r>1&&(null==u.fy?u.y+=u.vy*=l:(u.y=u.fy,u.vy=0)),r>2&&(null==u.fz?u.z+=u.vz*=l:(u.z=u.fz,u.vz=0));return n}function v(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),null!=e.fz&&(e.z=e.fz),isNaN(e.x)||r>1&&isNaN(e.y)||r>2&&isNaN(e.z)){var o=10*(r>2?Math.cbrt(.5+n):r>1?Math.sqrt(.5+n):n),a=n*Mi,s=n*Ai;1===r?e.x=o:2===r?(e.x=o*Math.cos(a),e.y=o*Math.sin(a)):(e.x=o*Math.sin(a)*Math.cos(s),e.y=o*Math.cos(a),e.z=o*Math.sin(a)*Math.sin(s))}(isNaN(e.vx)||r>1&&isNaN(e.vy)||r>2&&isNaN(e.vz))&&(e.vx=0,r>1&&(e.vy=0),r>2&&(e.vz=0))}}function g(e){return e.initialize&&e.initialize(t,f,r),e}return null==t&&(t=[]),v(),n={tick:p,restart:function(){return u.restart(d),n},stop:function(){return u.stop(),n},numDimensions:function(t){return arguments.length?(r=Math.min(3,Math.max(1,Math.round(t))),c.forEach(g),n):r},nodes:function(e){return arguments.length?(t=e,v(),c.forEach(g),n):t},alpha:function(t){return arguments.length?(i=+t,n):i},alphaMin:function(t){return arguments.length?(o=+t,n):o},alphaDecay:function(t){return arguments.length?(a=+t,n):+a},alphaTarget:function(t){return arguments.length?(s=+t,n):s},velocityDecay:function(t){return arguments.length?(l=1-t,n):1-l},randomSource:function(t){return arguments.length?(f=t,c.forEach(g),n):f},force:function(t,e){return arguments.length>1?(null==e?c.delete(t):c.set(t,g(e)),n):c.get(t)},find:function(){var e,n,i,o,a,s,l=Array.prototype.slice.call(arguments),c=l.shift()||0,u=(r>1?l.shift():null)||0,h=(r>2?l.shift():null)||0,f=l.shift()||1/0,d=0,p=t.length;for(f*=f,d=0;d<p;++d)(o=(e=c-(a=t[d]).x)*e+(n=u-(a.y||0))*n+(i=h-(a.z||0))*i)<f&&(s=a,f=o);return s},on:function(t,e){return arguments.length>1?(h.on(t,e),n):h.on(t)}}}const Di={showLabels:!0,showNodeDetails:!0,nodeScale:1,edgeWidth:2,linkDistance:300,chargeStrength:-5e3,gravity:.005,friction:.4,maxFPS:60,lodEnabled:!0,highContrast:!1,reducedMotion:!1},Pi=K(t=>({sidebarOpen:!0,sidebarTab:"details",menuOpen:null,loadingProgress:0,loadingMessage:"",notifications:[],isDragging:!1,viewport:{zoom:1,rotation:[0,0,0],target:[0,0,0],mode:"2d"},settings:Di,toggleSidebar:()=>t(t=>({sidebarOpen:!t.sidebarOpen})),setSidebarTab:e=>t({sidebarTab:e}),setMenuOpen:e=>t({menuOpen:e}),setLoadingProgress:(e,n)=>t({loadingProgress:e,loadingMessage:n||""}),addNotification:e=>t(n=>{const r=`notification-${Date.now()}-${Math.random()}`,i={...e,id:r};return 0!==e.duration&&setTimeout(()=>{t(t=>({notifications:t.notifications.filter(t=>t.id!==r)}))},e.duration||5e3),{notifications:[...n.notifications,i]}}),removeNotification:e=>t(t=>({notifications:t.notifications.filter(t=>t.id!==e)})),setZoom:e=>t(t=>({viewport:{...t.viewport,zoom:e}})),setRotation:e=>t(t=>({viewport:{...t.viewport,rotation:e}})),setTarget:e=>t(t=>({viewport:{...t.viewport,target:e}})),toggleViewMode:()=>t(t=>({viewport:{...t.viewport,mode:"2d"===t.viewport.mode?"3d":"2d"}})),setDragging:e=>t({isDragging:e}),updateSettings:e=>t(t=>({settings:{...t.settings,...e}})),resetSettings:()=>t({settings:Di})}));function Fi(){const t=n.useRef(null),e=n.useRef([]),r=n.useRef([]),{nodes:i,edges:o,updateNodePosition:a}=Z(),{settings:s,viewport:c}=Pi(),u="3d"===c.mode;n.useEffect(()=>{if(0===i.size)return;const n=Array.from(i.values()).map(t=>({id:t.id,type:t.type,label:t.label,iri:t.iri,x:t.position.x||0,y:t.position.y||0,z:u&&t.position.z||0,vx:0,vy:0,vz:0})),a=Array.from(o.values()).filter(t=>{const e=i.has(t.source),n=i.has(t.target);return e&&n}).map(t=>({id:t.id,type:t.type,source:t.source,target:t.target}));e.current=n,r.current=a;const l=Ci(n).numDimensions(u?3:2).force("link",function(t){var e,n,r,i,o,a,s,l=ti,c=function(t){return 1/Math.min(o[t.source.index],o[t.target.index])},u=Yr(30),h=1;function f(r){for(var o=0,l=t.length;o<h;++o)for(var c,u,f,d,p,v=0,g=0,m=0,y=0;v<l;++v)u=(c=t[v]).source,g=(f=c.target).x+f.vx-u.x-u.vx||Kr(s),i>1&&(m=f.y+f.vy-u.y-u.vy||Kr(s)),i>2&&(y=f.z+f.vz-u.z-u.vz||Kr(s)),g*=d=((d=Math.sqrt(g*g+m*m+y*y))-n[v])/d*r*e[v],m*=d,y*=d,f.vx-=g*(p=a[v]),i>1&&(f.vy-=m*p),i>2&&(f.vz-=y*p),u.vx+=g*(p=1-p),i>1&&(u.vy+=m*p),i>2&&(u.vz+=y*p)}function d(){if(r){var i,s,c=r.length,u=t.length,h=new Map(r.map((t,e)=>[l(t,e,r),t]));for(i=0,o=new Array(c);i<u;++i)(s=t[i]).index=i,"object"!=typeof s.source&&(s.source=ei(h,s.source)),"object"!=typeof s.target&&(s.target=ei(h,s.target)),o[s.source.index]=(o[s.source.index]||0)+1,o[s.target.index]=(o[s.target.index]||0)+1;for(i=0,a=new Array(u);i<u;++i)s=t[i],a[i]=o[s.source.index]/(o[s.source.index]+o[s.target.index]);e=new Array(u),p(),n=new Array(u),v()}}function p(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+c(t[n],n,t)}function v(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+u(t[e],e,t)}return null==t&&(t=[]),f.initialize=function(t,...e){r=t,s=e.find(t=>"function"==typeof t)||Math.random,i=e.find(t=>[1,2,3].includes(t))||2,d()},f.links=function(e){return arguments.length?(t=e,d(),f):t},f.id=function(t){return arguments.length?(l=t,f):l},f.iterations=function(t){return arguments.length?(h=+t,f):h},f.strength=function(t){return arguments.length?(c="function"==typeof t?t:Yr(+t),p(),f):c},f.distance=function(t){return arguments.length?(u="function"==typeof t?t:Yr(+t),v(),f):u},f}(a).id(t=>t.id).distance(s.linkDistance).strength(.3)).force("charge",function(){var t,e,n,r,i,o,a=Yr(-30),s=1,l=1/0,c=.81;function u(r){var o,a=t.length,s=(1===e?Er(t,ki):2===e?zr(t,ki,Ti):3===e?Hr(t,ki,Ti,Ei):null).visitAfter(f);for(i=r,o=0;o<a;++o)n=t[o],s.visit(d)}function h(){if(t){var e,n,r=t.length;for(o=new Array(r),e=0;e<r;++e)n=t[e],o[n.index]=+a(n,e,t)}}function f(t){var n,r,i,a,s,l,c=0,u=0,h=t.length;if(h){for(i=a=s=l=0;l<h;++l)(n=t[l])&&(r=Math.abs(n.value))&&(c+=n.value,u+=r,i+=r*(n.x||0),a+=r*(n.y||0),s+=r*(n.z||0));c*=Math.sqrt(4/h),t.x=i/u,e>1&&(t.y=a/u),e>2&&(t.z=s/u)}else{(n=t).x=n.data.x,e>1&&(n.y=n.data.y),e>2&&(n.z=n.data.z);do{c+=o[n.data.index]}while(n=n.next)}t.value=c}function d(t,a,u,h,f){if(!t.value)return!0;var d=[u,h,f][e-1],p=t.x-n.x,v=e>1?t.y-n.y:0,g=e>2?t.z-n.z:0,m=d-a,y=p*p+v*v+g*g;if(m*m/c<y)return y<l&&(0===p&&(y+=(p=Kr(r))*p),e>1&&0===v&&(y+=(v=Kr(r))*v),e>2&&0===g&&(y+=(g=Kr(r))*g),y<s&&(y=Math.sqrt(s*y)),n.vx+=p*t.value*i/y,e>1&&(n.vy+=v*t.value*i/y),e>2&&(n.vz+=g*t.value*i/y)),!0;if(!(t.length||y>=l)){(t.data!==n||t.next)&&(0===p&&(y+=(p=Kr(r))*p),e>1&&0===v&&(y+=(v=Kr(r))*v),e>2&&0===g&&(y+=(g=Kr(r))*g),y<s&&(y=Math.sqrt(s*y)));do{t.data!==n&&(m=o[t.data.index]*i/y,n.vx+=p*m,e>1&&(n.vy+=v*m),e>2&&(n.vz+=g*m))}while(t=t.next)}}return u.initialize=function(n,...i){t=n,r=i.find(t=>"function"==typeof t)||Math.random,e=i.find(t=>[1,2,3].includes(t))||2,h()},u.strength=function(t){return arguments.length?(a="function"==typeof t?t:Yr(+t),h(),u):a},u.distanceMin=function(t){return arguments.length?(s=t*t,u):Math.sqrt(s)},u.distanceMax=function(t){return arguments.length?(l=t*t,u):Math.sqrt(l)},u.theta=function(t){return arguments.length?(c=t*t,u):Math.sqrt(c)},u}().strength(s.chargeStrength).distanceMax(1e3)).force("center",function(t,e,n){var r,i=1;function o(){var o,a,s=r.length,l=0,c=0,u=0;for(o=0;o<s;++o)l+=(a=r[o]).x||0,c+=a.y||0,u+=a.z||0;for(l=(l/s-t)*i,c=(c/s-e)*i,u=(u/s-n)*i,o=0;o<s;++o)a=r[o],l&&(a.x-=l),c&&(a.y-=c),u&&(a.z-=u)}return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),o.initialize=function(t){r=t},o.x=function(e){return arguments.length?(t=+e,o):t},o.y=function(t){return arguments.length?(e=+t,o):e},o.z=function(t){return arguments.length?(n=+t,o):n},o.strength=function(t){return arguments.length?(i=+t,o):i},o}(0,0,0).strength(s.gravity)).force("collide",function(t){var e,n,r,i,o=1,a=1;function s(){for(var t,s,c,u,h,f,d,p,v=e.length,g=0;g<a;++g)for(s=(1===n?Er(e,Zr):2===n?zr(e,Zr,Qr):3===n?Hr(e,Zr,Qr,Jr):null).visitAfter(l),t=0;t<v;++t)c=e[t],d=r[c.index],p=d*d,u=c.x+c.vx,n>1&&(h=c.y+c.vy),n>2&&(f=c.z+c.vz),s.visit(m);function m(t,e,r,a,s,l,v){var g=[e,r,a,s,l,v],m=g[0],y=g[1],x=g[2],b=g[n],_=g[n+1],w=g[n+2],S=t.data,U=t.r,k=d+U;if(!S)return m>u+k||b<u-k||n>1&&(y>h+k||_<h-k)||n>2&&(x>f+k||w<f-k);if(S.index>c.index){var T=u-S.x-S.vx,E=n>1?h-S.y-S.vy:0,M=n>2?f-S.z-S.vz:0,A=T*T+E*E+M*M;A<k*k&&(0===T&&(A+=(T=Kr(i))*T),n>1&&0===E&&(A+=(E=Kr(i))*E),n>2&&0===M&&(A+=(M=Kr(i))*M),A=(k-(A=Math.sqrt(A)))/A*o,c.vx+=(T*=A)*(k=(U*=U)/(p+U)),n>1&&(c.vy+=(E*=A)*k),n>2&&(c.vz+=(M*=A)*k),S.vx-=T*(k=1-k),n>1&&(S.vy-=E*k),n>2&&(S.vz-=M*k))}}}function l(t){if(t.data)return t.r=r[t.data.index];for(var e=t.r=0;e<Math.pow(2,n);++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function c(){if(e){var n,i,o=e.length;for(r=new Array(o),n=0;n<o;++n)i=e[n],r[i.index]=+t(i,n,e)}}return"function"!=typeof t&&(t=Yr(null==t?1:+t)),s.initialize=function(t,...r){e=t,i=r.find(t=>"function"==typeof t)||Math.random,n=r.find(t=>[1,2,3].includes(t))||2,c()},s.iterations=function(t){return arguments.length?(a=+t,s):a},s.strength=function(t){return arguments.length?(o=+t,s):o},s.radius=function(e){return arguments.length?(t="function"==typeof e?e:Yr(+e),c(),s):t},s}().radius(20).strength(.8)).alphaDecay(.005).velocityDecay(s.friction).alpha(1).restart();return t.current=l,()=>{t.current&&t.current.stop()}},[i,o,s.linkDistance,s.chargeStrength,s.gravity,s.friction,u]),l(()=>{t.current&&e.current.length&&(t.current.tick(),e.current.forEach(t=>{a(t.id,[t.x||0,t.y||0,u&&t.z||0])}))});return{fixNodePosition:(t,n,r,i)=>{const o=e.current.find(e=>e.id===t);o&&(o.fx=n??null,o.fy=r??null,o.fz=u?i??null:null)},releaseNode:t=>{const n=e.current.find(e=>e.id===t);n&&(n.fx=null,n.fy=null,n.fz=null)},reheat:()=>{t.current&&t.current.alpha(1).restart()},isRunning:!!t.current&&t.current.alpha()>.01}}function Oi({node:t,onDragStart:r,onDragEnd:o}){const a=n.useRef(null),[c,f]=n.useState(!1),[d,p]=n.useState(!1),v=i(),{camera:g,size:m}=s(),{selectNode:y,hoverNode:x,selectedNode:b,updateNodePosition:_}=Z(),{settings:w,viewport:S}=Pi(),U=b===t.id;S.mode;const k=t.properties?.instances||0,T=(k>0?.1*Math.sqrt(k)+1.6:1.6)*w.nodeScale,E=(M={onDrag:({delta:[e,n],first:i,last:s})=>{if(i&&(p(!0),Pi.getState().setDragging(!0),r?.()),a.current){const r=g.position.z/m.height*2,i=e*r,o=-n*r;_(t.id,[t.position.x+i,t.position.y+o,t.position.z])}s&&(p(!1),Pi.getState().setDragging(!1),o?.())},onClick:e=>{2===e.event.detail||e.event.metaKey||e.event.ctrlKey?v(`/page/${encodeURIComponent(t.label)}`):y(U?null:t.id)}},Ue([ae,ce,ue,he,le,se])(M,{}));var M;return l(()=>{if(a.current&&!t.pinned){const e=new h(t.position.x,t.position.y,t.position.z);a.current.position.lerp(e,.1)}}),e.jsxs("group",{children:[e.jsx(Sr,{ref:a,args:[T,32],position:[t.position.x,t.position.y,t.position.z],...E(),onPointerOver:e=>{e.stopPropagation(),f(!0),x(t.id),document.body.style.cursor=d?"grabbing":"grab"},onPointerOut:()=>{d||(f(!1),x(null),document.body.style.cursor="auto")},children:e.jsx("meshBasicMaterial",{color:d?"#ff6b6b":U?"#67bc0f":c?"#8cd0f0":"#aaccee",transparent:!0,opacity:t.opacity||1})}),e.jsx(Sr,{args:[T+2,32],position:[t.position.x,t.position.y,t.position.z-.1],children:e.jsx("meshBasicMaterial",{color:U?"#67bc0f":"#333",transparent:!0,opacity:U?.5:.2,side:u})}),w.showLabels&&e.jsx(pr,{position:[t.position.x,t.position.y-T-3,t.position.z+1],fontSize:1.4,color:"#333",anchorX:"center",anchorY:"middle",maxWidth:4*T,textAlign:"center",children:t.label}),w.showNodeDetails&&k>0&&e.jsx(pr,{position:[t.position.x,t.position.y,t.position.z+2],fontSize:1,color:"#666",anchorX:"center",anchorY:"middle",children:k}),U&&e.jsx(Sr,{args:[T+8,32],position:[t.position.x,t.position.y,t.position.z-.2],children:e.jsx("meshBasicMaterial",{color:"#67bc0f",transparent:!0,opacity:.3,side:u})}),c&&!U&&e.jsx(Sr,{args:[T+5,32],position:[t.position.x,t.position.y,t.position.z-.15],children:e.jsx("meshBasicMaterial",{color:"#8cd0f0",transparent:!0,opacity:.2,side:u})})]})}function zi({edge:t}){const{nodes:r,selectedEdge:i}=Z(),{settings:o}=Pi(),a=i===t.id,s=r.get(t.source),l=r.get(t.target),c=n.useMemo(()=>{if(!s||!l)return null;if(!s.position||!l.position)return null;const t=s.position.x,e=s.position.y,n=s.position.z,r=l.position.x,i=l.position.y,o=l.position.z;return"number"!=typeof t||"number"!=typeof e||"number"!=typeof n||"number"!=typeof r||"number"!=typeof i||"number"!=typeof o||isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(o)?null:[new h(t,e,n),new h(r,i,o)]},[s,l]);if(!c||!s||!l)return null;const u=()=>{if(a)return"#67bc0f";switch(t.type){case"subclass":return"#444";case"objectProperty":default:return"#999";case"datatypeProperty":return"#666";case"disjoint":return"#ff6666"}},f=()=>("subclass"===t.type?3:2)*o.edgeWidth,d=()=>{if("disjoint"===t.type)return[5,5]},p=n.useMemo(()=>new h((c[0].x+c[1].x)/2,(c[0].y+c[1].y)/2,(c[0].z+c[1].z)/2+1),[c]),v=n.useMemo(()=>(new h).subVectors(c[1],c[0]).normalize(),[c]);return e.jsxs("group",{children:[e.jsx(Ke,{points:c,color:u(),lineWidth:f(),transparent:!0,opacity:t.opacity||.6,dashed:!!d(),dashSize:d()?.[0],gapSize:d()?.[1]}),o.showLabels&&t.label&&e.jsx(pr,{position:p,fontSize:10,color:"#666",anchorX:"center",anchorY:"middle",maxWidth:200,textAlign:"center",backgroundColor:"rgba(255, 255, 255, 0.8)",padding:.05,children:t.label}),"disjoint"!==t.type&&e.jsxs("mesh",{position:[l.position.x-25*v.x,l.position.y-25*v.y,l.position.z],rotation:[0,0,Math.atan2(v.y,v.x)],children:[e.jsx("coneGeometry",{args:[5,10,8]}),e.jsx("meshBasicMaterial",{color:u(),transparent:!0,opacity:t.opacity||.6})]}),a&&e.jsx(Ke,{points:c,color:"#67bc0f",lineWidth:f()+4,transparent:!0,opacity:.3})]})}function Ii(){const{nodes:t,edges:n,filteredNodes:r,filteredEdges:i}=Z(),{isRunning:o,fixNodePosition:a,releaseNode:s}=Fi(),l=Array.from(t.values()).filter(t=>r.has(t.id)),c=Array.from(n.values()).filter(t=>i.has(t.id));return e.jsxs("group",{children:[c.map(t=>e.jsx(zi,{edge:t},t.id)),l.map(t=>e.jsx(Oi,{node:t,onDragStart:()=>a(t.id),onDragEnd:()=>s(t.id)},t.id)),o&&e.jsx(dt,{position:[0,250,0],center:!0,style:{pointerEvents:"none",userSelect:"none"},children:e.jsx("div",{style:{background:"rgba(0, 0, 0, 0.7)",color:"white",padding:"8px 16px",borderRadius:"4px",fontSize:"14px",fontFamily:"system-ui, sans-serif"},children:"Simulating..."})}),0===t.size&&e.jsx(dt,{center:!0,children:e.jsxs("div",{style:{textAlign:"center",color:"#999",fontSize:"18px",fontFamily:"system-ui, sans-serif"},children:[e.jsx("h2",{children:"No ontology loaded"}),e.jsx("p",{children:"Drop a JSON file or select from the menu"})]})})]})}function Ri(){const{viewport:t,isDragging:r}=Pi(),i=n.useRef(null),o="3d"===t.mode;return e.jsx("div",{style:{width:"100%",height:"100vh",background:"#f5f5f5"},children:e.jsxs(Q,{gl:{antialias:!0,alpha:!0,powerPreference:"high-performance"},dpr:[1,2],children:[o?e.jsx(xr,{makeDefault:!0,position:[0,300,500],fov:50}):e.jsx(yr,{makeDefault:!0,position:[0,0,500],zoom:1,near:.1,far:2e3}),e.jsx(J,{ref:i,enabled:!r,enableDamping:!0,dampingFactor:.05,minDistance:50,maxDistance:2e3,enableRotate:o,enablePan:!0,mouseButtons:{LEFT:2,MIDDLE:1,RIGHT:0}}),e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[10,10,5],intensity:.5}),e.jsx("pointLight",{position:[-10,-10,-5],intensity:.3}),o&&e.jsx(_r,{args:[1e3,1e3],cellColor:"#cccccc",sectionColor:"#aaaaaa",fadeDistance:800,fadeStrength:1}),e.jsx(Ii,{})]})})}function Li(){const{nodeId:t}=a(),r=i(),[s,l]=n.useState(!0),[c,u]=n.useState(null),h=Z(t=>t.setSelectedNode),f=Z(t=>t.loadOntology),d=Z(t=>t.nodes.size),[p,v]=function(){const[t,e]=o();return[{zoom:parseFloat(t.get("zoom")||"1"),rotation:t.get("rotation")?.split(",").map(Number)||[0,0,0],selectedNode:t.get("selected")||null},n.useCallback(t=>{e(e=>{const n=new URLSearchParams(e);return void 0!==t.zoom&&n.set("zoom",t.zoom.toString()),void 0!==t.rotation&&n.set("rotation",t.rotation.join(",")),void 0!==t.selectedNode&&(null===t.selectedNode?n.delete("selected"):n.set("selected",t.selectedNode)),n},{replace:!0})},[e])]}();n.useEffect(()=>{(async()=>{if(d>0)l(!1);else try{const t=await fetch("/data/ontology.json");if(!t.ok)throw new Error(`Failed to fetch ontology: ${t.status} ${t.statusText}`);const e=await t.json();if(!e.class||!Array.isArray(e.class))throw new Error("Invalid ontology format: missing class array");const n={header:e.header,namespace:e.namespace,class:e.class,property:e.property||[],datatype:e.datatype,classAttribute:e.classAttribute,propertyAttribute:e.propertyAttribute};f(n),l(!1)}catch(t){u(t instanceof Error?t.message:"Unknown error"),l(!1)}})()},[f,d]),n.useEffect(()=>{t&&h(t)},[t,h]);return s?e.jsx("div",{className:"ontology-view loading",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading ontology visualization..."})]})}):c?e.jsx("div",{className:"ontology-view error",children:e.jsxs("div",{className:"error-container",children:[e.jsx("h2",{children:"Failed to Load Ontology"}),e.jsx("p",{children:c}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Retry"})]})}):e.jsx("div",{className:"ontology-view",children:e.jsx(Ri,{onNodeClick:t=>{const e=Z.getState().nodes.get(t);e?.label&&(v({selectedNode:t}),r(`/page/${encodeURIComponent(e.label)}`))}})})}export{Li as default};
