import{k as t,_ as e,j as n,__tla as __tla_0}from"./index-ClLAXtKW.js";import{b as r,u as i,f as a,e as o}from"./vendor-DcxHNL6q.js";import{a as s,b as l,_ as c,D as u,V as f,c as d,P as h,d as p,R as v,I as g,F as m,e as y,f as x,W as b,B as S,S as w,g as U,U as _,h as k,M as T,i as C,L as E,j as F,k as A,l as M,m as D,n as P,o as R,p as O,q as I,r as L,T as B,s as G,t as z,v as j,w as W,x as N,H as V,y as H,z as q,A as $,E as X,G as Y,J as K,u as Z,C as J,O as Q}from"./useGraphStore-D93k41P1.js";import"./fuse-DRqTZInw.js";let xn;let __tla=Promise.all([(()=>{try{return __tla_0}catch{}})()]).then(async()=>{const tt=[];function et(t,e,n=(t,e)=>t===e){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}const nt=(t,e,n)=>function(t,e=null,n=!1,r={}){null===e&&(e=[t]);for(const o of tt)if(et(e,o.keys,o.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return r.lifespan&&r.lifespan>0&&(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(o.remove,r.lifespan)),o.response;if(!n)throw o.promise}const i={keys:e,equal:r.equal,remove:()=>{const t=tt.indexOf(i);-1!==t&&tt.splice(t,1)},promise:(a=t,"object"==typeof a&&"function"==typeof a.then?t:t(...e)).then(t=>{i.response=t,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(t=>i.error=t)};var a;if(tt.push(i),!n)throw i.promise}(t,e,!1,n),rt=new f,it=new f,at=new f,ot=new d;function st(t,e,n){const r=rt.setFromMatrixPosition(t.matrixWorld);r.project(e);const i=n.width/2,a=n.height/2;return[r.x*i+i,-r.y*a+a]}const lt=t=>Math.abs(t)<1e-10?0:t;function ct(t,e,n=""){let r="matrix3d(";for(let i=0;16!==i;i++)r+=lt(e[i]*t.elements[i])+(15!==i?",":")");return n+r}const ut=(ft=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],t=>ct(t,ft));var ft;const dt=(t,e)=>{return ct(t,[1/(n=e),1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1],"translate(-50%,-50%)");var n};const ht=r.forwardRef(({children:e,eps:n=.001,style:i,className:a,prepend:o,center:d,fullscreen:v,portal:g,distanceFactor:m,sprite:y=!1,transform:x=!1,occlude:b,onOcclude:S,castShadow:w,receiveShadow:U,material:_,geometry:k,zIndexRange:T=[0x1000037,0],calculatePosition:C=st,as:E="div",wrapperClass:F,pointerEvents:A="auto",...M},D)=>{const{gl:P,camera:R,scene:O,size:I,raycaster:L,events:B,viewport:G}=s(),[z]=r.useState(()=>document.createElement(E)),j=r.useRef(null),W=r.useRef(null),N=r.useRef(0),V=r.useRef([0,0]),H=r.useRef(null),q=r.useRef(null),$=(null==g?void 0:g.current)||B.connected||P.domElement.parentNode,X=r.useRef(null),Y=r.useRef(!1),K=r.useMemo(()=>b&&"blending"!==b||Array.isArray(b)&&b.length&&function(t){return t&&"object"==typeof t&&"current"in t}(b[0]),[b]);r.useLayoutEffect(()=>{const t=P.domElement;b&&"blending"===b?(t.style.zIndex=`${Math.floor(T[0]/2)}`,t.style.position="absolute",t.style.pointerEvents="none"):(t.style.zIndex=null,t.style.position=null,t.style.pointerEvents=null)},[b]),r.useLayoutEffect(()=>{if(W.current){const e=j.current=t.createRoot(z);if(O.updateMatrixWorld(),x)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const t=C(W.current,R,I);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${t[0]}px,${t[1]}px,0);transform-origin:0 0;`}return $&&(o?$.prepend(z):$.appendChild(z)),()=>{$&&$.removeChild(z),e.unmount()}}},[$,x]),r.useLayoutEffect(()=>{F&&(z.className=F)},[F]);const Z=r.useMemo(()=>x?{position:"absolute",top:0,left:0,width:I.width,height:I.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:d?"translate3d(-50%,-50%,0)":"none",...v&&{top:-I.height/2,left:-I.width/2,width:I.width,height:I.height},...i},[i,d,v,I,x]),J=r.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);r.useLayoutEffect(()=>{var t,n;(Y.current=!1,x)?null==(t=j.current)||t.render(r.createElement("div",{ref:H,style:Z},r.createElement("div",{ref:q,style:J},r.createElement("div",{ref:D,className:a,style:i,children:e})))):null==(n=j.current)||n.render(r.createElement("div",{ref:D,style:Z,className:a,children:e}))});const Q=r.useRef(!0);l(t=>{if(W.current){R.updateMatrixWorld(),W.current.updateWorldMatrix(!0,!1);const t=x?V.current:C(W.current,R,I);if(x||Math.abs(N.current-R.zoom)>n||Math.abs(V.current[0]-t[0])>n||Math.abs(V.current[1]-t[1])>n){const e=function(t,e){const n=rt.setFromMatrixPosition(t.matrixWorld),r=it.setFromMatrixPosition(e.matrixWorld),i=n.sub(r),a=e.getWorldDirection(at);return i.angleTo(a)>Math.PI/2}(W.current,R);let n=!1;K&&(Array.isArray(b)?n=b.map(t=>t.current):"blending"!==b&&(n=[O]));const r=Q.current;if(n){const t=function(t,e,n,r){const i=rt.setFromMatrixPosition(t.matrixWorld),a=i.clone();a.project(e),ot.set(a.x,a.y),n.setFromCamera(ot,e);const o=n.intersectObjects(r,!0);if(o.length){const t=o[0].distance;return i.distanceTo(n.ray.origin)<t}return!0}(W.current,R,L,n);Q.current=t&&!e}else Q.current=!e;r!==Q.current&&(S?S(!Q.current):z.style.display=Q.current?"block":"none");const i=Math.floor(T[0]/2),a=b?K?[T[0],i]:[i-1,0]:T;if(z.style.zIndex=`${function(t,e,n){if(e instanceof h||e instanceof p){const r=rt.setFromMatrixPosition(t.matrixWorld),i=it.setFromMatrixPosition(e.matrixWorld),a=r.distanceTo(i),o=(n[1]-n[0])/(e.far-e.near),s=n[1]-o*e.far;return Math.round(o*a+s)}}(W.current,R,a)}`,x){const[t,e]=[I.width/2,I.height/2],n=R.projectionMatrix.elements[5]*e,{isOrthographicCamera:r,top:i,left:a,bottom:o,right:s}=R,l=ut(R.matrixWorldInverse),c=r?`scale(${n})translate(${lt(-(s+a)/2)}px,${lt((i+o)/2)}px)`:`translateZ(${n}px)`;let u=W.current.matrixWorld;y&&(u=R.matrixWorldInverse.clone().transpose().copyPosition(u).scale(W.current.scale),u.elements[3]=u.elements[7]=u.elements[11]=0,u.elements[15]=1),z.style.width=I.width+"px",z.style.height=I.height+"px",z.style.perspective=r?"":`${n}px`,H.current&&q.current&&(H.current.style.transform=`${c}${l}translate(${t}px,${e}px)`,q.current.style.transform=dt(u,1/((m||10)/400)))}else{const e=void 0===m?1:function(t,e){if(e instanceof p)return e.zoom;if(e instanceof h){const n=rt.setFromMatrixPosition(t.matrixWorld),r=it.setFromMatrixPosition(e.matrixWorld),i=e.fov*Math.PI/180,a=n.distanceTo(r);return 1/(2*Math.tan(i/2)*a)}return 1}(W.current,R)*m;z.style.transform=`translate3d(${t[0]}px,${t[1]}px,0) scale(${e})`}V.current=t,N.current=R.zoom}}if(!K&&X.current&&!Y.current)if(x){if(H.current){const t=H.current.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const{isOrthographicCamera:e}=R;if(e||k)M.scale&&(Array.isArray(M.scale)?M.scale instanceof f?X.current.scale.copy(M.scale.clone().divideScalar(1)):X.current.scale.set(1/M.scale[0],1/M.scale[1],1/M.scale[2]):X.current.scale.setScalar(1/M.scale));else{const e=(m||10)/400,n=t.clientWidth*e,r=t.clientHeight*e;X.current.scale.set(n,r,1)}Y.current=!0}}}else{const e=z.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const t=1/G.factor,n=e.clientWidth*t,r=e.clientHeight*t;X.current.scale.set(n,r,1),Y.current=!0}X.current.lookAt(t.camera.position)}});const tt=r.useMemo(()=>({vertexShader:x?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "}),[x]);return r.createElement("group",c({},M,{ref:W}),b&&!K&&r.createElement("mesh",{castShadow:w,receiveShadow:U,ref:X},k||r.createElement("planeGeometry",null),_||r.createElement("shaderMaterial",{side:u,vertexShader:tt.vertexShader,fragmentShader:tt.fragmentShader})))}),pt=(()=>parseInt(v.replace(/\D+/g,"")))(),vt=pt>=125?"uv1":"uv2",gt=new S,mt=new f;class yt extends g{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new m([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new m([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(t){const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const n=new y(e,6,1);return this.setAttribute("instanceStart",new x(n,3,0)),this.setAttribute("instanceEnd",new x(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t,e=3){let n;t instanceof Float32Array?n=t:Array.isArray(t)&&(n=new Float32Array(t));const r=new y(n,2*e,1);return this.setAttribute("instanceColorStart",new x(r,e,0)),this.setAttribute("instanceColorEnd",new x(r,e,e)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new b(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new S);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),gt.setFromBufferAttribute(e),this.boundingBox.union(gt))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new w),null===this.boundingBox&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let i=0,a=t.count;i<a;i++)mt.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(mt)),mt.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(mt));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)}}toJSON(){}applyMatrix(t){return this.applyMatrix4(t)}}class xt extends yt{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const e=t.length-3,n=new Float32Array(2*e);for(let r=0;r<e;r+=3)n[2*r]=t[r],n[2*r+1]=t[r+1],n[2*r+2]=t[r+2],n[2*r+3]=t[r+3],n[2*r+4]=t[r+4],n[2*r+5]=t[r+5];return super.setPositions(n),this}setColors(t,e=3){const n=t.length-e,r=new Float32Array(2*n);if(3===e)for(let i=0;i<n;i+=e)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5];else for(let i=0;i<n;i+=e)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5],r[2*i+6]=t[i+6],r[2*i+7]=t[i+7];return super.setColors(r,e),this}fromLine(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}}class bt extends U{constructor(t){super({type:"LineMaterial",uniforms:_.clone(_.merge([k.common,k.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new d(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n				#include <common>\n				#include <fog_pars_vertex>\n				#include <logdepthbuf_pars_vertex>\n				#include <clipping_planes_pars_vertex>\n\n				uniform float linewidth;\n				uniform vec2 resolution;\n\n				attribute vec3 instanceStart;\n				attribute vec3 instanceEnd;\n\n				#ifdef USE_COLOR\n					#ifdef USE_LINE_COLOR_ALPHA\n						varying vec4 vLineColor;\n						attribute vec4 instanceColorStart;\n						attribute vec4 instanceColorEnd;\n					#else\n						varying vec3 vLineColor;\n						attribute vec3 instanceColorStart;\n						attribute vec3 instanceColorEnd;\n					#endif\n				#endif\n\n				#ifdef WORLD_UNITS\n\n					varying vec4 worldPos;\n					varying vec3 worldStart;\n					varying vec3 worldEnd;\n\n					#ifdef USE_DASH\n\n						varying vec2 vUv;\n\n					#endif\n\n				#else\n\n					varying vec2 vUv;\n\n				#endif\n\n				#ifdef USE_DASH\n\n					uniform float dashScale;\n					attribute float instanceDistanceStart;\n					attribute float instanceDistanceEnd;\n					varying float vLineDistance;\n\n				#endif\n\n				void trimSegment( const in vec4 start, inout vec4 end ) {\n\n					// trim end segment so it terminates between the camera plane and the near plane\n\n					// conservative estimate of the near plane\n					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n					float nearEstimate = - 0.5 * b / a;\n\n					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n					end.xyz = mix( start.xyz, end.xyz, alpha );\n\n				}\n\n				void main() {\n\n					#ifdef USE_COLOR\n\n						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n					#endif\n\n					#ifdef USE_DASH\n\n						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n						vUv = uv;\n\n					#endif\n\n					float aspect = resolution.x / resolution.y;\n\n					// camera space\n					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n					#ifdef WORLD_UNITS\n\n						worldStart = start.xyz;\n						worldEnd = end.xyz;\n\n					#else\n\n						vUv = uv;\n\n					#endif\n\n					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n					// perhaps there is a more elegant solution -- WestLangley\n\n					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n					if ( perspective ) {\n\n						if ( start.z < 0.0 && end.z >= 0.0 ) {\n\n							trimSegment( start, end );\n\n						} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n							trimSegment( end, start );\n\n						}\n\n					}\n\n					// clip space\n					vec4 clipStart = projectionMatrix * start;\n					vec4 clipEnd = projectionMatrix * end;\n\n					// ndc space\n					vec3 ndcStart = clipStart.xyz / clipStart.w;\n					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n					// direction\n					vec2 dir = ndcEnd.xy - ndcStart.xy;\n\n					// account for clip-space aspect ratio\n					dir.x *= aspect;\n					dir = normalize( dir );\n\n					#ifdef WORLD_UNITS\n\n						// get the offset direction as perpendicular to the view vector\n						vec3 worldDir = normalize( end.xyz - start.xyz );\n						vec3 offset;\n						if ( position.y < 0.5 ) {\n\n							offset = normalize( cross( start.xyz, worldDir ) );\n\n						} else {\n\n							offset = normalize( cross( end.xyz, worldDir ) );\n\n						}\n\n						// sign flip\n						if ( position.x < 0.0 ) offset *= - 1.0;\n\n						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n						// don't extend the line if we're rendering dashes because we\n						// won't be rendering the endcaps\n						#ifndef USE_DASH\n\n							// extend the line bounds to encompass  endcaps\n							start.xyz += - worldDir * linewidth * 0.5;\n							end.xyz += worldDir * linewidth * 0.5;\n\n							// shift the position of the quad so it hugs the forward edge of the line\n							offset.xy -= dir * forwardOffset;\n							offset.z += 0.5;\n\n						#endif\n\n						// endcaps\n						if ( position.y > 1.0 || position.y < 0.0 ) {\n\n							offset.xy += dir * 2.0 * forwardOffset;\n\n						}\n\n						// adjust for linewidth\n						offset *= linewidth * 0.5;\n\n						// set the world position\n						worldPos = ( position.y < 0.5 ) ? start : end;\n						worldPos.xyz += offset;\n\n						// project the worldpos\n						vec4 clip = projectionMatrix * worldPos;\n\n						// shift the depth of the projected points so the line\n						// segments overlap neatly\n						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n						clip.z = clipPose.z * clip.w;\n\n					#else\n\n						vec2 offset = vec2( dir.y, - dir.x );\n						// undo aspect ratio adjustment\n						dir.x /= aspect;\n						offset.x /= aspect;\n\n						// sign flip\n						if ( position.x < 0.0 ) offset *= - 1.0;\n\n						// endcaps\n						if ( position.y < 0.0 ) {\n\n							offset += - dir;\n\n						} else if ( position.y > 1.0 ) {\n\n							offset += dir;\n\n						}\n\n						// adjust for linewidth\n						offset *= linewidth;\n\n						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n						offset /= resolution.y;\n\n						// select end\n						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n						// back to clip space\n						offset *= clip.w;\n\n						clip.xy += offset;\n\n					#endif\n\n					gl_Position = clip;\n\n					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n					#include <logdepthbuf_vertex>\n					#include <clipping_planes_vertex>\n					#include <fog_vertex>\n\n				}\n			",fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${pt>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){!0===t?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===t?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===t?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}}const St=new C,wt=new f,Ut=new f,_t=new C,kt=new C,Tt=new C,Ct=new f,Et=new F,Ft=new E,At=new f,Mt=new S,Dt=new w,Pt=new C;let Rt,Ot;function It(t,e,n){return Pt.set(0,0,-e,1).applyMatrix4(t.projectionMatrix),Pt.multiplyScalar(1/Pt.w),Pt.x=Ot/n.width,Pt.y=Ot/n.height,Pt.applyMatrix4(t.projectionMatrixInverse),Pt.multiplyScalar(1/Pt.w),Math.abs(Math.max(Pt.x,Pt.y))}class Lt extends T{constructor(t=new yt,e=new bt({color:0xffffff*Math.random()})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,r=new Float32Array(2*e.count);for(let a=0,o=0,s=e.count;a<s;a++,o+=2)wt.fromBufferAttribute(e,a),Ut.fromBufferAttribute(n,a),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+wt.distanceTo(Ut);const i=new y(r,2,1);return t.setAttribute("instanceDistanceStart",new x(i,1,0)),t.setAttribute("instanceDistanceEnd",new x(i,1,1)),this}raycast(t,e){const n=this.material.worldUnits,r=t.camera,i=void 0!==t.params.Line2&&t.params.Line2.threshold||0;Rt=t.ray;const a=this.matrixWorld,o=this.geometry,s=this.material;let l,c;if(Ot=s.linewidth+i,null===o.boundingSphere&&o.computeBoundingSphere(),Dt.copy(o.boundingSphere).applyMatrix4(a),n)l=.5*Ot;else{l=It(r,Math.max(r.near,Dt.distanceToPoint(Rt.origin)),s.resolution)}if(Dt.radius+=l,!1!==Rt.intersectsSphere(Dt)){if(null===o.boundingBox&&o.computeBoundingBox(),Mt.copy(o.boundingBox).applyMatrix4(a),n)c=.5*Ot;else{c=It(r,Math.max(r.near,Mt.distanceToPoint(Rt.origin)),s.resolution)}Mt.expandByScalar(c),!1!==Rt.intersectsBox(Mt)&&(n?function(t,e){const n=t.matrixWorld,r=t.geometry,i=r.attributes.instanceStart,a=r.attributes.instanceEnd;for(let o=0,s=Math.min(r.instanceCount,i.count);o<s;o++){Ft.start.fromBufferAttribute(i,o),Ft.end.fromBufferAttribute(a,o),Ft.applyMatrix4(n);const r=new f,s=new f;Rt.distanceSqToSegment(Ft.start,Ft.end,s,r),s.distanceTo(r)<.5*Ot&&e.push({point:s,pointOnLine:r,distance:Rt.origin.distanceTo(s),object:t,face:null,faceIndex:o,uv:null,[vt]:null})}}(this,e):function(t,e,n){const r=e.projectionMatrix,i=t.material.resolution,a=t.matrixWorld,o=t.geometry,s=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,s.count),u=-e.near;Rt.at(1,Tt),Tt.w=1,Tt.applyMatrix4(e.matrixWorldInverse),Tt.applyMatrix4(r),Tt.multiplyScalar(1/Tt.w),Tt.x*=i.x/2,Tt.y*=i.y/2,Tt.z=0,Ct.copy(Tt),Et.multiplyMatrices(e.matrixWorldInverse,a);for(let d=0,h=c;d<h;d++){if(_t.fromBufferAttribute(s,d),kt.fromBufferAttribute(l,d),_t.w=1,kt.w=1,_t.applyMatrix4(Et),kt.applyMatrix4(Et),_t.z>u&&kt.z>u)continue;if(_t.z>u){const t=_t.z-kt.z,e=(_t.z-u)/t;_t.lerp(kt,e)}else if(kt.z>u){const t=kt.z-_t.z,e=(kt.z-u)/t;kt.lerp(_t,e)}_t.applyMatrix4(r),kt.applyMatrix4(r),_t.multiplyScalar(1/_t.w),kt.multiplyScalar(1/kt.w),_t.x*=i.x/2,_t.y*=i.y/2,kt.x*=i.x/2,kt.y*=i.y/2,Ft.start.copy(_t),Ft.start.z=0,Ft.end.copy(kt),Ft.end.z=0;const e=Ft.closestPointToPointParameter(Ct,!0);Ft.at(e,At);const o=A.lerp(_t.z,kt.z,e),c=o>=-1&&o<=1,h=Ct.distanceTo(At)<.5*Ot;if(c&&h){Ft.start.fromBufferAttribute(s,d),Ft.end.fromBufferAttribute(l,d),Ft.start.applyMatrix4(a),Ft.end.applyMatrix4(a);const e=new f,r=new f;Rt.distanceSqToSegment(Ft.start,Ft.end,r,e),n.push({point:r,pointOnLine:e,distance:Rt.origin.distanceTo(r),object:t,face:null,faceIndex:d,uv:null,[vt]:null})}}}(this,r,e))}}onBeforeRender(t){const e=this.material.uniforms;e&&e.resolution&&(t.getViewport(St),this.material.uniforms.resolution.value.set(St.z,St.w))}}class Bt extends Lt{constructor(t=new xt,e=new bt({color:0xffffff*Math.random()})){super(t,e),this.isLine2=!0,this.type="Line2"}}const Gt=r.forwardRef(function({points:t,color:e=0xffffff,vertexColors:n,linewidth:i,lineWidth:a,segments:o,dashed:l,...u},h){var p,v;const g=s(t=>t.size),m=r.useMemo(()=>o?new Lt:new Bt,[o]),[y]=r.useState(()=>new bt),x=4===(null==n||null==(p=n[0])?void 0:p.length)?4:3,b=r.useMemo(()=>{const r=o?new yt:new xt,i=t.map(t=>{const e=Array.isArray(t);return t instanceof f||t instanceof C?[t.x,t.y,t.z]:t instanceof d?[t.x,t.y,0]:e&&3===t.length?[t[0],t[1],t[2]]:e&&2===t.length?[t[0],t[1],0]:t});if(r.setPositions(i.flat()),n){e=0xffffff;const t=n.map(t=>t instanceof M?t.toArray():t);r.setColors(t.flat(),x)}return r},[t,o,n,x]);return r.useLayoutEffect(()=>{m.computeLineDistances()},[t,m]),r.useLayoutEffect(()=>{l?y.defines.USE_DASH="":delete y.defines.USE_DASH,y.needsUpdate=!0},[l,y]),r.useEffect(()=>()=>{b.dispose(),y.dispose()},[b]),r.createElement("primitive",c({object:m,ref:h},u),r.createElement("primitive",{object:b,attach:"geometry"}),r.createElement("primitive",c({object:y,attach:"material",color:e,vertexColors:Boolean(n),resolution:[g.width,g.height],linewidth:null!==(v=null!=i?i:a)&&void 0!==v?v:1,dashed:l,transparent:4===x},u)))});function zt(){var t=Object.create(null);function e(r,i){var a=r.id,o=r.name,s=r.dependencies;void 0===s&&(s=[]);var l=r.init;void 0===l&&(l=function(){});var c=r.getTransferables;if(void 0===c&&(c=null),!t[a])try{s=s.map(function(n){return n&&n.isWorkerModule&&(e(n,function(t){if(t instanceof Error)throw t}),n=t[n.id].value),n}),l=n("<"+o+">.init",l),c&&(c=n("<"+o+">.getTransferables",c));var u=null;"function"==typeof l&&(u=l.apply(void 0,s)),t[a]={id:a,value:u,getTransferables:c},i(u)}catch(f){!f||f.noLog,i(f)}}function n(t,e){var n=void 0;self.troikaDefine=function(t){return n=t};var r=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+e+"\n)"],{type:"application/javascript"}));try{importScripts(r)}catch(i){}return URL.revokeObjectURL(r),delete self.troikaDefine,n}self.addEventListener("message",function(n){var r=n.data,i=r.messageId,a=r.action,o=r.data;try{"registerModule"===a&&e(o,function(t){t instanceof Error?postMessage({messageId:i,success:!1,error:t.message}):postMessage({messageId:i,success:!0,result:{isCallable:"function"==typeof t}})}),"callModule"===a&&function(e,n){var r,i=e.id,a=e.args;t[i]&&"function"==typeof t[i].value||n(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var o=(r=t[i]).value.apply(r,a);o&&"function"==typeof o.then?o.then(s,function(t){return n(t instanceof Error?t:new Error(""+t))}):s(o)}catch(l){n(l)}function s(e){try{var r=t[i].getTransferables&&t[i].getTransferables(e);r&&Array.isArray(r)&&r.length||(r=void 0),n(e,r)}catch(l){n(l)}}}(o,function(t,e){t instanceof Error?postMessage({messageId:i,success:!1,error:t.message}):postMessage({messageId:i,success:!0,result:t},e||void 0)})}catch(s){postMessage({messageId:i,success:!1,error:s.stack})}})}var jt=function(){var t=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),t=!0}catch(e){}return jt=function(){return t},t},Wt=0,Nt=0,Vt=!1,Ht=Object.create(null),qt=Object.create(null),$t=Object.create(null);function Xt(t){if(!(t&&"function"==typeof t.init||Vt))throw new Error("requires `options.init` function");var e=t.dependencies,n=t.init,r=t.getTransferables,i=t.workerId,a=function(t){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(e){if("function"==typeof e)return e.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var n=t.dependencies,r=t.init;n=Array.isArray(n)?n.map(function(t){return t&&(t=t.onMainThread||t)._getInitResult&&(t=t._getInitResult()),t}):[];var i=Promise.all(n).then(function(t){return r.apply(null,t)});return e._getInitResult=function(){return i},i},e}(t);null==i&&(i="#default");var o="workerModule"+ ++Wt,s=t.name||o,l=null;function c(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(!jt())return a.apply(void 0,t);if(!l){l=Kt(i,"registerModule",c.workerModuleData);var n=function(){l=null,qt[i].delete(n)};(qt[i]||(qt[i]=new Set)).add(n)}return l.then(function(e){if(e.isCallable)return Kt(i,"callModule",{id:o,args:t});throw new Error("Worker module function was called but `init` did not return a callable function")})}return e=e&&e.map(function(t){return"function"!=typeof t||t.workerModuleData||(Vt=!0,t=Xt({workerId:i,name:"<"+s+"> function dependency: "+t.name,init:"function(){return (\n"+Yt(t)+"\n)}"}),Vt=!1),t&&t.workerModuleData&&(t=t.workerModuleData),t}),c.workerModuleData={isWorkerModule:!0,id:o,name:s,dependencies:e,init:Yt(n),getTransferables:r&&Yt(r)},c.onMainThread=a,c}function Yt(t){var e=t.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function Kt(t,e,n){return new Promise(function(r,i){var a=++Nt;$t[a]=function(t){t.success?r(t.result):i(new Error("Error in worker "+e+" call: "+t.error))},function(t){var e=Ht[t];if(!e){var n=Yt(zt);(e=Ht[t]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+t.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(t){var e=t.data,n=e.messageId,r=$t[n];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete $t[n],r(e)}}return e}(t).postMessage({messageId:a,action:e,data:n})})}function Zt(){var t=function(t){function e(t,e,n,r,i,a,o,s){var l=1-o;s.x=l*l*t+2*l*o*n+o*o*i,s.y=l*l*e+2*l*o*r+o*o*a}function n(t,e,n,r,i,a,o,s,l,c){var u=1-l;c.x=u*u*u*t+3*u*u*l*n+3*u*l*l*i+l*l*l*o,c.y=u*u*u*e+3*u*u*l*r+3*u*l*l*a+l*l*l*s}function r(t,e){for(var n,r,i,a,o,s=/([MLQCZ])([^MLQCZ]*)/g;n=s.exec(t);){var l=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(t){return parseFloat(t)});switch(n[1]){case"M":a=r=l[0],o=i=l[1];break;case"L":l[0]===a&&l[1]===o||e("L",a,o,a=l[0],o=l[1]);break;case"Q":e("Q",a,o,a=l[2],o=l[3],l[0],l[1]);break;case"C":e("C",a,o,a=l[4],o=l[5],l[0],l[1],l[2],l[3]);break;case"Z":a===r&&o===i||e("L",a,o,r,i)}}}function i(t,i,a){void 0===a&&(a=16);var o={x:0,y:0};r(t,function(t,r,s,l,c,u,f,d,h){switch(t){case"L":i(r,s,l,c);break;case"Q":for(var p=r,v=s,g=1;g<a;g++)e(r,s,u,f,l,c,g/(a-1),o),i(p,v,o.x,o.y),p=o.x,v=o.y;break;case"C":for(var m=r,y=s,x=1;x<a;x++)n(r,s,u,f,d,h,l,c,x/(a-1),o),i(m,y,o.x,o.y),m=o.x,y=o.y}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o=new WeakMap,s={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(t,e){var n=t.getContext?t.getContext("webgl",s):t,r=o.get(n);if(!r){var i="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,a={},l={},c={},u=-1,f=[];function d(t){var e=a[t];if(!e&&!(e=a[t]=n.getExtension(t)))throw new Error(t+" not supported");return e}function h(t,e){var r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}function p(t,e,r,a){if(!l[t]){var o={},s={},c=n.createProgram();n.attachShader(c,h(e,n.VERTEX_SHADER)),n.attachShader(c,h(r,n.FRAGMENT_SHADER)),n.linkProgram(c),l[t]={program:c,transaction:function(t){n.useProgram(c),t({setUniform:function(t,e){for(var r=[],i=arguments.length-2;i-- >0;)r[i]=arguments[i+2];var a=s[e]||(s[e]=n.getUniformLocation(c,e));n["uniform"+t].apply(n,[a].concat(r))},setAttribute:function(t,e,r,a,s){var l=o[t];l||(l=o[t]={buf:n.createBuffer(),loc:n.getAttribLocation(c,t),data:null}),n.bindBuffer(n.ARRAY_BUFFER,l.buf),n.vertexAttribPointer(l.loc,e,n.FLOAT,!1,0,0),n.enableVertexAttribArray(l.loc),i?n.vertexAttribDivisor(l.loc,a):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,a),s!==l.data&&(n.bufferData(n.ARRAY_BUFFER,s,r),l.data=s)}})}}}l[t].transaction(a)}function v(t,e){u++;try{n.activeTexture(n.TEXTURE0+u);var r=c[t];r||(r=c[t]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,r),e(r,u)}finally{u--}}function g(t,e,r){var i=n.createFramebuffer();f.push(i),n.bindFramebuffer(n.FRAMEBUFFER,i),n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);try{r(i)}finally{n.deleteFramebuffer(i),n.bindFramebuffer(n.FRAMEBUFFER,f[--f.length-1]||null)}}function m(){a={},l={},c={},u=-1,f.length=0}n.canvas.addEventListener("webglcontextlost",function(t){m(),t.preventDefault()},!1),o.set(n,r={gl:n,isWebGL2:i,getExtension:d,withProgram:p,withTexture:v,withTextureFramebuffer:g,handleContextLoss:m})}e(r)}function c(t,e,n,r,i,o,s,c){void 0===s&&(s=15),void 0===c&&(c=null),l(t,function(t){var l=t.gl,u=t.withProgram;(0,t.withTexture)("copy",function(t,f){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,i,o,0,l.RGBA,l.UNSIGNED_BYTE,e),u("copy",a,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(t){var e=t.setUniform;(0,t.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),e("1i","image",f),l.bindFramebuffer(l.FRAMEBUFFER,c||null),l.disable(l.BLEND),l.colorMask(8&s,4&s,2&s,1&s),l.viewport(n,r,i,o),l.scissor(n,r,i,o),l.drawArrays(l.TRIANGLES,0,3)})})})}var u=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:c,resizeWebGLCanvasWithoutClearing:function(t,e,n){var r=t.width,i=t.height;l(t,function(a){var o=a.gl,s=new Uint8Array(r*i*4);o.readPixels(0,0,r,i,o.RGBA,o.UNSIGNED_BYTE,s),t.width=e,t.height=n,c(o,s,0,0,r,i)})}});function f(t,e,n,r,a,o){void 0===o&&(o=1);var s=new Uint8Array(t*e),l=r[2]-r[0],c=r[3]-r[1],u=[];i(n,function(t,e,n,r){u.push({x1:t,y1:e,x2:n,y2:r,minX:Math.min(t,n),minY:Math.min(e,r),maxX:Math.max(t,n),maxY:Math.max(e,r)})}),u.sort(function(t,e){return t.maxX-e.maxX});for(var f=0;f<t;f++)for(var d=0;d<e;d++){var h=g(r[0]+l*(f+.5)/t,r[1]+c*(d+.5)/e),v=Math.pow(1-Math.abs(h)/a,o)/2;h<0&&(v=1-v),v=Math.max(0,Math.min(255,Math.round(255*v))),s[d*t+f]=v}return s;function g(t,e){for(var n=1/0,r=1/0,i=u.length;i--;){var a=u[i];if(a.maxX+r<=t)break;if(t+r>a.minX&&e-r<a.maxY&&e+r>a.minY){var o=p(t,e,a.x1,a.y1,a.x2,a.y2);o<n&&(n=o,r=Math.sqrt(n))}}return function(t,e){for(var n=0,r=u.length;r--;){var i=u[r];if(i.maxX<=t)break;i.y1>e!=i.y2>e&&t<(i.x2-i.x1)*(e-i.y1)/(i.y2-i.y1)+i.x1&&(n+=i.y1<i.y2?1:-1)}return 0!==n}(t,e)&&(r=-r),r}}function d(t,e,n,r,i,a,o,s,l,c){void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),h(t,e,n,r,i,a,o,null,s,l,c)}function h(t,e,n,r,i,a,o,s,l,u,d){void 0===a&&(a=1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===d&&(d=0);for(var h=f(t,e,n,r,i,a),p=new Uint8Array(4*h.length),v=0;v<h.length;v++)p[4*v+d]=h[v];c(o,p,l,u,t,e,1<<3-d,s)}function p(t,e,n,r,i,a){var o=i-n,s=a-r,l=o*o+s*s,c=l?Math.max(0,Math.min(1,((t-n)*o+(e-r)*s)/l)):0,u=t-(n+c*o),f=e-(r+c*s);return u*u+f*f}var v=Object.freeze({__proto__:null,generate:f,generateIntoCanvas:d,generateIntoFramebuffer:h}),g=new Float32Array([0,0,2,0,0,2]),m=null,y=!1,x={},b=new WeakMap;function S(t){if(!y&&!k(t))throw new Error("WebGL generation not supported")}function w(t,e,n,r,i,a,o){if(void 0===a&&(a=1),void 0===o&&(o=null),!o&&!(o=m)){var s="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!s)throw new Error("OffscreenCanvas or DOM canvas not supported");o=m=s.getContext("webgl",{depth:!1})}S(o);var c=new Uint8Array(t*e*4);l(o,function(o){var s=o.gl,l=o.withTexture,u=o.withTextureFramebuffer;l("readable",function(o,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,s.UNSIGNED_BYTE,null),u(o,l,function(o){_(t,e,n,r,i,a,s,o,0,0,0),s.readPixels(0,0,t,e,s.RGBA,s.UNSIGNED_BYTE,c)})})});for(var u=new Uint8Array(t*e),f=0,d=0;f<c.length;f+=4)u[d++]=c[f];return u}function U(t,e,n,r,i,a,o,s,l,c){void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),_(t,e,n,r,i,a,o,null,s,l,c)}function _(t,e,n,r,o,s,c,u,f,d,h){void 0===s&&(s=1),void 0===f&&(f=0),void 0===d&&(d=0),void 0===h&&(h=0),S(c);var p=[];i(n,function(t,e,n,r){p.push(t,e,n,r)}),p=new Float32Array(p),l(c,function(n){var i=n.gl,l=n.isWebGL2,c=n.getExtension,v=n.withProgram,m=n.withTexture,y=n.withTextureFramebuffer,x=n.handleContextLoss;if(m("rawDistances",function(n,m){t===n._lastWidth&&e===n._lastHeight||i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n._lastWidth=t,n._lastHeight=e,0,i.RGBA,i.UNSIGNED_BYTE,null),v("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(a){var u=a.setAttribute,f=a.setUniform,d=!l&&c("ANGLE_instanced_arrays"),h=!l&&c("EXT_blend_minmax");u("aUV",2,i.STATIC_DRAW,0,g),u("aLineSegment",4,i.DYNAMIC_DRAW,1,p),f.apply(void 0,["4f","uGlyphBounds"].concat(r)),f("1f","uMaxDistance",o),f("1f","uExponent",s),y(n,m,function(n){i.enable(i.BLEND),i.colorMask(!0,!0,!0,!0),i.viewport(0,0,t,e),i.scissor(0,0,t,e),i.blendFunc(i.ONE,i.ONE),i.blendEquationSeparate(i.FUNC_ADD,l?i.MAX:h.MAX_EXT),i.clear(i.COLOR_BUFFER_BIT),l?i.drawArraysInstanced(i.TRIANGLES,0,3,p.length/4):d.drawArraysInstancedANGLE(i.TRIANGLES,0,3,p.length/4)})}),v("post",a,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(n){n.setAttribute("aUV",2,i.STATIC_DRAW,0,g),n.setUniform("1i","tex",m),i.bindFramebuffer(i.FRAMEBUFFER,u),i.disable(i.BLEND),i.colorMask(0===h,1===h,2===h,3===h),i.viewport(f,d,t,e),i.scissor(f,d,t,e),i.drawArrays(i.TRIANGLES,0,3)})}),i.isContextLost())throw x(),new Error("webgl context lost")})}function k(t){var e=t&&t!==m?t.canvas||t:x,n=b.get(e);if(void 0===n){y=!0;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],i=w(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,t);(n=i&&r.length===i.length&&i.every(function(t,e){return t===r[e]}))||"bad trial run results"}catch(a){n=!1,a.message}y=!1,b.set(e,n)}return n}var T=Object.freeze({__proto__:null,generate:w,generateIntoCanvas:U,generateIntoFramebuffer:_,isSupported:k});return t.forEachPathCommand=r,t.generate=function(t,e,n,r,i,a){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===a&&(a=1);try{return w.apply(T,arguments)}catch(o){return f.apply(v,arguments)}},t.generateIntoCanvas=function(t,e,n,r,i,a,o,s,l,c){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return U.apply(T,arguments)}catch(u){return d.apply(v,arguments)}},t.javascript=v,t.pathToLineSegments=i,t.webgl=T,t.webglUtils=u,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return t}const Jt=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Qt(t){return t.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(t,e){let n=O[e];return n?Qt(n):t})}const te=[];for(let bn=0;bn<256;bn++)te[bn]=(bn<16?"0":"")+bn.toString(16);const ee=Object.assign||function(){let t=arguments[0];for(let e=1,n=arguments.length;e<n;e++){let n=arguments[e];if(n)for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},ne=Date.now(),re=new WeakMap,ie=new Map;let ae=1e10;function oe(t,e){const n=function(t){const e=JSON.stringify(t,le);let n=ue.get(e);null==n&&ue.set(e,n=++ce);return n}(e);let r=re.get(t);if(r||re.set(t,r=Object.create(null)),r[n])return new r[n];const i=`_onBeforeCompile${n}`,a=function(r,a){t.onBeforeCompile.call(this,r,a);const o=this.customProgramCacheKey()+"|"+r.vertexShader+"|"+r.fragmentShader;let s=ie[o];if(!s){const t=function(t,{vertexShader:e,fragmentShader:n},r,i){let{vertexDefs:a,vertexMainIntro:o,vertexMainOutro:s,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:p}=r;a=a||"",o=o||"",s=s||"",c=c||"",u=u||"",f=f||"",(l||h)&&(e=Qt(e));(d||h)&&(n=Qt(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(h){let t=h({vertexShader:e,fragmentShader:n});e=t.vertexShader,n=t.fragmentShader}if(d){let t=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,e=>(t.push(e),"")),f=`${d}
${t.join("\n")}
${f}`}if(p){const t=`
uniform float ${p};
`;a=t+a,c=t+c}l&&(a=`${a}
void troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,o=`
troika_position_${i} = vec3(position);
troika_normal_${i} = vec3(normal);
troika_uv_${i} = vec2(uv);
troikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});
${o}
`,e=(e=`vec3 troika_position_${i};
vec3 troika_normal_${i};
vec2 troika_uv_${i};
${e}
`).replace(/\b(position|normal|uv)\b/g,(t,e,n,r)=>/\battribute\s+vec[23]\s+$/.test(r.substr(0,n))?e:`troika_${e}_${i}`),t.map&&t.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${i}`)));return e=se(e,i,a,o,s),n=se(n,i,c,u,f),{vertexShader:e,fragmentShader:n}}(this,r,e,n);s=ie[o]=t}r.vertexShader=s.vertexShader,r.fragmentShader=s.fragmentShader,ee(r.uniforms,this.uniforms),e.timeUniform&&(r.uniforms[e.timeUniform]={get value(){return Date.now()-ne}}),this[i]&&this[i](r)},o=function(){return s(e.chained?t:t.clone())},s=function(r){const i=Object.create(r,l);return Object.defineProperty(i,"baseMaterial",{value:t}),Object.defineProperty(i,"id",{value:ae++}),i.uuid=function(){const t=0xffffffff*Math.random()|0,e=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0;return(te[255&t]+te[t>>8&255]+te[t>>16&255]+te[t>>24&255]+"-"+te[255&e]+te[e>>8&255]+"-"+te[e>>16&15|64]+te[e>>24&255]+"-"+te[63&n|128]+te[n>>8&255]+"-"+te[n>>16&255]+te[n>>24&255]+te[255&r]+te[r>>8&255]+te[r>>16&255]+te[r>>24&255]).toUpperCase()}(),i.uniforms=ee({},r.uniforms,e.uniforms),i.defines=ee({},r.defines,e.defines),i.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",i.extensions=ee({},r.extensions,e.extensions),i._listeners=void 0,i},l={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>t.type,set:e=>{t.type=e}},isDerivedFrom:{writable:!0,configurable:!0,value:function(t){const e=this.baseMaterial;return t===e||e.isDerivedMaterial&&e.isDerivedFrom(t)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>a,set(t){this[i]=t}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(ee(this.extensions,e.extensions),ee(this.defines,e.defines),ee(this.uniforms,_.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const e=new t.constructor;return s(e).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=oe(t.isDerivedMaterial?t.getDepthMaterial():new P({depthPacking:R}),e),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=oe(t.isDerivedMaterial?t.getDistanceMaterial():new D,e),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:e,_distanceMaterial:n}=this;e&&e.dispose(),n&&n.dispose(),t.dispose.call(this)}}};return r[n]=o,new o}function se(t,e,n,r,i){return(r||i||n)&&(t=t.replace(Jt,`
${n}
void troikaOrigMain${e}() {`),t+=`
void main() {
  ${r}
  troikaOrigMain${e}();
  ${i}
}`),t}function le(t,e){return"uniforms"===t?void 0:"function"==typeof e?e.toString():e}let ce=0;const ue=new Map;const fe=Xt({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(t){var e={parse:function(t){var n=e._bin,r=new Uint8Array(t);if("ttcf"==n.readASCII(r,0,4)){var i=4;n.readUshort(r,i),i+=2,n.readUshort(r,i),i+=2;var a=n.readUint(r,i);i+=4;for(var o=[],s=0;s<a;s++){var l=n.readUint(r,i);i+=4,o.push(e._readFont(r,l))}return o}return[e._readFont(r,0)]},_readFont:function(t,n){var r=e._bin,i=n;r.readFixed(t,n),n+=4;var a=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},l={},c=0;c<a;c++){var u=r.readASCII(t,n,4);n+=4,r.readUint(t,n),n+=4;var f=r.readUint(t,n);n+=4;var d=r.readUint(t,n);n+=4,l[u]={offset:f,length:d}}for(c=0;c<o.length;c++){var h=o[c];l[h]&&(s[h.trim()]=e[h.trim()].parse(t,l[h].offset,l[h].length,s))}return s},_tabOffset:function(t,n,r){for(var i=e._bin,a=i.readUshort(t,r+4),o=r+12,s=0;s<a;s++){var l=i.readASCII(t,o,4);o+=4,i.readUint(t,o),o+=4;var c=i.readUint(t,o);if(o+=4,i.readUint(t,o),o+=4,l==n)return c}return 0}};e._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,n){return e._bin.readShort(t,n)/16384},readInt:function(t,n){return e._bin._view(t).getInt32(n)},readInt8:function(t,n){return e._bin._view(t).getInt8(n)},readShort:function(t,n){return e._bin._view(t).getInt16(n)},readUshort:function(t,n){return e._bin._view(t).getUint16(n)},readUshorts:function(t,n,r){for(var i=[],a=0;a<r;a++)i.push(e._bin.readUshort(t,n+2*a));return i},readUint:function(t,n){return e._bin._view(t).getUint32(n)},readUint64:function(t,n){return 0x100000000*e._bin.readUint(t,n)+e._bin.readUint(t,n+4)},readASCII:function(t,e,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(t[e+i]);return r},readUnicode:function(t,e,n){for(var r="",i=0;i<n;i++){var a=t[e++]<<8|t[e++];r+=String.fromCharCode(a)}return r},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,n,r){var i=e._bin._tdec;return i&&0==n&&r==t.length?i.decode(t):e._bin.readASCII(t,n,r)},readBytes:function(t,e,n){for(var r=[],i=0;i<n;i++)r.push(t[e+i]);return r},readASCIIArray:function(t,e,n){for(var r=[],i=0;i<n;i++)r.push(String.fromCharCode(t[e+i]));return r},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},e._lctf={},e._lctf.parse=function(t,n,r,i,a){var o=e._bin,s={},l=n;o.readFixed(t,n),n+=4;var c=o.readUshort(t,n);n+=2;var u=o.readUshort(t,n);n+=2;var f=o.readUshort(t,n);return n+=2,s.scriptList=e._lctf.readScriptList(t,l+c),s.featureList=e._lctf.readFeatureList(t,l+u),s.lookupList=e._lctf.readLookupList(t,l+f,a),s},e._lctf.readLookupList=function(t,n,r){var i=e._bin,a=n,o=[],s=i.readUshort(t,n);n+=2;for(var l=0;l<s;l++){var c=i.readUshort(t,n);n+=2;var u=e._lctf.readLookupTable(t,a+c,r);o.push(u)}return o},e._lctf.readLookupTable=function(t,n,r){var i=e._bin,a=n,o={tabs:[]};o.ltype=i.readUshort(t,n),n+=2,o.flag=i.readUshort(t,n),n+=2;var s=i.readUshort(t,n);n+=2;for(var l=o.ltype,c=0;c<s;c++){var u=i.readUshort(t,n);n+=2;var f=r(t,l,a+u,o);o.tabs.push(f)}return o},e._lctf.numOfOnes=function(t){for(var e=0,n=0;n<32;n++)t>>>n&1&&e++;return e},e._lctf.readClassDef=function(t,n){var r=e._bin,i=[],a=r.readUshort(t,n);if(n+=2,1==a){var o=r.readUshort(t,n);n+=2;var s=r.readUshort(t,n);n+=2;for(var l=0;l<s;l++)i.push(o+l),i.push(o+l),i.push(r.readUshort(t,n)),n+=2}if(2==a){var c=r.readUshort(t,n);for(n+=2,l=0;l<c;l++)i.push(r.readUshort(t,n)),n+=2,i.push(r.readUshort(t,n)),n+=2,i.push(r.readUshort(t,n)),n+=2}return i},e._lctf.getInterval=function(t,e){for(var n=0;n<t.length;n+=3){var r=t[n],i=t[n+1];if(t[n+2],r<=e&&e<=i)return n}return-1},e._lctf.readCoverage=function(t,n){var r=e._bin,i={};i.fmt=r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);return n+=2,1==i.fmt&&(i.tab=r.readUshorts(t,n,a)),2==i.fmt&&(i.tab=r.readUshorts(t,n,3*a)),i},e._lctf.coverageIndex=function(t,n){var r=t.tab;if(1==t.fmt)return r.indexOf(n);if(2==t.fmt){var i=e._lctf.getInterval(r,n);if(-1!=i)return r[i+2]+(n-r[i])}return-1},e._lctf.readFeatureList=function(t,n){var r=e._bin,i=n,a=[],o=r.readUshort(t,n);n+=2;for(var s=0;s<o;s++){var l=r.readASCII(t,n,4);n+=4;var c=r.readUshort(t,n);n+=2;var u=e._lctf.readFeatureTable(t,i+c);u.tag=l.trim(),a.push(u)}return a},e._lctf.readFeatureTable=function(t,n){var r=e._bin,i=n,a={},o=r.readUshort(t,n);n+=2,o>0&&(a.featureParams=i+o);var s=r.readUshort(t,n);n+=2,a.tab=[];for(var l=0;l<s;l++)a.tab.push(r.readUshort(t,n+2*l));return a},e._lctf.readScriptList=function(t,n){var r=e._bin,i=n,a={},o=r.readUshort(t,n);n+=2;for(var s=0;s<o;s++){var l=r.readASCII(t,n,4);n+=4;var c=r.readUshort(t,n);n+=2,a[l.trim()]=e._lctf.readScriptTable(t,i+c)}return a},e._lctf.readScriptTable=function(t,n){var r=e._bin,i=n,a={},o=r.readUshort(t,n);n+=2,o>0&&(a.default=e._lctf.readLangSysTable(t,i+o));var s=r.readUshort(t,n);n+=2;for(var l=0;l<s;l++){var c=r.readASCII(t,n,4);n+=4;var u=r.readUshort(t,n);n+=2,a[c.trim()]=e._lctf.readLangSysTable(t,i+u)}return a},e._lctf.readLangSysTable=function(t,n){var r=e._bin,i={};r.readUshort(t,n),n+=2,i.reqFeature=r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);return n+=2,i.features=r.readUshorts(t,n,a),i},e.CFF={},e.CFF.parse=function(t,n,r){var i=e._bin;(t=new Uint8Array(t.buffer,n,r))[n=0],t[++n],t[++n],t[++n],n++;var a=[];n=e.CFF.readIndex(t,n,a);for(var o=[],s=0;s<a.length-1;s++)o.push(i.readASCII(t,n+a[s],a[s+1]-a[s]));n+=a[a.length-1];var l=[];n=e.CFF.readIndex(t,n,l);var c=[];for(s=0;s<l.length-1;s++)c.push(e.CFF.readDict(t,n+l[s],n+l[s+1]));n+=l[l.length-1];var u=c[0],f=[];n=e.CFF.readIndex(t,n,f);var d=[];for(s=0;s<f.length-1;s++)d.push(i.readASCII(t,n+f[s],f[s+1]-f[s]));if(n+=f[f.length-1],e.CFF.readSubrs(t,n,u),u.CharStrings){n=u.CharStrings,f=[],n=e.CFF.readIndex(t,n,f);var h=[];for(s=0;s<f.length-1;s++)h.push(i.readBytes(t,n+f[s],f[s+1]-f[s]));u.CharStrings=h}if(u.ROS){n=u.FDArray;var p=[];for(n=e.CFF.readIndex(t,n,p),u.FDArray=[],s=0;s<p.length-1;s++){var v=e.CFF.readDict(t,n+p[s],n+p[s+1]);e.CFF._readFDict(t,v,d),u.FDArray.push(v)}n+=p[p.length-1],n=u.FDSelect,u.FDSelect=[];var g=t[n];if(n++,3!=g)throw g;var m=i.readUshort(t,n);for(n+=2,s=0;s<m+1;s++)u.FDSelect.push(i.readUshort(t,n),t[n+2]),n+=3}return u.Encoding&&(u.Encoding=e.CFF.readEncoding(t,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=e.CFF.readCharset(t,u.charset,u.CharStrings.length)),e.CFF._readFDict(t,u,d),u},e.CFF._readFDict=function(t,n,r){var i;for(var a in n.Private&&(i=n.Private[1],n.Private=e.CFF.readDict(t,i,i+n.Private[0]),n.Private.Subrs&&e.CFF.readSubrs(t,i+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(a)&&(n[a]=r[n[a]-426+35])},e.CFF.readSubrs=function(t,n,r){var i=e._bin,a=[];n=e.CFF.readIndex(t,n,a);var o,s=a.length;o=s<1240?107:s<33900?1131:32768,r.Bias=o,r.Subrs=[];for(var l=0;l<a.length-1;l++)r.Subrs.push(i.readBytes(t,n+a[l],a[l+1]-a[l]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(t,e){for(var n=0;n<t.charset.length;n++)if(t.charset[n]==e)return n;return-1},e.CFF.glyphBySE=function(t,n){return n<0||n>255?-1:e.CFF.glyphByUnicode(t,e.CFF.tableSE[n])},e.CFF.readEncoding=function(t,n,r){e._bin;var i=[".notdef"],a=t[n];if(n++,0!=a)throw"error: unknown encoding format: "+a;var o=t[n];n++;for(var s=0;s<o;s++)i.push(t[n+s]);return i},e.CFF.readCharset=function(t,n,r){var i=e._bin,a=[".notdef"],o=t[n];if(n++,0==o)for(var s=0;s<r;s++){var l=i.readUshort(t,n);n+=2,a.push(l)}else{if(1!=o&&2!=o)throw"error: format: "+o;for(;a.length<r;){l=i.readUshort(t,n),n+=2;var c=0;for(1==o?(c=t[n],n++):(c=i.readUshort(t,n),n+=2),s=0;s<=c;s++)a.push(l),l++}}return a},e.CFF.readIndex=function(t,n,r){var i=e._bin,a=i.readUshort(t,n)+1,o=t[n+=2];if(n++,1==o)for(var s=0;s<a;s++)r.push(t[n+s]);else if(2==o)for(s=0;s<a;s++)r.push(i.readUshort(t,n+2*s));else if(3==o)for(s=0;s<a;s++)r.push(0xffffff&i.readUint(t,n+3*s-1));else if(1!=a)throw"unsupported offset size: "+o+", count: "+a;return(n+=a*o)-1},e.CFF.getCharString=function(t,n,r){var i=e._bin,a=t[n],o=t[n+1];t[n+2],t[n+3],t[n+4];var s=1,l=null,c=null;a<=20&&(l=a,s=1),12==a&&(l=100*a+o,s=2),21<=a&&a<=27&&(l=a,s=1),28==a&&(c=i.readShort(t,n+1),s=3),29<=a&&a<=31&&(l=a,s=1),32<=a&&a<=246&&(c=a-139,s=1),247<=a&&a<=250&&(c=256*(a-247)+o+108,s=2),251<=a&&a<=254&&(c=256*-(a-251)-o-108,s=2),255==a&&(c=i.readInt(t,n+1)/65535,s=5),r.val=null!=c?c:"o"+l,r.size=s},e.CFF.readCharString=function(t,n,r){for(var i=n+r,a=e._bin,o=[];n<i;){var s=t[n],l=t[n+1];t[n+2],t[n+3],t[n+4];var c=1,u=null,f=null;s<=20&&(u=s,c=1),12==s&&(u=100*s+l,c=2),19!=s&&20!=s||(u=s,c=2),21<=s&&s<=27&&(u=s,c=1),28==s&&(f=a.readShort(t,n+1),c=3),29<=s&&s<=31&&(u=s,c=1),32<=s&&s<=246&&(f=s-139,c=1),247<=s&&s<=250&&(f=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(f=256*-(s-251)-l-108,c=2),255==s&&(f=a.readInt(t,n+1)/65535,c=5),o.push(null!=f?f:"o"+u),n+=c}return o},e.CFF.readDict=function(t,n,r){for(var i=e._bin,a={},o=[];n<r;){var s=t[n],l=t[n+1];t[n+2],t[n+3],t[n+4];var c=1,u=null,f=null;if(28==s&&(f=i.readShort(t,n+1),c=3),29==s&&(f=i.readInt(t,n+1),c=5),32<=s&&s<=246&&(f=s-139,c=1),247<=s&&s<=250&&(f=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(f=256*-(s-251)-l-108,c=2),255==s)throw f=i.readInt(t,n+1)/65535,c=5,"unknown number";if(30==s){var d=[];for(c=1;;){var h=t[n+c];c++;var p=h>>4,v=15&h;if(15!=p&&d.push(p),15!=v&&d.push(v),15==v)break}for(var g="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<d.length;y++)g+=m[d[y]];f=parseFloat(g)}s<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],c=1,12==s&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=u?(a[u]=1==o.length?o[0]:o,o=[]):o.push(f),n+=c}return a},e.cmap={},e.cmap.parse=function(t,n,r){t=new Uint8Array(t.buffer,n,r),n=0;var i=e._bin,a={};i.readUshort(t,n),n+=2;var o=i.readUshort(t,n);n+=2;var s=[];a.tables=[];for(var l=0;l<o;l++){var c=i.readUshort(t,n);n+=2;var u=i.readUshort(t,n);n+=2;var f=i.readUint(t,n);n+=4;var d="p"+c+"e"+u,h=s.indexOf(f);if(-1==h){var p;h=a.tables.length,s.push(f);var v=i.readUshort(t,f);0==v?p=e.cmap.parse0(t,f):4==v?p=e.cmap.parse4(t,f):6==v?p=e.cmap.parse6(t,f):12==v&&(p=e.cmap.parse12(t,f)),a.tables.push(p)}if(null!=a[d])throw"multiple tables for one platform+encoding";a[d]=h}return a},e.cmap.parse0=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2,i.map=[];for(var o=0;o<a-6;o++)i.map.push(t[n+o]);return i},e.cmap.parse4=function(t,n){var r=e._bin,i=n,a={};a.format=r.readUshort(t,n),n+=2;var o=r.readUshort(t,n);n+=2,r.readUshort(t,n),n+=2;var s=r.readUshort(t,n);n+=2;var l=s/2;a.searchRange=r.readUshort(t,n),n+=2,a.entrySelector=r.readUshort(t,n),n+=2,a.rangeShift=r.readUshort(t,n),n+=2,a.endCount=r.readUshorts(t,n,l),n+=2*l,n+=2,a.startCount=r.readUshorts(t,n,l),n+=2*l,a.idDelta=[];for(var c=0;c<l;c++)a.idDelta.push(r.readShort(t,n)),n+=2;for(a.idRangeOffset=r.readUshorts(t,n,l),n+=2*l,a.glyphIdArray=[];n<i+o;)a.glyphIdArray.push(r.readUshort(t,n)),n+=2;return a},e.cmap.parse6=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,r.readUshort(t,n),n+=2,i.firstCode=r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);n+=2,i.glyphIdArray=[];for(var o=0;o<a;o++)i.glyphIdArray.push(r.readUshort(t,n)),n+=2;return i},e.cmap.parse12=function(t,n){var r=e._bin,i={};i.format=r.readUshort(t,n),n+=2,n+=2,r.readUint(t,n),n+=4,r.readUint(t,n),n+=4;var a=r.readUint(t,n);n+=4,i.groups=[];for(var o=0;o<a;o++){var s=n+12*o,l=r.readUint(t,s+0),c=r.readUint(t,s+4),u=r.readUint(t,s+8);i.groups.push([l,c,u])}return i},e.glyf={},e.glyf.parse=function(t,e,n,r){for(var i=[],a=0;a<r.maxp.numGlyphs;a++)i.push(null);return i},e.glyf._parseGlyf=function(t,n){var r=e._bin,i=t._data,a=e._tabOffset(i,"glyf",t._offset)+t.loca[n];if(t.loca[n]==t.loca[n+1])return null;var o={};if(o.noc=r.readShort(i,a),a+=2,o.xMin=r.readShort(i,a),a+=2,o.yMin=r.readShort(i,a),a+=2,o.xMax=r.readShort(i,a),a+=2,o.yMax=r.readShort(i,a),a+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(r.readUshort(i,a)),a+=2;var l=r.readUshort(i,a);if(a+=2,i.length-a<l)return null;o.instructions=r.readBytes(i,a,l),a+=l;var c=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<c;s++){var u=i[a];if(a++,o.flags.push(u),8&u){var f=i[a];a++;for(var d=0;d<f;d++)o.flags.push(u),s++}}for(o.xs=[],s=0;s<c;s++){var h=!!(2&o.flags[s]),p=!!(16&o.flags[s]);h?(o.xs.push(p?i[a]:-i[a]),a++):p?o.xs.push(0):(o.xs.push(r.readShort(i,a)),a+=2)}for(o.ys=[],s=0;s<c;s++)h=!!(4&o.flags[s]),p=!!(32&o.flags[s]),h?(o.ys.push(p?i[a]:-i[a]),a++):p?o.ys.push(0):(o.ys.push(r.readShort(i,a)),a+=2);var v=0,g=0;for(s=0;s<c;s++)v+=o.xs[s],g+=o.ys[s],o.xs[s]=v,o.ys[s]=g}else{var m;o.parts=[];do{m=r.readUshort(i,a),a+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(y),y.glyphIndex=r.readUshort(i,a),a+=2,1&m){var x=r.readShort(i,a);a+=2;var b=r.readShort(i,a);a+=2}else x=r.readInt8(i,a),a++,b=r.readInt8(i,a),a++;2&m?(y.m.tx=x,y.m.ty=b):(y.p1=x,y.p2=b),8&m?(y.m.a=y.m.d=r.readF2dot14(i,a),a+=2):64&m?(y.m.a=r.readF2dot14(i,a),a+=2,y.m.d=r.readF2dot14(i,a),a+=2):128&m&&(y.m.a=r.readF2dot14(i,a),a+=2,y.m.b=r.readF2dot14(i,a),a+=2,y.m.c=r.readF2dot14(i,a),a+=2,y.m.d=r.readF2dot14(i,a),a+=2)}while(32&m);if(256&m){var S=r.readUshort(i,a);for(a+=2,o.instr=[],s=0;s<S;s++)o.instr.push(i[a]),a++}}return o},e.GDEF={},e.GDEF.parse=function(t,n,r,i){var a=n;n+=4;var o=e._bin.readUshort(t,n);return{glyphClassDef:0===o?null:e._lctf.readClassDef(t,a+o)}},e.GPOS={},e.GPOS.parse=function(t,n,r,i){return e._lctf.parse(t,n,r,i,e.GPOS.subt)},e.GPOS.subt=function(t,n,r,i){var a=e._bin,o=r,s={};if(s.fmt=a.readUshort(t,r),r+=2,1==n||2==n||3==n||7==n||8==n&&s.fmt<=2){var l=a.readUshort(t,r);r+=2,s.coverage=e._lctf.readCoverage(t,l+o)}if(1==n&&1==s.fmt){var c=a.readUshort(t,r);r+=2,0!=c&&(s.pos=e.GPOS.readValueRecord(t,r,c))}else if(2==n&&s.fmt>=1&&s.fmt<=2){c=a.readUshort(t,r),r+=2;var u=a.readUshort(t,r);r+=2;var f=e._lctf.numOfOnes(c),d=e._lctf.numOfOnes(u);if(1==s.fmt){s.pairsets=[];var h=a.readUshort(t,r);r+=2;for(var p=0;p<h;p++){var v=o+a.readUshort(t,r);r+=2;var g=a.readUshort(t,v);v+=2;for(var m=[],y=0;y<g;y++){var x=a.readUshort(t,v);v+=2,0!=c&&(k=e.GPOS.readValueRecord(t,v,c),v+=2*f),0!=u&&(T=e.GPOS.readValueRecord(t,v,u),v+=2*d),m.push({gid2:x,val1:k,val2:T})}s.pairsets.push(m)}}if(2==s.fmt){var b=a.readUshort(t,r);r+=2;var S=a.readUshort(t,r);r+=2;var w=a.readUshort(t,r);r+=2;var U=a.readUshort(t,r);for(r+=2,s.classDef1=e._lctf.readClassDef(t,o+b),s.classDef2=e._lctf.readClassDef(t,o+S),s.matrix=[],p=0;p<w;p++){var _=[];for(y=0;y<U;y++){var k=null,T=null;0!=c&&(k=e.GPOS.readValueRecord(t,r,c),r+=2*f),0!=u&&(T=e.GPOS.readValueRecord(t,r,u),r+=2*d),_.push({val1:k,val2:T})}s.matrix.push(_)}}}else if(4==n&&1==s.fmt)s.markCoverage=e._lctf.readCoverage(t,a.readUshort(t,r)+o),s.baseCoverage=e._lctf.readCoverage(t,a.readUshort(t,r+2)+o),s.markClassCount=a.readUshort(t,r+4),s.markArray=e.GPOS.readMarkArray(t,a.readUshort(t,r+6)+o),s.baseArray=e.GPOS.readBaseArray(t,a.readUshort(t,r+8)+o,s.markClassCount);else if(6==n&&1==s.fmt)s.mark1Coverage=e._lctf.readCoverage(t,a.readUshort(t,r)+o),s.mark2Coverage=e._lctf.readCoverage(t,a.readUshort(t,r+2)+o),s.markClassCount=a.readUshort(t,r+4),s.mark1Array=e.GPOS.readMarkArray(t,a.readUshort(t,r+6)+o),s.mark2Array=e.GPOS.readBaseArray(t,a.readUshort(t,r+8)+o,s.markClassCount);else if(9==n&&1==s.fmt){var C=a.readUshort(t,r);r+=2;var E=a.readUint(t,r);if(r+=4,9==i.ltype)i.ltype=C;else if(i.ltype!=C)throw"invalid extension substitution";return e.GPOS.subt(t,i.ltype,o+E)}return s},e.GPOS.readValueRecord=function(t,n,r){var i=e._bin,a=[];return a.push(1&r?i.readShort(t,n):0),n+=1&r?2:0,a.push(2&r?i.readShort(t,n):0),n+=2&r?2:0,a.push(4&r?i.readShort(t,n):0),n+=4&r?2:0,a.push(8&r?i.readShort(t,n):0),n+=8&r?2:0,a},e.GPOS.readBaseArray=function(t,n,r){var i=e._bin,a=[],o=n,s=i.readUshort(t,n);n+=2;for(var l=0;l<s;l++){for(var c=[],u=0;u<r;u++)c.push(e.GPOS.readAnchorRecord(t,o+i.readUshort(t,n))),n+=2;a.push(c)}return a},e.GPOS.readMarkArray=function(t,n){var r=e._bin,i=[],a=n,o=r.readUshort(t,n);n+=2;for(var s=0;s<o;s++){var l=e.GPOS.readAnchorRecord(t,r.readUshort(t,n+2)+a);l.markClass=r.readUshort(t,n),i.push(l),n+=4}return i},e.GPOS.readAnchorRecord=function(t,n){var r=e._bin,i={};return i.fmt=r.readUshort(t,n),i.x=r.readShort(t,n+2),i.y=r.readShort(t,n+4),i},e.GSUB={},e.GSUB.parse=function(t,n,r,i){return e._lctf.parse(t,n,r,i,e.GSUB.subt)},e.GSUB.subt=function(t,n,r,i){var a=e._bin,o=r,s={};if(s.fmt=a.readUshort(t,r),r+=2,1!=n&&2!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||2==n||4==n||5==n&&s.fmt<=2||6==n&&s.fmt<=2){var l=a.readUshort(t,r);r+=2,s.coverage=e._lctf.readCoverage(t,o+l)}if(1==n&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=a.readShort(t,r),r+=2;else if(2==s.fmt){var c=a.readUshort(t,r);r+=2,s.newg=a.readUshorts(t,r,c),r+=2*s.newg.length}}else if(2==n&&1==s.fmt){c=a.readUshort(t,r),r+=2,s.seqs=[];for(var u=0;u<c;u++){var f=a.readUshort(t,r)+o;r+=2;var d=a.readUshort(t,f);s.seqs.push(a.readUshorts(t,f+2,d))}}else if(4==n)for(s.vals=[],c=a.readUshort(t,r),r+=2,u=0;u<c;u++){var h=a.readUshort(t,r);r+=2,s.vals.push(e.GSUB.readLigatureSet(t,o+h))}else if(5==n&&2==s.fmt){if(2==s.fmt){var p=a.readUshort(t,r);r+=2,s.cDef=e._lctf.readClassDef(t,o+p),s.scset=[];var v=a.readUshort(t,r);for(r+=2,u=0;u<v;u++){var g=a.readUshort(t,r);r+=2,s.scset.push(0==g?null:e.GSUB.readSubClassSet(t,o+g))}}}else if(6==n&&3==s.fmt){if(3==s.fmt){for(u=0;u<3;u++){c=a.readUshort(t,r),r+=2;for(var m=[],y=0;y<c;y++)m.push(e._lctf.readCoverage(t,o+a.readUshort(t,r+2*y)));r+=2*c,0==u&&(s.backCvg=m),1==u&&(s.inptCvg=m),2==u&&(s.ahedCvg=m)}c=a.readUshort(t,r),r+=2,s.lookupRec=e.GSUB.readSubstLookupRecords(t,r,c)}}else if(7==n&&1==s.fmt){var x=a.readUshort(t,r);r+=2;var b=a.readUint(t,r);if(r+=4,9==i.ltype)i.ltype=x;else if(i.ltype!=x)throw"invalid extension substitution";return e.GSUB.subt(t,i.ltype,o+b)}return s},e.GSUB.readSubClassSet=function(t,n){var r=e._bin.readUshort,i=n,a=[],o=r(t,n);n+=2;for(var s=0;s<o;s++){var l=r(t,n);n+=2,a.push(e.GSUB.readSubClassRule(t,i+l))}return a},e.GSUB.readSubClassRule=function(t,n){var r=e._bin.readUshort,i={},a=r(t,n),o=r(t,n+=2);n+=2,i.input=[];for(var s=0;s<a-1;s++)i.input.push(r(t,n)),n+=2;return i.substLookupRecords=e.GSUB.readSubstLookupRecords(t,n,o),i},e.GSUB.readSubstLookupRecords=function(t,n,r){for(var i=e._bin.readUshort,a=[],o=0;o<r;o++)a.push(i(t,n),i(t,n+2)),n+=4;return a},e.GSUB.readChainSubClassSet=function(t,n){var r=e._bin,i=n,a=[],o=r.readUshort(t,n);n+=2;for(var s=0;s<o;s++){var l=r.readUshort(t,n);n+=2,a.push(e.GSUB.readChainSubClassRule(t,i+l))}return a},e.GSUB.readChainSubClassRule=function(t,n){for(var r=e._bin,i={},a=["backtrack","input","lookahead"],o=0;o<a.length;o++){var s=r.readUshort(t,n);n+=2,1==o&&s--,i[a[o]]=r.readUshorts(t,n,s),n+=2*i[a[o]].length}return s=r.readUshort(t,n),n+=2,i.subst=r.readUshorts(t,n,2*s),n+=2*i.subst.length,i},e.GSUB.readLigatureSet=function(t,n){var r=e._bin,i=n,a=[],o=r.readUshort(t,n);n+=2;for(var s=0;s<o;s++){var l=r.readUshort(t,n);n+=2,a.push(e.GSUB.readLigature(t,i+l))}return a},e.GSUB.readLigature=function(t,n){var r=e._bin,i={chain:[]};i.nglyph=r.readUshort(t,n),n+=2;var a=r.readUshort(t,n);n+=2;for(var o=0;o<a-1;o++)i.chain.push(r.readUshort(t,n)),n+=2;return i},e.head={},e.head.parse=function(t,n,r){var i=e._bin,a={};return i.readFixed(t,n),n+=4,a.fontRevision=i.readFixed(t,n),n+=4,i.readUint(t,n),n+=4,i.readUint(t,n),n+=4,a.flags=i.readUshort(t,n),n+=2,a.unitsPerEm=i.readUshort(t,n),n+=2,a.created=i.readUint64(t,n),n+=8,a.modified=i.readUint64(t,n),n+=8,a.xMin=i.readShort(t,n),n+=2,a.yMin=i.readShort(t,n),n+=2,a.xMax=i.readShort(t,n),n+=2,a.yMax=i.readShort(t,n),n+=2,a.macStyle=i.readUshort(t,n),n+=2,a.lowestRecPPEM=i.readUshort(t,n),n+=2,a.fontDirectionHint=i.readShort(t,n),n+=2,a.indexToLocFormat=i.readShort(t,n),n+=2,a.glyphDataFormat=i.readShort(t,n),n+=2,a},e.hhea={},e.hhea.parse=function(t,n,r){var i=e._bin,a={};return i.readFixed(t,n),n+=4,a.ascender=i.readShort(t,n),n+=2,a.descender=i.readShort(t,n),n+=2,a.lineGap=i.readShort(t,n),n+=2,a.advanceWidthMax=i.readUshort(t,n),n+=2,a.minLeftSideBearing=i.readShort(t,n),n+=2,a.minRightSideBearing=i.readShort(t,n),n+=2,a.xMaxExtent=i.readShort(t,n),n+=2,a.caretSlopeRise=i.readShort(t,n),n+=2,a.caretSlopeRun=i.readShort(t,n),n+=2,a.caretOffset=i.readShort(t,n),n+=2,n+=8,a.metricDataFormat=i.readShort(t,n),n+=2,a.numberOfHMetrics=i.readUshort(t,n),n+=2,a},e.hmtx={},e.hmtx.parse=function(t,n,r,i){for(var a=e._bin,o={aWidth:[],lsBearing:[]},s=0,l=0,c=0;c<i.maxp.numGlyphs;c++)c<i.hhea.numberOfHMetrics&&(s=a.readUshort(t,n),n+=2,l=a.readShort(t,n),n+=2),o.aWidth.push(s),o.lsBearing.push(l);return o},e.kern={},e.kern.parse=function(t,n,r,i){var a=e._bin,o=a.readUshort(t,n);if(n+=2,1==o)return e.kern.parseV1(t,n-2,r,i);var s=a.readUshort(t,n);n+=2;for(var l={glyph1:[],rval:[]},c=0;c<s;c++){n+=2,r=a.readUshort(t,n),n+=2;var u=a.readUshort(t,n);n+=2;var f=u>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;n=e.kern.readFormat0(t,n,l)}return l},e.kern.parseV1=function(t,n,r,i){var a=e._bin;a.readFixed(t,n),n+=4;var o=a.readUint(t,n);n+=4;for(var s={glyph1:[],rval:[]},l=0;l<o;l++){a.readUint(t,n),n+=4;var c=a.readUshort(t,n);n+=2,a.readUshort(t,n),n+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;n=e.kern.readFormat0(t,n,s)}return s},e.kern.readFormat0=function(t,n,r){var i=e._bin,a=-1,o=i.readUshort(t,n);n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2,i.readUshort(t,n),n+=2;for(var s=0;s<o;s++){var l=i.readUshort(t,n);n+=2;var c=i.readUshort(t,n);n+=2;var u=i.readShort(t,n);n+=2,l!=a&&(r.glyph1.push(l),r.rval.push({glyph2:[],vals:[]}));var f=r.rval[r.rval.length-1];f.glyph2.push(c),f.vals.push(u),a=l}return n},e.loca={},e.loca.parse=function(t,n,r,i){var a=e._bin,o=[],s=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(0==s)for(var c=0;c<l;c++)o.push(a.readUshort(t,n+(c<<1))<<1);if(1==s)for(c=0;c<l;c++)o.push(a.readUint(t,n+(c<<2)));return o},e.maxp={},e.maxp.parse=function(t,n,r){var i=e._bin,a={},o=i.readUint(t,n);return n+=4,a.numGlyphs=i.readUshort(t,n),n+=2,65536==o&&(a.maxPoints=i.readUshort(t,n),n+=2,a.maxContours=i.readUshort(t,n),n+=2,a.maxCompositePoints=i.readUshort(t,n),n+=2,a.maxCompositeContours=i.readUshort(t,n),n+=2,a.maxZones=i.readUshort(t,n),n+=2,a.maxTwilightPoints=i.readUshort(t,n),n+=2,a.maxStorage=i.readUshort(t,n),n+=2,a.maxFunctionDefs=i.readUshort(t,n),n+=2,a.maxInstructionDefs=i.readUshort(t,n),n+=2,a.maxStackElements=i.readUshort(t,n),n+=2,a.maxSizeOfInstructions=i.readUshort(t,n),n+=2,a.maxComponentElements=i.readUshort(t,n),n+=2,a.maxComponentDepth=i.readUshort(t,n),n+=2),a},e.name={},e.name.parse=function(t,n,r){var i=e._bin,a={};i.readUshort(t,n),n+=2;var o=i.readUshort(t,n);n+=2,i.readUshort(t,n);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=n+=2,u=0;u<o;u++){var f=i.readUshort(t,n);n+=2;var d=i.readUshort(t,n);n+=2;var h=i.readUshort(t,n);n+=2;var p=i.readUshort(t,n);n+=2;var v=i.readUshort(t,n);n+=2;var g=i.readUshort(t,n);n+=2;var m,y=l[p],x=c+12*o+g;if(0==f)m=i.readUnicode(t,x,v/2);else if(3==f&&0==d)m=i.readUnicode(t,x,v/2);else if(0==d)m=i.readASCII(t,x,v);else if(1==d)m=i.readUnicode(t,x,v/2);else if(3==d)m=i.readUnicode(t,x,v/2);else{if(1!=f)throw"unknown encoding "+d+", platformID: "+f;m=i.readASCII(t,x,v)}var b="p"+f+","+h.toString(16);null==a[b]&&(a[b]={}),a[b][void 0!==y?y:p]=m,a[b]._lang=h}for(var S in a)if(null!=a[S].postScriptName&&1033==a[S]._lang)return a[S];for(var S in a)if(null!=a[S].postScriptName&&0==a[S]._lang)return a[S];for(var S in a)if(null!=a[S].postScriptName&&3084==a[S]._lang)return a[S];for(var S in a)if(null!=a[S].postScriptName)return a[S];for(var S in a){s=S;break}return a[s]},e["OS/2"]={},e["OS/2"].parse=function(t,n,r){var i=e._bin.readUshort(t,n);n+=2;var a={};if(0==i)e["OS/2"].version0(t,n,a);else if(1==i)e["OS/2"].version1(t,n,a);else if(2==i||3==i||4==i)e["OS/2"].version2(t,n,a);else{if(5!=i)throw"unknown OS/2 table version: "+i;e["OS/2"].version5(t,n,a)}return a},e["OS/2"].version0=function(t,n,r){var i=e._bin;return r.xAvgCharWidth=i.readShort(t,n),n+=2,r.usWeightClass=i.readUshort(t,n),n+=2,r.usWidthClass=i.readUshort(t,n),n+=2,r.fsType=i.readUshort(t,n),n+=2,r.ySubscriptXSize=i.readShort(t,n),n+=2,r.ySubscriptYSize=i.readShort(t,n),n+=2,r.ySubscriptXOffset=i.readShort(t,n),n+=2,r.ySubscriptYOffset=i.readShort(t,n),n+=2,r.ySuperscriptXSize=i.readShort(t,n),n+=2,r.ySuperscriptYSize=i.readShort(t,n),n+=2,r.ySuperscriptXOffset=i.readShort(t,n),n+=2,r.ySuperscriptYOffset=i.readShort(t,n),n+=2,r.yStrikeoutSize=i.readShort(t,n),n+=2,r.yStrikeoutPosition=i.readShort(t,n),n+=2,r.sFamilyClass=i.readShort(t,n),n+=2,r.panose=i.readBytes(t,n,10),n+=10,r.ulUnicodeRange1=i.readUint(t,n),n+=4,r.ulUnicodeRange2=i.readUint(t,n),n+=4,r.ulUnicodeRange3=i.readUint(t,n),n+=4,r.ulUnicodeRange4=i.readUint(t,n),n+=4,r.achVendID=[i.readInt8(t,n),i.readInt8(t,n+1),i.readInt8(t,n+2),i.readInt8(t,n+3)],n+=4,r.fsSelection=i.readUshort(t,n),n+=2,r.usFirstCharIndex=i.readUshort(t,n),n+=2,r.usLastCharIndex=i.readUshort(t,n),n+=2,r.sTypoAscender=i.readShort(t,n),n+=2,r.sTypoDescender=i.readShort(t,n),n+=2,r.sTypoLineGap=i.readShort(t,n),n+=2,r.usWinAscent=i.readUshort(t,n),n+=2,r.usWinDescent=i.readUshort(t,n),n+2},e["OS/2"].version1=function(t,n,r){var i=e._bin;return n=e["OS/2"].version0(t,n,r),r.ulCodePageRange1=i.readUint(t,n),n+=4,r.ulCodePageRange2=i.readUint(t,n),n+4},e["OS/2"].version2=function(t,n,r){var i=e._bin;return n=e["OS/2"].version1(t,n,r),r.sxHeight=i.readShort(t,n),n+=2,r.sCapHeight=i.readShort(t,n),n+=2,r.usDefault=i.readUshort(t,n),n+=2,r.usBreak=i.readUshort(t,n),n+=2,r.usMaxContext=i.readUshort(t,n),n+2},e["OS/2"].version5=function(t,n,r){var i=e._bin;return n=e["OS/2"].version2(t,n,r),r.usLowerOpticalPointSize=i.readUshort(t,n),n+=2,r.usUpperOpticalPointSize=i.readUshort(t,n),n+2},e.post={},e.post.parse=function(t,n,r){var i=e._bin,a={};return a.version=i.readFixed(t,n),n+=4,a.italicAngle=i.readFixed(t,n),n+=4,a.underlinePosition=i.readShort(t,n),n+=2,a.underlineThickness=i.readShort(t,n),n+=2,a},null==e&&(e={}),null==e.U&&(e.U={}),e.U.codeToGlyph=function(t,e){var n=t.cmap,r=-1;if(null!=n.p0e4?r=n.p0e4:null!=n.p3e1?r=n.p3e1:null!=n.p1e0?r=n.p1e0:null!=n.p0e3&&(r=n.p0e3),-1==r)throw"no familiar platform and encoding!";var i=n.tables[r];if(0==i.format)return e>=i.map.length?0:i.map[e];if(4==i.format){for(var a=-1,o=0;o<i.endCount.length;o++)if(e<=i.endCount[o]){a=o;break}return-1==a||i.startCount[a]>e?0:65535&(0!=i.idRangeOffset[a]?i.glyphIdArray[e-i.startCount[a]+(i.idRangeOffset[a]>>1)-(i.idRangeOffset.length-a)]:e+i.idDelta[a])}if(12==i.format){if(e>i.groups[i.groups.length-1][1])return 0;for(o=0;o<i.groups.length;o++){var s=i.groups[o];if(s[0]<=e&&e<=s[1])return s[2]+(e-s[0])}return 0}throw"unknown cmap table format "+i.format},e.U.glyphToPath=function(t,n){var r={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[n]){var i=t.SVG.entries[n];return null==i?r:("string"==typeof i&&(i=e.SVG.toPath(i),t.SVG.entries[n]=i),i)}if(t.CFF){var a={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},o=t.CFF,s=t.CFF.Private;if(o.ROS){for(var l=0;o.FDSelect[l+2]<=n;)l+=2;s=o.FDArray[o.FDSelect[l+1]].Private}e.U._drawCFF(t.CFF.CharStrings[n],a,o,s,r)}else t.glyf&&e.U._drawGlyf(n,t,r);return r},e.U._drawGlyf=function(t,n,r){var i=n.glyf[t];null==i&&(i=n.glyf[t]=e.glyf._parseGlyf(n,t)),null!=i&&(i.noc>-1?e.U._simpleGlyph(i,r):e.U._compoGlyph(i,n,r))},e.U._simpleGlyph=function(t,n){for(var r=0;r<t.noc;r++){for(var i=0==r?0:t.endPts[r-1]+1,a=t.endPts[r],o=i;o<=a;o++){var s=o==i?a:o-1,l=o==a?i:o+1,c=1&t.flags[o],u=1&t.flags[s],f=1&t.flags[l],d=t.xs[o],h=t.ys[o];if(o==i)if(c){if(!u){e.U.P.moveTo(n,d,h);continue}e.U.P.moveTo(n,t.xs[s],t.ys[s])}else u?e.U.P.moveTo(n,t.xs[s],t.ys[s]):e.U.P.moveTo(n,(t.xs[s]+d)/2,(t.ys[s]+h)/2);c?u&&e.U.P.lineTo(n,d,h):f?e.U.P.qcurveTo(n,d,h,t.xs[l],t.ys[l]):e.U.P.qcurveTo(n,d,h,(d+t.xs[l])/2,(h+t.ys[l])/2)}e.U.P.closePath(n)}},e.U._compoGlyph=function(t,n,r){for(var i=0;i<t.parts.length;i++){var a={cmds:[],crds:[]},o=t.parts[i];e.U._drawGlyf(o.glyphIndex,n,a);for(var s=o.m,l=0;l<a.crds.length;l+=2){var c=a.crds[l],u=a.crds[l+1];r.crds.push(c*s.a+u*s.b+s.tx),r.crds.push(c*s.c+u*s.d+s.ty)}for(l=0;l<a.cmds.length;l++)r.cmds.push(a.cmds[l])}},e.U._getGlyphClass=function(t,n){var r=e._lctf.getInterval(n,t);return-1==r?0:n[r+2]},e.U._applySubs=function(t,n,r,i){for(var a=t.length-n-1,o=0;o<r.tabs.length;o++)if(null!=r.tabs[o]){var s,l=r.tabs[o];if(!l.coverage||-1!=(s=e._lctf.coverageIndex(l.coverage,t[n])))if(1==r.ltype)t[n],1==l.fmt?t[n]=t[n]+l.delta:t[n]=l.newg[s];else if(4==r.ltype)for(var c=l.vals[s],u=0;u<c.length;u++){var f=c[u],d=f.chain.length;if(!(d>a)){for(var h=!0,p=0,v=0;v<d;v++){for(;-1==t[n+p+(1+v)];)p++;f.chain[v]!=t[n+p+(1+v)]&&(h=!1)}if(h){for(t[n]=f.nglyph,v=0;v<d+p;v++)t[n+v+1]=-1;break}}}else if(5==r.ltype&&2==l.fmt)for(var g=e._lctf.getInterval(l.cDef,t[n]),m=l.cDef[g+2],y=l.scset[m],x=0;x<y.length;x++){var b=y[x],S=b.input;if(!(S.length>a)){for(h=!0,v=0;v<S.length;v++){var w=e._lctf.getInterval(l.cDef,t[n+1+v]);if(-1==g&&l.cDef[w+2]!=S[v]){h=!1;break}}if(h){var U=b.substLookupRecords;for(u=0;u<U.length;u+=2)U[u],U[u+1]}}}else if(6==r.ltype&&3==l.fmt){if(!e.U._glsCovered(t,l.backCvg,n-l.backCvg.length))continue;if(!e.U._glsCovered(t,l.inptCvg,n))continue;if(!e.U._glsCovered(t,l.ahedCvg,n+l.inptCvg.length))continue;var _=l.lookupRec;for(x=0;x<_.length;x+=2){g=_[x];var k=i[_[x+1]];e.U._applySubs(t,n+g,k,i)}}}},e.U._glsCovered=function(t,n,r){for(var i=0;i<n.length;i++)if(-1==e._lctf.coverageIndex(n[i],t[r+i]))return!1;return!0},e.U.glyphsToPath=function(t,n,r){for(var i={cmds:[],crds:[]},a=0,o=0;o<n.length;o++){var s=n[o];if(-1!=s){for(var l=o<n.length-1&&-1!=n[o+1]?n[o+1]:0,c=e.U.glyphToPath(t,s),u=0;u<c.crds.length;u+=2)i.crds.push(c.crds[u]+a),i.crds.push(c.crds[u+1]);for(r&&i.cmds.push(r),u=0;u<c.cmds.length;u++)i.cmds.push(c.cmds[u]);r&&i.cmds.push("X"),a+=t.hmtx.aWidth[s],o<n.length-1&&(a+=e.U.getPairAdjustment(t,s,l))}}return i},e.U.P={},e.U.P.moveTo=function(t,e,n){t.cmds.push("M"),t.crds.push(e,n)},e.U.P.lineTo=function(t,e,n){t.cmds.push("L"),t.crds.push(e,n)},e.U.P.curveTo=function(t,e,n,r,i,a,o){t.cmds.push("C"),t.crds.push(e,n,r,i,a,o)},e.U.P.qcurveTo=function(t,e,n,r,i){t.cmds.push("Q"),t.crds.push(e,n,r,i)},e.U.P.closePath=function(t){t.cmds.push("Z")},e.U._drawCFF=function(t,n,r,i,a){for(var o=n.stack,s=n.nStems,l=n.haveWidth,c=n.width,u=n.open,f=0,d=n.x,h=n.y,p=0,v=0,g=0,m=0,y=0,x=0,b=0,S=0,w=0,U=0,_={val:0,size:0};f<t.length;){e.CFF.getCharString(t,f,_);var k=_.val;if(f+=_.size,"o1"==k||"o18"==k)o.length%2!=0&&!l&&(c=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o3"==k||"o23"==k)o.length%2!=0&&!l&&(c=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o4"==k)o.length>1&&!l&&(c=o.shift()+i.nominalWidthX,l=!0),u&&e.U.P.closePath(a),h+=o.pop(),e.U.P.moveTo(a,d,h),u=!0;else if("o5"==k)for(;o.length>0;)d+=o.shift(),h+=o.shift(),e.U.P.lineTo(a,d,h);else if("o6"==k||"o7"==k)for(var T=o.length,C="o6"==k,E=0;E<T;E++){var F=o.shift();C?d+=F:h+=F,C=!C,e.U.P.lineTo(a,d,h)}else if("o8"==k||"o24"==k){T=o.length;for(var A=0;A+6<=T;)p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m+o.shift(),e.U.P.curveTo(a,p,v,g,m,d,h),A+=6;"o24"==k&&(d+=o.shift(),h+=o.shift(),e.U.P.lineTo(a,d,h))}else{if("o11"==k)break;if("o1234"==k||"o1235"==k||"o1236"==k||"o1237"==k)"o1234"==k&&(v=h,g=(p=d+o.shift())+o.shift(),U=m=v+o.shift(),x=m,S=h,d=(b=(y=(w=g+o.shift())+o.shift())+o.shift())+o.shift(),e.U.P.curveTo(a,p,v,g,m,w,U),e.U.P.curveTo(a,y,x,b,S,d,h)),"o1235"==k&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),w=g+o.shift(),U=m+o.shift(),y=w+o.shift(),x=U+o.shift(),b=y+o.shift(),S=x+o.shift(),d=b+o.shift(),h=S+o.shift(),o.shift(),e.U.P.curveTo(a,p,v,g,m,w,U),e.U.P.curveTo(a,y,x,b,S,d,h)),"o1236"==k&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),U=m=v+o.shift(),x=m,b=(y=(w=g+o.shift())+o.shift())+o.shift(),S=x+o.shift(),d=b+o.shift(),e.U.P.curveTo(a,p,v,g,m,w,U),e.U.P.curveTo(a,y,x,b,S,d,h)),"o1237"==k&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),w=g+o.shift(),U=m+o.shift(),y=w+o.shift(),x=U+o.shift(),b=y+o.shift(),S=x+o.shift(),Math.abs(b-d)>Math.abs(S-h)?d=b+o.shift():h=S+o.shift(),e.U.P.curveTo(a,p,v,g,m,w,U),e.U.P.curveTo(a,y,x,b,S,d,h));else if("o14"==k){if(o.length>0&&!l&&(c=o.shift()+r.nominalWidthX,l=!0),4==o.length){var M=o.shift(),D=o.shift(),P=o.shift(),R=o.shift(),O=e.CFF.glyphBySE(r,P),I=e.CFF.glyphBySE(r,R);e.U._drawCFF(r.CharStrings[O],n,r,i,a),n.x=M,n.y=D,e.U._drawCFF(r.CharStrings[I],n,r,i,a)}u&&(e.U.P.closePath(a),u=!1)}else if("o19"==k||"o20"==k)o.length%2!=0&&!l&&(c=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0,f+=s+7>>3;else if("o21"==k)o.length>2&&!l&&(c=o.shift()+i.nominalWidthX,l=!0),h+=o.pop(),d+=o.pop(),u&&e.U.P.closePath(a),e.U.P.moveTo(a,d,h),u=!0;else if("o22"==k)o.length>1&&!l&&(c=o.shift()+i.nominalWidthX,l=!0),d+=o.pop(),u&&e.U.P.closePath(a),e.U.P.moveTo(a,d,h),u=!0;else if("o25"==k){for(;o.length>6;)d+=o.shift(),h+=o.shift(),e.U.P.lineTo(a,d,h);p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m+o.shift(),e.U.P.curveTo(a,p,v,g,m,d,h)}else if("o26"==k)for(o.length%2&&(d+=o.shift());o.length>0;)p=d,v=h+o.shift(),d=g=p+o.shift(),h=(m=v+o.shift())+o.shift(),e.U.P.curveTo(a,p,v,g,m,d,h);else if("o27"==k)for(o.length%2&&(h+=o.shift());o.length>0;)v=h,g=(p=d+o.shift())+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m,e.U.P.curveTo(a,p,v,g,m,d,h);else if("o10"==k||"o29"==k){var L="o10"==k?i:r;if(0==o.length);else{var B=o.pop(),G=L.Subrs[B+L.Bias];n.x=d,n.y=h,n.nStems=s,n.haveWidth=l,n.width=c,n.open=u,e.U._drawCFF(G,n,r,i,a),d=n.x,h=n.y,s=n.nStems,l=n.haveWidth,c=n.width,u=n.open}}else if("o30"==k||"o31"==k){var z=o.length,j=(A=0,"o31"==k);for(A+=z-(T=-3&z);A<T;)j?(v=h,g=(p=d+o.shift())+o.shift(),h=(m=v+o.shift())+o.shift(),T-A==5?(d=g+o.shift(),A++):d=g,j=!1):(p=d,v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),T-A==5?(h=m+o.shift(),A++):h=m,j=!0),e.U.P.curveTo(a,p,v,g,m,d,h),A+=4}else{if("o"==(k+"").charAt(0))throw k;o.push(k)}}}n.x=d,n.y=h,n.nStems=s,n.haveWidth=l,n.width=c,n.open=u};var n=e,r={Typr:n};return t.Typr=n,t.default=r,Object.defineProperty(t,"__esModule",{value:!0}),t}({}).Typr},function(){return function(t){var e=Uint8Array,n=Uint16Array,r=Uint32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(t,e){for(var i=new n(31),a=0;a<31;++a)i[a]=e+=1<<t[a-1];var o=new r(i[30]);for(a=1;a<30;++a)for(var s=i[a];s<i[a+1];++s)o[s]=s-i[a]<<5|a;return[i,o]},l=s(i,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var f=s(a,0)[0],d=new n(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(t,e,r){for(var i=t.length,a=0,o=new n(e);a<i;++a)++o[t[a]-1];var s,l=new n(e);for(a=0;a<e;++a)l[a]=l[a-1]+o[a-1]<<1;s=new n(1<<e);var c=15-e;for(a=0;a<i;++a)if(t[a])for(var u=a<<4|t[a],f=e-t[a],h=l[t[a]-1]++<<f,p=h|(1<<f)-1;h<=p;++h)s[d[h]>>>c]=u;return s},g=new e(288);for(h=0;h<144;++h)g[h]=8;for(h=144;h<256;++h)g[h]=9;for(h=256;h<280;++h)g[h]=7;for(h=280;h<288;++h)g[h]=8;var m=new e(32);for(h=0;h<32;++h)m[h]=5;var y=v(g,9),x=v(m,5),b=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},S=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},w=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},U=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_=function(t,e,n){var r=new Error(e||U[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,_),!n)throw r;return r},k=function(t,s,l){var u=t.length;if(!u||l&&!l.l&&u<5)return s||new e(0);var d=!s||l,h=!l||l.i;l||(l={}),s||(s=new e(3*u));var p,g=function(t){var n=s.length;if(t>n){var r=new e(Math.max(2*n,t));r.set(s),s=r}},m=l.f||0,U=l.p||0,k=l.b||0,T=l.l,C=l.d,E=l.m,F=l.n,A=8*u;do{if(!T){l.f=m=S(t,U,1);var M=S(t,U+1,3);if(U+=3,!M){var D=t[(N=((p=U)/8|0)+(7&p&&1)+4)-4]|t[N-3]<<8,P=N+D;if(P>u){h&&_(0);break}d&&g(k+D),s.set(t.subarray(N,P),k),l.b=k+=D,l.p=U=8*P;continue}if(1==M)T=y,C=x,E=9,F=5;else if(2==M){var R=S(t,U,31)+257,O=S(t,U+10,15)+4,I=R+S(t,U+5,31)+1;U+=14;for(var L=new e(I),B=new e(19),G=0;G<O;++G)B[o[G]]=S(t,U+3*G,7);U+=3*O;var z=b(B),j=(1<<z)-1,W=v(B,z);for(G=0;G<I;){var N,V=W[S(t,U,j)];if(U+=15&V,(N=V>>>4)<16)L[G++]=N;else{var H=0,q=0;for(16==N?(q=3+S(t,U,3),U+=2,H=L[G-1]):17==N?(q=3+S(t,U,7),U+=3):18==N&&(q=11+S(t,U,127),U+=7);q--;)L[G++]=H}}var $=L.subarray(0,R),X=L.subarray(R);E=b($),F=b(X),T=v($,E),C=v(X,F)}else _(1);if(U>A){h&&_(0);break}}d&&g(k+131072);for(var Y=(1<<E)-1,K=(1<<F)-1,Z=U;;Z=U){var J=(H=T[w(t,U)&Y])>>>4;if((U+=15&H)>A){h&&_(0);break}if(H||_(2),J<256)s[k++]=J;else{if(256==J){Z=U,T=null;break}var Q=J-254;if(J>264){var tt=i[G=J-257];Q=S(t,U,(1<<tt)-1)+c[G],U+=tt}var et=C[w(t,U)&K],nt=et>>>4;if(et||_(3),U+=15&et,X=f[nt],nt>3&&(tt=a[nt],X+=w(t,U)&(1<<tt)-1,U+=tt),U>A){h&&_(0);break}d&&g(k+131072);for(var rt=k+Q;k<rt;k+=4)s[k]=s[k-X],s[k+1]=s[k+1-X],s[k+2]=s[k+2-X],s[k+3]=s[k+3-X];k=rt}}l.l=T,l.p=Z,l.b=k,T&&(m=1,l.m=E,l.d=C,l.n=F)}while(!m);return k==s.length?s:function(t,i,a){(null==a||a>t.length)&&(a=t.length);var o=new(t instanceof n?n:t instanceof r?r:e)(a-0);return o.set(t.subarray(0,a)),o}(s,0,k)},T=new e(0),C="undefined"!=typeof TextDecoder&&new TextDecoder;try{C.decode(T,{stream:!0})}catch(t){}return t.convert_streams=function(t){var e=new DataView(t),n=0;function r(){var t=e.getUint16(n);return n+=2,t}function i(){var t=e.getUint32(n);return n+=4,t}function a(t){m.setUint16(y,t),y+=2}function o(t){m.setUint32(y,t),y+=4}for(var s={signature:i(),flavor:i(),length:i(),numTables:r(),reserved:r(),totalSfntSize:i(),majorVersion:r(),minorVersion:r(),metaOffset:i(),metaLength:i(),metaOrigLength:i(),privOffset:i(),privLength:i()},l=0;Math.pow(2,l)<=s.numTables;)l++;l--;for(var c=16*Math.pow(2,l),u=16*s.numTables-c,f=12,d=[],h=0;h<s.numTables;h++)d.push({tag:i(),offset:i(),compLength:i(),origLength:i(),origChecksum:i()}),f+=16;var p,v=new Uint8Array(12+16*d.length+d.reduce(function(t,e){return t+e.origLength+4},0)),g=v.buffer,m=new DataView(g),y=0;return o(s.flavor),a(s.numTables),a(c),a(l),a(u),d.forEach(function(t){o(t.tag),o(t.origChecksum),o(f),o(t.origLength),t.outOffset=f,(f+=t.origLength)%4!=0&&(f+=4-f%4)}),d.forEach(function(e){var n,r=t.slice(e.offset,e.offset+e.compLength);if(e.compLength!=e.origLength){var i=new Uint8Array(e.origLength);n=new Uint8Array(r,2),k(n,i)}else i=new Uint8Array(r);v.set(i,e.outOffset);var a=0;(f=e.outOffset+e.origLength)%4!=0&&(a=4-f%4),v.set(new Uint8Array(a).buffer,e.outOffset+e.origLength),p=f+a}),g.slice(0,p)},Object.defineProperty(t,"__esModule",{value:!0}),t}({}).convert_streams},function(t,e){const n={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let i;function a(t){if(!i){const t={R:2,L:1,D:4,C:16,U:32,T:8};i=new Map;for(let e in r){let n=0;r[e].split(",").forEach(r=>{let[a,o]=r.split("+");a=parseInt(a,36),o=o?parseInt(o,36):0,i.set(n+=a,t[e]);for(let s=o;s--;)i.set(++n,t[e])})}}return i.get(t)||32}const o=[null,"isol","init","fina","medi"];function s(t){const e=new Uint8Array(t.length);let n=32,r=1,i=-1;for(let o=0;o<t.length;o++){const s=t.codePointAt(o);let l=0|a(s),c=1;8&l||(21&n?22&l?(c=3,1!==r&&3!==r||e[i]++):33&l&&(2!==r&&4!==r||e[i]--):34&n&&(2!==r&&4!==r||e[i]--),r=e[o]=c,n=l,i=o,s>65535&&o++)}return e}function l(e,n){const r=e.GDEF&&e.GDEF.glyphClassDef;return r?t.U._getGlyphClass(n,r):0}function c(...t){for(let e=0;e<t.length;e++)if("number"==typeof t[e])return t[e]}function u(e){const r=Object.create(null),i=e["OS/2"],a=e.hhea,u=e.head.unitsPerEm,f=c(i&&i.sTypoAscender,a&&a.ascender,u),d={unitsPerEm:u,ascender:f,descender:c(i&&i.sTypoDescender,a&&a.descender,0),capHeight:c(i&&i.sCapHeight,f),xHeight:c(i&&i.sxHeight,f),lineGap:c(i&&i.sTypoLineGap,a&&a.lineGap),supportsCodePoint:n=>t.U.codeToGlyph(e,n)>0,forEachGlyph(i,a,c,u){let f=0;const h=1/d.unitsPerEm*a,p=function(e,n){const r=[];for(let a=0;a<n.length;a++){const i=n.codePointAt(a);i>65535&&a++,r.push(t.U.codeToGlyph(e,i))}const i=e.GSUB;if(i){const{lookupList:e,featureList:a}=i;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,u=[];a.forEach(i=>{if(c.test(i.tag))for(let a=0;a<i.tab.length;a++){if(u[i.tab[a]])continue;u[i.tab[a]]=!0;const c=e[i.tab[a]],f=/^(isol|init|fina|medi)$/.test(i.tag);f&&!l&&(l=s(n));for(let n=0;n<r.length;n++)l&&f&&o[l[n]]!==i.tag||t.U._applySubs(r,n,c,e)}})}return r}(e,i);let v=0;const g=function(e,n){const r=new Int16Array(3*n.length);let i=0;for(;i<n.length;i++){const c=n[i];if(-1===c)continue;r[3*i+2]=e.hmtx.aWidth[c];const u=e.GPOS;if(u){const f=u.lookupList;for(let u=0;u<f.length;u++){const d=f[u];for(let u=0;u<d.tabs.length;u++){const f=d.tabs[u];if(1===d.ltype){if(-1!==t._lctf.coverageIndex(f.coverage,c)&&f.pos){s(f.pos,i);break}}else if(2===d.ltype){let e=null,r=a();if(-1!==r){const a=t._lctf.coverageIndex(f.coverage,n[r]);if(-1!==a){if(1===f.fmt){const t=f.pairsets[a];for(let n=0;n<t.length;n++)t[n].gid2===c&&(e=t[n])}else if(2===f.fmt){const i=t.U._getGlyphClass(n[r],f.classDef1),a=t.U._getGlyphClass(c,f.classDef2);e=f.matrix[i][a]}if(e){e.val1&&s(e.val1,r),e.val2&&s(e.val2,i);break}}}}else if(4===d.ltype){const e=t._lctf.coverageIndex(f.markCoverage,c);if(-1!==e){const s=a(o),l=-1===s?-1:t._lctf.coverageIndex(f.baseCoverage,n[s]);if(-1!==l){const t=f.markArray[e],n=f.baseArray[l][t.markClass];r[3*i]=n.x-t.x+r[3*s]-r[3*s+2],r[3*i+1]=n.y-t.y+r[3*s+1];break}}}else if(6===d.ltype){const o=t._lctf.coverageIndex(f.mark1Coverage,c);if(-1!==o){const s=a();if(-1!==s){const a=n[s];if(3===l(e,a)){const e=t._lctf.coverageIndex(f.mark2Coverage,a);if(-1!==e){const t=f.mark1Array[o],n=f.mark2Array[e][t.markClass];r[3*i]=n.x-t.x+r[3*s]-r[3*s+2],r[3*i+1]=n.y-t.y+r[3*s+1];break}}}}}}}}else if(e.kern&&!e.cff){const t=a();if(-1!==t){const i=e.kern.glyph1.indexOf(n[t]);if(-1!==i){const n=e.kern.rval[i].glyph2.indexOf(c);-1!==n&&(r[3*t+2]+=e.kern.rval[i].vals[n])}}}}return r;function a(t){for(let e=i-1;e>=0;e--)if(-1!==n[e]&&(!t||t(n[e])))return e;return-1}function o(t){return 1===l(e,t)}function s(t,e){for(let n=0;n<3;n++)r[3*e+n]+=t[n]||0}}(e,p);return p.forEach((o,s)=>{if(-1!==o){let i=r[o];if(!i){const{cmds:a,crds:s}=t.U.glyphToPath(e,o);let l,c,u,f,d="",h=0;for(let t=0,e=a.length;t<e;t++){const e=n[a[t]];d+=a[t];for(let t=1;t<=e;t++)d+=(t>1?",":"")+s[h++]}if(s.length){l=c=1/0,u=f=-1/0;for(let t=0,e=s.length;t<e;t+=2){let e=s[t],n=s[t+1];e<l&&(l=e),n<c&&(c=n),e>u&&(u=e),n>f&&(f=n)}}else l=u=c=f=0;i=r[o]={index:o,advanceWidth:e.hmtx.aWidth[o],xMin:l,yMin:c,xMax:u,yMax:f,path:d}}u.call(null,i,f+g[3*s]*h,g[3*s+1]*h,v),f+=g[3*s+2]*h,c&&(f+=c*a)}v+=i.codePointAt(v)>65535?2:1}),f}};return d}return function(n){const r=new Uint8Array(n,0,4),i=t._bin.readASCII(r,0,4);if("wOFF"===i)n=e(n);else if("wOF2"===i)throw new Error("woff2 fonts not supported");return u(t.parse(n)[0])}}],init:(t,e,n)=>n(t(),e())});const de=Xt({name:"FontResolver",dependencies:[function(t,e){const n=Object.create(null),r=Object.create(null);function i(e,i){let a=n[e];a?i(a):r[e]?r[e].push(i):(r[e]=[i],function(e,n){const r=t=>{};try{const i=new XMLHttpRequest;i.open("get",e,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)new Error(i.statusText);else if(i.status>0)try{const r=t(i.response);r.src=e,n(r)}catch(r){}},i.onerror=r,i.send()}catch(i){}}(e,t=>{t.src=e,n[e]=t,r[e].forEach(e=>e(t)),delete r[e]}))}return function(t,r,{lang:a,fonts:o=[],style:s="normal",weight:l="normal",unicodeFontsURL:c}={}){const u=new Uint8Array(t.length),f=[];t.length||v();const d=new Map,h=[];if("italic"!==s&&(s="normal"),"number"!=typeof l&&(l="bold"===l?700:400),o&&!Array.isArray(o)&&(o=[o]),(o=o.slice().filter(t=>!t.lang||t.lang.test(a)).reverse()).length){const e=1,r=2;let a=0;!function s(l=0){for(let c=l,p=t.length;c<p;c++){const l=t.codePointAt(c);if(a===e&&f[u[c-1]].supportsCodePoint(l)||c>0&&/\s/.test(t[c]))u[c]=u[c-1],a===r&&(h[h.length-1][1]=c);else for(let t=u[c],p=o.length;t<=p;t++)if(t===p){(a===r?h[h.length-1]:h[h.length]=[c,c])[1]=c,a=r}else{u[c]=t;const{src:r,unicodeRange:h}=o[t];if(!h||g(l,h)){const t=n[r];if(!t)return void i(r,()=>{s(c)});if(t.supportsCodePoint(l)){let n=d.get(t);"number"!=typeof n&&(n=f.length,f.push(t),d.set(t,n)),u[c]=n,a=e;break}}}l>65535&&c+1<p&&(u[c+1]=u[c],c++,a===r&&(h[h.length-1][1]=c))}p()}()}else h.push([0,t.length-1]),p();function p(){if(h.length){const n=h.map(e=>t.substring(e[0],e[1]+1)).join("\n");e.getFontsForString(n,{lang:a||void 0,style:s,weight:l,dataUrl:c}).then(({fontUrls:t,chars:e})=>{const n=f.length;let r=0;h.forEach(t=>{for(let i=0,a=t[1]-t[0];i<=a;i++)u[t[0]+i]=e[r++]+n;r++});let a=0;t.forEach((e,r)=>{i(e,e=>{f[r+n]=e,++a===t.length&&v()})})})}else v()}function v(){r({chars:u,fonts:f})}function g(t,e){for(let n=0;n<e.length;n++){const[r,i=r]=e[n];if(r<=t&&t<=i)return!0}return!1}}},fe,function(){return function(t){var e=function(){this.buckets=new Map};e.prototype.add=function(t){var e=t>>5;this.buckets.set(e,(this.buckets.get(e)||0)|1<<(31&t))},e.prototype.has=function(t){var e=this.buckets.get(t>>5);return void 0!==e&&!!(e&1<<(31&t))},e.prototype.serialize=function(){var t=[];return this.buckets.forEach(function(e,n){t.push((+n).toString(36)+":"+e.toString(36))}),t.join(",")},e.prototype.deserialize=function(t){var e=this;this.buckets.clear(),t.split(",").forEach(function(t){var n=t.split(":");e.buckets.set(parseInt(n[0],36),parseInt(n[1],36))})};var n=Math.pow(2,8),r=n-1,i=~r;function a(t){var e=function(t){return t&i}(t).toString(16),r=function(t){return(t&i)+n-1}(t).toString(16);return"codepoint-index/plane"+(t>>16)+"/"+e+"-"+r+".json"}function o(t,e){var n=t&r,i=e.codePointAt(n/6|0);return!!((i=(i||48)-48)&1<<n%6)}function s(t,e){!function(t,e){var n;(n=t,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(t){return t.split("-").map(function(t){return parseInt(t.trim(),16)})})).forEach(function(t){var n=t[0],r=t[1];void 0===r&&(r=n),e(n,r)})}(t,function(t,n){for(var r=t;r<=n;r++)e(r)})}var l={},c={},u=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(t){var n=u.get(t);return n||(n=new e,s(t.ranges,function(t){return n.add(t)}),u.set(t,n)),n}var h,p=new Map;function v(t,e,n){return t[e]?e:t[n]?n:function(t){for(var e in t)return e}(t)}function g(t,e){var n=e;if(!t.includes(n)){n=1/0;for(var r=0;r<t.length;r++)Math.abs(t[r]-e)<Math.abs(n-e)&&(n=t[r])}return n}function m(t){return h||(h=new Set,s("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(t){h.add(t)})),h.has(t)}return t.CodePointSet=e,t.clearCache=function(){l={},c={}},t.getFontsForString=function(t,e){void 0===e&&(e={});var n,r=e.lang;void 0===r&&(r=/\p{Script=Hangul}/u.test(n=t)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(n)?"ja":"en");var i=e.category;void 0===i&&(i="sans-serif");var s=e.style;void 0===s&&(s="normal");var u=e.weight;void 0===u&&(u=400);var h=(e.dataUrl||f).replace(/\/$/g,""),y=new Map,x=new Uint8Array(t.length),b={},S={},w=new Array(t.length),U=new Map,_=!1;function k(t){var e=p.get(t);return e||(e=fetch(h+"/"+t).then(function(t){if(!t.ok)throw new Error(t.statusText);return t.json().then(function(t){if(!Array.isArray(t)||1!==t[0])throw new Error("Incorrect schema version; need 1, got "+t[0]);return t[1]})}).catch(function(e){if(h!==f)return _||(_=!0),h=f,p.delete(t),k(t);throw e}),p.set(t,e)),e}for(var T=function(e){var n=t.codePointAt(e),r=a(n);w[e]=r,l[r]||U.has(r)||U.set(r,k(r).then(function(t){l[r]=t})),n>65535&&(e++,C=e)},C=0;C<t.length;C++)T(C);return Promise.all(U.values()).then(function(){U.clear();for(var e=function(e){var i=t.codePointAt(e),a=null,s=l[w[e]],u=void 0;for(var f in s){var d=S[f];if(void 0===d&&(d=S[f]=new RegExp(f).test(r||"en")),d){for(var h in u=f,s[f])if(o(i,s[f][h])){a=h;break}break}}if(!a)t:for(var p in s)if(p!==u)for(var v in s[p])if(o(i,s[p][v])){a=v;break t}a||(a="latin"),w[e]=a,c[a]||U.has(a)||U.set(a,k("font-meta/"+a+".json").then(function(t){c[a]=t})),i>65535&&(e++,n=e)},n=0;n<t.length;n++)e(n);return Promise.all(U.values())}).then(function(){for(var e,n=null,r=0;r<t.length;r++){var a=t.codePointAt(r);if(n&&(m(a)||d(n).has(a)))x[r]=x[r-1];else{n=c[w[r]];var o=b[n.id];if(!o){var l=n.typeforms,f=v(l,i,"sans-serif"),p=v(l[f],s,"normal"),S=g(null===(e=l[f])||void 0===e?void 0:e[p],u);o=b[n.id]=h+"/font-files/"+n.id+"/"+f+"."+p+"."+S+".woff"}var U=y.get(o);null==U&&(U=y.size,y.set(o,U)),x[r]=U}a>65535&&(r++,x[r]=x[r-1])}return{fontUrls:Array.from(y.keys()),chars:x}})},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}],init:(t,e,n)=>t(e,n())});const he=()=>(self.performance||Date).now(),pe=Zt();let ve;const ge=[];let me=0;function ye(){const t=he();for(;ge.length&&he()-t<5;)ge.shift()();me=ge.length?setTimeout(ye,0):0}const xe=(...t)=>new Promise((e,n)=>{ge.push(()=>{const r=he();try{pe.webgl.generateIntoCanvas(...t),e({timing:he()-r})}catch(i){n(i)}}),me||(me=setTimeout(ye,0))}),be=4,Se=2e3,we={};let Ue=0;function _e(t,e,n,r,i,a,o,s,l,c){const u="TroikaTextSDFGenerator_JS_"+Ue++%be;let f=we[u];return f||(f=we[u]={workerModule:Xt({name:u,workerId:u,dependencies:[Zt,he],init(t,e){const n=t().javascript.generate;return function(...t){const r=e();return{textureData:n(...t),timing:e()-r}}},getTransferables:t=>[t.textureData.buffer]}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(t,e,n,r,i,a).then(({textureData:n,timing:r})=>{const i=he(),a=new Uint8Array(4*n.length);for(let t=0;t<n.length;t++)a[4*t+c]=n[t];return pe.webglUtils.renderImageData(o,a,s,l,t,e,1<<3-c),r+=he()-i,0===--f.requests&&(f.idleTimer=setTimeout(()=>{!function(t){qt[t]&&qt[t].forEach(function(t){t()}),Ht[t]&&(Ht[t].terminate(),delete Ht[t])}(u)},Se)),{timing:r}})}const ke=pe.webglUtils.resizeWebGLCanvasWithoutClearing,Te={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Ce=new M;function Ee(){return(self.performance||Date).now()}const Fe=Object.create(null);function Ae(t,e){t=function(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({},t);const n=Ee(),r=[];if(t.font&&r.push({label:"user",src:Pe(t.font)}),t.font=r,t.text=""+t.text,t.sdfGlyphSize=t.sdfGlyphSize||Te.sdfGlyphSize,t.unicodeFontsURL=t.unicodeFontsURL||Te.unicodeFontsURL,null!=t.colorRanges){let e={};for(let n in t.colorRanges)if(t.colorRanges.hasOwnProperty(n)){let r=t.colorRanges[n];"number"!=typeof r&&(r=Ce.set(r).getHex()),e[n]=r}t.colorRanges=e}Object.freeze(t);const{textureWidth:i,sdfExponent:a}=Te,{sdfGlyphSize:o}=t,s=i/o*4;let l=Fe[o];if(!l){const t=document.createElement("canvas");t.width=i,t.height=256*o/s,l=Fe[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:t,sdfTexture:new B(t,void 0,void 0,void 0,G,G),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,function(t){const e=t.sdfCanvas;e.addEventListener("webglcontextlost",e=>{e.preventDefault(),t.contextLost=!0}),e.addEventListener("webglcontextrestored",e=>{t.contextLost=!1;const n=[];t.glyphsByFont.forEach(e=>{e.forEach(e=>{n.push(Me(e,t,!0))})}),Promise.all(n).then(()=>{Re(t),t.sdfTexture.needsUpdate=!0})})}(l)}const{sdfTexture:c,sdfCanvas:u}=l;Ie(t).then(r=>{const{glyphIds:f,glyphFontIndices:d,fontData:h,glyphPositions:p,fontSize:v,timings:g}=r,m=[],y=new Float32Array(4*f.length);let x=0,b=0;const S=Ee(),w=h.map(t=>{let e=l.glyphsByFont.get(t.src);return e||l.glyphsByFont.set(t.src,e=new Map),e});f.forEach((t,e)=>{const n=d[e],{src:i,unitsPerEm:a}=h[n];let s=w[n].get(t);if(!s){const{path:e,pathBounds:a}=r.glyphData[i][t],c=Math.max(a[2]-a[0],a[3]-a[1])/o*(Te.sdfMargin*o+.5),u=l.glyphCount++,f=[a[0]-c,a[1]-c,a[2]+c,a[3]+c];w[n].set(t,s={path:e,atlasIndex:u,sdfViewBox:f}),m.push(s)}const{sdfViewBox:c}=s,u=p[b++],g=p[b++],S=v/a;y[x++]=u+c[0]*S,y[x++]=g+c[1]*S,y[x++]=u+c[2]*S,y[x++]=g+c[3]*S,f[e]=s.atlasIndex}),g.quads=(g.quads||0)+(Ee()-S);const U=Ee();g.sdf={};const _=u.height,k=Math.ceil(l.glyphCount/s),T=Math.pow(2,Math.ceil(Math.log2(k*o)));T>_&&(ke(u,i,T),c.dispose()),Promise.all(m.map(e=>Me(e,l,t.gpuAccelerateSDF).then(({timing:t})=>{g.sdf[e.atlasIndex]=t}))).then(()=>{m.length&&!l.contextLost&&(Re(l),c.needsUpdate=!0),g.sdfTotal=Ee()-U,g.total=Ee()-n,e(Object.freeze({parameters:t,sdfTexture:c,sdfGlyphSize:o,sdfExponent:a,glyphBounds:y,glyphAtlasIndices:f,glyphColors:r.glyphColors,caretPositions:r.caretPositions,chunkedBounds:r.chunkedBounds,ascender:r.ascender,descender:r.descender,lineHeight:r.lineHeight,capHeight:r.capHeight,xHeight:r.xHeight,topBaseline:r.topBaseline,blockBounds:r.blockBounds,visibleBounds:r.visibleBounds,timings:r.timings}))})}),Promise.resolve().then(()=>{var t;l.contextLost||(t=u)._warm||(pe.webgl.isSupported(t),t._warm=!0)})}function Me({path:t,atlasIndex:e,sdfViewBox:n},{sdfGlyphSize:r,sdfCanvas:i,contextLost:a},o){if(a)return Promise.resolve({timing:-1});const{textureWidth:s,sdfExponent:l}=Te,c=Math.max(n[2]-n[0],n[3]-n[1]),u=Math.floor(e/4);return function(t,e,n,r,i,a,o,s,l,c,u=!0){return u?xe(t,e,n,r,i,a,o,s,l,c).then(null,u=>(ve||(ve=!0),_e(t,e,n,r,i,a,o,s,l,c))):_e(t,e,n,r,i,a,o,s,l,c)}(r,r,t,n,c,l,i,u%(s/r)*r,Math.floor(u/(s/r))*r,e%4,o)}let De;function Pe(t){return De||(De="undefined"==typeof document?{}:document.createElement("a")),De.href=t,De.href}function Re(t){if("function"!=typeof createImageBitmap){const{sdfCanvas:e,sdfTexture:n}=t,{width:r,height:i}=e,a=t.sdfCanvas.getContext("webgl");let o=n.image.data;o&&o.length===r*i*4||(o=new Uint8Array(r*i*4),n.image={width:r,height:i,data:o},n.flipY=!1,n.isDataTexture=!0),a.readPixels(0,0,r,i,a.RGBA,a.UNSIGNED_BYTE,o)}}const Oe=Xt({name:"Typesetter",dependencies:[function(t,e){const n=1/0,r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,i="[^\\S\\u00A0]",a=new RegExp(`${i}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:o="",font:f,lang:d,sdfGlyphSize:h=64,fontSize:p=400,fontWeight:v=1,fontStyle:g="normal",letterSpacing:m=0,lineHeight:y="normal",maxWidth:x=n,direction:b,textAlign:S="left",textIndent:w=0,whiteSpace:U="normal",overflowWrap:_="normal",anchorX:k=0,anchorY:T=0,metricsOnly:C=!1,unicodeFontsURL:E,preResolvedFonts:F=null,includeCaretPositions:A=!1,chunkedBoundsSize:M=8192,colorRanges:D=null},P){const R=c(),O={fontLoad:0,typesetting:0};o.indexOf("\r")>-1&&(o=o.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,m=+m,x=+x,y=y||"normal",w=+w,function({text:e,lang:n,fonts:r,style:i,weight:a,preResolvedFonts:o,unicodeFontsURL:s},l){const c=({chars:t,fonts:e})=>{let n,r;const i=[];for(let a=0;a<t.length;a++)t[a]!==r?(r=t[a],i.push(n={start:a,end:a,fontObj:e[t[a]]})):n.end=a;l(i)};o?c(o):t(e,c,{lang:n,fonts:r,style:i,weight:a,unicodeFontsURL:s})}({text:o,lang:d,style:g,weight:v,fonts:"string"==typeof f?[{src:f}]:f,unicodeFontsURL:E,preResolvedFonts:F},t=>{O.fontLoad=c()-R;const f=isFinite(x);let d=null,h=null,v=null,g=null,E=null,F=null,I=null,L=null,B=0,G=0,z="nowrap"!==U;const j=new Map,W=c();let N=w,V=0,H=new u;const q=[H];t.forEach(t=>{const{fontObj:e}=t,{ascender:n,descender:s,unitsPerEm:l,lineGap:c,capHeight:d,xHeight:h}=e;let v=j.get(e);if(!v){const t=p/l,r="normal"===y?(n-s+c)*t:y*p,i=(r-(n-s)*t)/2,a=Math.min(r,(n-s)*t),o=(n+s)/2*t+a/2;v={index:j.size,src:e.src,fontObj:e,fontSizeMult:t,unitsPerEm:l,ascender:n*t,descender:s*t,capHeight:d*t,xHeight:h*t,lineHeight:r,baseline:-i-n*t,caretTop:o,caretBottom:o-a},j.set(e,v)}const{fontSizeMult:g}=v,b=o.slice(t.start,t.end+1);let S,U;e.forEachGlyph(b,p,m,(e,n,s,l)=>{n+=V,l+=t.start,S=n,U=e;const c=o.charAt(l),d=e.advanceWidth*g,h=H.count;let y;if("isEmpty"in e||(e.isWhitespace=!!c&&new RegExp(i).test(c),e.canBreakAfter=!!c&&a.test(c),e.isEmpty=e.xMin===e.xMax||e.yMin===e.yMax||r.test(c)),e.isWhitespace||e.isEmpty||G++,z&&f&&!e.isWhitespace&&n+d+N>x&&h){if(H.glyphAt(h-1).glyphObj.canBreakAfter)y=new u,N=-n;else for(let t=h;t--;){if(0===t&&"break-word"===_){y=new u,N=-n;break}if(H.glyphAt(t).glyphObj.canBreakAfter){y=H.splitAt(t+1);const e=y.glyphAt(0).x;N-=e;for(let t=y.count;t--;)y.glyphAt(t).x-=e;break}}y&&(H.isSoftWrapped=!0,H=y,q.push(H),B=x)}let b=H.glyphAt(H.count);b.glyphObj=e,b.x=n+N,b.y=s,b.width=d,b.charIndex=l,b.fontData=v,"\n"===c&&(H=new u,q.push(H),N=-(n+d+m*p)+w)}),V=S+U.advanceWidth*g+m*p});let $=0;q.forEach(t=>{let e=!0;for(let n=t.count;n--;){const r=t.glyphAt(n);e&&!r.glyphObj.isWhitespace&&(t.width=r.x+r.width,t.width>B&&(B=t.width),e=!1);let{lineHeight:i,capHeight:a,xHeight:o,baseline:s}=r.fontData;i>t.lineHeight&&(t.lineHeight=i);const l=s-t.baseline;l<0&&(t.baseline+=l,t.cap+=l,t.ex+=l),t.cap=Math.max(t.cap,t.baseline+a),t.ex=Math.max(t.ex,t.baseline+o)}t.baseline-=$,t.cap-=$,t.ex-=$,$+=t.lineHeight});let X=0,Y=0;if(k&&("number"==typeof k?X=-k:"string"==typeof k&&(X=-B*("left"===k?0:"center"===k?.5:"right"===k?1:s(k)))),T&&("number"==typeof T?Y=-T:"string"==typeof T&&(Y="top"===T?0:"top-baseline"===T?-q[0].baseline:"top-cap"===T?-q[0].cap:"top-ex"===T?-q[0].ex:"middle"===T?$/2:"bottom"===T?$:"bottom-baseline"===T?-q[q.length-1].baseline:s(T)*$)),!C){const t=e.getEmbeddingLevels(o,b);d=new Uint16Array(G),h=new Uint8Array(G),v=new Float32Array(2*G),g={},I=[n,n,-1/0,-1/0],L=[],A&&(F=new Float32Array(4*o.length)),D&&(E=new Uint8Array(3*G));let r,i,a=0,s=-1,c=-1;if(q.forEach((u,f)=>{let{count:p,width:m}=u;if(p>0){let f=0;for(let t=p;t--&&u.glyphAt(t).glyphObj.isWhitespace;)f++;let y=0,x=0;if("center"===S)y=(B-m)/2;else if("right"===S)y=B-m;else if("justify"===S&&u.isSoftWrapped){let t=0;for(let e=p-f;e--;)u.glyphAt(e).glyphObj.isWhitespace&&t++;x=(B-m)/t}if(x||y){let t=0;for(let e=0;e<p;e++){let n=u.glyphAt(e);const r=n.glyphObj;n.x+=y+t,0!==x&&r.isWhitespace&&e<p-f&&(t+=x,n.width+=x)}}const b=e.getReorderSegments(o,t,u.glyphAt(0).charIndex,u.glyphAt(u.count-1).charIndex);for(let t=0;t<b.length;t++){const[e,n]=b[t];let r=1/0,i=-1/0;for(let t=0;t<p;t++)if(u.glyphAt(t).charIndex>=e){let e=t,a=t;for(;a<p;a++){let t=u.glyphAt(a);if(t.charIndex>n)break;a<p-f&&(r=Math.min(r,t.x),i=Math.max(i,t.x+t.width))}for(let t=e;t<a;t++){const e=u.glyphAt(t);e.x=i-(e.x+e.width-r)}break}}let w;const U=t=>w=t;for(let m=0;m<p;m++){const f=u.glyphAt(m);w=f.glyphObj;const p=w.index,y=1&t.levels[f.charIndex];if(y){const t=e.getMirroredCharacter(o[f.charIndex]);t&&f.fontData.fontObj.forEachGlyph(t,0,0,U)}if(A){const{charIndex:t,fontData:e}=f,n=f.x+X,r=f.x+f.width+X;F[4*t]=y?r:n,F[4*t+1]=y?n:r,F[4*t+2]=u.baseline+e.caretBottom+Y,F[4*t+3]=u.baseline+e.caretTop+Y;const i=t-s;i>1&&l(F,s,i),s=t}if(D){const{charIndex:t}=f;for(;t>c;)c++,D.hasOwnProperty(c)&&(i=D[c])}if(!w.isWhitespace&&!w.isEmpty){const t=a++,{fontSizeMult:e,src:o,index:s}=f.fontData,l=g[o]||(g[o]={});l[p]||(l[p]={path:w.path,pathBounds:[w.xMin,w.yMin,w.xMax,w.yMax]});const c=f.x+X,m=f.y+u.baseline+Y;v[2*t]=c,v[2*t+1]=m;const y=c+w.xMin*e,x=m+w.yMin*e,b=c+w.xMax*e,S=m+w.yMax*e;y<I[0]&&(I[0]=y),x<I[1]&&(I[1]=x),b>I[2]&&(I[2]=b),S>I[3]&&(I[3]=S),t%M===0&&(r={start:t,end:t,rect:[n,n,-1/0,-1/0]},L.push(r)),r.end++;const U=r.rect;if(y<U[0]&&(U[0]=y),x<U[1]&&(U[1]=x),b>U[2]&&(U[2]=b),S>U[3]&&(U[3]=S),d[t]=p,h[t]=s,D){const e=3*t;E[e]=i>>16&255,E[e+1]=i>>8&255,E[e+2]=255&i}}}}}),F){const t=o.length-s;t>1&&l(F,s,t)}}const K=[];j.forEach(({index:t,src:e,unitsPerEm:n,ascender:r,descender:i,lineHeight:a,capHeight:o,xHeight:s})=>{K[t]={src:e,unitsPerEm:n,ascender:r,descender:i,lineHeight:a,capHeight:o,xHeight:s}}),O.typesetting=c()-W,P({glyphIds:d,glyphFontIndices:h,glyphPositions:v,glyphData:g,fontData:K,caretPositions:F,glyphColors:E,chunkedBounds:L,fontSize:p,topBaseline:Y+q[0].baseline,blockBounds:[X,Y-$,X+B,Y],visibleBounds:I,timings:O})})}function s(t){let e=t.match(/^([\d.]+)%$/),n=e?parseFloat(e[1]):NaN;return isNaN(n)?0:n/100}function l(t,e,n){const r=t[4*e],i=t[4*e+1],a=t[4*e+2],o=t[4*e+3],s=(i-r)/n;for(let l=0;l<n;l++){const n=4*(e+l);t[n]=r+s*l,t[n+1]=r+s*(l+1),t[n+2]=a,t[n+3]=o}}function c(){return(self.performance||Date).now()}function u(){this.data=[]}const f=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(t){let e=u.flyweight;return e.data=this.data,e.index=t,e},splitAt(t){let e=new u;return e.data=this.data.splice(t*f.length),e}},u.flyweight=f.reduce((t,e,n,r)=>(Object.defineProperty(t,e,{get(){return this.data[this.index*f.length+n]},set(t){this.data[this.index*f.length+n]=t}}),t),{data:null,index:0}),{typeset:o,measure:function(t,e){o({...t,metricsOnly:!0},t=>{const[n,r,i,a]=t.blockBounds;e({width:i-n,height:a-r})})}}},de,function(){return function(t){var e={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(e).forEach(function(t,e){n[t]=1<<e+1,r[n[t]]=t}),Object.freeze(n);var i=n.LRI|n.RLI|n.FSI,a=n.L|n.R|n.AL,o=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,s=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,l=n.S|n.WS|n.B|i|n.PDI|s,c=null;function u(t){return function(){if(!c){c=new Map;var t=function(t){if(e.hasOwnProperty(t)){var r=0;e[t].split(",").forEach(function(e){var i=e.split("+"),a=i[0],o=i[1];a=parseInt(a,36),o=o?parseInt(o,36):0,c.set(r+=a,n[t]);for(var s=0;s<o;s++)c.set(++r,n[t])})}};for(var r in e)t(r)}}(),c.get(t.codePointAt(0))||n.L}var f,d,h,p="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",v="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function g(t,e){var n,r=0,i=new Map,a=e&&new Map;return t.split(",").forEach(function t(o){if(-1!==o.indexOf("+"))for(var s=+o;s--;)t(n);else{n=o;var l=o.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(r+=parseInt(c,36)),u=String.fromCodePoint(r+=parseInt(u,36)),i.set(c,u),e&&a.set(u,c)}}),{map:i,reverseMap:a}}function m(){if(!f){var t=g(p,!0),e=t.map,n=t.reverseMap;f=e,d=n,h=g(v,!1).map}}function y(t){return m(),f.get(t)||null}function x(t){return m(),d.get(t)||null}function b(t){return m(),h.get(t)||null}var S=n.L,w=n.R,U=n.EN,_=n.ES,k=n.ET,T=n.AN,C=n.CS,E=n.B,F=n.S,A=n.ON,M=n.BN,D=n.NSM,P=n.AL,R=n.LRO,O=n.RLO,I=n.LRE,L=n.RLE,B=n.PDF,G=n.LRI,z=n.RLI,j=n.FSI,W=n.PDI;var N;function V(t){return function(){if(!N){var t=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),e=t.map;t.reverseMap.forEach(function(t,n){e.set(n,t)}),N=e}}(),N.get(t)||null}function H(t,e,n,r){var i=t.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);var a=[];return e.paragraphs.forEach(function(i){var o=Math.max(n,i.start),s=Math.min(r,i.end);if(o<s){for(var c=e.levels.slice(o,s+1),f=s;f>=o&&u(t[f])&l;f--)c[f]=i.level;for(var d=i.level,h=1/0,p=0;p<c.length;p++){var v=c[p];v>d&&(d=v),v<h&&(h=1|v)}for(var g=d;g>=h;g--)for(var m=0;m<c.length;m++)if(c[m]>=g){for(var y=m;m+1<c.length&&c[m+1]>=g;)m++;m>y&&a.push([y+o,m+o])}}}),a}function q(t,e,n,r){for(var i=H(t,e,n,r),a=[],o=0;o<t.length;o++)a[o]=o;return i.forEach(function(t){for(var e=t[0],n=t[1],r=a.slice(e,n+1),i=r.length;i--;)a[n-i]=r[i]}),a}return t.closingToOpeningBracket=x,t.getBidiCharType=u,t.getBidiCharTypeName=function(t){return r[u(t)]},t.getCanonicalBracket=b,t.getEmbeddingLevels=function(t,e){for(var n=new Uint32Array(t.length),r=0;r<t.length;r++)n[r]=u(t[r]);var c=new Map;function f(t,e){var r=n[t];n[t]=e,c.set(r,c.get(r)-1),r&o&&c.set(o,c.get(o)-1),c.set(e,(c.get(e)||0)+1),e&o&&c.set(o,(c.get(o)||0)+1)}for(var d=new Uint8Array(t.length),h=new Map,p=[],v=null,g=0;g<t.length;g++)v||p.push(v={start:g,end:t.length-1,level:"rtl"===e?1:"ltr"===e?0:je(g,!1)}),n[g]&E&&(v.end=g,v=null);for(var m=L|I|O|R|i|W|B|E,N=function(t){return t+(1&t?1:2)},V=function(t){return t+(1&t?2:1)},H=0;H<p.length;H++){var q=[{_level:(v=p[H]).level,_override:0,_isolate:0}],$=void 0,X=0,Y=0,K=0;c.clear();for(var Z=v.start;Z<=v.end;Z++){var J=n[Z];if($=q[q.length-1],c.set(J,(c.get(J)||0)+1),J&o&&c.set(o,(c.get(o)||0)+1),J&m)if(J&(L|I)){d[Z]=$._level;var Q=(J===L?V:N)($._level);Q<=125&&!X&&!Y?q.push({_level:Q,_override:0,_isolate:0}):X||Y++}else if(J&(O|R)){d[Z]=$._level;var tt=(J===O?V:N)($._level);tt<=125&&!X&&!Y?q.push({_level:tt,_override:J&O?w:S,_isolate:0}):X||Y++}else if(J&i){J&j&&(J=1===je(Z+1,!0)?z:G),d[Z]=$._level,$._override&&f(Z,$._override);var et=(J===z?V:N)($._level);et<=125&&0===X&&0===Y?(K++,q.push({_level:et,_override:0,_isolate:1,_isolInitIndex:Z})):X++}else if(J&W){if(X>0)X--;else if(K>0){for(Y=0;!q[q.length-1]._isolate;)q.pop();var nt=q[q.length-1]._isolInitIndex;null!=nt&&(h.set(nt,Z),h.set(Z,nt)),q.pop(),K--}$=q[q.length-1],d[Z]=$._level,$._override&&f(Z,$._override)}else J&B?(0===X&&(Y>0?Y--:!$._isolate&&q.length>1&&(q.pop(),$=q[q.length-1])),d[Z]=$._level):J&E&&(d[Z]=v.level);else d[Z]=$._level,$._override&&J!==M&&f(Z,$._override)}for(var rt=[],it=null,at=v.start;at<=v.end;at++){var ot=n[at];if(!(ot&s)){var st=d[at],lt=ot&i,ct=ot===W;it&&st===it._level?(it._end=at,it._endsWithIsolInit=lt):rt.push(it={_start:at,_end:at,_level:st,_startsWithPDI:ct,_endsWithIsolInit:lt})}}for(var ut=[],ft=0;ft<rt.length;ft++){var dt=rt[ft];if(!dt._startsWithPDI||dt._startsWithPDI&&!h.has(dt._start)){for(var ht=[it=dt],pt=void 0;it&&it._endsWithIsolInit&&null!=(pt=h.get(it._end));)for(var vt=ft+1;vt<rt.length;vt++)if(rt[vt]._start===pt){ht.push(it=rt[vt]);break}for(var gt=[],mt=0;mt<ht.length;mt++)for(var yt=ht[mt],xt=yt._start;xt<=yt._end;xt++)gt.push(xt);for(var bt=d[gt[0]],St=v.level,wt=gt[0]-1;wt>=0;wt--)if(!(n[wt]&s)){St=d[wt];break}var Ut=gt[gt.length-1],_t=d[Ut],kt=v.level;if(!(n[Ut]&i))for(var Tt=Ut+1;Tt<=v.end;Tt++)if(!(n[Tt]&s)){kt=d[Tt];break}ut.push({_seqIndices:gt,_sosType:Math.max(St,bt)%2?w:S,_eosType:Math.max(kt,_t)%2?w:S})}}for(var Ct=0;Ct<ut.length;Ct++){var Et=ut[Ct],Ft=Et._seqIndices,At=Et._sosType,Mt=Et._eosType,Dt=1&d[Ft[0]]?w:S;if(c.get(D))for(var Pt=0;Pt<Ft.length;Pt++){var Rt=Ft[Pt];if(n[Rt]&D){for(var Ot=At,It=Pt-1;It>=0;It--)if(!(n[Ft[It]]&s)){Ot=n[Ft[It]];break}f(Rt,Ot&(i|W)?A:Ot)}}if(c.get(U))for(var Lt=0;Lt<Ft.length;Lt++){var Bt=Ft[Lt];if(n[Bt]&U)for(var Gt=Lt-1;Gt>=-1;Gt--){var zt=-1===Gt?At:n[Ft[Gt]];if(zt&a){zt===P&&f(Bt,T);break}}}if(c.get(P))for(var jt=0;jt<Ft.length;jt++){var Wt=Ft[jt];n[Wt]&P&&f(Wt,w)}if(c.get(_)||c.get(C))for(var Nt=1;Nt<Ft.length-1;Nt++){var Vt=Ft[Nt];if(n[Vt]&(_|C)){for(var Ht=0,qt=0,$t=Nt-1;$t>=0&&(Ht=n[Ft[$t]])&s;$t--);for(var Xt=Nt+1;Xt<Ft.length&&(qt=n[Ft[Xt]])&s;Xt++);Ht===qt&&(n[Vt]===_?Ht===U:Ht&(U|T))&&f(Vt,Ht)}}if(c.get(U))for(var Yt=0;Yt<Ft.length;Yt++){var Kt=Ft[Yt];if(n[Kt]&U){for(var Zt=Yt-1;Zt>=0&&n[Ft[Zt]]&(k|s);Zt--)f(Ft[Zt],U);for(Yt++;Yt<Ft.length&&n[Ft[Yt]]&(k|s|U);Yt++)n[Ft[Yt]]!==U&&f(Ft[Yt],U)}}if(c.get(k)||c.get(_)||c.get(C))for(var Jt=0;Jt<Ft.length;Jt++){var Qt=Ft[Jt];if(n[Qt]&(k|_|C)){f(Qt,A);for(var te=Jt-1;te>=0&&n[Ft[te]]&s;te--)f(Ft[te],A);for(var ee=Jt+1;ee<Ft.length&&n[Ft[ee]]&s;ee++)f(Ft[ee],A)}}if(c.get(U))for(var ne=0,re=At;ne<Ft.length;ne++){var ie=Ft[ne],ae=n[ie];ae&U?re===S&&f(ie,S):ae&a&&(re=ae)}if(c.get(o)){for(var oe=w|U|T,se=oe|S,le=[],ce=[],ue=0;ue<Ft.length;ue++)if(n[Ft[ue]]&o){var fe=t[Ft[ue]],de=void 0;if(null!==y(fe)){if(!(ce.length<63))break;ce.push({char:fe,seqIndex:ue})}else if(null!==(de=x(fe)))for(var he=ce.length-1;he>=0;he--){var pe=ce[he].char;if(pe===de||pe===x(b(fe))||y(b(pe))===fe){le.push([ce[he].seqIndex,ue]),ce.length=he;break}}}le.sort(function(t,e){return t[0]-e[0]});for(var ve=0;ve<le.length;ve++){for(var ge=le[ve],me=ge[0],ye=ge[1],xe=!1,be=0,Se=me+1;Se<ye;Se++){var we=Ft[Se];if(n[we]&se){xe=!0;var Ue=n[we]&oe?w:S;if(Ue===Dt){be=Ue;break}}}if(xe&&!be){be=At;for(var _e=me-1;_e>=0;_e--){var ke=Ft[_e];if(n[ke]&se){var Te=n[ke]&oe?w:S;be=Te!==Dt?Te:Dt;break}}}if(be){if(n[Ft[me]]=n[Ft[ye]]=be,be!==Dt)for(var Ce=me+1;Ce<Ft.length;Ce++)if(!(n[Ft[Ce]]&s)){u(t[Ft[Ce]])&D&&(n[Ft[Ce]]=be);break}if(be!==Dt)for(var Ee=ye+1;Ee<Ft.length;Ee++)if(!(n[Ft[Ee]]&s)){u(t[Ft[Ee]])&D&&(n[Ft[Ee]]=be);break}}}for(var Fe=0;Fe<Ft.length;Fe++)if(n[Ft[Fe]]&o){for(var Ae=Fe,Me=Fe,De=At,Pe=Fe-1;Pe>=0;Pe--){if(!(n[Ft[Pe]]&s)){De=n[Ft[Pe]]&oe?w:S;break}Ae=Pe}for(var Re=Mt,Oe=Fe+1;Oe<Ft.length;Oe++){if(!(n[Ft[Oe]]&(o|s))){Re=n[Ft[Oe]]&oe?w:S;break}Me=Oe}for(var Ie=Ae;Ie<=Me;Ie++)n[Ft[Ie]]=De===Re?De:Dt;Fe=Me}}}for(var Le=v.start;Le<=v.end;Le++){var Be=d[Le],Ge=n[Le];if(1&Be?Ge&(S|U|T)&&d[Le]++:Ge&w?d[Le]++:Ge&(T|U)&&(d[Le]+=2),Ge&s&&(d[Le]=0===Le?v.level:d[Le-1]),Le===v.end||u(t[Le])&(F|E))for(var ze=Le;ze>=0&&u(t[ze])&l;ze--)d[ze]=v.level}}return{levels:d,paragraphs:p};function je(e,r){for(var a=e;a<t.length;a++){var o=n[a];if(o&(w|P))return 1;if(o&(E|S)||r&&o===W)return 0;if(o&i){var s=We(a);a=-1===s?t.length:s}}return 0}function We(e){for(var r=1,a=e+1;a<t.length;a++){var o=n[a];if(o&E)break;if(o&W){if(0===--r)return a}else o&i&&r++}return-1}},t.getMirroredCharacter=V,t.getMirroredCharactersMap=function(t,e,n,r){var i=t.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);for(var a=new Map,o=n;o<=r;o++)if(1&e[o]){var s=V(t[o]);null!==s&&a.set(o,s)}return a},t.getReorderSegments=H,t.getReorderedIndices=q,t.getReorderedString=function(t,e,n,r){var i=q(t,e,n,r),a=[].concat(t);return i.forEach(function(n,r){a[r]=(1&e.levels[n]?V(t[n]):null)||t[n]}),a.join("")},t.openingToClosingBracket=y,Object.defineProperty(t,"__esModule",{value:!0}),t}({})}],init:(t,e,n)=>t(e,n())}),Ie=Xt({name:"Typesetter",dependencies:[Oe],init:t=>function(e){return new Promise(n=>{t.typeset(e,n)})},getTransferables(t){const e=[];for(let n in t)t[n]&&t[n].buffer&&e.push(t[n].buffer);return e}});Ie.onMainThread;const Le={};const Be="aTroikaGlyphIndex";class Ge extends g{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new w,this.boundingBox=new S}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,("number"!=typeof t||t<1)&&(t=1);let e=function(t){let e=Le[t];return e||(e=Le[t]=new j(1,1,t,t).translate(.5,.5,0)),e}(t);["position","normal","uv"].forEach(t=>{this.attributes[t]=e.attributes[t].clone()}),this.setIndex(e.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,e,n,r,i){this.updateAttributeData("aTroikaGlyphBounds",t,4),this.updateAttributeData(Be,e,1),this.updateAttributeData("aTroikaGlyphColor",i,3),this._blockBounds=n,this._chunkedBounds=r,this.instanceCount=e.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:e,boundingBox:n}=this;if(e){const{PI:r,floor:i,min:a,max:o,sin:s,cos:l}=Math,c=r/2,u=2*r,f=Math.abs(e),d=t[0]/f,h=t[2]/f,p=i((d+c)/u)!==i((h+c)/u)?-f:a(s(d)*f,s(h)*f),v=i((d-c)/u)!==i((h-c)/u)?f:o(s(d)*f,s(h)*f),g=i((d+r)/u)!==i((h+r)/u)?2*f:o(f-l(d)*f,f-l(h)*f);n.min.set(p,t[1],e<0?-g:0),n.max.set(v,t[3],e<0?0:g)}else n.min.set(t[0],t[1],0),n.max.set(t[2],t[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let e=this.getAttribute(Be).count,n=this._chunkedBounds;if(n)for(let r=n.length;r--;){e=n[r].end;let i=n[r].rect;if(i[1]<t.w&&i[3]>t.y&&i[0]<t.z&&i[2]>t.x)break}this.instanceCount=e}updateAttributeData(t,e,n){const r=this.getAttribute(t);e?r&&r.array.length===e.length?(r.array.set(e),r.needsUpdate=!0):(this.setAttribute(t,new L(e,n)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(t)}}const ze=new I({color:0xffffff,side:u,transparent:!0}),je=8421504,We=new F,Ne=new f,Ve=new f,He=[],qe=new f,$e="+x+y";function Xe(t){return Array.isArray(t)?t[0]:t}let Ye=()=>{const t=new T(new j(1,1),ze);return Ye=()=>t,t},Ke=()=>{const t=new T(new j(1,1,32,1),ze);return Ke=()=>t,t};const Ze={type:"syncstart"},Je={type:"synccomplete"},Qe=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],tn=Qe.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let en=class extends T{constructor(){super(new Ge,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=je,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=$e,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(Ze),Ae({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},e=>{this._isSyncing=!1,this._textRenderInfo=e,this.geometry.updateGlyphs(e.glyphBounds,e.glyphAtlasIndices,e.blockBounds,e.chunkedBounds,e.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(t=>t&&t())})),this.dispatchEvent(Je),t&&t()})))}onBeforeRender(t,e,n,r,i,a){this.sync(),i.isTroikaTextMaterial&&this._prepareForRender(i)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return function(t){const e=oe(t,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new d},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new C(0,0,0,0)},uTroikaClipRect:{value:new C(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new d},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new M},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new z},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:t,fragmentShader:e}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(e)&&(e=e.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(t)||(t=t.replace(Jt,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:e}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}(t)}get material(){let t=this._derivedMaterial;const e=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=ze.clone());if(t&&t.isDerivedFrom(e)||(t=this._derivedMaterial=this.createDerivedMaterial(e),e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),t.dispose()})),this.hasOutline()){let e=t._outlineMtl;return e||(e=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),e.isTextOutlineMaterial=!0,e.depthWrite=!1,e.map=null,t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),[e,t]}return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return Xe(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return Xe(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const e=t.isTextOutlineMaterial,n=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:t,blockBounds:i}=r;n.uTroikaSDFTexture.value=t,n.uTroikaSDFTextureSize.value.set(t.image.width,t.image.height),n.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,n.uTroikaSDFExponent.value=r.sdfExponent,n.uTroikaTotalBounds.value.fromArray(i),n.uTroikaUseGlyphColors.value=!e&&!!r.glyphColors;let a,o,s,l=0,c=0,u=0,f=0,d=0;if(e){let{outlineWidth:t,outlineOffsetX:e,outlineOffsetY:n,outlineBlur:r,outlineOpacity:i}=this;l=this._parsePercent(t)||0,c=Math.max(0,this._parsePercent(r)||0),a=i,f=this._parsePercent(e)||0,d=this._parsePercent(n)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(s=this.strokeColor,n.uTroikaStrokeColor.value.set(null==s?je:s),o=this.strokeOpacity,null==o&&(o=1)),a=this.fillOpacity;n.uTroikaEdgeOffset.value=l,n.uTroikaPositionOffset.value.set(f,d),n.uTroikaBlurRadius.value=c,n.uTroikaStrokeWidth.value=u,n.uTroikaStrokeOpacity.value=o,n.uTroikaFillOpacity.value=null==a?1:a,n.uTroikaCurveRadius.value=this.curveRadius||0;let h=this.clipRect;if(h&&Array.isArray(h)&&4===h.length)n.uTroikaClipRect.value.fromArray(h);else{const t=100*(this.fontSize||.1);n.uTroikaClipRect.value.set(i[0]-t,i[1]-t,i[2]+t,i[3]+t)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const i=e?this.outlineColor||0:this.color;if(null==i)delete t.color;else{const e=t.hasOwnProperty("color")?t.color:t.color=new M;i===e._input&&"object"!=typeof i||e.set(e._input=i)}let a=this.orientation||$e;if(a!==t._orientation){let e=n.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let r=a!==$e&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,t,n,i,a]=r;Ne.set(0,0,0)[n]="-"===t?1:-1,Ve.set(0,0,0)[a]="-"===i?-1:1,We.lookAt(qe,Ne.cross(Ve),Ve),e.setFromMatrix4(We)}else e.identity();t._orientation=a}}_parsePercent(t){if("string"==typeof t){let e=t.match(/^(-?[\d.]+)%$/),n=e?parseFloat(e[1]):NaN;t=(isNaN(n)?0:n/100)*this.fontSize}return t}localPositionToTextCoords(t,e=new d){e.copy(t);const n=this.curveRadius;return n&&(e.x=Math.atan2(t.x,Math.abs(n)-Math.abs(t.z))*Math.abs(n)),e}worldPositionToTextCoords(t,e=new d){return Ne.copy(t),this.localPositionToTextCoords(this.worldToLocal(Ne),e)}raycast(t,e){const{textRenderInfo:n,curveRadius:r}=this;if(n){const i=n.blockBounds,a=r?Ke():Ye(),o=a.geometry,{position:s,uv:l}=o.attributes;for(let t=0;t<l.count;t++){let e=i[0]+l.getX(t)*(i[2]-i[0]);const n=i[1]+l.getY(t)*(i[3]-i[1]);let a=0;r&&(a=r-Math.cos(e/r)*r,e=Math.sin(e/r)*r),s.setXYZ(t,e,n,a)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,He.length=0,a.raycast(t,He);for(let t=0;t<He.length;t++)He[t].object=this,e.push(He[t])}}copy(t){const e=this.geometry;return super.copy(t),this.geometry=e,tn.forEach(e=>{this[e]=t[e]}),this}clone(){return(new this.constructor).copy(this)}};Qe.forEach(t=>{const e="_private_"+t;Object.defineProperty(en.prototype,t,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})}),new S,new M;const nn=r.forwardRef(({sdfGlyphSize:t=64,anchorX:e="center",anchorY:n="middle",font:i,fontSize:a=1,children:o,characters:l,onSync:u,...f},d)=>{const h=s(({invalidate:t})=>t),[p]=r.useState(()=>new en),[v,g]=r.useMemo(()=>{const t=[];let e="";return r.Children.forEach(o,n=>{"string"==typeof n||"number"==typeof n?e+=n:t.push(n)}),[t,e]},[o]);return nt(()=>new Promise(t=>function({font:t,characters:e,sdfGlyphSize:n},r){Ae({font:t,sdfGlyphSize:n,text:Array.isArray(e)?e.join("\n"):""+e},r)}({font:i,characters:l},t)),["troika-text",i,l]),r.useLayoutEffect(()=>{p.sync(()=>{h(),u&&u(p)})}),r.useEffect(()=>()=>p.dispose(),[p]),r.createElement("primitive",c({object:p,ref:d,font:i,text:g,anchorX:e,anchorY:n,fontSize:a,sdfGlyphSize:t},f),v)});function rn(t,e,n,r){var i;return(i=class extends U{constructor(r){super({vertexShader:e,fragmentShader:n,...r});for(const e in t)this.uniforms[e]=new W(t[e]),Object.defineProperty(this,e,{get(){return this.uniforms[e].value},set(t){this.uniforms[e].value=t}});this.uniforms=_.clone(this.uniforms)}}).key=A.generateUUID(),i}const an=(()=>parseInt(v.replace(/\D+/g,"")))();const on=r.forwardRef(({envMap:t,resolution:e=256,frames:n=1/0,makeDefault:i,children:a,...o},u)=>{const f=s(({set:t})=>t),d=s(({camera:t})=>t),h=s(({size:t})=>t),p=r.useRef(null);r.useImperativeHandle(u,()=>p.current,[]);const v=r.useRef(null),g=function(t,e,n){const i=s(t=>t.size),a=s(t=>t.viewport),o="number"==typeof t?t:i.width*a.dpr,l=i.height*a.dpr,c=("number"==typeof t?n:t)||{},{samples:u=0,depth:f,...d}=c,h=null!=f?f:c.depthBuffer,p=r.useMemo(()=>{const t=new N(o,l,{minFilter:G,magFilter:G,type:V,...d});return h&&(t.depthTexture=new H(o,l,q)),t.samples=u,t},[]);return r.useLayoutEffect(()=>{p.setSize(o,l),u&&(p.samples=u)},[u,p,o,l]),r.useEffect(()=>()=>p.dispose(),[]),p}(e);r.useLayoutEffect(()=>{o.manual||(p.current.aspect=h.width/h.height)},[h,o]),r.useLayoutEffect(()=>{p.current.updateProjectionMatrix()});let m=0,y=null;const x="function"==typeof a;return l(e=>{x&&(n===1/0||m<n)&&(v.current.visible=!1,e.gl.setRenderTarget(g),y=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,p.current),e.scene.background=y,e.gl.setRenderTarget(null),v.current.visible=!0,m++)}),r.useLayoutEffect(()=>{if(i){const t=d;return f(()=>({camera:p.current})),()=>f(()=>({camera:t}))}},[p,i,f]),r.createElement(r.Fragment,null,r.createElement("perspectiveCamera",c({ref:p},o),!x&&a),r.createElement("group",{ref:v},x&&a(g.texture)))}),sn=rn({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new M,sectionColor:new M,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new f,worldPlanePosition:new f},"\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform vec3 worldPlanePosition;\n    uniform float fadeDistance;\n    uniform bool infiniteGrid;\n    uniform bool followCamera;\n\n    void main() {\n      localPosition = position.xzy;\n      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n      \n      worldPosition = modelMatrix * vec4(localPosition, 1.0);\n      if (followCamera) {\n        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n        localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n      }\n\n      gl_Position = projectionMatrix * viewMatrix * worldPosition;\n    }\n  ",`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${an>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),ln=r.forwardRef(({args:t,cellColor:e="#000000",sectionColor:n="#2080ff",cellSize:i=.5,sectionSize:a=1,followCamera:o=!1,infiniteGrid:s=!1,fadeDistance:u=100,fadeStrength:d=1,fadeFrom:h=1,cellThickness:p=.5,sectionThickness:v=1,side:g=X,...m},y)=>{$({GridMaterial:sn});const x=r.useRef(null);r.useImperativeHandle(y,()=>x.current,[]);const b=new Y,S=new f(0,1,0),w=new f(0,0,0);l(t=>{b.setFromNormalAndCoplanarPoint(S,w).applyMatrix4(x.current.matrixWorld);const e=x.current.material,n=e.uniforms.worldCamProjPosition,r=e.uniforms.worldPlanePosition;b.projectPoint(t.camera.position,n.value),r.value.set(0,0,0).applyMatrix4(x.current.matrixWorld)});const U={cellSize:i,sectionSize:a,cellColor:e,sectionColor:n,cellThickness:p,sectionThickness:v},_={fadeDistance:u,fadeStrength:d,fadeFrom:h,infiniteGrid:s,followCamera:o};return r.createElement("mesh",c({ref:x,frustumCulled:!1},m),r.createElement("gridMaterial",c({transparent:!0,"extensions-derivatives":!0,side:g},U,_)),r.createElement("planeGeometry",{args:t}))});function cn(t,e){const n=t+"Geometry";return r.forwardRef(({args:t,children:i,...a},o)=>{const s=r.useRef(null);return r.useImperativeHandle(o,()=>s.current),r.useLayoutEffect(()=>{null==e||e(s.current)}),r.createElement("mesh",c({ref:s},a),r.createElement(n,{attach:"geometry",args:t}),i)})}const un=cn("circle"),fn={showLabels:!0,showNodeDetails:!0,nodeScale:1,edgeWidth:2,linkDistance:250,chargeStrength:-2e3,gravity:.01,friction:.6,maxFPS:60,lodEnabled:!0,highContrast:!1,reducedMotion:!1},dn=K(t=>({sidebarOpen:!0,sidebarTab:"details",menuOpen:null,loadingProgress:0,loadingMessage:"",notifications:[],viewport:{zoom:1,rotation:[0,0,0],target:[0,0,0],mode:"2d"},settings:fn,toggleSidebar:()=>t(t=>({sidebarOpen:!t.sidebarOpen})),setSidebarTab:e=>t({sidebarTab:e}),setMenuOpen:e=>t({menuOpen:e}),setLoadingProgress:(e,n)=>t({loadingProgress:e,loadingMessage:n||""}),addNotification:e=>t(n=>{const r=`notification-${Date.now()}-${Math.random()}`,i={...e,id:r};return 0!==e.duration&&setTimeout(()=>{t(t=>({notifications:t.notifications.filter(t=>t.id!==r)}))},e.duration||5e3),{notifications:[...n.notifications,i]}}),removeNotification:e=>t(t=>({notifications:t.notifications.filter(t=>t.id!==e)})),setZoom:e=>t(t=>({viewport:{...t.viewport,zoom:e}})),setRotation:e=>t(t=>({viewport:{...t.viewport,rotation:e}})),setTarget:e=>t(t=>({viewport:{...t.viewport,target:e}})),toggleViewMode:()=>t(t=>({viewport:{...t.viewport,mode:"2d"===t.viewport.mode?"3d":"2d"}})),updateSettings:e=>t(t=>({settings:{...t.settings,...e}})),resetSettings:()=>t({settings:fn})})),hn={logForces:!1,logPositions:!1,logVelocities:!1,logAlpha:!1,logRepulsion:!1,logAttraction:!1,logCentering:!1,logBarnesHut:!1,logFPS:!1,logIterations:!1,logNodeCount:!1,showQuadtree:!1,showForceVectors:!1,showVelocityVectors:!1,highlightClusters:!1,logInterval:10,trackNodes:[],logPositionHistory:!1,positionHistorySize:100};const pn=new class{config;iteration=0;positionHistory=new Map;constructor(){const t=localStorage.getItem("wasmvowl-debug-config");this.config=t?{...hn,...JSON.parse(t)}:{...hn};"true"===new URLSearchParams(window.location.search).get("debug")&&this.enableAllLogging()}get(){return this.config}set(t){this.config={...this.config,...t},localStorage.setItem("wasmvowl-debug-config",JSON.stringify(this.config))}enableAllLogging(){this.set({logForces:!0,logPositions:!0,logVelocities:!0,logAlpha:!0,logRepulsion:!0,logAttraction:!0,logCentering:!0,logBarnesHut:!0,logFPS:!0,logIterations:!0,logNodeCount:!0})}disableAllLogging(){this.set({...hn})}shouldLog(){return this.iteration%this.config.logInterval===0}incrementIteration(){this.iteration++}resetIteration(){this.iteration=0}trackPosition(t,e,n){if(!this.config.logPositionHistory)return;this.positionHistory.has(t)||this.positionHistory.set(t,[]);const r=this.positionHistory.get(t);r.push({x:e,y:n,iteration:this.iteration}),r.length>this.config.positionHistorySize&&r.shift()}getPositionHistory(t){return this.positionHistory.get(t)||[]}calculateNodeDistribution(t){if(0===t.length)return null;const e={x:t.reduce((t,e)=>t+e.x,0)/t.length,y:t.reduce((t,e)=>t+e.y,0)/t.length},n=t.map(t=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))),r=Math.min(...n),i=Math.max(...n),a=n.reduce((t,e)=>t+e,0)/n.length,o=Math.sqrt(n.reduce((t,e)=>t+Math.pow(e-a,2),0)/n.length),s=n.filter(t=>t<100).length,l=n.filter(t=>t>500).length;return{centroid:e,minDist:r,maxDist:i,avgDist:a,stdDev:o,clusteredCount:s,spreadCount:l,clusteringPercentage:s/t.length*100,spreadPercentage:l/t.length*100}}logDistribution(t,e){const n=this.calculateNodeDistribution(e);n&&n.clusteringPercentage}};function vn({node:t}){const e=r.useRef(null),[a,o]=r.useState(!1),[s,c]=r.useState(null),d=i(),{selectNode:h,hoverNode:p,selectedNode:v}=Z(),{settings:g}=dn(),m=v===t.id,y=t.properties?.instances||0,x=(y>0?.1*Math.sqrt(y)+1.6:1.6)*g.nodeScale;return l(()=>{if(e.current&&!t.pinned){const n=new f(t.position.x,t.position.y,t.position.z);e.current.position.lerp(n,.1)}}),n.jsxs("group",{children:[n.jsx(un,{ref:e,args:[x,32],position:[t.position.x,t.position.y,t.position.z],onPointerDown:t=>{c({x:t.clientX,y:t.clientY})},onClick:e=>{if(e.stopPropagation(),s){if(Math.sqrt(Math.pow(e.clientX-s.x,2)+Math.pow(e.clientY-s.y,2))>5)return void c(null)}c(null),2===e.detail||e.metaKey||e.ctrlKey?d(`/page/${encodeURIComponent(t.label)}`):h(m?null:t.id)},onPointerOver:e=>{e.stopPropagation(),o(!0),p(t.id),document.body.style.cursor="pointer",e.object&&e.object.el&&(e.object.el.title=`${t.label}

Double-click or Ctrl+Click to open page`)},onPointerOut:()=>{o(!1),p(null),document.body.style.cursor="auto"},children:n.jsx("meshBasicMaterial",{color:m?"#67bc0f":a?"#8cd0f0":"#aaccee",transparent:!0,opacity:t.opacity||1})}),n.jsx(un,{args:[x+2,32],position:[t.position.x,t.position.y,t.position.z-.1],children:n.jsx("meshBasicMaterial",{color:m?"#67bc0f":"#333",transparent:!0,opacity:m?.5:.2,side:u})}),g.showLabels&&n.jsx(nn,{position:[t.position.x,t.position.y-x-3,t.position.z+1],fontSize:1.4,color:"#333",anchorX:"center",anchorY:"middle",maxWidth:4*x,textAlign:"center",children:t.label}),g.showNodeDetails&&y>0&&n.jsx(nn,{position:[t.position.x,t.position.y,t.position.z+2],fontSize:1,color:"#666",anchorX:"center",anchorY:"middle",children:y}),m&&n.jsx(un,{args:[x+8,32],position:[t.position.x,t.position.y,t.position.z-.2],children:n.jsx("meshBasicMaterial",{color:"#67bc0f",transparent:!0,opacity:.3,side:u})}),a&&!m&&n.jsx(un,{args:[x+5,32],position:[t.position.x,t.position.y,t.position.z-.15],children:n.jsx("meshBasicMaterial",{color:"#8cd0f0",transparent:!0,opacity:.2,side:u})})]})}function gn({edge:t}){const{nodes:e,selectedEdge:i}=Z(),{settings:a}=dn(),o=i===t.id,s=e.get(t.source),l=e.get(t.target),c=r.useMemo(()=>{if(!s||!l)return null;if(!s.position||!l.position)return null;const t=s.position.x,e=s.position.y,n=s.position.z,r=l.position.x,i=l.position.y,a=l.position.z;return"number"!=typeof t||"number"!=typeof e||"number"!=typeof n||"number"!=typeof r||"number"!=typeof i||"number"!=typeof a||isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a)?null:[new f(t,e,n),new f(r,i,a)]},[s,l]);if(!c||!s||!l)return null;const u=()=>{if(o)return"#67bc0f";switch(t.type){case"subclass":return"#444";case"objectProperty":default:return"#999";case"datatypeProperty":return"#666";case"disjoint":return"#ff6666"}},d=()=>("subclass"===t.type?3:2)*a.edgeWidth,h=()=>{if("disjoint"===t.type)return[5,5]},p=r.useMemo(()=>new f((c[0].x+c[1].x)/2,(c[0].y+c[1].y)/2,(c[0].z+c[1].z)/2+1),[c]),v=r.useMemo(()=>(new f).subVectors(c[1],c[0]).normalize(),[c]);return n.jsxs("group",{children:[n.jsx(Gt,{points:c,color:u(),lineWidth:d(),transparent:!0,opacity:t.opacity||.6,dashed:!!h(),dashSize:h()?.[0],gapSize:h()?.[1]}),a.showLabels&&t.label&&n.jsx(nn,{position:p,fontSize:10,color:"#666",anchorX:"center",anchorY:"middle",maxWidth:200,textAlign:"center",backgroundColor:"rgba(255, 255, 255, 0.8)",padding:.05,children:t.label}),"disjoint"!==t.type&&n.jsxs("mesh",{position:[l.position.x-25*v.x,l.position.y-25*v.y,l.position.z],rotation:[0,0,Math.atan2(v.y,v.x)],children:[n.jsx("coneGeometry",{args:[5,10,8]}),n.jsx("meshBasicMaterial",{color:u(),transparent:!0,opacity:t.opacity||.6})]}),o&&n.jsx(Gt,{points:c,color:"#67bc0f",lineWidth:d()+4,transparent:!0,opacity:.3})]})}function mn(){const{nodes:t,edges:i,filteredNodes:a,filteredEdges:o}=Z(),{isRunning:s,alpha:c}=function(t={}){const{autoStart:n=!0,iterations:i}=t,a=r.useRef(null),[o,s]=r.useState(!1),[c,u]=r.useState(!1),[f,d]=r.useState(1),{nodes:h,edges:p,updateNodePosition:v}=Z(),{settings:g}=dn();return r.useEffect(()=>{let t=!0;return async function(){try{const n=await e(()=>import("./webvowl_wasm-Cu8mNxsR.js"),[]);if(await n.default(),!t)return;a.current=new n.WebVowl,s(!0),a.current.setCenter(0,0),a.current.setLinkDistance(g.linkDistance),a.current.setChargeStrength(g.chargeStrength)}catch(n){}}(),()=>{t=!1,a.current&&(a.current=null)}},[]),r.useRef(0),r.useEffect(()=>{if(!a.current||!o)return;if(0===h.size)return;const t=new Set(Array.from(h.values()).map(t=>t.id)),e=Array.from(p.values()).filter(e=>{const n=e.source&&t.has(e.source),r=e.target&&t.has(e.target);return n&&r}),r={header:{title:{en:"Ontology Graph"}},namespace:[],class:Array.from(h.values()).map(t=>({id:t.id,type:t.type})),classAttribute:Array.from(h.values()).map(t=>({id:t.id,label:{en:t.label},iri:t.iri})),property:e.map(t=>({id:t.id,type:"objectProperty"===t.type?"owl:ObjectProperty":"owl:DatatypeProperty",domain:t.source,range:t.target,label:t.label||t.id,iri:t.iri||`http://example.org/${t.id}`}))};try{const t=r.property.filter(t=>!t.domain||!t.range);if(t.length>0)throw new Error(`Invalid properties: ${t.map(t=>t.id).join(", ")}`);r.property.length>0&&r.property[0],r.property.find(t=>"1244"===t.id),a.current.loadOntology(JSON.stringify(r)),a.current.initSimulation(),n&&(i?(a.current.runSimulation(i),u(!1)):u(!0))}catch(s){}},[h,p,o,n,i]),r.useEffect(()=>{a.current&&(a.current.setLinkDistance(g.linkDistance),a.current.setChargeStrength(g.chargeStrength))},[g.linkDistance,g.chargeStrength]),l(()=>{const t=a.current;if(t&&c)try{if(t.isFinished())return u(!1),void d(0);t.tick();const e=t.getAlpha();d(e);const n=t.getGraphData();n&&n.nodes&&n.nodes.forEach(t=>{v(t.id,[t.x,t.y,0])})}catch(e){u(!1)}}),{isInitialized:o,isRunning:c,alpha:f,start:()=>{a.current&&!c&&u(!0)},stop:()=>{u(!1)},reset:()=>{a.current&&(a.current.initSimulation(),d(1),n&&u(!0))},step:()=>{if(a.current&&!c){a.current.tick();const t=a.current.getGraphData();t&&t.nodes&&t.nodes.forEach(t=>{v(t.id,[t.x,t.y,0])}),d(a.current.getAlpha())}},checkNodeClick:(t,e)=>null}}({autoStart:!0}),u=Array.from(t.values()).filter(t=>a.has(t.id)),f=Array.from(i.values()).filter(t=>o.has(t.id));return n.jsxs("group",{children:[f.map(t=>n.jsx(gn,{edge:t},t.id)),u.map(t=>n.jsx(vn,{node:t},t.id)),s&&n.jsx(ht,{position:[0,250,0],center:!0,style:{pointerEvents:"none",userSelect:"none"},children:n.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.7)",color:"white",padding:"8px 16px",borderRadius:"4px",fontSize:"14px",fontFamily:"system-ui, sans-serif"},children:["Simulating... ",(100*c).toFixed(0),"%"]})}),0===t.size&&n.jsx(ht,{center:!0,children:n.jsxs("div",{style:{textAlign:"center",color:"#999",fontSize:"18px",fontFamily:"system-ui, sans-serif"},children:[n.jsx("h2",{children:"No ontology loaded"}),n.jsx("p",{children:"Drop a JSON file or select from the menu"})]})})]})}function yn(){const{viewport:t}=dn(),e="3d"===t.mode;return n.jsx("div",{style:{width:"100%",height:"100vh",background:"#f5f5f5"},children:n.jsxs(J,{gl:{antialias:!0,alpha:!0,powerPreference:"high-performance"},dpr:[1,2],children:[n.jsx(on,{makeDefault:!0,position:e?[0,300,500]:[0,0,500],fov:50}),n.jsx(Q,{enableDamping:!0,dampingFactor:.05,minDistance:50,maxDistance:2e3,enableRotate:e,enablePan:!0,mouseButtons:{LEFT:2,MIDDLE:1,RIGHT:0}}),n.jsx("ambientLight",{intensity:.6}),n.jsx("directionalLight",{position:[10,10,5],intensity:.5}),n.jsx("pointLight",{position:[-10,-10,-5],intensity:.3}),e&&n.jsx(ln,{args:[1e3,1e3],cellColor:"#cccccc",sectionColor:"#aaaaaa",fadeDistance:800,fadeStrength:1}),n.jsx(mn,{})]})})}xn=function(){const{nodeId:t}=o(),e=i(),[s,l]=r.useState(!0),[c,u]=r.useState(null),f=Z(t=>t.setSelectedNode),d=Z(t=>t.loadOntology),h=Z(t=>t.nodes.size),[p,v]=function(){const[t,e]=a();return[{zoom:parseFloat(t.get("zoom")||"1"),rotation:t.get("rotation")?.split(",").map(Number)||[0,0,0],selectedNode:t.get("selected")||null},r.useCallback(t=>{e(e=>{const n=new URLSearchParams(e);return void 0!==t.zoom&&n.set("zoom",t.zoom.toString()),void 0!==t.rotation&&n.set("rotation",t.rotation.join(",")),void 0!==t.selectedNode&&(null===t.selectedNode?n.delete("selected"):n.set("selected",t.selectedNode)),n},{replace:!0})},[e])]}();r.useEffect(()=>{(async()=>{if(h>0)l(!1);else try{const t=await fetch("/data/ontology.json");if(!t.ok)throw new Error(`Failed to fetch ontology: ${t.status} ${t.statusText}`);const e=await t.json();if(!e.class||!Array.isArray(e.class))throw new Error("Invalid ontology format: missing class array");const n={header:e.header,namespace:e.namespace,class:e.class,property:e.property||[],datatype:e.datatype,classAttribute:e.classAttribute,propertyAttribute:e.propertyAttribute};d(n),l(!1)}catch(t){u(t instanceof Error?t.message:"Unknown error"),l(!1)}})()},[d,h]),r.useEffect(()=>{t&&f(t)},[t,f]);return s?n.jsx("div",{className:"ontology-view loading",children:n.jsxs("div",{className:"loading-container",children:[n.jsx("div",{className:"spinner"}),n.jsx("p",{children:"Loading ontology visualization..."})]})}):c?n.jsx("div",{className:"ontology-view error",children:n.jsxs("div",{className:"error-container",children:[n.jsx("h2",{children:"Failed to Load Ontology"}),n.jsx("p",{children:c}),n.jsx("button",{onClick:()=>window.location.reload(),children:"Retry"})]})}):n.jsx("div",{className:"ontology-view",children:n.jsx(yn,{onNodeClick:t=>{const n=Z.getState().nodes.get(t);n?.label&&(v({selectedNode:t}),e(`/page/${encodeURIComponent(n.label)}`))}})})};"undefined"!=typeof window&&(window.wasmvowlDebug=pn)});export{xn as default,__tla};